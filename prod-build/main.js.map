{"version":3,"file":"main.js","mappings":"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","sources":["webpack://cpc_erp/./models/ sync","webpack://cpc_erp/./models/ sync nonrecursive \\.js$","webpack://cpc_erp/./configs/db.config.js","webpack://cpc_erp/./middlewares/asyncMiddleware.js","webpack://cpc_erp/./middlewares/cloudinaryUpload.js","webpack://cpc_erp/./middlewares/errorHandler.js","webpack://cpc_erp/./middlewares/fileUploadMiddleware.js","webpack://cpc_erp/./middlewares/hasRole.js","webpack://cpc_erp/./middlewares/responseFormatter.js","webpack://cpc_erp/./middlewares/tokenValidator.js","webpack://cpc_erp/./middlewares/validateRequest.js","webpack://cpc_erp/./models/Department.js","webpack://cpc_erp/./models/Dispatch.js","webpack://cpc_erp/./models/DispatchItem.js","webpack://cpc_erp/./models/Invoice.js","webpack://cpc_erp/./models/InvoiceItem.js","webpack://cpc_erp/./models/Item.js","webpack://cpc_erp/./models/ItemGroup.js","webpack://cpc_erp/./models/LogbookEntry.js","webpack://cpc_erp/./models/MachineCategory.js","webpack://cpc_erp/./models/MachineServiceInterval.js","webpack://cpc_erp/./models/MachineTransfer.js","webpack://cpc_erp/./models/Machinery.js","webpack://cpc_erp/./models/MachineryItemCode.js","webpack://cpc_erp/./models/MaintenanceLog.js","webpack://cpc_erp/./models/MaterialIssue.js","webpack://cpc_erp/./models/MaterialIssueItem.js","webpack://cpc_erp/./models/Notification.js","webpack://cpc_erp/./models/NotificationReadStatus.js","webpack://cpc_erp/./models/NotificationRole.js","webpack://cpc_erp/./models/Payment.js","webpack://cpc_erp/./models/PrimaryCategory.js","webpack://cpc_erp/./models/Procurement.js","webpack://cpc_erp/./models/ProcurementItem.js","webpack://cpc_erp/./models/QuotationComparison.js","webpack://cpc_erp/./models/QuotationComparisonItem.js","webpack://cpc_erp/./models/QuotationComparisonRate.js","webpack://cpc_erp/./models/QuotationComparisonVendor.js","webpack://cpc_erp/./models/QuotationComparisonVersion.js","webpack://cpc_erp/./models/Requisition.js","webpack://cpc_erp/./models/RequisitionItem.js","webpack://cpc_erp/./models/RequisitionSiteRejection.js","webpack://cpc_erp/./models/Role.js","webpack://cpc_erp/./models/Site.js","webpack://cpc_erp/./models/SiteInventory.js","webpack://cpc_erp/./models/StockLog.js","webpack://cpc_erp/./models/Unit.js","webpack://cpc_erp/./models/User.js","webpack://cpc_erp/./models/Vendor.js","webpack://cpc_erp/./models/index.js","webpack://cpc_erp/./src/Item/item.controller.js","webpack://cpc_erp/./src/Item/item.routes.js","webpack://cpc_erp/./src/Item/item.service.js","webpack://cpc_erp/./src/Item/item.validator.js","webpack://cpc_erp/./src/ItemGroup/itemGroup.controller.js","webpack://cpc_erp/./src/ItemGroup/itemGroup.routes.js","webpack://cpc_erp/./src/ItemGroup/itemGroup.service.js","webpack://cpc_erp/./src/ItemGroup/itemGroup.validator.js","webpack://cpc_erp/./src/Unit/unit.controller.js","webpack://cpc_erp/./src/Unit/unit.routes.js","webpack://cpc_erp/./src/Unit/unit.service.js","webpack://cpc_erp/./src/Unit/unit.validator.js","webpack://cpc_erp/./src/auth/auth.controller.js","webpack://cpc_erp/./src/auth/auth.routes.js","webpack://cpc_erp/./src/auth/auth.validator.js","webpack://cpc_erp/./src/category/category.controller.js","webpack://cpc_erp/./src/category/category.routes.js","webpack://cpc_erp/./src/category/category.service.js","webpack://cpc_erp/./src/category/category.validator.js","webpack://cpc_erp/./src/cronJobs/index.js","webpack://cpc_erp/./src/cronJobs/tasks/checkDocumentExpiry.js","webpack://cpc_erp/./src/cronJobs/tasks/checkLowStockItems.js","webpack://cpc_erp/./src/cronJobs/tasks/checkMachineMaintenanceAlerts.js","webpack://cpc_erp/./src/cronJobs/tasks/checkScheduledMaintenance.js","webpack://cpc_erp/./src/cronJobs/tasks/index.js","webpack://cpc_erp/./src/dashboard/dashboard.controller.js","webpack://cpc_erp/./src/dashboard/dashboard.routes.js","webpack://cpc_erp/./src/dashboard/dashboard.service.js","webpack://cpc_erp/./src/dashboard/dashboard.validator.js","webpack://cpc_erp/./src/events/index.js","webpack://cpc_erp/./src/file/file.controller.js","webpack://cpc_erp/./src/file/file.routes.js","webpack://cpc_erp/./src/file/file.service.js","webpack://cpc_erp/./src/inventory/inventory.controller.js","webpack://cpc_erp/./src/inventory/inventory.routes.js","webpack://cpc_erp/./src/inventory/inventory.service.js","webpack://cpc_erp/./src/inventory/inventory.validator.js","webpack://cpc_erp/./src/invoice/invoice.controller.js","webpack://cpc_erp/./src/invoice/invoice.routes.js","webpack://cpc_erp/./src/invoice/invoice.service.js","webpack://cpc_erp/./src/invoice/invoice.validator.js","webpack://cpc_erp/./src/logbook/logbook.controller.js","webpack://cpc_erp/./src/logbook/logbook.routes.js","webpack://cpc_erp/./src/machineTransfer/transfer.controller.js","webpack://cpc_erp/./src/machineTransfer/transfer.routes.js","webpack://cpc_erp/./src/machineTransfer/transfer.service.js","webpack://cpc_erp/./src/machinery/machinery.controller.js","webpack://cpc_erp/./src/machinery/machinery.routes.js","webpack://cpc_erp/./src/machinery/machinery.service.js","webpack://cpc_erp/./src/machinery/machinery.validator.js","webpack://cpc_erp/./src/machineryItemCode/machineryItemCode.controller.js","webpack://cpc_erp/./src/machineryItemCode/machineryItemCode.routes.js","webpack://cpc_erp/./src/machineryItemCode/machineryItemCode.service.js","webpack://cpc_erp/./src/machineryItemCode/machineryItemCode.validator.js","webpack://cpc_erp/./src/maintanance/machineServiceInterval.controller.js","webpack://cpc_erp/./src/maintanance/machineServiceInterval.routes.js","webpack://cpc_erp/./src/maintanance/machineServiceInterval.service.js","webpack://cpc_erp/./src/maintanance/machineServiceInterval.validator.js","webpack://cpc_erp/./src/maintanance/maintanance.controller.js","webpack://cpc_erp/./src/maintanance/maintanance.routes.js","webpack://cpc_erp/./src/maintanance/maintanance.service.js","webpack://cpc_erp/./src/maintanance/maintanance.validator.js","webpack://cpc_erp/./src/materialIssue/issue.controller.js","webpack://cpc_erp/./src/materialIssue/issue.routes.js","webpack://cpc_erp/./src/materialIssue/issue.service.js","webpack://cpc_erp/./src/materialIssue/issue.validator.js","webpack://cpc_erp/./src/notification/notification.controller.js","webpack://cpc_erp/./src/notification/notification.routes.js","webpack://cpc_erp/./src/notification/notification.service.js","webpack://cpc_erp/./src/procurement/procurement.controller.js","webpack://cpc_erp/./src/procurement/procurement.routes.js","webpack://cpc_erp/./src/procurement/procurement.service.js","webpack://cpc_erp/./src/procurement/procurement.validator.js","webpack://cpc_erp/./src/quotationComparison/quotationComparison.controller.js","webpack://cpc_erp/./src/quotationComparison/quotationComparison.routes.js","webpack://cpc_erp/./src/quotationComparison/quotationComparison.service.js","webpack://cpc_erp/./src/quotationComparison/quotationComparison.validator.js","webpack://cpc_erp/./src/reports/reports.controller.js","webpack://cpc_erp/./src/reports/reports.routes.js","webpack://cpc_erp/./src/reports/reports.service.js","webpack://cpc_erp/./src/reports/reports.validator.js","webpack://cpc_erp/./src/requisition/requisition.controller.js","webpack://cpc_erp/./src/requisition/requisition.routes.js","webpack://cpc_erp/./src/requisition/requisition.service.js","webpack://cpc_erp/./src/requisition/requisition.validator.js","webpack://cpc_erp/./src/site/site.controller.js","webpack://cpc_erp/./src/site/site.routes.js","webpack://cpc_erp/./src/site/site.service.js","webpack://cpc_erp/./src/site/site.validator.js","webpack://cpc_erp/./src/user/user.controller.js","webpack://cpc_erp/./src/user/user.routes.js","webpack://cpc_erp/./src/user/user.service.js","webpack://cpc_erp/./src/user/user.validator.js","webpack://cpc_erp/./src/vendor/vendor.controller.js","webpack://cpc_erp/./src/vendor/vendor.routes.js","webpack://cpc_erp/./src/vendor/vendor.service.js","webpack://cpc_erp/./src/vendor/vendor.validator.js","webpack://cpc_erp/./utils/cloudinary.js","webpack://cpc_erp/./utils/logger.js","webpack://cpc_erp/./utils/roles.js","webpack://cpc_erp/external commonjs \"bcryptjs\"","webpack://cpc_erp/external commonjs \"cloudinary\"","webpack://cpc_erp/external commonjs \"cookie-parser\"","webpack://cpc_erp/external commonjs \"cors\"","webpack://cpc_erp/external commonjs \"dotenv\"","webpack://cpc_erp/external commonjs \"express\"","webpack://cpc_erp/external commonjs \"express-rate-limit\"","webpack://cpc_erp/external commonjs \"helmet\"","webpack://cpc_erp/external commonjs \"joi\"","webpack://cpc_erp/external commonjs \"jsonwebtoken\"","webpack://cpc_erp/external commonjs \"moment\"","webpack://cpc_erp/external commonjs \"multer\"","webpack://cpc_erp/external commonjs \"multer-storage-cloudinary\"","webpack://cpc_erp/external commonjs \"node-cron\"","webpack://cpc_erp/external commonjs \"sequelize\"","webpack://cpc_erp/external commonjs \"sequelize-joi\"","webpack://cpc_erp/external commonjs \"winston\"","webpack://cpc_erp/external node-commonjs \"fs\"","webpack://cpc_erp/external node-commonjs \"path\"","webpack://cpc_erp/external node-commonjs \"process\"","webpack://cpc_erp/external node-commonjs \"stream\"","webpack://cpc_erp/external node-commonjs \"zlib\"","webpack://cpc_erp/webpack/bootstrap","webpack://cpc_erp/webpack/runtime/hasOwnProperty shorthand","webpack://cpc_erp/./app.js"],"sourcesContent":["function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = () => ([]);\nwebpackEmptyContext.resolve = webpackEmptyContext;\nwebpackEmptyContext.id = 1537;\nmodule.exports = webpackEmptyContext;","var map = {\n\t\"./Department.js\": 5,\n\t\"./Dispatch.js\": 8809,\n\t\"./DispatchItem.js\": 3686,\n\t\"./Invoice.js\": 812,\n\t\"./InvoiceItem.js\": 9167,\n\t\"./Item.js\": 6064,\n\t\"./ItemGroup.js\": 9637,\n\t\"./LogbookEntry.js\": 3262,\n\t\"./MachineCategory.js\": 9422,\n\t\"./MachineServiceInterval.js\": 3866,\n\t\"./MachineTransfer.js\": 7509,\n\t\"./Machinery.js\": 1103,\n\t\"./MachineryItemCode.js\": 4441,\n\t\"./MaintenanceLog.js\": 5832,\n\t\"./MaterialIssue.js\": 6215,\n\t\"./MaterialIssueItem.js\": 1468,\n\t\"./Notification.js\": 6800,\n\t\"./NotificationReadStatus.js\": 8778,\n\t\"./NotificationRole.js\": 7460,\n\t\"./Payment.js\": 2477,\n\t\"./PrimaryCategory.js\": 2709,\n\t\"./Procurement.js\": 5213,\n\t\"./ProcurementItem.js\": 7090,\n\t\"./QuotationComparison.js\": 3452,\n\t\"./QuotationComparisonItem.js\": 2319,\n\t\"./QuotationComparisonRate.js\": 7078,\n\t\"./QuotationComparisonVendor.js\": 7710,\n\t\"./QuotationComparisonVersion.js\": 4690,\n\t\"./Requisition.js\": 4299,\n\t\"./RequisitionItem.js\": 3992,\n\t\"./RequisitionSiteRejection.js\": 6989,\n\t\"./Role.js\": 6003,\n\t\"./Site.js\": 8516,\n\t\"./SiteInventory.js\": 8362,\n\t\"./StockLog.js\": 3999,\n\t\"./Unit.js\": 6109,\n\t\"./User.js\": 5596,\n\t\"./Vendor.js\": 4197,\n\t\"./index.js\": 9239\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 2979;","module.exports = {\n  prod: {\n    username: process.env.DB_USERNAME,\n    password: process.env.DB_PASSWORD,\n    database: process.env.DB_NAME,\n    host: process.env.DB_HOST,\n    dialect: process.env.DB_DIALECT,\n    logging: false,\n  },\n  dev: {\n    username: process.env.DB_USERNAME,\n    password: process.env.DB_PASSWORD,\n    database: process.env.DB_NAME,\n    host: process.env.DB_HOST,\n    port: process.env.DB_PORT,\n    dialect: \"postgres\",\n    logging: false,\n    dialectOptions: {\n      ssl: {\n        require: true, // This will help you. But you will see nwe error\n        rejectUnauthorized: false // This line will fix new error\n      }\n    },\n  },\n};\n","function asyncMiddleware(handler) {\n    return async (req, res, next) => {\n      try {\n        await handler(req, res, next);\n      } catch (err) {\n        next(err);\n      }\n    };\n  }\n  \n  module.exports = asyncMiddleware;\n  ","const multer = require(\"multer\");\nconst cloudinary = require(\"./../utils/cloudinary\");\n\n// For older versions (v1.x)\nconst storage = require(\"multer-storage-cloudinary\");\n\nconst cloudinaryStorage = storage({\n  cloudinary: cloudinary,\n  params: {\n    folder: \"hekopay_logos\",\n    allowedFormats: [\"jpg\", \"jpeg\", \"png\", \"webp\"],\n    public_id: (req, file) => `user_${req.params.id}_logo`,\n  },\n});\n\nconst upload = multer({ storage: cloudinaryStorage });\n\nmodule.exports = upload;","const logger = require(\"../utils/logger\"); // Adjust path as needed\n\nasync function errorHandler(err, req, res, next) {\n  let statusCode = err.statusCode || 500;\n  // const endpoint = req.originalUrl; // Gets the triggered API endpoint\n  // const method = req.method;\n  // const requestBody = JSON.stringify(req.body); // Convert body to string for logging\n\n  // if (statusCode === 500) {\n  //   // Log internal server errors\n  //   logger.error(`Internal Server Error: ${err} | Endpoint: ${method} ${endpoint} | Request Body: ${requestBody}`);\n  // } else {\n  //   // Log client errors\n  //   logger.warn(`Client Error: ${err} | Endpoint: ${method} ${endpoint} | Request Body: ${requestBody}`);\n  // }\n\n  // Send error response\n  res.sendError(err, statusCode);\n}\n\nmodule.exports = errorHandler;\n","const multer = require(\"multer\");\nconst cloudinary = require(\"cloudinary\").v2;\nconst { Readable } = require(\"stream\");\n\n// Configure Cloudinary\ncloudinary.config({\n  cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\n  api_key: process.env.CLOUDINARY_API_KEY,\n  api_secret: process.env.CLOUDINARY_API_SECRET,\n});\n\n// Configure Multer to store files in memory\nconst upload = multer({ storage: multer.memoryStorage() });\n\n/**\n * Uploads a file to Cloudinary\n * @param {Object} file - The file object from Multer\n * @param {string} folder - Folder name in Cloudinary\n * @returns {Promise<string|null>} - Public URL of uploaded file\n */\nasync function uploadFileToCloudinary(file, folder, field, oldFileUrl = null) {\n  if (!file) return null; // Skip if no file provided\n\n  // Optional: Delete old file from Cloudinary\n  if (oldFileUrl) {\n    const publicId = oldFileUrl.split(\"/\").pop().split(\".\")[0]; // Extract public ID\n    await cloudinary.uploader.destroy(publicId);\n  }\n\n  return new Promise((resolve, reject) => {\n    const stream = cloudinary.uploader.upload_stream(\n      { folder },\n      (error, result) => {\n        if (error) return reject(error);\n        resolve({ field, url: result.secure_url });\n      }\n    );\n\n    Readable.from(file.buffer).pipe(stream);\n  });\n}\n\n/**\n * Middleware to handle file uploads and store file URLs in req.fileData\n * @param {string[]} fileFields - Array of expected file field names\n * @param {string} folder - Cloudinary folder name\n */\nfunction fileUploadMiddleware(\n  fileFields,\n  folder = \"uploads\",\n  subFolder,\n  getExistingFiles\n) {\n  return async (req, res, next) => {\n    try {\n      if (!req.files) return next();\n\n      req.fileData = {};\n\n      // Determine full upload path\n      const uploadPath = subFolder ? `${folder}/${subFolder}` : folder;\n\n      // Optionally load existing files (e.g., for replacements)\n      let existingFiles = undefined;\n      if (typeof getExistingFiles === \"function\") {\n        try {\n          existingFiles = await getExistingFiles(req);\n        } catch (e) {\n          // If fetching existing files fails, proceed without them\n          existingFiles = undefined;\n        }\n      }\n\n      // Normalize a field's files to an array of file objects\n      const toArray = (maybeArray) => {\n        if (!maybeArray) return [];\n        return Array.isArray(maybeArray) ? maybeArray : [maybeArray];\n      };\n\n      // Build upload promises for each field, supporting multiple files\n      const uploadPromises = [];\n\n      for (const field of fileFields) {\n        const incoming = req.files[field]; // could be undefined | file | file[]\n        const files = toArray(incoming); // always an array now\n\n        if (files.length === 0) continue;\n\n        // Determine old files for this field (could be string or array)\n        const oldForField = existingFiles?.[field];\n\n        // If multiple files uploaded, pass oldFileUrl per index (optional logic)\n        // Strategy:\n        // - If oldForField is an array, align by index; otherwise, pass null for multiples.\n        // - For single upload, keep previous behavior.\n        files.forEach((file, idx) => {\n          const oldUrl = Array.isArray(oldForField)\n            ? oldForField[idx] ?? null\n            : (idx === 0 && typeof oldForField === \"string\" ? oldForField : null);\n\n          uploadPromises.push(\n            uploadFileToCloudinary(file, uploadPath, field, oldUrl).then((res) => ({\n              field,\n              url: res?.url,\n            }))\n          );\n        });\n      }\n\n      if (uploadPromises.length === 0) {\n        return next();\n      }\n\n      const uploaded = await Promise.all(uploadPromises);\n\n      // Aggregate results by field: if multiple files arrive for a field, store an array\n      const aggregated = {};\n      for (const { field, url } of uploaded) {\n        if (!url) continue;\n        if (!aggregated[field]) aggregated[field] = [];\n        aggregated[field].push(url);\n      }\n\n      // Decide per field whether to store a single string or an array\n      for (const field of Object.keys(aggregated)) {\n        const urls = aggregated[field];\n        req.fileData[field] = urls.length === 1 ? urls[0] : urls;\n      }\n\n      next();\n    } catch (error) {\n      res\n        .status(500)\n        .send({ message: \"Error uploading files to Cloudinary\", error });\n    }\n  };\n}\n\nmodule.exports = { upload, fileUploadMiddleware };\n","function hasRole(allowedRoles) {\n    return (req, res, next) => {\n        if (!req.user || !allowedRoles.includes(req.user.roleId)) {\n            return res.sendError({ message: 'Forbidden: Insufficient permissions', name: \"PermissionDeniedError\" }, 403);\n        }\n        next();\n    };\n}\n\nmodule.exports = hasRole;","const zlib = require(\"zlib\");\n\nfunction responseFormatter(req, res, next) {\n  // Success response\n  res.sendResponse = (data, message = \"Success\", statusCode = 200) => {\n    const response = {\n      status: true,\n      message,\n      data,\n      timestamp: new Date().toISOString(),\n    };\n\n    handleCompression(req, res, response, statusCode);\n  };\n\n  // Error response\n  res.sendError = (error, statusCode = 500) => {\n    const response = {\n      status: false,\n      message: error.message || \"An error occurred\",\n      error: {\n        name: error.name || \"Error\",\n        stack: process.env.NODE_ENV === \"dev\" ? error.stack : undefined,\n        details: error.details || null,\n      },\n      timestamp: new Date().toISOString(),\n    };\n\n    handleCompression(req, res, response, statusCode);\n  };\n\n  next();\n}\n\n// Helper function to handle compression\nfunction handleCompression(req, res, response, statusCode) {\n  const acceptEncoding = req.headers[\"accept-encoding\"] || \"\";\n  const jsonResponse = JSON.stringify(response);\n\n  if (acceptEncoding.includes(\"gzip\")) {\n    zlib.gzip(jsonResponse, (err, compressedData) => {\n      if (err) {\n        // console.error(\"Compression error:\", err);\n        res.status(500).send(\"Internal Server Error\");\n        return;\n      }\n      res.setHeader(\"Content-Encoding\", \"gzip\");\n      res.setHeader(\"Content-Type\", \"application/json\");\n      res.status(statusCode).send(compressedData);\n    });\n  } else {\n    res.setHeader(\"Content-Type\", \"application/json\");\n    res.status(statusCode).send(jsonResponse);\n  }\n}\n\nmodule.exports = responseFormatter;\n","const jwt = require(\"jsonwebtoken\");\nconst db = require(\"../models\");\n\nasync function tokenValidator(req, res, next) {\n  try {\n    const token = req.cookies.token;\n    if (!token) {\n      return res.sendError({ message: \"Access denied. No token provided.\",name:\"TokenNotFoundError\" }, 401);\n    }\n    const decoded = jwt.verify(token, process.env.JWT_SECRET);\n    req.user = decoded; // Attach decoded token to request object\n    const user = await db.User.findByPk(req.user.id);\n    if (!user) {\n      res.clearCookie(\"token\", {\n        httpOnly: false,\n        secure: true, // Match the same attributes used during cookie setting\n        sameSite: \"None\",\n      });\n      return res.sendError({ message: \"Access denied. User not found.\", name: \"UserNotFoundErro\" }, 401);\n    }\n    next(); // Proceed to the next middleware or route handler\n  } catch (err) {\n    err.statusCode = 401;\n    err.data = { tokenProvided: true };\n    return res.sendError(err, 401);\n  }\n}\n\nmodule.exports = tokenValidator;","const validateRequest =\n  (schema, source = \"body\") =>\n  (req, res, next) => {\n    const dataToValidate = req[source];\n\n    const { error } = schema.validate(dataToValidate, {\n      convert: true,\n      abortEarly: false,\n    });\n\n    if (error) {\n      const e = new Error();\n      e.name = \"Validation Error\";\n      e.message = error.details?.map((detail) => detail.message).join(\"\\n\");\n      throw e;\n    }\n\n    next();\n  };\n\nmodule.exports = validateRequest;\n","module.exports = (sequelize, DataTypes) => {\n  const Department = sequelize.define(\n    \"Department\",\n    {\n      id: {\n        type: DataTypes.INTEGER,\n        primaryKey: true,\n        autoIncrement: true,\n      },\n      name: {\n        type: DataTypes.STRING,\n        allowNull: false,\n        // unique: true, // Ensure no duplicate Departments\n      },\n    },\n    {\n      tableName: \"departments\", // Table name in your database\n      timestamps: true,\n      paranoid: true,\n    }\n  );\n  Department.associate = (models) => {\n    Department.belongsTo(models.User, {\n      foreignKey: \"id\",\n    });\n    Department.hasMany(models.Site, { foreignKey: \"id\" });\n  };\n  return Department;\n};\n","module.exports = (sequelize, DataTypes) => {\n    const Dispatch = sequelize.define(\n        \"Dispatch\",\n        {\n            vehicleNo: {\n                type: DataTypes.STRING,\n                allowNull: true,\n            },\n            driverName: {\n                type: DataTypes.STRING,\n                allowNull: true,\n            },\n            remarks: {\n                type: DataTypes.STRING,\n                allowNull: true,\n            },\n            procurementId: {\n                type: DataTypes.INTEGER,\n                allowNull: false,\n            },\n            fromSiteId: {\n                type: DataTypes.INTEGER,\n                allowNull: false,\n            },\n            toSiteId: {\n                type: DataTypes.INTEGER,\n                allowNull: false,\n            },\n            status: {\n                type: DataTypes.ENUM(\"dispatched\", \"received\"),\n                defaultValue: \"dispatched\",\n            },\n        },\n        {\n            tableName: \"dispatches\",\n            timestamps: true,\n        }\n    );\n\n    Dispatch.associate = (models) => {\n        Dispatch.belongsTo(models.Procurement, { foreignKey: \"procurementId\" });\n        Dispatch.belongsTo(models.Site, { as: \"fromSite\", foreignKey: \"fromSiteId\" });\n        Dispatch.belongsTo(models.Site, { as: \"toSite\", foreignKey: \"toSiteId\" });\n        Dispatch.hasMany(models.DispatchItem, { foreignKey: \"dispatchId\", as: \"items\" });\n    };\n\n    return Dispatch;\n};\n","module.exports = (sequelize, DataTypes) => {\n    const DispatchItem = sequelize.define(\n        \"DispatchItem\",\n        {\n            dispatchId: {\n                type: DataTypes.INTEGER,\n                allowNull: false,\n            },\n            itemId: {\n                type: DataTypes.INTEGER,\n                allowNull: false,\n            },\n            quantity: {\n                type: DataTypes.INTEGER,\n                allowNull: false,\n            },\n        },\n        {\n            tableName: \"dispatch_items\",\n            timestamps: true,\n        }\n    );\n\n    DispatchItem.associate = (models) => {\n        DispatchItem.belongsTo(models.Dispatch, { foreignKey: \"dispatchId\" });\n        DispatchItem.belongsTo(models.Item, { foreignKey: \"itemId\" });\n    };\n\n    return DispatchItem;\n};\n","// models/invoice.model.js\nmodule.exports = (sequelize, DataTypes) => {\n  const Invoice = sequelize.define(\n    \"Invoice\",\n    {\n      invoiceNumber: {\n        type: DataTypes.STRING,\n        allowNull: false,\n        unique: true,\n      },\n      invoiceDate: {\n        type: DataTypes.DATE,\n        allowNull: false,\n      },\n      amount: {\n        type: DataTypes.DECIMAL(12, 2),\n        allowNull: false,\n      },\n      status: {\n        type: DataTypes.ENUM(\n          \"DRAFT\",\n          \"SENT\",\n          \"PAID\",\n          \"PARTIALLY_PAID\",\n          \"CANCELLED\"\n        ),\n        defaultValue: \"DRAFT\",\n      },\n      files: {\n        type: DataTypes.JSONB,\n        allowNull: true,\n      },\n      notes: DataTypes.TEXT,\n      isInventoryUpdated: {\n        type: DataTypes.BOOLEAN,\n        defaultValue: false,\n      },\n    },\n    {\n      tableName: \"invoices\",\n      timestamps: true,\n    }\n  );\n\n  Invoice.associate = (models) => {\n    Invoice.belongsTo(models.Procurement, {\n      foreignKey: \"procurementId\",\n      as: \"procurement\",\n    });\n    Invoice.hasMany(models.Payment, {\n      foreignKey: \"invoiceId\",\n      as: \"payments\",\n    });\n    Invoice.hasMany(models.InvoiceItem, {\n      foreignKey: \"invoiceId\",\n      as: \"items\",\n    });\n  };\n\n  return Invoice;\n};\n","// models/InvoiceItem.js\nmodule.exports = (sequelize, DataTypes) => {\n  const InvoiceItem = sequelize.define(\n    \"InvoiceItem\",\n    {\n      invoiceId: { type: DataTypes.INTEGER, allowNull: false },\n      procurementItemId: { type: DataTypes.INTEGER, allowNull: false },\n      quantity: { type: DataTypes.INTEGER, allowNull: false },\n      rate: { type: DataTypes.DECIMAL(10, 2) },\n      amount: { type: DataTypes.DECIMAL(10, 2) },\n    },\n    {\n      tableName: \"invoice_items\",\n      timestamps: true,\n    }\n  );\n\n  InvoiceItem.associate = (models) => {\n    InvoiceItem.belongsTo(models.Invoice, { foreignKey: \"invoiceId\" });\n    InvoiceItem.belongsTo(models.ProcurementItem, {\n      foreignKey: \"procurementItemId\",\n    });\n  };\n\n  return InvoiceItem;\n};\n","module.exports = (sequelize, DataTypes) => {\n  const Item = sequelize.define(\n    \"Item\",\n    {\n      id: {\n        type: DataTypes.INTEGER,\n        autoIncrement: true,\n        allowNull: false,\n        primaryKey: true,\n      },\n      name: {\n        type: DataTypes.STRING,\n        allowNull: false,\n      },\n      shortName: {\n        type: DataTypes.STRING,\n        allowNull: true,\n      },\n      partNumber: {\n        type: DataTypes.STRING,\n        allowNull: true,\n      },\n      hsnCode: {\n        type: DataTypes.STRING,\n        allowNull: true,\n      },\n      itemGroupId: {\n        type: DataTypes.INTEGER,\n        allowNull: false,\n      },\n      unitId: {\n        type: DataTypes.INTEGER,\n        allowNull: false,\n      },\n    },\n    {\n      tableName: \"items\",\n      timestamps: false,\n    }\n  );\n\n  Item.associate = (models) => {\n    Item.belongsTo(models.ItemGroup, { foreignKey: \"itemGroupId\" });\n    Item.belongsTo(models.Unit, { foreignKey: \"unitId\" });\n    Item.hasMany(models.SiteInventory, { foreignKey: \"itemId\" });\n  };\n\n  return Item;\n};\n","module.exports = (sequelize, DataTypes) => {\n  const ItemGroup = sequelize.define(\n    \"ItemGroup\",\n    {\n      id: {\n        type: DataTypes.INTEGER,\n        autoIncrement: true,\n        primaryKey: true,\n      },\n      name: {\n        type: DataTypes.STRING,\n        allowNull: false,\n      },\n      shortName: {\n        type: DataTypes.STRING,\n        allowNull: true,\n      },\n      itemType: {\n        type: DataTypes.STRING,\n        allowNull: true,\n      },\n    },\n    {\n      tableName: \"item_groups\",\n      timestamps: false,\n    }\n  );\n\n  ItemGroup.associate = (models) => {\n    ItemGroup.hasMany(models.Item, { foreignKey: \"itemGroupId\" });\n  };\n\n  return ItemGroup;\n};\n","module.exports = (sequelize, DataTypes) => {\n    const LogbookEntry = sequelize.define(\n        \"LogbookEntry\",\n        {\n            id: { type: DataTypes.INTEGER, autoIncrement: true, primaryKey: true },\n            date: { type: DataTypes.DATE, allowNull: false },\n            machineId: { type: DataTypes.INTEGER, allowNull: false },\n            siteId: { type: DataTypes.INTEGER, allowNull: false },\n            location: { type: DataTypes.STRING, allowNull: true },\n            name: { type: DataTypes.STRING, allowNull: true, unique: true },\n            dieselOpeningBalance: { type: DataTypes.FLOAT, defaultValue: 0 },\n            dieselIssue: { type: DataTypes.FLOAT, defaultValue: 0 },\n            dieselClosingBalance: { type: DataTypes.FLOAT, defaultValue: 0 },\n            openingKmReading: { type: DataTypes.FLOAT, defaultValue: 0 },\n            closingKmReading: { type: DataTypes.FLOAT, defaultValue: 0 },\n            openingHrsMeter: { type: DataTypes.FLOAT, defaultValue: 0 },\n            closingHrsMeter: { type: DataTypes.FLOAT, defaultValue: 0 },\n            workingDetails: { type: DataTypes.TEXT, allowNull: true },\n            createdBy: { type: DataTypes.INTEGER, allowNull: false },\n            totalRunKM: { type: DataTypes.FLOAT, allowNull: true },\n            dieselAvgKM: { type: DataTypes.FLOAT, allowNull: true },\n            totalRunHrsMeter: { type: DataTypes.FLOAT, allowNull: true },\n            dieselAvgHrsMeter: { type: DataTypes.FLOAT, allowNull: true },\n            status: {\n                type: DataTypes.ENUM(\"Pending\", \"Approved\", \"Rejected\"),\n                defaultValue: \"Pending\",\n            },\n            approvedById: {\n                type: DataTypes.INTEGER,\n                allowNull: true,\n            },\n            approvedAt: {\n                type: DataTypes.DATE,\n                allowNull: true,\n            },\n            rejectedById: {\n                type: DataTypes.INTEGER,\n                allowNull: true,\n            },\n            rejectedAt: {\n                type: DataTypes.DATE,\n                allowNull: true,\n            },\n            rejectionRemarks: {\n                type: DataTypes.TEXT,\n                allowNull: true,\n            },\n        },\n        {\n            tableName: \"logbook_entries\",\n            timestamps: true,\n            hooks: {\n                afterCreate: async (logbookEntry, options) => {\n                    const newName = `LOG-${String(logbookEntry.id).padStart(3, \"0\")}`;\n                    await logbookEntry.update({ name: newName }, { transaction: options.transaction });\n                },\n            }\n        }\n    );\n\n    LogbookEntry.associate = (models) => {\n        LogbookEntry.belongsTo(models.Site, {\n            foreignKey: \"siteId\",\n            as: \"site\",\n        });\n        LogbookEntry.belongsTo(models.Machinery, {\n            foreignKey: \"machineId\",\n            as: \"machine\",\n        });\n        LogbookEntry.belongsTo(models.User, {\n            foreignKey: \"createdBy\",\n            as: \"creater\",\n        });\n        LogbookEntry.belongsTo(models.User, {\n            foreignKey: \"approvedById\",\n            as: \"approvedBy\",\n        });\n        LogbookEntry.belongsTo(models.User, {\n            foreignKey: \"rejectedById\",\n            as: \"rejectedBy\",\n        });\n    };\n    return LogbookEntry;\n};\n","module.exports = (sequelize, DataTypes) => {\n  const MachineCategory = sequelize.define(\n    \"MachineCategory\",\n    {\n      id: { type: DataTypes.INTEGER, primaryKey: true, autoIncrement: true },\n      name: { type: DataTypes.STRING, allowNull: false, unique:true },\n      primaryCategoryId: { type: DataTypes.INTEGER, allowNull: true },\n      averageBase: {\n        type: DataTypes.ENUM(\"Distance\", \"Time\", \"Both\", \"None\"),\n        allowNull: true,\n      },\n      standardKmRun: { type: DataTypes.FLOAT, allowNull: true },\n      standardMileage: { type: DataTypes.FLOAT, allowNull: true },\n      standardHrsRun: { type: DataTypes.FLOAT, allowNull: true },\n      ltrPerHour: { type: DataTypes.FLOAT, allowNull: true },\n      remarks: { type: DataTypes.TEXT, allowNull: true },\n      useFor: { type: DataTypes.STRING, allowNull: true },\n      machineType: {\n        type: DataTypes.ENUM(\"Vehicle\", \"Machine\", \"Drilling\"),\n        allowNull: true,\n      },\n      unitPerHour: { type: DataTypes.FLOAT, allowNull: true },\n      isApplicable: { type: DataTypes.JSON, allowNull: true },\n      other: { type: DataTypes.STRING, allowNull: true },\n    },\n    { tableName: \"machine_categories\", timestamps: true }\n  );\n\n  MachineCategory.associate = (models) => {\n    MachineCategory.belongsTo(models.PrimaryCategory, {\n      foreignKey: \"primaryCategoryId\",\n      as: \"primaryCategory\",\n    });\n\n    MachineCategory.hasMany(models.Machinery, {\n      foreignKey: \"machineCategoryId\",\n      as: \"machineries\",\n      onDelete: \"CASCADE\",\n    });\n  };\n\n  return MachineCategory;\n};\n","module.exports = (sequelize, DataTypes) => {\n  const MachineServiceInterval = sequelize.define(\n    \"MachineServiceInterval\",\n    {\n      id: {\n        type: DataTypes.INTEGER,\n        primaryKey: true,\n        autoIncrement: true,\n      },\n      machineId: {\n        type: DataTypes.INTEGER,\n        allowNull: false,\n        references: {\n          model: \"machineries\",\n          key: \"id\",\n        },\n        onDelete: \"CASCADE\",\n        onUpdate: \"CASCADE\",\n      },\n      serviceType: {\n        type: DataTypes.STRING,\n        allowNull: false,\n      },\n      intervalHours: {\n        type: DataTypes.INTEGER,\n        allowNull: false,\n      },\n      intervalKm: {\n        type: DataTypes.INTEGER,\n        allowNull: false,\n      },\n      intervalCalendarDays: {\n        type: DataTypes.INTEGER,\n        allowNull: false,\n      },\n      isActive: {\n        type: DataTypes.BOOLEAN,\n        defaultValue: true,\n      },\n      notes: {\n        type: DataTypes.TEXT,\n        allowNull: true,\n      },\n    },\n    {\n      tableName: \"machine_service_intervals\",\n      timestamps: true,\n    }\n  );\n\n  MachineServiceInterval.associate = (models) => {\n    MachineServiceInterval.belongsTo(models.Machinery, {\n      foreignKey: \"machineId\",\n      as: \"machine\",\n    });\n  };\n\n  return MachineServiceInterval;\n};\n","module.exports = (sequelize, DataTypes) => {\n  const MachineTransfer = sequelize.define(\n    \"MachineTransfer\",\n    {\n      id: {\n        type: DataTypes.INTEGER,\n        primaryKey: true,\n        autoIncrement: true,\n      },\n      name: {\n        type: DataTypes.STRING,\n        allowNull: true,\n        unique: true,\n      },\n      machineId: {\n        type: DataTypes.INTEGER,\n        allowNull: false,\n      },\n      currentSiteId: {\n        type: DataTypes.INTEGER,\n        allowNull: false,\n      },\n      destinationSiteId: {\n        type: DataTypes.INTEGER,\n        allowNull: true,\n      },\n      requestType: {\n        type: DataTypes.ENUM(\"Site Transfer\", \"Sell Machine\", \"Scrap Machine\"),\n        defaultValue: \"Site Transfer\",\n      },\n      status: {\n        type: DataTypes.ENUM(\n          \"Pending\",\n          \"Approved\",\n          \"Dispatched\",\n          \"Received\",\n          \"Rejected\"\n        ),\n        defaultValue: \"Pending\",\n      },\n      vehicleType: {\n        type: DataTypes.ENUM(\"self_carrying\", \"other_carrying\"),\n        allowNull: true,\n        defaultValue: \"other_carrying\",\n      },\n      selfCarryingVehicle: {\n        type: DataTypes.BOOLEAN,\n        defaultValue: false,\n      },\n      reason: DataTypes.STRING,\n      requestedBy: DataTypes.INTEGER,\n      approvedBy: DataTypes.INTEGER,\n      rejectedBy: DataTypes.INTEGER,\n      dispatchedBy: DataTypes.INTEGER,\n      receivedBy: DataTypes.INTEGER,\n      requestedAt: DataTypes.DATE,\n      approvedAt: DataTypes.DATE,\n      dispatchedAt: DataTypes.DATE,\n      receivedAt: DataTypes.DATE,\n      rejectedAt: DataTypes.DATE,\n      transportDetails: DataTypes.JSON,\n      scrapDetails: DataTypes.JSON,\n      buyerDetails: DataTypes.JSON,\n      itemsIncluded: DataTypes.JSON,\n      itemsReceived: DataTypes.JSON,\n      odometerReading: DataTypes.STRING,\n      fuelGaugeReading: DataTypes.STRING,\n      hrsMeter: DataTypes.STRING,\n      dispatchRemarks: DataTypes.STRING,\n      approveRemarks: DataTypes.STRING,\n      rejectionRemarks: { type: DataTypes.STRING },\n      finalRemarks: { type: DataTypes.STRING },\n      files: {\n        type: DataTypes.JSON,\n      },\n    },\n    {\n      tableName: \"machine_transfers\",\n      timestamps: true,\n      paranoid: true,\n      hooks: {\n        afterCreate: async (transfer, options) => {\n          let prefix = \"MT\"; // default\n\n          switch (transfer.requestType) {\n            case \"Sell Machine\":\n              prefix = \"MT-SL\";\n              break;\n            case \"Scrap Machine\":\n              prefix = \"MT-SCR\";\n              break;\n            case \"Site Transfer\":\n            default:\n              prefix = \"MT-TR\";\n              break;\n          }\n\n          const name = `${prefix}-${String(transfer.id).padStart(4, \"0\")}`;\n          await transfer.update({ name }, { transaction: options.transaction });\n        },\n      },\n    }\n  );\n\n  MachineTransfer.associate = (models) => {\n    MachineTransfer.belongsTo(models.Site, {\n      foreignKey: \"currentSiteId\",\n      as: \"currentSite\",\n    });\n    MachineTransfer.belongsTo(models.Site, {\n      foreignKey: \"destinationSiteId\",\n      as: \"destinationSite\",\n    });\n    MachineTransfer.belongsTo(models.Machinery, {\n      foreignKey: \"machineId\",\n      as: \"machine\",\n    });\n    MachineTransfer.belongsTo(models.User, {\n      foreignKey: \"requestedBy\",\n      as: \"requester\",\n    });\n    MachineTransfer.belongsTo(models.User, {\n      foreignKey: \"approvedBy\",\n      as: \"approver\",\n    });\n    MachineTransfer.belongsTo(models.User, {\n      foreignKey: \"dispatchedBy\",\n      as: \"dispatcher\",\n    });\n    MachineTransfer.belongsTo(models.User, {\n      foreignKey: \"receivedBy\",\n      as: \"receiver\",\n    });\n    MachineTransfer.belongsTo(models.User, {\n      foreignKey: \"rejectedBy\",\n      as: \"rejecter\",\n    });\n  };\n  return MachineTransfer;\n};\n","module.exports = (sequelize, DataTypes) => {\n  const Machinery = sequelize.define(\n    \"Machinery\",\n    {\n      id: { type: DataTypes.INTEGER, primaryKey: true, autoIncrement: true },\n      primaryCategoryId: { type: DataTypes.INTEGER, allowNull: true }, // Foreign Key for PrimaryCategory\n      machineCategoryId: { type: DataTypes.INTEGER, allowNull: true }, // Foreign Key for MachineCategory\n      erpCode: { type: DataTypes.STRING, allowNull: true, unique: true }, // ERP Code\n      registrationNumber: {\n        type: DataTypes.STRING,\n        allowNull: true,\n        unique: true,\n      }, // Registration Number\n      machineNumber: { type: DataTypes.STRING, allowNull: true, unique: true }, // Machine Number\n      machineCode: { type: DataTypes.STRING, allowNull: true, unique: true }, // Machine Code\n      chassisNumber: { type: DataTypes.STRING, allowNull: true, unique: true }, // Chassis Number\n      engineNumber: { type: DataTypes.STRING, allowNull: true, unique: true }, // Engine Number\n      serialNumber: { type: DataTypes.STRING, allowNull: true, unique: true }, // Serial Number\n      model: { type: DataTypes.STRING, allowNull: true }, // Model\n      make: { type: DataTypes.STRING, allowNull: true }, // Make\n      yom: { type: DataTypes.INTEGER, allowNull: true }, // Year of Manufacture (YOM)\n      purchaseDate: { type: DataTypes.DATE, allowNull: true }, // Purchase Date\n      capacity: { type: DataTypes.STRING, allowNull: true }, // Capacity\n      ownerName: { type: DataTypes.STRING, allowNull: true }, // Owner Name\n      ownerType: { type: DataTypes.STRING, allowNull: true }, // Owner Type (Company/Individual)\n      siteId: { type: DataTypes.INTEGER, allowNull: true }, // Foreign Key - Site\n      isActive: { type: DataTypes.BOOLEAN, defaultValue: true }, // Is Active\n      machineName: { type: DataTypes.STRING, allowNull: true }, // Machine name\n      fitnessCertificateExpiry: { type: DataTypes.DATE, allowNull: true }, // Fitness certificate expiry date\n      motorVehicleTaxDue: { type: DataTypes.DATE, allowNull: true }, // Motor vehicle tax due date\n      permitExpiryDate: { type: DataTypes.DATE, allowNull: true }, // Permit expiry date\n      nationalPermitExpiry: { type: DataTypes.DATE, allowNull: true }, // National permit expiry date\n      insuranceExpiry: { type: DataTypes.DATE, allowNull: true }, // Insurance expiry date\n      pollutionCertificateExpiry: { type: DataTypes.DATE, allowNull: true }, // Pollution certificate expiry date\n      fitnessCertificateFile: { type: DataTypes.STRING, allowNull: true }, // Fitness certificate file\n      pollutionCertificateFile: { type: DataTypes.STRING, allowNull: true }, // Pollution certificate file\n      insuranceFile: { type: DataTypes.STRING, allowNull: true }, // Insurance file\n      permitFile: { type: DataTypes.STRING, allowNull: true }, // Permit file\n      nationalPermitFile: { type: DataTypes.STRING, allowNull: true }, // National permit file\n      motorVehicleTaxFile: { type: DataTypes.STRING, allowNull: true }, // Motor vehicle tax file\n      machineImageFile: { type: DataTypes.STRING, allowNull: true }, // Machine image file\n      status: {\n        type: DataTypes.ENUM(\"Idle\", \"In Use\", \"In Transfer\", \"Sold\", \"Scrap\"),\n        allowNull: true,\n        defaultValue: \"Idle\",\n      }, // Machine status\n      totalHoursRun: { type: DataTypes.FLOAT, allowNull: true }, // Total hours run\n      totalKmRun: { type: DataTypes.FLOAT, allowNull: true }, // Total kilometers run\n      lastServiceDate: { type: DataTypes.DATE, allowNull: true }, // Last service date\n      lastServiceAtkm: { type: DataTypes.FLOAT, allowNull: true }, // Last service at kilometers\n      lastServiceAtHours: { type: DataTypes.FLOAT, allowNull: true }, // Last service at hours\n    },\n    {\n      tableName: \"machineries\", // Table name in your database\n      timestamps: true,\n      paranoid: true,\n      hooks: {\n        afterCreate: async (machine, options) => {\n          const newErpCode = `ERP-${String(machine.id).padStart(4, \"0\")}`;\n          await machine.update(\n            { erpCode: newErpCode },\n            { transaction: options.transaction }\n          );\n        },\n      },\n    }\n  );\n\n  Machinery.associate = (models) => {\n    // Establishing connection with PrimaryCategory\n    Machinery.belongsTo(models.PrimaryCategory, {\n      foreignKey: \"primaryCategoryId\",\n      as: \"primaryCategory\",\n    });\n\n    // Establishing connection with MachineCategory\n    Machinery.belongsTo(models.MachineCategory, {\n      foreignKey: \"machineCategoryId\",\n      as: \"machineCategory\",\n    });\n    // Existing association with Site\n    Machinery.belongsTo(models.Site, {\n      foreignKey: \"siteId\",\n      as: \"site\",\n    });\n    Machinery.hasMany(models.LogbookEntry, {\n      foreignKey: \"machineId\",\n      as: \"logbookEntries\",\n    });\n  };\n\n  return Machinery;\n};\n","module.exports = (sequelize, DataTypes) => {\n  const MachineryItemCode = sequelize.define(\n    \"MachineryItemCode\",\n    {\n      id: {\n        type: DataTypes.INTEGER,\n        primaryKey: true,\n        autoIncrement: true,\n      },\n      code: {\n        type: DataTypes.STRING,\n        allowNull: false,\n      },\n      name: {\n        type: DataTypes.STRING,\n        allowNull: false,\n      },\n      remarks: {\n        type: DataTypes.TEXT,\n        allowNull: true,\n      },\n    },\n    {\n      tableName: \"machinery_item_codes\", // Table name in your database\n      timestamps: true,\n      paranoid: true,\n    }\n  );\n  return MachineryItemCode;\n};\n","module.exports = (sequelize, DataTypes) => {\n  const MaintenanceLog = sequelize.define(\n    \"MaintenanceLog\",\n    {\n      id: {\n        type: DataTypes.INTEGER,\n        autoIncrement: true,\n        primaryKey: true,\n      },\n      machineId: {\n        type: DataTypes.INTEGER,\n        allowNull: false,\n      },\n      type: {\n        type: DataTypes.STRING,\n        allowNull: true,\n      },\n      date: {\n        type: DataTypes.DATE,\n        allowNull: true,\n      },\n      title: {\n        type: DataTypes.STRING,\n        allowNull: true,\n      },\n      description: {\n        type: DataTypes.TEXT,\n        allowNull: true,\n      },\n      parts: {\n        type: DataTypes.TEXT,\n        allowNull: true,\n      },\n      cost: {\n        type: DataTypes.DECIMAL(10, 2),\n        allowNull: true,\n      },\n      technician: {\n        type: DataTypes.STRING,\n        allowNull: true,\n      },\n      status: {\n        type: DataTypes.ENUM(\n          \"completed\",\n          \"in_progress\",\n          \"scheduled\",\n          \"overdue\",\n          \"due_today\"\n        ),\n        allowNull: false,\n      },\n      hoursAtService: {\n        type: DataTypes.INTEGER,\n        allowNull: true,\n      },\n      kilometersAtService: {\n        type: DataTypes.INTEGER,\n        allowNull: true,\n      },\n      vendorAndPartsDetails: {\n        type: DataTypes.JSONB,\n        allowNull: true,\n      },\n      dueDate: {\n        type: DataTypes.DATE,\n        allowNull: true,\n      },\n      estimatedHours: {\n        type: DataTypes.FLOAT,\n        allowNull: true,\n      },\n      estimatedCost: {\n        type: DataTypes.DECIMAL(10, 2),\n        allowNull: true,\n      },\n      priority: {\n        type: DataTypes.ENUM(\"low\", \"medium\", \"high\"),\n        allowNull: true,\n        defaultValue: \"medium\",\n      },\n      assignedTo: {\n        type: DataTypes.STRING,\n        allowNull: true,\n      },\n      lastAlertDate: {\n        type: DataTypes.DATE,\n        allowNull: true,\n      },\n    },\n    {\n      tableName: \"maintenance_logs\",\n      timestamps: true,\n    }\n  );\n  MaintenanceLog.associate = (models) => {\n    MaintenanceLog.belongsTo(models.Machinery, {\n      foreignKey: \"machineId\",\n      as: \"machine\",\n    });\n  };\n\n  return MaintenanceLog;\n};\n","module.exports = (sequelize, DataTypes) => {\n  const MaterialIssue = sequelize.define(\n    \"MaterialIssue\",\n    {\n      id: {\n        type: DataTypes.INTEGER,\n        primaryKey: true,\n        autoIncrement: true,\n      },\n      issueNumber: {\n        type: DataTypes.STRING,\n        unique: true,\n      },\n      issueDate: {\n        type: DataTypes.DATE,\n        defaultValue: DataTypes.NOW,\n      },\n      issueType: {\n        type: DataTypes.ENUM(\"Consumption\", \"Site Transfer\"),\n        allowNull: false,\n      },\n      status: {\n        type: DataTypes.STRING,\n        defaultValue: \"Pending\",\n      },\n      siteId: {\n        type: DataTypes.INTEGER,\n        allowNull: true,\n      },\n      otherSiteId: {\n        type: DataTypes.INTEGER,\n        allowNull: true,\n      },\n      requisitionId: {\n        type: DataTypes.INTEGER,\n        allowNull: true, // only present if issued against a requisition\n      },\n      approvedById: {\n        type: DataTypes.INTEGER,\n        allowNull: true, // ID of the user who approved the issue\n      },\n      approvedAt: {\n        type: DataTypes.DATE,\n        allowNull: true, // timestamp of when the issue was approved\n      },\n      issuedById: {\n        type: DataTypes.INTEGER,\n        allowNull: true, // ID of the user who issued the materials\n      },\n      issuedAt: {\n        type: DataTypes.DATE,\n        allowNull: true, // timestamp of when the materials were issued\n      },\n      consumedById: {\n        type: DataTypes.INTEGER,\n        allowNull: true, // ID of the user who consumed the materials\n      },\n      consumedAt: {\n        type: DataTypes.DATE,\n        allowNull: true, // timestamp of when the materials were consumed\n      },\n      dispatchedById: {\n        type: DataTypes.INTEGER,\n        allowNull: true, // ID of the user who dispatched the materials\n      },\n      dispatchedAt: {\n        type: DataTypes.DATE,\n        allowNull: true, // timestamp of when the materials were dispatched\n      },\n      receivedById: {\n        type: DataTypes.INTEGER,\n        allowNull: true, // ID of the user who received the materials\n      },\n      receivedAt: {\n        type: DataTypes.DATE,\n        allowNull: true, // timestamp of when the materials were received\n      },\n      rejectedById: {\n        type: DataTypes.INTEGER,\n        allowNull: true, // ID of the user who rejected the issue\n      },\n      rejectedAt: {\n        type: DataTypes.DATE,\n        allowNull: true, // timestamp of when the issue was rejected\n      },\n      rejectionReason: {\n        type: DataTypes.STRING,\n        allowNull: true, // Optional rejection reason\n      },\n    },\n    {\n      tableName: \"material_issues\",\n      timestamps: true,\n      hooks: {\n        afterCreate: async (issue, options) => {\n          const code = `ISS-${String(issue.id).padStart(3, \"0\")}`;\n          await issue.update(\n            { issueNumber: code },\n            { transaction: options.transaction }\n          );\n        },\n      },\n    }\n  );\n\n  MaterialIssue.associate = (models) => {\n    MaterialIssue.hasMany(models.MaterialIssueItem, {\n      foreignKey: \"materialIssueId\",\n      as: \"items\",\n    });\n    MaterialIssue.belongsTo(models.Site, {\n      foreignKey: \"siteId\",\n      as: \"fromSite\",\n    });\n    MaterialIssue.belongsTo(models.Site, {\n      foreignKey: \"otherSiteId\",\n      as: \"toSite\",\n    });\n    MaterialIssue.belongsTo(models.Requisition, {\n      foreignKey: \"requisitionId\",\n      as: \"requisition\",\n    });\n    MaterialIssue.belongsTo(models.User, {\n      foreignKey: \"issuedById\",\n      as: \"issuedBy\",\n    });\n    MaterialIssue.belongsTo(models.User, {\n      foreignKey: \"approvedById\",\n      as: \"approvedBy\",\n    });\n    MaterialIssue.belongsTo(models.User, {\n      foreignKey: \"dispatchedById\",\n      as: \"dispatchedBy\",\n    });\n    MaterialIssue.belongsTo(models.User, {\n      foreignKey: \"receivedById\",\n      as: \"receivedBy\",\n    });\n    MaterialIssue.belongsTo(models.User, {\n      foreignKey: \"rejectedById\",\n      as: \"rejectedBy\",\n    });\n    MaterialIssue.belongsTo(models.User, {\n      foreignKey: \"consumedById\",\n      as: \"consumedBy\",\n    });\n\n  };\n\n  return MaterialIssue;\n};\n","module.exports = (sequelize, DataTypes) => {\n  const MaterialIssueItem = sequelize.define(\n    \"MaterialIssueItem\",\n    {\n      id: {\n        type: DataTypes.INTEGER,\n        primaryKey: true,\n        autoIncrement: true,\n      },\n      materialIssueId: {\n        type: DataTypes.INTEGER,\n        allowNull: false,\n      },\n      itemId: {\n        type: DataTypes.INTEGER,\n        allowNull: false,\n      },\n      quantity: {\n        type: DataTypes.FLOAT,\n        allowNull: false,\n      },\n      issueTo: {\n        type: DataTypes.STRING, // could be vehicle number, person, etc.\n        allowNull: true,\n      },\n      siteId: {\n        type: DataTypes.INTEGER,\n        allowNull: false,\n      },\n      otherSiteId: {\n        type: DataTypes.INTEGER,\n        allowNull: true,\n      },\n      machineId: {\n        type: DataTypes.INTEGER,\n        allowNull: true,\n      },\n    },\n    {\n      tableName: \"material_issue_items\",\n      timestamps: false,\n    }\n  );\n\n  MaterialIssueItem.associate = (models) => {\n    MaterialIssueItem.belongsTo(models.Item, { foreignKey: \"itemId\" });\n    MaterialIssueItem.belongsTo(models.MaterialIssue, {\n      foreignKey: \"materialIssueId\",\n    });\n    MaterialIssueItem.belongsTo(models.Site, {\n      foreignKey: \"siteId\",\n      as: \"fromSite\",\n    });\n    MaterialIssueItem.belongsTo(models.Site, {\n      foreignKey: \"otherSiteId\",\n      as: \"toSite\",\n    });\n    MaterialIssueItem.belongsTo(models.Machinery, {\n      foreignKey: \"machineId\",\n      as: \"machine\",\n    });\n  };\n\n  return MaterialIssueItem;\n};\n","// models/Notification.js\nmodule.exports = (sequelize, DataTypes) => {\n  const Notification = sequelize.define(\n    \"Notification\",\n    {\n      id: {\n        type: DataTypes.INTEGER,\n        primaryKey: true,\n        autoIncrement: true,\n      },\n      eventType: {\n        type: DataTypes.ENUM(\n          \"MachineTransfer\",\n          \"MachineScrap\",\n          \"MachineSold\",\n          \"MaterialRequisition\",\n          \"MaterialIssue\",\n          \"LowStock\",\n          \"DocumentExpiry\",\n          \"MaintenanceAlert\",\n          \"MachineMaintenanceAlert\",\n          \"LogbookEntry\"\n        ),\n        allowNull: false,\n      },\n      eventAction: {\n        type: DataTypes.STRING,\n        allowNull: false,\n      },\n      // eventAction: {\n      //   type: DataTypes.ENUM(\n      //     \"Requested\",\n      //     \"Approved\",\n      //     \"Dispatched\",\n      //     \"Received\",\n      //     \"Rejected\",\n      //     \"Completed\",\n      //     \"Expired\",\n      //     \"Out Of Stock\",\n      //     \"Low Stock\",\n\n      //   ),\n      //   allowNull: false,\n      // },\n      referenceId: {\n        type: DataTypes.INTEGER,\n        allowNull: false,\n      },\n      siteId: {\n        type: DataTypes.INTEGER,\n        allowNull: true,\n      },\n      title: {\n        type: DataTypes.STRING,\n        allowNull: true,\n      },\n      description: {\n        type: DataTypes.TEXT,\n      },\n      isRead: {\n        type: DataTypes.BOOLEAN,\n        defaultValue: false,\n      },\n      createdBy: {\n        type: DataTypes.INTEGER,\n        allowNull: true,\n      },\n    },\n    {\n      tableName: \"notifications\",\n      timestamps: true,\n      paranoid: true,\n    }\n  );\n\n  Notification.associate = (models) => {\n    Notification.belongsTo(models.User, {\n      foreignKey: \"createdBy\",\n      as: \"creator\",\n    });\n    Notification.belongsTo(models.Site, { foreignKey: \"siteId\", as: \"site\" });\n    Notification.belongsToMany(models.Role, {\n      through: models.NotificationRole,\n      foreignKey: \"notificationId\",\n    });\n    Notification.belongsToMany(models.User, {\n      through: models.NotificationReadStatus,\n      foreignKey: \"notificationId\",\n    });\n\n    Notification.hasMany(models.NotificationReadStatus, {\n      foreignKey: \"notificationId\",\n      as: \"readStatuses\",\n    });\n  };\n\n  return Notification;\n};\n","module.exports = (sequelize, DataTypes) => {\n  const NotificationReadStatus = sequelize.define(\n    \"NotificationReadStatus\",\n    {\n      id: {\n        type: DataTypes.INTEGER,\n        autoIncrement: true,\n        primaryKey: true,\n      },\n      userId: {\n        type: DataTypes.INTEGER,\n        allowNull: false,\n      },\n      notificationId: {\n        type: DataTypes.INTEGER,\n        allowNull: false,\n      },\n      isRead: {\n        type: DataTypes.BOOLEAN,\n        defaultValue: false,\n      },\n      readAt: {\n        type: DataTypes.DATE,\n        allowNull: true,\n      },\n    },\n    {\n      tableName: \"notification_read_status\",\n      timestamps: true,\n    }\n  );\n\n  NotificationReadStatus.associate = (models) => {\n    NotificationReadStatus.belongsTo(models.Notification, {\n      foreignKey: \"notificationId\",\n      as: \"notification\",\n    });\n\n    NotificationReadStatus.belongsTo(models.User, {\n      foreignKey: \"userId\",\n      as: \"user\",\n    });\n  };\n  return NotificationReadStatus;\n};\n","module.exports = (sequelize, DataTypes) => {\n  const NotificationRole = sequelize.define(\n    \"NotificationRole\",\n    {},\n    { tableName: \"notification_roles\", timestamps: false }\n  );\n  return NotificationRole;\n};\n","// models/payment.model.js\nmodule.exports = (sequelize, DataTypes) => {\n  const Payment = sequelize.define('Payment', {\n    paymentDate: {\n      type: DataTypes.DATE,\n      allowNull: false\n    },\n    amount: {\n      type: DataTypes.DECIMAL(12, 2),\n      allowNull: false\n    },\n    paymentMethod: {\n      type: DataTypes.ENUM('CASH', 'CHEQUE', 'BANK_TRANSFER', 'ONLINE_PAYMENT', 'OTHER'),\n      allowNull: false\n    },\n    referenceNumber: DataTypes.STRING,\n    slipUrl: DataTypes.STRING,\n    status: {\n      type: DataTypes.ENUM('PENDING', 'COMPLETED', 'FAILED'),\n      defaultValue: 'PENDING'\n    },\n    remarks: DataTypes.TEXT\n  });\n\n  Payment.associate = (models) => {\n    Payment.belongsTo(models.Invoice, {\n      foreignKey: 'invoiceId',\n      as: 'invoice'\n    });\n  };\n\n  return Payment;\n};","module.exports = (sequelize, DataTypes) => {\n  const PrimaryCategory = sequelize.define(\n    \"PrimaryCategory\",\n    {\n      id: { type: DataTypes.INTEGER, primaryKey: true, autoIncrement: true },\n      name: { type: DataTypes.STRING, allowNull: false, unique: true },\n    },\n    { tableName: \"primary_categories\", timestamps: true }\n  );\n\n  PrimaryCategory.associate = (models) => {\n    PrimaryCategory.hasMany(models.MachineCategory, {\n      foreignKey: \"primaryCategoryId\",\n      as: \"machineCategories\",\n      onDelete: \"CASCADE\",\n    });\n\n    PrimaryCategory.hasMany(models.Machinery, {\n      foreignKey: \"primaryCategoryId\",\n      as: \"machineries\",\n      onDelete: \"CASCADE\",\n    });\n  };\n\n  return PrimaryCategory;\n};\n","// models/Procurement.js\nmodule.exports = (sequelize, DataTypes) => {\n  const Procurement = sequelize.define(\n    \"Procurement\",\n    {\n      procurementNo: { type: DataTypes.STRING, }, // e.g., \"PRC-2025-0001\" unique: true \n      requisitionId: { type: DataTypes.INTEGER, allowNull: false },\n      vendorId: { type: DataTypes.INTEGER, allowNull: false },\n      expectedDelivery: { type: DataTypes.DATE },\n      notes: { type: DataTypes.TEXT },\n      status: {\n        type: DataTypes.ENUM(\"pending\", \"ordered\", \"accepted_at_virtual_site\", \"in_transit_to_requested_site\", \"delivered\", \"paid\"),\n        defaultValue: \"pending\",\n      },\n      totalAmount: { type: DataTypes.DECIMAL(10, 2) },\n      quotationComparisonId: { type: DataTypes.INTEGER, allowNull: true },\n    },\n    {\n      tableName: \"procurements\",\n      timestamps: true,\n    }\n  );\n\n  Procurement.associate = (models) => {\n    Procurement.belongsTo(models.Requisition, { foreignKey: \"requisitionId\" });\n    Procurement.belongsTo(models.Vendor, { foreignKey: \"vendorId\" });\n    Procurement.belongsTo(models.QuotationComparison, { foreignKey: \"quotationComparisonId\", as: \"quotationComparison\" });\n    Procurement.hasMany(models.ProcurementItem, {\n      foreignKey: \"procurementId\",\n    });\n    Procurement.hasMany(models.Invoice, {\n      foreignKey: \"procurementId\",\n      as: \"invoices\",\n    });\n    Procurement.hasMany(models.Dispatch, {\n      foreignKey: \"procurementId\",\n    });\n  };\n\n  return Procurement;\n};\n","// models/ProcurementItem.js\nmodule.exports = (sequelize, DataTypes) => {\n  const ProcurementItem = sequelize.define(\n    \"ProcurementItem\",\n    {\n      procurementId: { type: DataTypes.INTEGER },\n      requisitionItemId: { type: DataTypes.INTEGER },\n      itemId: { type: DataTypes.INTEGER },\n      quantity: { type: DataTypes.INTEGER },\n      rate: { type: DataTypes.DECIMAL(10, 2) },\n      amount: { type: DataTypes.DECIMAL(10, 2) },\n      receivedQuantity: { type: DataTypes.INTEGER, defaultValue: 0 },\n    },\n    {\n      tableName: \"procurement_items\",\n      timestamps: true,\n    }\n  );\n\n  ProcurementItem.associate = (models) => {\n    ProcurementItem.belongsTo(models.Procurement, { foreignKey: \"procurementId\" });\n    ProcurementItem.belongsTo(models.RequisitionItem, { foreignKey: \"requisitionItemId\" });\n    ProcurementItem.belongsTo(models.Item, { foreignKey: \"itemId\" });\n    ProcurementItem.hasMany(models.InvoiceItem, { foreignKey: \"procurementItemId\" });\n  };\n\n  return ProcurementItem;\n};\n","// models/QuotationComparison.js\nmodule.exports = (sequelize, DataTypes) => {\n  const QuotationComparison = sequelize.define('QuotationComparison', {\n    id: {\n      type: DataTypes.INTEGER,\n      primaryKey: true,\n      autoIncrement: true,\n    },\n    requisitionId: {\n      type: DataTypes.INTEGER,\n      allowNull: false,\n      references: {\n        model: 'requisitions',\n        key: 'id',\n      },\n    },\n    comparisonNo: {\n      type: DataTypes.STRING,\n      unique: true,\n    },\n    status: {\n      type: DataTypes.STRING,\n      defaultValue: 'draft', // draft, submitted, approved, locked\n    },\n    submittedById: {\n      type: DataTypes.INTEGER,\n      allowNull: true,\n    },\n    submittedAt: {\n      type: DataTypes.DATE,\n      allowNull: true,\n    },\n    approvedById: {\n      type: DataTypes.INTEGER,\n      allowNull: true,\n    },\n    approvedAt: {\n      type: DataTypes.DATE,\n      allowNull: true,\n    },\n    remarks: {\n      type: DataTypes.TEXT,\n      allowNull: true,\n    },\n    submissionRemarks: {\n      type: DataTypes.TEXT,\n      allowNull: true,\n    },\n    approvalRemarks: {\n      type: DataTypes.TEXT,\n      allowNull: true,\n    },\n    lockRemarks: {\n      type: DataTypes.TEXT,\n      allowNull: true,\n    },\n    totalAmount: {\n      type: DataTypes.DECIMAL(15, 2),\n      defaultValue: 0.00,\n    },\n  }, {\n    tableName: 'quotation_comparisons',\n    timestamps: true,\n    hooks: {\n      afterCreate: async (comparison, options) => {\n        const newCode = `QC-${String(comparison.id).padStart(4, '0')}`;\n        await comparison.update(\n          { comparisonNo: newCode },\n          { transaction: options.transaction }\n        );\n      },\n    },\n  });\n\n  QuotationComparison.associate = (models) => {\n    QuotationComparison.belongsTo(models.Requisition, {\n      foreignKey: 'requisitionId',\n      as: 'requisition',\n    });\n    QuotationComparison.belongsTo(models.User, {\n      foreignKey: 'submittedById',\n      as: 'submittedBy',\n    });\n    QuotationComparison.belongsTo(models.User, {\n      foreignKey: 'approvedById',\n      as: 'approvedBy',\n    });\n    QuotationComparison.hasMany(models.QuotationComparisonItem, {\n      foreignKey: 'comparisonId',\n      as: 'items',\n    });\n    QuotationComparison.hasMany(models.QuotationComparisonVendor, {\n      foreignKey: 'comparisonId',\n      as: 'vendors',\n    });\n    QuotationComparison.hasMany(models.QuotationComparisonVersion, {\n      foreignKey: 'comparisonId',\n      as: 'versions',\n    });\n  };\n\n  return QuotationComparison;\n};\n","// models/QuotationComparisonItem.js\nmodule.exports = (sequelize, DataTypes) => {\n  const QuotationComparisonItem = sequelize.define('QuotationComparisonItem', {\n    id: {\n      type: DataTypes.INTEGER,\n      primaryKey: true,\n      autoIncrement: true,\n    },\n    comparisonId: {\n      type: DataTypes.INTEGER,\n      allowNull: false,\n      references: {\n        model: 'quotation_comparisons',\n        key: 'id',\n      },\n    },\n    requisitionItemId: {\n      type: DataTypes.INTEGER,\n      allowNull: false,\n      references: {\n        model: 'requisition_items',\n        key: 'id',\n      },\n    },\n    itemId: {\n      type: DataTypes.INTEGER,\n      allowNull: false,\n      references: {\n        model: 'items',\n        key: 'id',\n      },\n    },\n    description: {\n      type: DataTypes.STRING,\n      allowNull: false,\n    },\n    unit: {\n      type: DataTypes.STRING,\n      allowNull: false,\n    },\n    quantity: {\n      type: DataTypes.INTEGER,\n      allowNull: false,\n    },\n    selectedVendorId: {\n      type: DataTypes.INTEGER,\n      allowNull: true,\n    },\n    selected: {\n      type: DataTypes.BOOLEAN,\n      defaultValue: false,\n    },\n  }, {\n    tableName: 'quotation_comparison_items',\n    timestamps: true,\n  });\n\n  QuotationComparisonItem.associate = (models) => {\n    QuotationComparisonItem.belongsTo(models.QuotationComparison, {\n      foreignKey: 'comparisonId',\n      as: 'comparison',\n    });\n    QuotationComparisonItem.belongsTo(models.RequisitionItem, {\n      foreignKey: 'requisitionItemId',\n      as: 'requisitionItem',\n    });\n    QuotationComparisonItem.belongsTo(models.Item, {\n      foreignKey: 'itemId',\n      as: 'item',\n    });\n    QuotationComparisonItem.belongsTo(models.Vendor, {\n      foreignKey: 'selectedVendorId',\n      as: 'selectedVendor',\n    });\n    QuotationComparisonItem.hasMany(models.QuotationComparisonRate, {\n      foreignKey: 'comparisonItemId',\n      as: 'rates',\n    });\n };\n\n  return QuotationComparisonItem;\n};\n","// models/QuotationComparisonRate.js\nmodule.exports = (sequelize, DataTypes) => {\n  const QuotationComparisonRate = sequelize.define('QuotationComparisonRate', {\n    id: {\n      type: DataTypes.INTEGER,\n      primaryKey: true,\n      autoIncrement: true,\n    },\n    comparisonItemId: {\n      type: DataTypes.INTEGER,\n      allowNull: false,\n      references: {\n        model: 'quotation_comparison_items',\n        key: 'id',\n      },\n    },\n    vendorId: {\n      type: DataTypes.INTEGER,\n      allowNull: false,\n      references: {\n        model: 'vendors',\n        key: 'id',\n      },\n    },\n    rate: {\n      type: DataTypes.DECIMAL(10, 2),\n      allowNull: false,\n      defaultValue: 0.00,\n    },\n    amount: {\n      type: DataTypes.DECIMAL(15, 2),\n      allowNull: false,\n      defaultValue: 0.00,\n    },\n    remarks: {\n      type: DataTypes.TEXT,\n      allowNull: true,\n    },\n    isLowest: {\n      type: DataTypes.BOOLEAN,\n      defaultValue: false,\n    },\n  }, {\n    tableName: 'quotation_comparison_rates',\n    timestamps: true,\n  });\n\n  QuotationComparisonRate.associate = (models) => {\n    QuotationComparisonRate.belongsTo(models.QuotationComparisonItem, {\n      foreignKey: 'comparisonItemId',\n      as: 'comparisonItem',\n    });\n    QuotationComparisonRate.belongsTo(models.Vendor, {\n      foreignKey: 'vendorId',\n      as: 'vendor',\n    });\n  };\n\n  return QuotationComparisonRate;\n};\n","// models/QuotationComparisonVendor.js\nmodule.exports = (sequelize, DataTypes) => {\n  const QuotationComparisonVendor = sequelize.define('QuotationComparisonVendor', {\n    id: {\n      type: DataTypes.INTEGER,\n      primaryKey: true,\n      autoIncrement: true,\n    },\n    comparisonId: {\n      type: DataTypes.INTEGER,\n      allowNull: false,\n      references: {\n        model: 'quotation_comparisons',\n        key: 'id',\n      },\n    },\n    vendorId: {\n      type: DataTypes.INTEGER,\n      allowNull: false,\n      references: {\n        model: 'vendors',\n        key: 'id',\n      },\n    },\n    vendorName: {\n      type: DataTypes.STRING,\n      allowNull: false,\n    },\n    totalAmount: {\n      type: DataTypes.DECIMAL(15, 2),\n      defaultValue: 0.00,\n    },\n    status: {\n      type: DataTypes.STRING,\n      defaultValue: 'active', // active, rejected\n    },\n    // Attachment fields\n    // attachmentFileName: {\n    //   type: DataTypes.STRING,\n    //   allowNull: true,\n    // },\n    attachmentFilePath: {\n      type: DataTypes.STRING,\n      allowNull: true,\n    },\n    // attachmentFileSize: {\n    //   type: DataTypes.BIGINT,\n    //   allowNull: true,\n    // },\n    // attachmentMimeType: {\n    //   type: DataTypes.STRING,\n    //   allowNull: true,\n    // },\n    attachmentUploadedAt: {\n      type: DataTypes.DATE,\n      allowNull: true,\n    },\n    attachmentUploadedById: {\n      type: DataTypes.INTEGER,\n      allowNull: true,\n      references: {\n        model: 'users',\n        key: 'id',\n      },\n    },\n  }, {\n    tableName: 'quotation_comparison_vendors',\n    timestamps: true,\n  });\n\n  QuotationComparisonVendor.associate = (models) => {\n    QuotationComparisonVendor.belongsTo(models.QuotationComparison, {\n      foreignKey: 'comparisonId',\n      as: 'comparison',\n    });\n    QuotationComparisonVendor.belongsTo(models.Vendor, {\n      foreignKey: 'vendorId',\n      as: 'vendor',\n    });\n    QuotationComparisonVendor.hasMany(models.QuotationComparisonRate, {\n      foreignKey: 'vendorId',\n      as: 'rates',\n    });\n    QuotationComparisonVendor.belongsTo(models.User, {\n      foreignKey: 'attachmentUploadedById',\n      as: 'attachmentUploadedBy',\n    });\n  };\n\n  return QuotationComparisonVendor;\n};\n","// models/QuotationComparisonVersion.js\nmodule.exports = (sequelize, DataTypes) => {\n  const QuotationComparisonVersion = sequelize.define('QuotationComparisonVersion', {\n    id: {\n      type: DataTypes.INTEGER,\n      primaryKey: true,\n      autoIncrement: true,\n    },\n    comparisonId: {\n      type: DataTypes.INTEGER,\n      allowNull: false,\n      references: {\n        model: 'quotation_comparisons',\n        key: 'id',\n      },\n    },\n    versionNumber: {\n      type: DataTypes.INTEGER,\n      allowNull: false,\n    },\n    changes: {\n      type: DataTypes.TEXT,\n      allowNull: true,\n    },\n    changedById: {\n      type: DataTypes.INTEGER,\n      allowNull: true,\n    },\n    changedAt: {\n      type: DataTypes.DATE,\n      defaultValue: DataTypes.NOW,\n    },\n    status: {\n      type: DataTypes.STRING,\n      defaultValue: 'active',\n    },\n  }, {\n    tableName: 'quotation_comparison_versions',\n    timestamps: false,\n  });\n\n  QuotationComparisonVersion.associate = (models) => {\n    QuotationComparisonVersion.belongsTo(models.QuotationComparison, {\n      foreignKey: 'comparisonId',\n      as: 'comparison',\n    });\n    QuotationComparisonVersion.belongsTo(models.User, {\n      foreignKey: 'changedById',\n      as: 'changedBy',\n    });\n  };\n\n  return QuotationComparisonVersion;\n};\n","// models/Requisition.js\nmodule.exports = (sequelize, DataTypes) => {\n  const Requisition = sequelize.define(\n    \"Requisition\",\n    {\n      id: {\n        type: DataTypes.INTEGER,\n        primaryKey: true,\n        autoIncrement: true,\n      },\n      requisitionNo: {\n        type: DataTypes.STRING,\n        unique: true,\n      },\n      requestedAt: {\n        type: DataTypes.DATE,\n        defaultValue: DataTypes.NOW,\n      },\n      requestingSiteId: {\n        type: DataTypes.INTEGER,\n        allowNull: false,\n      },\n      requestedFor: {\n        type: DataTypes.STRING, // could be department, user, etc.\n      },\n      chargeType: {\n        type: DataTypes.STRING, // enum-like: \"Capex\", \"Opex\", etc.\n      },\n      requestPriority: {\n        type: DataTypes.STRING, // enum-like: \"High\", \"Medium\", \"Low\"\n      },\n      dueDate: {\n        type: DataTypes.DATE,\n      },\n      preparedById: {\n        type: DataTypes.INTEGER,\n        allowNull: true,\n      },\n      status: {\n        type: DataTypes.STRING, // \"pending\", \"approved\", \"received\", \"rejected\", \"approvedByPm\", \"approvedByHo\", \"completed\"\n        defaultValue: \"pending\",\n      },\n      approvedById: {\n        type: DataTypes.INTEGER,\n        allowNull: true,\n      },\n      approvedAt: {\n        type: DataTypes.DATE,\n        allowNull: true,\n      },\n      completedById: {\n        type: DataTypes.INTEGER,\n        allowNull: true,\n      },\n      completedAt: {\n        type: DataTypes.DATE,\n        allowNull: true,\n      },\n      rejectedById: {\n        type: DataTypes.INTEGER,\n        allowNull: true,\n      },\n      rejectedAt: {\n        type: DataTypes.DATE,\n        allowNull: true,\n      },\n      rejectionReason: {\n        type: DataTypes.TEXT,\n        allowNull: true,\n      },\n      approvedByPM: {\n        type: DataTypes.INTEGER,\n        allowNull: true, // ID of the user who approved the requisition\n      },\n      approvedAtPM: {\n        type: DataTypes.DATE,\n        allowNull: true, // timestamp of when the requisition was approved\n      },\n      approvedByHO: {\n        type: DataTypes.INTEGER,\n        allowNull: true, // ID of the user who approved the requisition\n      },\n      approvedAtHO: {\n        type: DataTypes.DATE,\n        allowNull: true, // timestamp of when the requisition was approved\n      },\n    },\n    {\n      tableName: \"requisitions\",\n      timestamps: true,\n      hooks: {\n        afterCreate: async (requisition, options) => {\n          const newCode = `REQ-${String(requisition.id).padStart(4, \"0\")}`;\n          await requisition.update(\n            { requisitionNo: newCode },\n            { transaction: options.transaction }\n          );\n        },\n      },\n    }\n  );\n\n  Requisition.associate = (models) => {\n    Requisition.hasMany(models.RequisitionItem, {\n      foreignKey: \"requisitionId\",\n      as: \"items\",\n    });\n    Requisition.belongsTo(models.User, {\n      foreignKey: \"preparedById\",\n      as: \"preparedBy\",\n    });\n    Requisition.belongsTo(models.User, {\n      foreignKey: \"approvedById\",\n      as: \"approvedBy\",\n    });\n    Requisition.belongsTo(models.User, {\n      foreignKey: \"completedById\",\n      as: \"completedBy\",\n    });\n    Requisition.belongsTo(models.User, {\n      foreignKey: \"rejectedById\",\n      as: \"rejectedBy\",\n    });\n    Requisition.belongsTo(models.User, {\n      foreignKey: \"approvedByPM\",\n      as: \"approvedByPMUser\",\n    });\n    Requisition.belongsTo(models.User, {\n      foreignKey: \"approvedByHO\",\n      as: \"approvedByHOUser\",\n    });\n    Requisition.belongsTo(models.Site, {\n      foreignKey: \"requestingSiteId\",\n      as: \"requestingSite\",\n    });\n    Requisition.hasMany(models.MaterialIssue, {\n      foreignKey: \"requisitionId\",\n      as: \"materialIssues\",\n    });\n    Requisition.hasMany(models.Procurement, {\n      foreignKey: \"requisitionId\",\n      as: \"procurements\",\n    });\n    Requisition.hasMany(models.RequisitionSiteRejection, {\n      foreignKey: \"requisitionId\",\n      as: \"siteRejections\",\n    });\n  };\n\n  return Requisition;\n};\n","// models/RequisitionItem.js\nmodule.exports = (sequelize, DataTypes) => {\n    const RequisitionItem = sequelize.define('RequisitionItem', {\n      id: {\n        type: DataTypes.INTEGER,\n        primaryKey: true,\n        autoIncrement: true,\n      },\n      requisitionId: {\n        type: DataTypes.INTEGER,\n        allowNull: false,\n      },\n      itemId: {\n        type: DataTypes.INTEGER,\n        allowNull: false,\n      },\n      quantity: {\n        type: DataTypes.INTEGER,\n        allowNull: false,\n      },\n    }, {\n      tableName: 'requisition_items',\n    });\n  \n    RequisitionItem.associate = (models) => {\n      RequisitionItem.belongsTo(models.Requisition, {\n        foreignKey: 'requisitionId',\n      });\n      RequisitionItem.belongsTo(models.Item, {\n        foreignKey: 'itemId',\n      });\n    };\n  \n    return RequisitionItem;\n  };\n  ","// models/RequisitionSiteRejection.js\nmodule.exports = (sequelize, DataTypes) => {\n  const RequisitionSiteRejection = sequelize.define(\n    \"RequisitionSiteRejection\",\n    {\n      id: {\n        type: DataTypes.INTEGER,\n        primaryKey: true,\n        autoIncrement: true,\n      },\n      requisitionId: {\n        type: DataTypes.INTEGER,\n        allowNull: false,\n      },\n      siteId: {\n        type: DataTypes.INTEGER,\n        allowNull: false,\n      },\n      rejectedById: {\n        type: DataTypes.INTEGER,\n        allowNull: false,\n      },\n      rejectionReason: {\n        type: DataTypes.TEXT,\n        allowNull: false,\n      },\n      rejectedAt: {\n        type: DataTypes.DATE,\n        defaultValue: DataTypes.NOW,\n      },\n    },\n    {\n      tableName: \"requisition_site_rejections\",\n      timestamps: true,\n      //   indexes: [\n      //     {\n      //       unique: true,\n      //       fields: [\"requisitionId\", \"siteId\"], // Prevent duplicate rejections from same site\n      //     },\n      //   ],\n      underscored: true,\n    }\n  );\n\n  RequisitionSiteRejection.associate = (models) => {\n    RequisitionSiteRejection.belongsTo(models.Requisition, {\n      foreignKey: \"requisitionId\",\n      as: \"requisition\",\n    });\n    RequisitionSiteRejection.belongsTo(models.Site, {\n      foreignKey: \"siteId\",\n      as: \"site\",\n    });\n    RequisitionSiteRejection.belongsTo(models.User, {\n      foreignKey: \"rejectedById\",\n      as: \"rejectedBy\",\n    });\n  };\n\n  return RequisitionSiteRejection;\n};\n","module.exports = (sequelize, DataTypes) => {\n  const Role = sequelize.define(\n    \"Role\",\n    {\n      id: {\n        type: DataTypes.INTEGER,\n        primaryKey: true,\n        autoIncrement: true,\n      },\n      name: {\n        type: DataTypes.STRING,\n        allowNull: false,\n        // unique: true, // Ensure no duplicate roles\n      },\n    },\n    {\n      tableName: \"roles\", // Table name in your database\n      timestamps: true,\n      paranoid: true,\n    }\n  );\n  Role.associate = (models) => {\n    Role.belongsTo(models.Department, {\n      foreignKey: \"departmentId\",\n    });\n    Role.hasMany(models.User, { foreignKey: \"id\" });\n    Role.belongsToMany(models.Notification, {\n      through: models.NotificationRole,\n      foreignKey: \"roleId\",\n    });\n  };\n\n  return Role;\n};\n","module.exports = (sequelize, DataTypes) => {\n  const Site = sequelize.define(\n    \"Site\",\n    {\n      id: {\n        type: DataTypes.INTEGER,\n        primaryKey: true,\n        autoIncrement: true,\n      },\n      name: {\n        type: DataTypes.STRING,\n        allowNull: false,\n      },\n      type: {\n        type: DataTypes.ENUM(\"virtual\", \"physical\"),\n        defaultValue: \"physical\",\n        allowNull: false,\n      },\n      code: {\n        type: DataTypes.STRING,\n        allowNull: true,\n        unique: true,\n      },\n      address: {\n        type: DataTypes.STRING,\n        allowNull: false,\n      },\n      pincode: {\n        type: DataTypes.STRING,\n        allowNull: true,\n      },\n      mobileNumber: {\n        type: DataTypes.STRING,\n        allowNull: true,\n      },\n      departmentId: {\n        type: DataTypes.INTEGER,\n        allowNull: false,\n      },\n      status: {\n        type: DataTypes.ENUM(\"active\", \"closed\", \"paused\"),\n        allowNull: false,\n        defaultValue: \"active\",\n      },\n    },\n    {\n      tableName: \"sites\",\n      timestamps: true,\n      paranoid: true,\n      hooks: {\n        afterCreate: async (site, options) => {\n          const newCode = `SITE-${String(site.id).padStart(3, \"0\")}`;\n          await site.update(\n            { code: newCode },\n            { transaction: options.transaction }\n          );\n        },\n      },\n    }\n  );\n\n  Site.associate = (models) => {\n    Site.belongsTo(models.Department, {\n      foreignKey: \"departmentId\",\n    });\n    Site.hasMany(models.User, {\n      foreignKey: \"siteId\",\n    });\n    Site.hasMany(models.Machinery, {\n      foreignKey: \"siteId\",\n    });\n  };\n\n  return Site;\n};\n","// models/SiteInventory.js\nmodule.exports = (sequelize, DataTypes) => {\n  const SiteInventory = sequelize.define(\"SiteInventory\", {\n    siteId: {\n      type: DataTypes.INTEGER,\n      allowNull: false,\n    },\n    itemId: {\n      type: DataTypes.INTEGER,\n      allowNull: false,\n    },\n    quantity: {\n      type: DataTypes.FLOAT,\n      allowNull: false,\n      defaultValue: 0,\n    },\n    minimumLevel: {\n      type: DataTypes.FLOAT,\n      allowNull: false,\n      defaultValue: 0,\n    },\n    status: {\n      type: DataTypes.ENUM(\"In Stock\", \"Out of Stock\", \"Low Stock\"),\n      allowNull: false,\n      defaultValue: \"In Stock\",\n    },\n    lockedQuantity: {\n      type: DataTypes.FLOAT,\n      allowNull: false,\n      defaultValue: 0,\n    },\n  }, {\n    tableName: \"site_inventories\",\n    timestamps: true,\n  });\n\n  SiteInventory.associate = (models) => {\n    SiteInventory.belongsTo(models.Site, { foreignKey: \"siteId\" });\n    SiteInventory.belongsTo(models.Item, { foreignKey: \"itemId\" });\n  };\n\n  return SiteInventory;\n};\n","module.exports = (sequelize, DataTypes) => {\n  const StockLog = sequelize.define(\n    \"StockLog\",\n    {\n      siteId: {\n        type: DataTypes.INTEGER,\n        allowNull: false,\n      },\n      itemId: {\n        type: DataTypes.INTEGER,\n        allowNull: false,\n      },\n      change: {\n        type: DataTypes.FLOAT,\n        allowNull: false,\n      },\n      type: {\n        type: DataTypes.ENUM(\"IN\", \"OUT\"),\n        allowNull: false,\n      },\n      sourceType: {\n        type: DataTypes.STRING, // e.g., \"Requisition\", \"Issue\", etc.\n      },\n      sourceId: {\n        type: DataTypes.INTEGER,\n      },\n      userId: {\n        type: DataTypes.INTEGER,\n        allowNull: true,\n      },\n    },\n    {\n      tableName: \"stock_logs\",\n      timestamps: true,\n    }\n  );\n\n  StockLog.associate = (models) => {\n    StockLog.belongsTo(models.Site, { foreignKey: \"siteId\" });\n    StockLog.belongsTo(models.Item, { foreignKey: \"itemId\" });\n    StockLog.belongsTo(models.User, { foreignKey: \"userId\" });\n  };\n\n  return StockLog;\n};\n","module.exports = (sequelize, DataTypes) => {\n  const Unit = sequelize.define(\n    \"Unit\",\n    {\n      id: {\n        type: DataTypes.INTEGER,\n        autoIncrement: true,\n        allowNull: false,\n        primaryKey: true,\n      },\n      name: {\n        type: DataTypes.STRING,\n        allowNull: false,\n      },\n      shortName: {\n        type: DataTypes.STRING,\n        allowNull: false,\n      },\n      decimalPlaces: {\n        type: DataTypes.INTEGER,\n        allowNull: true,\n      },\n    },\n    {\n      tableName: \"units\",\n      timestamps: false,\n    }\n  );\n\n  Unit.associate = (models) => {\n    Unit.hasMany(models.Item, { foreignKey: \"unitId\" });\n  };\n\n  return Unit;\n};\n","const bcrypt = require(\"bcryptjs\");\n\nmodule.exports = (sequelize, DataTypes) => {\n  const User = sequelize.define(\n    \"User\",\n    {\n      id: {\n        type: DataTypes.INTEGER,\n        primaryKey: true,\n        autoIncrement: true,\n      },\n      name: {\n        type: DataTypes.STRING,\n        allowNull: false,\n      },\n      code: {\n        type: DataTypes.STRING,\n        allowNull: true,\n        // unique: true,\n      },\n      email: {\n        type: DataTypes.STRING,\n        allowNull: false,\n        unique: true,\n      },\n      phone: {\n        type: DataTypes.STRING,\n        allowNull: false,\n        // unique: true,\n      },\n      imageUrl: {\n        type: DataTypes.STRING,\n        allowNull: true,\n      },\n      password: {\n        type: DataTypes.STRING,\n        allowNull: false,\n        set(value) {\n          this.setDataValue(\n            \"password\",\n            bcrypt.hashSync(value, bcrypt.genSaltSync(10))\n          );\n        },\n      },\n      roleId: {\n        type: DataTypes.INTEGER,\n        allowNull: true, // Every user must have a role\n      },\n      departmentId: {\n        type: DataTypes.INTEGER,\n        allowNull: true, // Every user must belong to a department\n      },\n      siteId: {\n        type: DataTypes.INTEGER,\n        allowNull: true, // Users can be department-level or site-level\n      },\n      status: {\n        type: DataTypes.ENUM(\"active\", \"inactive\", \"archived\"),\n        allowNull: false,\n        defaultValue: \"active\",\n      },\n    },\n    {\n      tableName: \"users\", // Table name in your database\n      timestamps: true,\n      paranoid: true,\n      hooks: {\n        afterCreate: async (user, options) => {\n          const newCode = `EMP-${String(user.id).padStart(3, \"0\")}`;\n          await user.update(\n            { code: newCode },\n            { transaction: options.transaction }\n          );\n        },\n      },\n    }\n  );\n  User.prototype.validPassword = async function (password) {\n    try {\n      return await bcrypt.compare(password, this.password);\n    } catch (error) {\n      // console.error(\"Error comparing passwords:\", error);\n      return false;\n    }\n  };\n\n  //hash password\n  User.hashPassword = function (password) {\n    return bcrypt.hashSync(password, bcrypt.genSaltSync(10));\n  };\n\n  User.associate = (models) => {\n    User.belongsTo(models.Role, { foreignKey: \"roleId\" });\n    User.belongsTo(models.Department, { foreignKey: \"departmentId\" });\n    User.belongsTo(models.Site, { foreignKey: \"siteId\" });\n    User.belongsToMany(models.Notification, {\n      through: models.NotificationReadStatus,\n      foreignKey: \"userId\",\n    });\n  };\n  return User;\n};\n","// models/Vendor.js\nmodule.exports = (sequelize, DataTypes) => {\n  const Vendor = sequelize.define(\n    \"Vendor\",\n    {\n      id: {\n        type: DataTypes.INTEGER,\n        primaryKey: true,\n        autoIncrement: true,\n      },\n      name: { type: DataTypes.STRING },\n      email: { type: DataTypes.STRING },\n      contactPerson: { type: DataTypes.STRING },\n      phone: { type: DataTypes.STRING },\n      address: { type: DataTypes.TEXT },\n    },\n    {\n      tableName: \"vendors\",\n      timestamps: true,\n    }\n  );\n\n  Vendor.associate = (models) => {\n    Vendor.hasMany(models.Procurement, { foreignKey: \"vendorId\" });\n  };\n\n  return Vendor;\n};\n","\"use strict\";\n\nconst fs = require(\"fs\");\nconst path = require(\"path\");\nconst Sequelize = require(\"sequelize\");\nconst { sequelizeJoi, Joi } = require(\"sequelize-joi\");\nconst process = require(\"process\");\nconst basename = path.basename(__filename);\nconst env = process.env.NODE_ENV || \"dev\";\nconst envFile = env === \"prod\" ? \".env.prod\" : \".env.dev\";\nrequire(\"dotenv\").config();\nconst config = require(__dirname + \"/../configs/db.config\")[env];\nconst db = {};\nlet sequelize;\nif (config?.use_env_variable) {\n  sequelize = new Sequelize(process.env[config.use_env_variable], config);\n} else {\n  sequelize = new Sequelize({\n    database: process.env.DB_NAME,\n    username: process.env.DB_USERNAME,\n    password: process.env.DB_PASSWORD,\n    host: process.env.DB_HOST,\n    port: process.env.DB_PORT,\n    dialect: process.env.DB_DIALECT,\n    dialectOptions: {\n      ssl: {\n        require: true, // This will help you. But you will see nwe error\n        rejectUnauthorized: false, // This line will fix new error\n      },\n    },\n    logging: false,\n  });\n  // sequelize = new Sequelize(config.database, config.username, config.password, {\n  //   ...config,\n  // });\n}\nsequelizeJoi(sequelize);\nif (env === \"dev\") {\n  fs.readdirSync(__dirname)\n    .filter((file) => {\n      return (\n        file.indexOf(\".\") !== 0 &&\n        file !== basename &&\n        file.slice(-3) === \".js\" &&\n        file.indexOf(\".test.js\") === -1\n      );\n    })\n    .forEach((file) => {\n      const model = require(path.join(__dirname, file))(\n        sequelize,\n        Sequelize.DataTypes,\n        Joi\n      );\n      db[model.name] = model;\n    });\n} else {\n  const modelContext = require.context(\".\", false, /\\.js$/);\n  modelContext.keys().forEach((file) => {\n    if (file !== \"./index.js\" && file.slice(-8) !== \".test.js\") {\n      const model = modelContext(file)(sequelize, Sequelize.DataTypes, Joi);\n      db[model.name] = model;\n    }\n  });\n}\n\nObject.keys(db).forEach((modelName) => {\n  if (db[modelName].associate) {\n    db[modelName].associate(db);\n  }\n});\nasync function syncDatabase() {\n  try {\n    await db.Notification.sync({ alter: true });\n    console.log(\"Database synchronized successfully.\");\n  } catch (error) {\n    console.error(\"Error synchronizing the database:\", error);\n  }\n}\n\n// syncDatabase();\ndb.sequelize = sequelize;\ndb.Sequelize = Sequelize;\n\nmodule.exports = db;\n","const itemService = require(\"./item.service\");\n\nconst getAllItems = async (req, res) => {\n  const items = await itemService.getAllItems();\n  res.sendResponse(items, \"All items fetched successfully\");\n};\n\nconst getItemById = async (req, res) => {\n  const item = await itemService.getItemById(req.params.id);\n  res.sendResponse(item, \"Item fetched successfully\");\n};\n\nconst createItem = async (req, res) => {\n  const item = await itemService.createItem(req.body);\n  res.sendResponse(item, \"Item created successfully\");\n};\n\nconst updateItem = async (req, res) => {\n  const item = await itemService.updateItem(req.params.id, req.body);\n  res.sendResponse(item, \"Item updated successfully\");\n};\n\nconst deleteItem = async (req, res) => {\n  await itemService.deleteItem(req.params.id);\n  res.sendResponse(null, \"Item deleted successfully\");\n};\n\nmodule.exports = {\n  getAllItems,\n  getItemById,\n  createItem,\n  updateItem,\n  deleteItem,\n};\n","const router = require(\"express\").Router();\nconst asyncMiddleware = require(\"../../middlewares/asyncMiddleware\");\nconst itemController = require(\"./item.controller\");\nconst validateRequest = require(\"../../middlewares/validateRequest\");\nconst { createItemSchema, updateItemSchema } = require(\"./item.validator\");\n\nrouter.get(\"/items\", asyncMiddleware(itemController.getAllItems));\nrouter.get(\"/items/:id\", asyncMiddleware(itemController.getItemById));\nrouter.post(\"/items\", validateRequest(createItemSchema), asyncMiddleware(itemController.createItem));\nrouter.put(\"/items/:id\", validateRequest(updateItemSchema), asyncMiddleware(itemController.updateItem));\nrouter.delete(\"/items/:id\", asyncMiddleware(itemController.deleteItem));\n\nmodule.exports = router;\n","const { Op } = require(\"sequelize\");\nconst db = require(\"./../../models\");\n\nconst getAllItems = async () => {\n  return await db.Item.findAll({\n    include: [{ model: db.ItemGroup }, { model: db.Unit }],\n  });\n};\n\nconst getItemById = async (id) => {\n  return await db.Item.findByPk(id, {\n    include: [{ model: db.ItemGroup }, { model: db.Unit }],\n  });\n};\n\nconst createItem = async (data) => {\n  return await db.Item.create(data);\n};\n\nconst updateItem = async (id, data) => {\n  const item = await db.Item.findByPk(id);\n  if (!item) throw new Error(\"Item not found\");\n  return await item.update(data);\n};\n\nconst deleteItem = async (id) => {\n  const item = await db.Item.findByPk(id);\n  if (!item) throw new Error(\"Item not found\");\n  await item.destroy();\n};\n\nconst getAllItemsV2 = async ({\n  page = 1,\n  limit = 10,\n  orderBy = \"name\",\n  orderDirection = \"ASC\",\n  search = \"\",\n  filters = {},\n}) => {\n  const offset = (page - 1) * limit;\n\n  const whereClause = {\n    ...filters,\n    ...(search && {\n      [Op.or]: [\n        { name: { [Op.iLike]: `%${search}%` } },\n        { shortName: { [Op.iLike]: `%${search}%` } },\n        { partNumber: { [Op.iLike]: `%${search}%` } },\n        { hsnCode: { [Op.iLike]: `%${search}%` } },\n      ],\n    }),\n  };\n\n  const { count, rows } = await db.Item.findAndCountAll({\n    where: whereClause,\n    include: [{ model: db.ItemGroup }, { model: db.Unit }],\n    order: [[orderBy, orderDirection]],\n    limit,\n    offset,\n  });\n\n  return {\n    data: rows,\n    currentPage: page,\n    totalPages: Math.ceil(count / limit),\n    totalCount: count,\n  };\n};\nmodule.exports = {\n  getAllItems,\n  getItemById,\n  createItem,\n  updateItem,\n  deleteItem,\n  getAllItemsV2,\n};\n","const Joi = require(\"joi\");\n\nconst createItemSchema = Joi.object({\n  name: Joi.string().min(2).max(100).required(),\n  shortName: Joi.string().allow(null, \"\").max(50),\n  partNumber: Joi.string().allow(null, \"\").max(50),\n  hsnCode: Joi.string().allow(null, \"\").max(50),\n  itemGroupId: Joi.number().integer().positive().required(),\n  unitId: Joi.number().integer().positive().required(),\n});\n\nconst updateItemSchema = createItemSchema;\n\nmodule.exports = { createItemSchema, updateItemSchema };\n","const itemGroupService = require(\"./itemGroup.service\");\n\nconst getAllItemGroups = async (req, res) => {\n  const groups = await itemGroupService.getAllItemGroups();\n  res.sendResponse(groups, \"All item groups fetched successfully\");\n};\n\nconst getItemGroupById = async (req, res) => {\n  const group = await itemGroupService.getItemGroupById(req.params.id);\n  res.sendResponse(group, \"Item group fetched successfully\");\n};\n\nconst createItemGroup = async (req, res) => {\n  const group = await itemGroupService.createItemGroup(req.body);\n  res.sendResponse(group, \"Item group created successfully\");\n};\n\nconst updateItemGroup = async (req, res) => {\n  const group = await itemGroupService.updateItemGroup(req.params.id, req.body);\n  res.sendResponse(group, \"Item group updated successfully\");\n};\n\nconst deleteItemGroup = async (req, res) => {\n  await itemGroupService.deleteItemGroup(req.params.id);\n  res.sendResponse(null, \"Item group deleted successfully\");\n};\n\nmodule.exports = {\n  getAllItemGroups,\n  getItemGroupById,\n  createItemGroup,\n  updateItemGroup,\n  deleteItemGroup,\n};\n","const router = require(\"express\").Router();\nconst asyncMiddleware = require(\"../../middlewares/asyncMiddleware\");\nconst itemGroupController = require(\"./itemGroup.controller\");\nconst validateRequest = require(\"../../middlewares/validateRequest\");\nconst { createItemGroupSchema, updateItemGroupSchema } = require(\"./itemGroup.validator\");\n\nrouter.get(\"/item-groups\", asyncMiddleware(itemGroupController.getAllItemGroups));\nrouter.get(\"/item-groups/:id\", asyncMiddleware(itemGroupController.getItemGroupById));\nrouter.post(\"/item-groups\", validateRequest(createItemGroupSchema), asyncMiddleware(itemGroupController.createItemGroup));\nrouter.put(\"/item-groups/:id\", validateRequest(updateItemGroupSchema), asyncMiddleware(itemGroupController.updateItemGroup));\nrouter.delete(\"/item-groups/:id\", asyncMiddleware(itemGroupController.deleteItemGroup));\n\nmodule.exports = router;\n","const { Op } = require(\"sequelize\");\nconst db = require(\"./../../models\");\n\nconst getAllItemGroups = async () => {\n  return await db.ItemGroup.findAll({\n    include: [{ model: db.Item }],\n  });\n};\n\nconst getAllItemGroupsV2 = async ({\n  page = 1,\n  limit = 10,\n  orderBy = \"name\",\n  orderDirection = \"ASC\",\n  search = \"\",\n  filters = {},\n}) => {\n  const offset = (page - 1) * limit;\n\n  const whereClause = {\n    ...filters,\n    ...(search && {\n      [Op.or]: [\n        { name: { [Op.iLike]: `%${search}%` } },\n        { shortName: { [Op.iLike]: `%${search}%` } },\n        { itemType: { [Op.iLike]: `%${search}%` } },\n      ],\n    }),\n  };\n\n  const { count, rows } = await db.ItemGroup.findAndCountAll({\n    where: whereClause,\n    include: [{ model: db.Item }],\n    order: [[orderBy, orderDirection]],\n    limit,\n    offset,\n  });\n\n  return {\n    data: rows,\n    currentPage: page,\n    totalPages: Math.ceil(count / limit),\n    totalCount: count,\n  };\n};\n\nconst getItemGroupById = async (id) => {\n  return await db.ItemGroup.findByPk(id, {\n    include: [{ model: db.Item }],\n  });\n};\n\nconst createItemGroup = async (data) => {\n  return await db.ItemGroup.create(data);\n};\n\nconst updateItemGroup = async (id, data) => {\n  const group = await db.ItemGroup.findByPk(id);\n  if (!group) throw new Error(\"Item group not found\");\n  return await group.update(data);\n};\n\nconst deleteItemGroup = async (id) => {\n  const group = await db.ItemGroup.findByPk(id);\n  if (!group) throw new Error(\"Item group not found\");\n  await group.destroy();\n};\n\nmodule.exports = {\n  getAllItemGroups,\n  getItemGroupById,\n  createItemGroup,\n  updateItemGroup,\n  deleteItemGroup,\n  getAllItemGroupsV2,\n};\n","const Joi = require(\"joi\");\n\nconst createItemGroupSchema = Joi.object({\n  name: Joi.string().min(2).max(100).required(),\n  shortName: Joi.string().allow(null, \"\").max(50),\n  itemType: Joi.string().allow(null, \"\").max(50),\n});\n\nconst updateItemGroupSchema = createItemGroupSchema;\n\nmodule.exports = {\n  createItemGroupSchema,\n  updateItemGroupSchema,\n};\n","const unitService = require(\"./unit.service\");\n\nconst getAllUnits = async (req, res) => {\n  const units = await unitService.getAllUnits();\n  res.sendResponse(units, \"All units fetched successfully\");\n};\n\nconst getAllUnitsV2 = async (req, res) => {\n  const { page, limit, orderBy, orderDirection, search } = req.query\n  const units = await unitService.getAllUnitsV2(page, limit, orderBy, orderDirection, search);\n  res.sendResponse(units, \"All units fetched successfully\");\n};\n\nconst getUnitById = async (req, res) => {\n  const unit = await unitService.getUnitById(req.params.id);\n  res.sendResponse(unit, \"Unit fetched successfully\");\n};\n\nconst createUnit = async (req, res) => {\n  const unit = await unitService.createUnit(req.body);\n  res.sendResponse(unit, \"Unit created successfully\");\n};\n\nconst updateUnit = async (req, res) => {\n  const unit = await unitService.updateUnit(req.params.id, req.body);\n  res.sendResponse(unit, \"Unit updated successfully\");\n};\n\nconst deleteUnit = async (req, res) => {\n  await unitService.deleteUnit(req.params.id);\n  res.sendResponse(null, \"Unit deleted successfully\");\n};\n\nmodule.exports = {\n  getAllUnits,\n  getUnitById,\n  createUnit,\n  updateUnit,\n  deleteUnit,\n};\n","const router = require(\"express\").Router();\nconst asyncMiddleware = require(\"../../middlewares/asyncMiddleware\");\nconst unitController = require(\"./unit.controller\");\nconst validateRequest = require(\"../../middlewares/validateRequest\");\nconst { createUnitSchema, updateUnitSchema } = require(\"./unit.validator\");\n\nrouter.get(\"/units\", asyncMiddleware(unitController.getAllUnits));\nrouter.get(\"/units/:id\", asyncMiddleware(unitController.getUnitById));\nrouter.post(\"/units\", validateRequest(createUnitSchema), asyncMiddleware(unitController.createUnit));\nrouter.put(\"/units/:id\", validateRequest(updateUnitSchema), asyncMiddleware(unitController.updateUnit));\nrouter.delete(\"/units/:id\", asyncMiddleware(unitController.deleteUnit));\n\nmodule.exports = router;\n","const { Op } = require(\"sequelize\");\nconst db = require(\"./../../models\");\n\nconst getAllUnits = async () => {\n  return await db.Unit.findAll({\n    include: [{ model: db.Item }],\n  });\n};\n\nconst getUnitById = async (id) => {\n  return await db.Unit.findByPk(id, {\n    include: [{ model: db.Item }],\n  });\n};\n\nconst createUnit = async (data) => {\n  return await db.Unit.create(data);\n};\n\nconst updateUnit = async (id, data) => {\n  const unit = await db.Unit.findByPk(id);\n  if (!unit) throw new Error(\"Unit not found\");\n  return await unit.update(data);\n};\n\nconst deleteUnit = async (id) => {\n  const unit = await db.Unit.findByPk(id);\n  if (!unit) throw new Error(\"Unit not found\");\n  await unit.destroy();\n};\n\nconst getAllUnitsV2 = async ({\n  page = 1,\n  limit = 10,\n  orderBy = \"name\",\n  orderDirection = \"ASC\",\n  search = \"\",\n  filters = {},\n}) => {\n  const offset = (page - 1) * limit;\n\n  const whereClause = {\n    ...filters,\n    ...(search && {\n      [Op.or]: [\n        { name: { [Op.iLike]: `%${search}%` } },\n        { shortName: { [Op.iLike]: `%${search}%` } },\n      ],\n    }),\n  };\n\n  const { count, rows } = await db.Unit.findAndCountAll({\n    where: whereClause,\n    include: [{ model: db.Item }],\n    order: [[orderBy, orderDirection]],\n    limit,\n    offset,\n  });\n\n  return {\n    data: rows,\n    currentPage: page,\n    totalPages: Math.ceil(count / limit),\n    totalCount: count,\n  };\n};\n\nmodule.exports = {\n  getAllUnits,\n  getUnitById,\n  createUnit,\n  updateUnit,\n  deleteUnit,\n  getAllUnitsV2,\n};\n","const Joi = require(\"joi\");\n\nconst createUnitSchema = Joi.object({\n  name: Joi.string().min(1).max(50).required(),\n  shortName: Joi.string().min(1).max(10).required(),\n  decimalPlaces: Joi.number().integer().min(0).max(5).allow(null),\n});\n\nconst updateUnitSchema = createUnitSchema;\n\nmodule.exports = {\n  createUnitSchema,\n  updateUnitSchema,\n};\n","const jwt = require(\"jsonwebtoken\");\nconst db = require(\"../../models\");\n\nmodule.exports = { login, logout, refreshToken, checkToken };\n// exports.exportLevelReport = function (req, res)\nasync function login(req, res, next) {\n  try {\n    const { email, password } = req.body;\n    const user = await db.User.findOne({\n      where: { email },\n      include: [\n        { model: db.Role, attributes: [\"name\", \"id\"] },\n        { model: db.Site, attributes: [\"name\", \"id\", \"address\"] },\n        { model: db.Department, attributes: [\"name\", \"id\"] },\n      ],\n    });\n    if (!user || !(await user.validPassword(password))) {\n      const error = new Error();\n      error.message = \"Invalid email or password\";\n      error.statusCode = 401;\n      throw error;\n    }\n\n    const token = generateToken(user);\n\n    // Set JWT in HttpOnly cookie\n    res.cookie(\"token\", token, {\n      httpOnly: false,\n      secure: true, // Set to true in production with HTTPS\n      sameSite: \"None\", // Required for cross-origin requests\n      maxAge: 3600000 * 24 * 180, // 1 hour in milliseconds\n      path: \"/\",\n    });\n\n    res.sendResponse(\n      {\n        id: user.id,\n        name: user.name,\n        email: user.email,\n        roleId: user.roleId,\n        role: user.Role,\n        // departmentId: user.departmentId,\n        // siteId: user.siteId,\n        image: user.image,\n        site: user.Site,\n        department: user.Department,\n      },\n      \"Login successful\"\n    );\n  } catch (error) {\n    next(error);\n  }\n}\n\nasync function logout(req, res) {\n  const token = req.cookies.token;\n\n  //   if (token) {\n  //     try {\n  //       const decoded = jwt.decode(token);\n  //     //   const expirationDate = new Date(decoded.exp * 1000);\n\n  //     //   await db.JwtTokenBlacklist.create({\n  //     //     token,\n  //     //     expiration_date: expirationDate,\n  //     //   });\n  //     } catch (error) {\n  //       console.error(\"Error blacklisting token:\", error);\n  //     }\n  //   }\n\n  res.clearCookie(\"token\", {\n    httpOnly: false,\n    secure: true, // Match the same attributes used during cookie setting\n    sameSite: \"None\",\n  });\n  res.sendResponse([], \"Logout successful\");\n}\n\nasync function refreshToken(req, res) {\n  const token = req.cookies.token;\n\n  if (!token) {\n    return res\n      .status(401)\n      .json({ message: \"Unauthorized: No refresh token provided\" });\n  }\n\n  // Check if token is blacklisted\n  //   const blacklistedToken = await db.JwtTokenBlacklist.findOne({\n  //     where: { token },\n  //   });\n  //   if (blacklistedToken) {\n  //     return res\n  //       .status(403)\n  //       .json({ message: \"Forbidden: Token has been invalidated\" });\n  //   }\n\n  try {\n    const decoded = jwt.verify(token, \"process.env.JWT_SECRET\");\n    const user = {\n      id: decoded.userid,\n      email: decoded.email,\n      role: decoded.role,\n    };\n\n    const newToken = generateToken(user);\n\n    // Set the new JWT in HttpOnly cookie\n    res.cookie(\"token\", newToken, {\n      httpOnly: true,\n      secure: true,\n      // secure: process.env.NODE_ENV === \"production\",\n      sameSite: \"None\",\n      maxAge: 3600000,\n    });\n\n    res.sendResponse({}, \"Token refreshed successfully\");\n  } catch (error) {\n    // console.log(error);\n    return res\n      .status(403)\n      .json({ message: \"Forbidden: Invalid refresh token\" });\n  }\n}\n\nasync function checkToken(req, res) {\n  try {\n    const token = req.cookies.token;\n\n    if (!token) {\n      return res.json({ isAuthenticated: false, token: false });\n    }\n\n    const blacklistedToken = await db.JwtTokenBlacklist.findOne({\n      where: { token },\n    });\n    if (blacklistedToken) {\n      return res.json({ isAuthenticated: false });\n    }\n\n    // Verify the token\n    jwt.verify(token, \"process.env.JWT_SECRET\", (err, decoded) => {\n      if (err) {\n        return res.json({ isAuthenticated: false });\n      }\n\n      return res.json({ isAuthenticated: true });\n    });\n  } catch (error) {\n    // console.log(\"Error checking token: \", error);\n    return res.status(500).json({ isAuthenticated: false });\n  }\n}\n\nfunction generateToken(user) {\n  const payload = {\n    id: user.id,\n    roleId: user.roleId,\n    departmentId: user.departmentId,\n    siteId: user.siteId,\n  };\n  return jwt.sign(payload, process.env.JWT_SECRET, { expiresIn: \"180d\" });\n}\n","const express = require(\"express\");\nconst router = express.Router();\n// const tokenValidator = require(\"./../../Middleware/tokenValidator\");\nconst contorller = require(\"./auth.controller\");\nconst { loginSchema } = require(\"./auth.validator\");\nconst validateRequest = require(\"../../middlewares/validateRequest\");\n\nrouter.post(\"/login\", validateRequest(loginSchema), contorller.login);\nrouter.post(\"/logout\", contorller.logout);\n// router.post(\"/refreshToken\", isAuthenticated, contorller.refreshToken);\n// router.post(\"/check-auth\", tokenValidator, function (req, res) {\n//   res.sendResponse({ isAuthenticated: true });\n// });\n\n// app.put('/update-profile', authMiddleware, userController.updateProfile);\n\nmodule.exports = router;\n","const Joi = require(\"joi\");\n\n// Define the Joi schema\nconst loginSchema = Joi.object({\n  email: Joi.string().email().required().messages({\n    \"string.email\": \"Please enter a valid email address\",\n    \"any.required\": \"Email is required\",\n  }),\n  password: Joi.string()\n    .min(8)\n    .pattern(\n      new RegExp(\n        \"^(?=.*[a-z])(?=.*[A-Z])(?=.*\\\\d)\"\n      )\n    )\n    .required()\n    .messages({\n      \"string.empty\": \"Password cannot be empty\",\n      \"any.required\": \"Password is required\",\n      \"string.min\": \"Password must be at least 8 characters long\",\n      \"string.pattern.base\":\n        \"Password must include at least one uppercase letter, one lowercase letter, one number, and one special character\",\n    }),\n});\n\nmodule.exports = {\n  loginSchema,\n};\n","const categoryService = require(\"./category.service\");\n\n//  Create Primary Category\nconst createPrimaryCategory = async (req, res) => {\n  const category = await categoryService.createPrimaryCategory(req.body);\n  res.sendResponse(category, \"Primary Category created successfully\");\n};\n\n//  Get All Primary Categories\nconst getAllPrimaryCategories = async (req, res) => {\n  const categories = await categoryService.getAllPrimaryCategories();\n  res.sendResponse(categories, \"All Primary Categories fetched successfully\");\n};\n\n//  Get Primary Category by ID\nconst getPrimaryCategoryById = async (req, res) => {\n  const category = await categoryService.getPrimaryCategoryById(req.params.id);\n  res.sendResponse(category, \"Primary Category fetched successfully\");\n};\n\n//  Update Primary Category\nconst updatePrimaryCategory = async (req, res) => {\n  const category = await categoryService.updatePrimaryCategory(req.params.id, req.body);\n  res.sendResponse(category, \"Primary Category updated successfully\");\n};\n\n//  Delete Primary Category\nconst deletePrimaryCategory = async (req, res) => {\n  const result = await categoryService.deletePrimaryCategory(req.params.id);\n  res.sendResponse(null, result.message);\n};\n\n//  Create Machine Category\nconst createMachineCategory = async (req, res) => {\n  const category = await categoryService.createMachineCategory(req.body);\n  res.sendResponse(category, \"Machine Category created successfully\");\n};\n\n//  Get All Machine Categories\nconst getAllMachineCategories = async (req, res) => {\n  const categories = await categoryService.getAllMachineCategories();\n  res.sendResponse(categories, \"All Machine Categories fetched successfully\");\n};\n\n//  Get Machine Category by ID\nconst getMachineCategoryById = async (req, res) => {\n  const category = await categoryService.getMachineCategoryById(req.params.id);\n  res.sendResponse(category, \"Machine Category fetched successfully\");\n};\n\n//  Update Machine Category\nconst updateMachineCategory = async (req, res) => {\n  const category = await categoryService.updateMachineCategory(req.params.id, req.body);\n  res.sendResponse(category, \"Machine Category updated successfully\");\n};\n\n//  Delete Machine Category\nconst deleteMachineCategory = async (req, res) => {\n  const result = await categoryService.deleteMachineCategory(req.params.id);\n  res.sendResponse(null, result.message);\n};\n\nmodule.exports = {\n  createPrimaryCategory,\n  getAllPrimaryCategories,\n  getPrimaryCategoryById,\n  updatePrimaryCategory,\n  deletePrimaryCategory,\n  createMachineCategory,\n  getAllMachineCategories,\n  getMachineCategoryById,\n  updateMachineCategory,\n  deleteMachineCategory,\n};\n","const express = require(\"express\");\nconst categoryController = require(\"./category.controller\");\nconst CategorySchema = require(\"./category.validator\");\nconst validateRequest = require(\"../../middlewares/validateRequest\");\nconst asyncMiddleware = require(\"../../middlewares/asyncMiddleware\");\nconst hasRole = require(\"./../../middlewares/hasRole\")\n\nconst router = express.Router();\n\n//  Primary Category Routes\nrouter.post(\n  \"/primary\",\n  hasRole([1, 2, 3]),\n  validateRequest(CategorySchema.createPrimaryCategorySchema),\n  asyncMiddleware(categoryController.createPrimaryCategory)\n);\nrouter.get(\"/primary\", asyncMiddleware(categoryController.getAllPrimaryCategories));\nrouter.get(\"/primary/:id\", asyncMiddleware(categoryController.getPrimaryCategoryById));\nrouter.put(\n  \"/primary/:id\",\n  hasRole([1, 2, 3]),\n  validateRequest(CategorySchema.updatePrimaryCategorySchema),\n  asyncMiddleware(categoryController.updatePrimaryCategory)\n);\nrouter.delete(\"/primary/:id\", hasRole([1, 2, 3]), asyncMiddleware(categoryController.deletePrimaryCategory));\n\n//  Machine Category Routes\nrouter.post(\n  \"/machine\",\n  hasRole([1, 2, 3]),\n  validateRequest(CategorySchema.createMachineCategorySchema),\n  asyncMiddleware(categoryController.createMachineCategory)\n);\nrouter.get(\"/machine\", asyncMiddleware(categoryController.getAllMachineCategories));\nrouter.get(\"/machine/:id\", asyncMiddleware(categoryController.getMachineCategoryById));\nrouter.put(\n  \"/machine/:id\",\n  hasRole([1, 2, 3]),\n  validateRequest(CategorySchema.updateMachineCategorySchema),\n  asyncMiddleware(categoryController.updateMachineCategory)\n);\nrouter.delete(\"/machine/:id\",\n  hasRole([1, 2, 3]),\n  asyncMiddleware(categoryController.deleteMachineCategory)\n);\n\nmodule.exports = router;\n","const { Op } = require(\"sequelize\");\nconst db = require(\"../../models\");\n\n//  Create Primary Category\nconst createPrimaryCategory = async (data) => {\n  return await db.PrimaryCategory.create(data);\n};\n\n//  Get All Primary Categories with Machine Categories\nconst getAllPrimaryCategories = async () => {\n  return await db.PrimaryCategory.findAll({\n    include: [{ model: db.MachineCategory, as: \"machineCategories\" }],\n  });\n};\n\n//  Get Primary Category by ID\nconst getPrimaryCategoryById = async (id) => {\n  const category = await db.PrimaryCategory.findByPk(id, {\n    include: [{ model: db.MachineCategory, as: \"machineCategories\" }],\n  });\n  if (!category) throw new Error(\"Primary Category not found.\");\n  return category;\n};\n\n//  Update Primary Category\nconst updatePrimaryCategory = async (id, data) => {\n  const category = await db.PrimaryCategory.findByPk(id);\n  if (!category) throw new Error(\"Primary Category not found.\");\n  await category.update(data);\n  return category;\n};\n\n//  Delete Primary Category\nconst deletePrimaryCategory = async (id) => {\n  const category = await db.PrimaryCategory.findByPk(id);\n  if (!category) throw new Error(\"Primary Category not found.\");\n  await category.destroy();\n  return { message: \"Primary Category deleted successfully.\" };\n};\n\n//  Create Machine Category\nconst createMachineCategory = async (data) => {\n  return await db.MachineCategory.create(data);\n};\n\n//  Get All Machine Categories\nconst getAllMachineCategories = async () => {\n  return await db.MachineCategory.findAll({\n    include: [{ model: db.PrimaryCategory, as: \"primaryCategory\" }],\n  });\n};\n\n//  Get Machine Category by ID\nconst getMachineCategoryById = async (id) => {\n  const category = await db.MachineCategory.findByPk(id, {\n    include: [{ model: db.PrimaryCategory, as: \"primaryCategory\" }],\n  });\n  if (!category) throw new Error(\"Machine Category not found.\");\n  return category;\n};\n\n//  Update Machine Category\nconst updateMachineCategory = async (id, data) => {\n  const category = await db.MachineCategory.findByPk(id);\n  if (!category) throw new Error(\"Machine Category not found.\");\n  await category.update(data);\n  return category;\n};\n\n//  Delete Machine Category\nconst deleteMachineCategory = async (id) => {\n  const category = await db.MachineCategory.findByPk(id);\n  if (!category) throw new Error(\"Machine Category not found.\");\n  await category.destroy();\n  return { message: \"Machine Category deleted successfully.\" };\n};\n\nconst getAllMachineCategoriesV2 = async (req, res) => {\n  const {\n    page = 1,\n    limit = 20,\n    search = \"\",\n    sortBy = \"name\",\n    sortOrder = \"ASC\",\n    machineType,\n    averageBase,\n    primaryCategoryId,\n  } = req.query;\n\n  const offset = (page - 1) * limit;\n  const whereClause = {};\n\n  if (search) {\n    whereClause[Op.or] = [\n      { name: { [Op.iLike]: `%${search}%` } },\n      { remarks: { [Op.iLike]: `%${search}%` } },\n    ];\n  }\n\n  if (machineType) whereClause.machineType = machineType;\n  if (averageBase) whereClause.averageBase = averageBase;\n  if (primaryCategoryId) whereClause.primaryCategoryId = primaryCategoryId;\n\n  const { count, rows: categories } = await db.MachineCategory.findAndCountAll({\n    where: whereClause,\n    include: [\n      {\n        model: db.PrimaryCategory,\n        as: \"primaryCategory\",\n        attributes: [\"id\", \"name\"],\n      },\n    ],\n    order: [[sortBy, sortOrder]],\n    offset,\n    limit,\n  });\n\n  res.sendResponse({\n    data: categories,\n    totalCount: count,\n    totalPages: Math.ceil(count / limit),\n    currentPage: Number(page),\n  });\n};\nmodule.exports = {\n  createPrimaryCategory,\n  getAllPrimaryCategories,\n  getPrimaryCategoryById,\n  updatePrimaryCategory,\n  deletePrimaryCategory,\n  createMachineCategory,\n  getAllMachineCategories,\n  getMachineCategoryById,\n  updateMachineCategory,\n  deleteMachineCategory,\n  getAllMachineCategoriesV2,\n};\n","const Joi = require(\"joi\");\n\n//  Schema for Primary Category\nconst createPrimaryCategorySchema = Joi.object({\n  name: Joi.string().trim().min(2).max(50).required(),\n});\n\nconst updatePrimaryCategorySchema = Joi.object({\n  name: Joi.string().trim().min(2).max(50).required(),\n});\n\n//  Schema for Machine Category\nconst createMachineCategorySchema = Joi.object({\n  name: Joi.string().trim().min(2).max(50).required(),\n  primaryCategoryId: Joi.number().integer().positive().allow(null),\n  averageBase: Joi.string().valid(\"Distance\", \"Time\", \"Both\", \"None\").allow(null),\n  standardKmRun: Joi.number().positive().allow(null),\n  standardMileage: Joi.number().positive().allow(null),\n  standardHrsRun: Joi.number().positive().allow(null),\n  ltrPerHour: Joi.number().positive().allow(null),\n  remarks: Joi.string().trim().allow(null, \"\"),\n  useFor: Joi.string().trim().allow(null, \"\"),\n  machineType: Joi.string().valid(\"Vehicle\", \"Machine\", \"Drilling\").allow(null),\n  unitPerHour: Joi.number().positive().allow(null),\n  isApplicable: Joi.array().allow(null), // JSON field\n  other: Joi.string().trim().allow(null, \"\"),\n});\n\nconst updateMachineCategorySchema = Joi.object({\n  name: Joi.string().trim().min(2).max(50).required(),\n  primaryCategoryId: Joi.number().integer().positive().allow(null),\n  averageBase: Joi.string().valid(\"Distance\", \"Time\", \"Both\", \"None\").allow(null),\n  standardKmRun: Joi.number().positive().allow(null),\n  standardMileage: Joi.number().positive().allow(null),\n  standardHrsRun: Joi.number().positive().allow(null),\n  ltrPerHour: Joi.number().positive().allow(null),\n  remarks: Joi.string().trim().allow(null, \"\"),\n  useFor: Joi.string().trim().allow(null, \"\"),\n  machineType: Joi.string().valid(\"Vehicle\", \"Machine\", \"Drilling\").allow(null),\n  unitPerHour: Joi.number().positive().allow(null),\n  isApplicable: Joi.array().allow(null), // JSON field\n  other: Joi.string().trim().allow(null, \"\"),\n});\n\nmodule.exports = {\n  createPrimaryCategorySchema,\n  updatePrimaryCategorySchema,\n  createMachineCategorySchema,\n  updateMachineCategorySchema,\n};","const cron = require(\"node-cron\");\nconst {\n  checkMachineryDocumentExpiry,\n  checkLowAndOutOfStock,\n  checkScheduledMaintenanceAlerts,\n  // checkMachineServiceIntervalAlerts,\n  checkMachineMaintenanceAlerts\n} = require(\"./tasks\");\n\nmodule.exports = function startCronJobs() {\n  // Run every day at 7 AM\n  cron.schedule(\"0 7 * * *\", async () => {\n    console.log(\"Running Low Stock and Document Expiry Checks...\");\n    try {\n      await checkMachineryDocumentExpiry();\n      await checkLowAndOutOfStock();\n    } catch (error) {\n      console.log(error);\n    }\n  });\n\n  // Run every day at 8 AM to check for maintenance alerts\n  cron.schedule(\"0 8 * * *\", async () => {\n    console.log(\"Running Scheduled Maintenance Alert Checks...\");\n    try {\n      // await checkScheduledMaintenanceAlerts();\n      // await checkMachineServiceIntervalAlerts(); // Check machine service intervals as well\n      await checkMachineMaintenanceAlerts(); // Check machine maintenance alerts based on intervals and current readings\n    } catch (error) {\n      console.log(error);\n    }\n  });\n};\n","const { Op } = require(\"sequelize\");\nconst db = require(\"./../../../models\");\nconst moment = require(\"moment\");\nconst roles = require(\"../../../utils/roles\");\n\nconst EXPIRY_FIELDS = [\n  { field: \"fitnessCertificateExpiry\", label: \"Fitness Certificate\" },\n  { field: \"motorVehicleTaxDue\", label: \"Motor Vehicle Tax\" },\n  { field: \"permitExpiryDate\", label: \"Permit\" },\n  { field: \"nationalPermitExpiry\", label: \"National Permit\" },\n  { field: \"insuranceExpiry\", label: \"Insurance\" },\n  { field: \"pollutionCertificateExpiry\", label: \"Pollution Certificate\" },\n];\n\n// Check if a notification already exists to prevent duplicates\nconst alreadyNotified = async (machineId, eventAction) => {\n  const today = moment().startOf(\"day\").toDate();\n  const existing = await db.Notification.findOne({\n    where: {\n      eventType: \"DocumentExpiry\",\n      referenceId: machineId,\n      eventAction,\n      createdAt: {\n        [Op.gte]: today,\n      },\n    },\n  });\n  return !!existing;\n};\n\nconst checkMachineryDocumentExpiries = async () => {\n  const upcomingDate = moment().add(15, \"days\").toDate(); // 15 days notice\n\n  const machineries = await db.Machinery.findAll({\n    where: {\n      [Op.or]: EXPIRY_FIELDS.map(({ field }) => ({\n        [field]: { [Op.lte]: upcomingDate },\n      })),\n    },\n    include: [{ model: db.Site, as: \"site\" }],\n  });\n\n  for (const machine of machineries) {\n    for (const { field, label } of EXPIRY_FIELDS) {\n      const expiryDate = machine[field];\n      if (expiryDate && moment(expiryDate).isSameOrBefore(upcomingDate)) {\n        const message = `${label} is expiring on ${moment(expiryDate).format(\n          \"YYYY-MM-DD\"\n        )} for Machine: ${machine.machineName} at ${machine.site?.name}`;\n\n        const alreadyExists = await alreadyNotified(machine.id, \"Expired\");\n        if (!alreadyExists) {\n          await db.Notification.create({\n            eventType: \"DocumentExpiry\",\n            eventAction: \"Expired\",\n            title: label,\n            referenceId: machine.id,\n            siteId: machine.siteId,\n            description: message,\n            roles: [\n              roles.STORE_MANAGER,\n              roles.PROJECT_MANAGER,\n              roles.MECHANICAL_MANAGER,\n            ],\n          });\n        }\n      }\n    }\n  }\n};\n\nmodule.exports = {\n  checkMachineryDocumentExpiries,\n};\n","const roles = require(\"../../../utils/roles\");\nconst db = require(\"./../../../models\");\n\nconst checkLowAndOutOfStock = async () => {\n  const inventories = await db.SiteInventory.findAll({\n    include: [\n      { model: db.Item },\n      { model: db.Site, where: { type: \"physical\" }, required: true },\n    ],\n  });\n\n  for (const inv of inventories) {\n    let eventAction = null;\n    if (inv.quantity === 0) {\n      eventAction = \"Out of Stock\";\n    } else if (inv.quantity < inv.minimumLevel) {\n      eventAction = \"Low Stock\";\n    }\n\n    if (eventAction) {\n      await db.Notification.create({\n        eventType: \"LowStock\",\n        eventAction,\n        referenceId: inv.itemId,\n        siteId: inv.siteId,\n        title: `${inv.Item.name} ${eventAction}`,\n        description: `${inv.Item.name} is ${eventAction} at ${inv.Site?.name}`,\n        roles: [\n          roles.STORE_MANAGER,\n          roles.PROJECT_MANAGER,\n          roles.MECHANICAL_MANAGER,\n        ],\n      });\n    }\n  }\n};\n\nmodule.exports = {\n  checkLowAndOutOfStock,\n};\n","const { Op } = require(\"sequelize\");\nconst db = require(\"./../../../models\");\nconst roles = require(\"../../../utils/roles\");\n\n// Check if a maintenance alert notification already exists to prevent duplicates\nconst alreadyNotified = async (referenceId, eventAction, eventType = \"MaintenanceAlert\") => {\n  // Get start of today (00:00:00)\n  const today = new Date();\n  today.setHours(0, 0, 0, 0);\n\n  const existing = await db.Notification.findOne({\n    where: {\n      eventType,\n      referenceId,\n      eventAction,\n      createdAt: {\n        [Op.gte]: today,\n      },\n    },\n  });\n  return !!existing;\n};\n\n// Get the latest log entry for a machine\nconst getLatestLogEntry = async (machineId) => {\n  return await db.LogbookEntry.findOne({\n    where: { machineId },\n    order: [['date', 'DESC']],\n    attributes: ['id', 'date', 'machineId', 'closingKmReading', 'closingHrsMeter']\n  });\n};\n\n// Get the latest maintenance log for a machine\nconst getLatestMaintenanceLog = async (machineId) => {\n  return await db.MaintenanceLog.findOne({\n    where: { machineId },\n    order: [['date', 'DESC']],\n    attributes: ['id', 'date', 'machineId', 'hoursAtService', 'kilometersAtService']\n  });\n};\n\n// Check for machine maintenance alerts based on intervals and current readings\nconst checkMachineMaintenanceAlerts = async () => {\n  console.log(\"Running Machine Maintenance Alert Checks...\");\n\n  try {\n    // Get all active machine service intervals\n    const serviceIntervals = await db.MachineServiceInterval.findAll({\n      where: { isActive: true },\n      include: [{ model: db.Machinery, as: 'machine' }]\n    });\n\n    for (const interval of serviceIntervals) {\n      const machineId = interval.machineId;\n\n      // Get the latest log entry for the machine\n      const latestLogEntry = await getLatestLogEntry(machineId);\n      // Get the latest maintenance log for the machine\n      const latestMaintenanceLog = await getLatestMaintenanceLog(machineId);\n\n      let shouldAlert = false;\n      let alertType = '';\n      let alertMessage = '';\n      let alertTitle = '';\n\n      // If we have both log entry and maintenance log, perform comparison\n      if (latestLogEntry && latestMaintenanceLog) {\n        // Check hours-based interval\n        if (interval.intervalHours > 0) {\n          const currentHours = latestLogEntry.closingHrsMeter || 0;\n          const lastServiceHours = latestMaintenanceLog.hoursAtService || 0;\n          const nextServiceHours = lastServiceHours + interval.intervalHours;\n\n          if (currentHours >= nextServiceHours) {\n            shouldAlert = true;\n            alertType = 'Hours';\n            alertMessage = `SERVICE DUE: ${interval.serviceType} for Machine: ${interval.machine?.machineName} (Current Hours: ${currentHours}, Due at: ${nextServiceHours})`;\n            alertTitle = `Service Due: ${interval.serviceType} - Hours Based`;\n          }\n        }\n\n        // Check km-based interval\n        if (interval.intervalKm > 0 && !shouldAlert) { // Only check if not already alerting for hours\n          const currentKm = latestLogEntry.closingKmReading || 0;\n          const lastServiceKm = latestMaintenanceLog.kilometersAtService || 0;\n          const nextServiceKm = lastServiceKm + interval.intervalKm;\n\n          if (currentKm >= nextServiceKm) {\n            shouldAlert = true;\n            alertType = 'Kilometers';\n            alertMessage = `SERVICE DUE: ${interval.serviceType} for Machine: ${interval.machine?.machineName} (Current KM: ${currentKm}, Due at: ${nextServiceKm})`;\n            alertTitle = `Service Due: ${interval.serviceType} - KM Based`;\n          }\n        }\n      }\n\n      // Check calendar-based interval\n      if (interval.intervalCalendarDays > 0 && !shouldAlert) { // Only check if not already alerting for hours/km\n        if (latestMaintenanceLog) {\n          const lastServiceDate = new Date(latestMaintenanceLog.date);\n          const nextServiceDate = new Date(lastServiceDate);\n          nextServiceDate.setDate(nextServiceDate.getDate() + interval.intervalCalendarDays);\n          const currentDate = new Date();\n\n          if (currentDate >= nextServiceDate) {\n            shouldAlert = true;\n            alertType = 'Calendar';\n            const nextServiceDateStr = nextServiceDate.toISOString().split('T')[0];\n            alertMessage = `SERVICE DUE: ${interval.serviceType} for Machine: ${interval.machine?.machineName} (Due Date: ${nextServiceDateStr})`;\n            alertTitle = `Service Due: ${interval.serviceType} - Calendar Based`;\n          }\n        } else {\n          // If no maintenance log exists, check from the interval creation date\n          const intervalCreationDate = new Date(interval.createdAt);\n          const nextServiceDate = new Date(intervalCreationDate);\n          nextServiceDate.setDate(nextServiceDate.getDate() + interval.intervalCalendarDays);\n          const currentDate = new Date();\n\n          if (currentDate >= nextServiceDate) {\n            shouldAlert = true;\n            alertType = 'Calendar';\n            const nextServiceDateStr = nextServiceDate.toISOString().split('T')[0];\n            alertMessage = `SERVICE DUE: ${interval.serviceType} for Machine: ${interval.machine?.machineName} (Due Date: ${nextServiceDateStr})`;\n            alertTitle = `Service Due: ${interval.serviceType} - Calendar Based`;\n          }\n        }\n      }\n\n      // Create notification if alert is needed\n      if (shouldAlert) {\n        const notificationExists = await alreadyNotified(interval.id, `Service Due - ${alertType}`, \"MachineMaintenanceAlert\");\n        if (!notificationExists) {\n          await db.Notification.create({\n            eventType: \"MachineMaintenanceAlert\",\n            eventAction: `Service Due - ${alertType}`,\n            title: alertTitle,\n            referenceId: machineId,\n            description: alertMessage,\n            roles: [\n              roles.ADMIN,\n              roles.STORE_MANAGER,\n              roles.PROJECT_MANAGER,\n              roles.MECHANICAL_MANAGER,\n            ],\n          });\n          console.log(`Created notification for machine ${interval.machine?.machineName}, service type: ${interval.serviceType}`);\n        }\n      }\n    }\n\n    console.log(\"Machine Maintenance Alert Checks completed.\");\n  } catch (error) {\n    console.error(\"Error in checkMachineMaintenanceAlerts:\", error);\n    throw error;\n  }\n};\n\nmodule.exports = {\n  checkMachineMaintenanceAlerts,\n  getLatestLogEntry,\n  getLatestMaintenanceLog\n};\n","const { Op } = require(\"sequelize\");\nconst db = require(\"./../../../models\");\nconst roles = require(\"../../../utils/roles\");\n\n// Check if a maintenance alert notification already exists to prevent duplicates\nconst alreadyNotified = async (referenceId, eventAction, eventType = \"MaintenanceAlert\") => {\n  // Get start of today (00:00:00)\n  const today = new Date();\n  today.setHours(0, 0, 0, 0);\n  \n  const existing = await db.Notification.findOne({\n    where: {\n      eventType,\n      referenceId,\n      eventAction,\n      createdAt: {\n        [Op.gte]: today,\n      },\n    },\n  });\n  return !!existing;\n};\n\nconst checkScheduledMaintenanceAlerts = async () => {\n  const now = new Date();\n  const tomorrow = new Date();\n  tomorrow.setDate(tomorrow.getDate() + 1);\n  tomorrow.setHours(0, 0, 0, 0); // Start of tomorrow\n  \n  const nextWeek = new Date();\n  nextWeek.setDate(nextWeek.getDate() + 7);\n  nextWeek.setHours(23, 59, 59, 999); // End of next week\n\n  // Find scheduled maintenance that are due soon\n  const scheduledMaintenances = await db.MaintenanceLog.findAll({\n    where: {\n      status: 'scheduled', // Only check scheduled maintenance, not completed ones\n      dueDate: {\n        [Op.lte]: nextWeek,\n        [Op.gte]: now,\n      },\n    },\n    include: [{ model: db.Machinery, as: 'machine' }],\n  });\n\n  for (const schedule of scheduledMaintenances) {\n    const dueDate = new Date(schedule.dueDate);\n    let eventAction = null;\n    let titlePrefix = \"\";\n\n    // Determine alert type based on due date\n    const scheduleDate = new Date(dueDate);\n    scheduleDate.setHours(0, 0, 0, 0); // Compare just the date part\n    const nowDate = new Date(now);\n    nowDate.setHours(0, 0, 0, 0);\n    const tomorrowDate = new Date(tomorrow);\n    tomorrowDate.setHours(0, 0, 0, 0);\n\n    if (scheduleDate.getTime() === nowDate.getTime()) {\n      eventAction = \"Due Today\";\n      titlePrefix = \"Due Today\";\n    } else if (scheduleDate.getTime() === tomorrowDate.getTime()) {\n      eventAction = \"Due Tomorrow\";\n      titlePrefix = \"Due Tomorrow\";\n    } else if (dueDate >= now && dueDate <= nextWeek) {\n      eventAction = \"Due Soon\";\n      titlePrefix = \"Due Soon\";\n    }\n\n    if (eventAction) {\n      const message = `${titlePrefix}: ${schedule.title} for Machine: ${schedule.machine?.machineName}`;\n      const title = `${titlePrefix}: ${schedule.title}`;\n\n      const alreadyExists = await alreadyNotified(schedule.id, eventAction, \"MaintenanceAlert\");\n      if (!alreadyExists) {\n        await db.Notification.create({\n          eventType: \"MaintenanceAlert\",\n          eventAction,\n          title,\n          referenceId: schedule.id,\n          description: message,\n          roles: [\n            roles.STORE_MANAGER,\n            roles.PROJECT_MANAGER,\n            roles.MECHANICAL_MANAGER,\n          ],\n        });\n      }\n    }\n  }\n\n  // Also check for overdue maintenance\n  // const overdueMaintenances = await db.MaintenanceLog.findAll({\n  //   where: {\n  //     status: 'scheduled', // Only check scheduled maintenance that should have been completed\n  //     dueDate: {\n  //       [Op.lt]: now,\n  //     },\n  //   },\n  //   include: [{ model: db.Machinery, as: 'machine' }],\n  // });\n\n  // for (const schedule of overdueMaintenances) {\n  //   const dueDateString = new Date(schedule.dueDate).toISOString().split('T')[0]; // Format as YYYY-MM-DD\n  //   const message = `OVERDUE: ${schedule.title} for Machine: ${schedule.machine?.machineName} (Due: ${dueDateString})`;\n  //   const title = `OVERDUE: ${schedule.title}`;\n\n  //   const alreadyExists = await alreadyNotified(schedule.id, \"Overdue\", \"MaintenanceAlert\");\n  //   if (!alreadyExists) {\n  //     await db.Notification.create({\n  //       eventType: \"MaintenanceAlert\",\n  //       eventAction: \"Overdue\",\n  //       title,\n  //       referenceId: schedule.id,\n  //       description: message,\n  //       roles: [\n  //         roles.STORE_MANAGER,\n  //         roles.PROJECT_MANAGER,\n  //         roles.MECHANICAL_MANAGER,\n  //       ],\n  //     });\n  //   }\n  // }\n};\n\n// Check for machine service intervals that are due based on hours/km readings\nconst checkMachineServiceIntervalAlerts = async () => {\n  const now = new Date();\n  const nextWeek = new Date();\n  nextWeek.setDate(nextWeek.getDate() + 7);\n\n  // Find all active machine service intervals that are due based on hours or kilometers\n  const dueIntervals = await db.MachineServiceInterval.findAll({\n    where: {\n      isActive: true,\n      [Op.or]: [\n        // Due based on hours\n        {\n          intervalType: 'hours',\n          nextServiceValue: {\n            [Op.lte]: db.sequelize.literal('(SELECT COALESCE(MAX(\"closingHrsMeter\"), 0) FROM logbook_entries WHERE machineId = MachineServiceInterval.machineId)')\n          }\n        },\n        // Due based on kilometers\n        {\n          intervalType: 'kilometers',\n          nextServiceValue: {\n            [Op.lte]: db.sequelize.literal('(SELECT COALESCE(MAX(\"closingKmReading\"), 0) FROM logbook_entries WHERE machineId = MachineServiceInterval.machineId)')\n          }\n        },\n        // Due based on calendar date\n        {\n          intervalType: 'calendar',\n          nextServiceDate: {\n            [Op.lte]: now\n          }\n        }\n      ]\n    },\n    include: [{ model: db.Machinery, as: 'machine' }]\n  });\n\n  for (const interval of dueIntervals) {\n    const message = `SERVICE DUE: ${interval.serviceType} for Machine: ${interval.machine?.machineName} (Interval: ${interval.intervalValue} ${interval.intervalType})`;\n    const title = `Service Due: ${interval.serviceType}`;\n\n    const alreadyExists = await alreadyNotified(interval.id, \"Service Due\", \"MachineServiceIntervalAlert\");\n    if (!alreadyExists) {\n      await db.Notification.create({\n        eventType: \"MachineServiceIntervalAlert\",\n        eventAction: \"Service Due\",\n        title,\n        referenceId: interval.id,\n        description: message,\n        roles: [\n          roles.STORE_MANAGER,\n          roles.PROJECT_MANAGER,\n          roles.MECHANICAL_MANAGER,\n        ],\n      });\n    }\n  }\n};\n\nmodule.exports = {\n  checkScheduledMaintenanceAlerts,\n  checkMachineServiceIntervalAlerts\n};\n","const { checkMachineryDocumentExpiries } = require(\"./checkDocumentExpiry\");\nconst { checkLowAndOutOfStock } = require(\"./checkLowStockItems\");\nconst { checkScheduledMaintenanceAlerts, checkMachineServiceIntervalAlerts } = require(\"./checkScheduledMaintenance\");\nconst { checkMachineMaintenanceAlerts } = require(\"./checkMachineMaintenanceAlerts\");\n\nmodule.exports = {\n  checkMachineryDocumentExpiry: checkMachineryDocumentExpiries,\n  checkLowAndOutOfStock,\n  checkScheduledMaintenanceAlerts,\n  checkMachineServiceIntervalAlerts,\n  checkMachineMaintenanceAlerts\n};\n","const dashboardService = require(\"./dashboard.service\");\n\nconst getOverview = async (req, res) => {\n  const overview = await dashboardService.getOverview(req.query);\n  res.sendResponse(overview, \"Overview data retrieved successfully\");\n};\n\nconst getAlerts = async (req, res) => {\n  const alerts = await dashboardService.getAlerts(req.query);\n  res.sendResponse(alerts, \"Alerts retrieved successfully\");\n};\n\nconst getRecentActivities = async (req, res) => {\n  const activities = await dashboardService.getRecentActivities(req.query);\n  res.sendResponse(activities, \"Recent activities retrieved successfully\");\n};\n\nconst getMachineStatus = async (req, res) => {\n  const machineStatus = await dashboardService.getMachineStatus(req.query);\n  res.sendResponse(machineStatus, \"Machine status data retrieved successfully\");\n};\n\nconst getSitesSummary = async (req, res) => {\n  const sitesSummary = await dashboardService.getSitesSummary(req.query);\n  res.sendResponse(sitesSummary, \"Sites summary retrieved successfully\");\n};\n\nconst getInventoryAlerts = async (req, res) => {\n  const inventoryAlerts = await dashboardService.getInventoryAlerts(req.query);\n  res.sendResponse(inventoryAlerts, \"Inventory alerts retrieved successfully\");\n};\n\nconst getMaintenanceDue = async (req, res) => {\n  const maintenanceDue = await dashboardService.getMaintenanceDue(req.query);\n  res.sendResponse(\n    maintenanceDue,\n    \"Maintenance due data retrieved successfully\"\n  );\n};\n\nconst getProcurementPending = async (req, res) => {\n  const procurementPending = await dashboardService.getProcurementPending(\n    req.query\n  );\n  res.sendResponse(\n    procurementPending,\n    \"Pending procurements retrieved successfully\"\n  );\n};\n\nconst getPaymentsOutstanding = async (req, res) => {\n  const paymentsOutstanding = await dashboardService.getPaymentsOutstanding(\n    req.query\n  );\n  res.sendResponse(\n    paymentsOutstanding,\n    \"Outstanding payments retrieved successfully\"\n  );\n};\n\nconst getExpensesMonthly = async (req, res) => {\n  const expensesMonthly = await dashboardService.getExpensesMonthly(req.query);\n  res.sendResponse(expensesMonthly, \"Monthly expenses retrieved successfully\");\n};\n\n\n// Helper for extracting the right siteId\nconst getRelevantSiteId = (req) => {\n  // Prefer siteId from user context (site users); fallback to query (admins)\n  return req.user && req.user.siteId ? req.user.siteId : req.query.siteId;\n};\n\nconst getSiteOverview = async (req, res) => {\n  const siteId = getRelevantSiteId(req);\n  if (!siteId) {\n    return res.status(400).send({ message: \"Site ID is required.\" });\n  }\n  const overview = await dashboardService.getSiteOverview(\n    siteId,\n    req.query\n  );\n  res.sendResponse(overview, \"Site overview retrieved successfully\");\n};\n\nconst getSiteRequisitions = async (req, res) => {\n  const siteId = getRelevantSiteId(req);\n  if (!siteId) {\n    return res.status(400).send({ message: \"Site ID is required.\" });\n  }\n  const requisitions = await dashboardService.getSiteRequisitions(\n    siteId,\n    req.query\n  );\n  res.sendResponse(requisitions, \"Site requisitions retrieved successfully\");\n};\n\nconst getSiteMaterialIssues = async (req, res) => {\n  const siteId = getRelevantSiteId(req);\n  if (!siteId) {\n    return res.status(400).send({ message: \"Site ID is required.\" });\n  }\n  const materialIssues = await dashboardService.getSiteMaterialIssues(\n    siteId,\n    req.query\n  );\n  res.sendResponse(\n    materialIssues,\n    \"Site material issues retrieved successfully\"\n  );\n};\n\nconst getSiteTransfers = async (req, res) => {\n  const siteId = getRelevantSiteId(req);\n  if (!siteId) {\n    return res.status(400).send({ message: \"Site ID is required.\" });\n  }\n  const transfers = await dashboardService.getSiteTransfers(\n    siteId,\n    req.query\n  );\n  res.sendResponse(transfers, \"Site transfers retrieved successfully\");\n};\n\nconst getSiteInventoryAlerts = async (req, res) => {\n  const siteId = getRelevantSiteId(req);\n  if (!siteId) {\n    return res.status(400).send({ message: \"Site ID is required.\" });\n  }\n  const alerts = await dashboardService.getSiteInventoryAlerts(\n    siteId,\n    req.query\n  );\n  res.sendResponse(alerts, \"Site inventory alerts retrieved successfully\");\n};\n\nconst getSiteMachineAlerts = async (req, res) => {\n  const siteId = getRelevantSiteId(req);\n  if (!siteId) {\n    return res.status(400).send({ message: \"Site ID is required.\" });\n  }\n  const alerts = await dashboardService.getSiteMachineAlerts(\n    siteId,\n    req.query\n  );\n  res.sendResponse(alerts, \"Site machine alerts retrieved successfully\");\n};\n\nconst getSiteMachineStatus = async (req, res) => {\n  const siteId = getRelevantSiteId(req);\n  if (!siteId) {\n    return res.status(400).send({ message: \"Site ID is required.\" });\n  }\n  const machineStatus = await dashboardService.getSiteMachineStatus(\n    siteId,\n    req.query\n  );\n  res.sendResponse(machineStatus, \"Site machine status retrieved successfully\");\n};\n\nconst getSiteInventoryStatus = async (req, res) => {\n  const siteId = getRelevantSiteId(req);\n  if (!siteId) {\n    return res.status(400).send({ message: \"Site ID is required.\" });\n  }\n  const inventoryStatus = await dashboardService.getSiteInventoryStatus(\n    siteId,\n    req.query\n  );\n  res.sendResponse(\n    inventoryStatus,\n    \"Site inventory status retrieved successfully\"\n  );\n};\n\nconst getSiteMaintenanceDue = async (req, res) => {\n  const siteId = getRelevantSiteId(req);\n  if (!siteId) {\n    return res.status(400).send({ message: \"Site ID is required.\" });\n  }\n  const maintenanceDue = await dashboardService.getSiteMaintenanceDue(\n    siteId,\n    req.query\n  );\n  res.sendResponse(\n    maintenanceDue,\n    \"Site maintenance due retrieved successfully\"\n  );\n};\n\nconst getSiteExpenses = async (req, res) => {\n  const siteId = getRelevantSiteId(req);\n  if (!siteId) {\n    return res.status(400).send({ message: \"Site ID is required.\" });\n  }\n  const expenses = await dashboardService.getSiteExpenses(\n    siteId,\n    req.query\n  );\n  res.sendResponse(expenses, \"Site expenses retrieved successfully\");\n};\n\nconst getSiteInfo = async (req, res) => {\n  const siteId = getRelevantSiteId(req);\n  if (!siteId) {\n    return res.status(400).send({ message: \"Site ID is required.\" });\n  }\n  const siteInfo = await dashboardService.getSiteInfo(siteId);\n  res.sendResponse(siteInfo, \"Site information retrieved successfully\");\n};\n\nmodule.exports = {\n  getOverview,\n  getAlerts,\n  getRecentActivities,\n  getMachineStatus,\n  getSitesSummary,\n  getInventoryAlerts,\n  getMaintenanceDue,\n  getProcurementPending,\n  getPaymentsOutstanding,\n  getExpensesMonthly,\n\n  getSiteOverview,\n  getSiteRequisitions,\n  getSiteMaterialIssues,\n  getSiteTransfers,\n  getSiteInventoryAlerts,\n  getSiteMachineAlerts,\n  getSiteMachineStatus,\n  getSiteInventoryStatus,\n  getSiteMaintenanceDue,\n  getSiteExpenses,\n  getSiteInfo,\n};\n","const router = require(\"express\").Router();\nconst asyncMiddleware = require(\"../../middlewares/asyncMiddleware\");\nconst dashboardController = require(\"./dashboard.controller\");\nconst validateRequest = require(\"../../middlewares/validateRequest\");\nconst { dashboardFiltersSchema } = require(\"./dashboard.validator\");\n\n// Executive Dashboard\nrouter.get(\n  \"/dashboard/overview\",\n  validateRequest(dashboardFiltersSchema, \"query\"),\n  asyncMiddleware(dashboardController.getOverview)\n);\nrouter.get(\n  \"/dashboard/alerts\",\n  validateRequest(dashboardFiltersSchema, \"query\"),\n  asyncMiddleware(dashboardController.getAlerts)\n);\nrouter.get(\n  \"/dashboard/recent-activities\",\n  validateRequest(dashboardFiltersSchema, \"query\"),\n  asyncMiddleware(dashboardController.getRecentActivities)\n);\n\n// Operational Dashboard\nrouter.get(\n  \"/dashboard/machines/status\",\n  validateRequest(dashboardFiltersSchema, \"query\"),\n  asyncMiddleware(dashboardController.getMachineStatus)\n);\nrouter.get(\n  \"/dashboard/sites/summary\",\n  validateRequest(dashboardFiltersSchema, \"query\"),\n  asyncMiddleware(dashboardController.getSitesSummary)\n);\nrouter.get(\n  \"/dashboard/inventory/alerts\",\n  validateRequest(dashboardFiltersSchema, \"query\"),\n  asyncMiddleware(dashboardController.getInventoryAlerts)\n);\nrouter.get(\n  \"/dashboard/maintenance/due\",\n  validateRequest(dashboardFiltersSchema, \"query\"),\n  asyncMiddleware(dashboardController.getMaintenanceDue)\n);\n\n// Financial Dashboard\nrouter.get(\n  \"/dashboard/procurement/pending\",\n  validateRequest(dashboardFiltersSchema, \"query\"),\n  asyncMiddleware(dashboardController.getProcurementPending)\n);\nrouter.get(\n  \"/dashboard/payments/outstanding\",\n  validateRequest(dashboardFiltersSchema, \"query\"),\n  asyncMiddleware(dashboardController.getPaymentsOutstanding)\n);\nrouter.get(\n  \"/dashboard/expenses/monthly\",\n  validateRequest(dashboardFiltersSchema, \"query\"),\n  asyncMiddleware(dashboardController.getExpensesMonthly)\n);\n\nrouter.get(\n  \"/dashboard/site/overview\",\n  validateRequest(dashboardFiltersSchema, \"query\"),\n  asyncMiddleware(dashboardController.getSiteOverview)\n);\n\nrouter.get(\n  \"/dashboard/site/info\",\n  asyncMiddleware(dashboardController.getSiteInfo)\n);\n\n// Operational Activities Routes\nrouter.get(\n  \"/dashboard/site/requisitions\",\n  validateRequest(dashboardFiltersSchema, \"query\"),\n  asyncMiddleware(dashboardController.getSiteRequisitions)\n);\n\nrouter.get(\n  \"/dashboard/site/material-issues\",\n  validateRequest(dashboardFiltersSchema, \"query\"),\n  asyncMiddleware(dashboardController.getSiteMaterialIssues)\n);\n\nrouter.get(\n  \"/dashboard/site/transfers\",\n  validateRequest(dashboardFiltersSchema, \"query\"),\n  asyncMiddleware(dashboardController.getSiteTransfers)\n);\n\n// Status Routes\nrouter.get(\n  \"/dashboard/site/machines/status\",\n  validateRequest(dashboardFiltersSchema, \"query\"),\n  asyncMiddleware(dashboardController.getSiteMachineStatus)\n);\n\nrouter.get(\n  \"/dashboard/site/inventory/status\",\n  validateRequest(dashboardFiltersSchema, \"query\"),\n  asyncMiddleware(dashboardController.getSiteInventoryStatus)\n);\n\n// Alerts Routes\nrouter.get(\n  \"/dashboard/site/inventory/alerts\",\n  validateRequest(dashboardFiltersSchema, \"query\"),\n  asyncMiddleware(dashboardController.getSiteInventoryAlerts)\n);\n\nrouter.get(\n  \"/dashboard/site/machine/alerts\",\n  validateRequest(dashboardFiltersSchema, \"query\"),\n  asyncMiddleware(dashboardController.getSiteMachineAlerts)\n);\n\n// Maintenance & Expenses Routes\nrouter.get(\n  \"/dashboard/site/maintenance/due\",\n  validateRequest(dashboardFiltersSchema, \"query\"),\n  asyncMiddleware(dashboardController.getSiteMaintenanceDue)\n);\n\nrouter.get(\n  \"/dashboard/site/expenses\",\n  validateRequest(dashboardFiltersSchema, \"query\"),\n  asyncMiddleware(dashboardController.getSiteExpenses)\n);\n\nmodule.exports = router;\n","const { Op, Sequelize } = require(\"sequelize\");\nconst db = require(\"./../../models\");\n\nconst getOverview = async (filters = {}) => {\n  const { siteId, dateRange } = filters;\n\n  const whereClause = {};\n  // if (siteId) whereClause.siteId = siteId;\n\n  const dateFilter = {};\n  if (dateRange?.startDate && dateRange?.endDate) {\n    dateFilter.createdAt = {\n      [Op.between]: [dateRange.startDate, dateRange.endDate],\n    };\n  }\n\n  const [\n    totalMachines,\n    activeMachines,\n    totalSites,\n    activeSites,\n    pendingRequisitions,\n    pendingTransfers,\n    lowStockItems,\n    outstandingInvoices,\n  ] = await Promise.all([\n    db.Machinery.count({ where: whereClause }),\n    db.Machinery.count({ where: { ...whereClause, status: \"In Use\" } }),\n    db.Site.count({ where: whereClause }),\n    db.Site.count({ where: { ...whereClause, status: \"active\" } }),\n    db.Requisition.count({\n      where: { ...whereClause, status: \"pending\", ...dateFilter },\n    }),\n    db.MachineTransfer.count({\n      where: { ...whereClause, status: \"Pending\", ...dateFilter },\n    }),\n    db.SiteInventory.count({ where: { ...whereClause, status: \"Low Stock\" } }),\n    db.Invoice.count({\n      where: { status: { [Op.in]: [\"SENT\", \"PARTIALLY_PAID\"] }, ...dateFilter },\n    }),\n  ]);\n\n  const machineStatusBreakdown = await db.Machinery.findAll({\n    attributes: [\n      \"status\",\n      [Sequelize.fn(\"COUNT\", Sequelize.col(\"id\")), \"count\"],\n    ],\n    where: whereClause,\n    group: [\"status\"],\n  });\n\n  return {\n    totalMachines,\n    activeMachines,\n    totalSites,\n    activeSites,\n    pendingRequisitions,\n    pendingTransfers,\n    lowStockItems,\n    outstandingInvoices,\n    machineStatusBreakdown,\n  };\n};\n\nconst getAlerts = async (filters = {}) => {\n  const { siteId, limit = 10 } = filters;\n  const whereClause = {};\n  // if (siteId) whereClause.siteId = siteId;\n\n  const thirtyDaysFromNow = new Date();\n  thirtyDaysFromNow.setDate(thirtyDaysFromNow.getDate() + 30);\n\n  const [\n    certificateExpiries,\n    lowStockAlerts,\n    pendingApprovals,\n    maintenanceOverdue,\n  ] = await Promise.all([\n    db.Machinery.findAll({\n      where: {\n        ...whereClause,\n        [Op.or]: [\n          { fitnessCertificateExpiry: { [Op.lte]: thirtyDaysFromNow } },\n          { insuranceExpiry: { [Op.lte]: thirtyDaysFromNow } },\n          { pollutionCertificateExpiry: { [Op.lte]: thirtyDaysFromNow } },\n          { permitExpiryDate: { [Op.lte]: thirtyDaysFromNow } },\n        ],\n      },\n      attributes: [\n        // Direct machine fields\n        \"id\",\n        \"machineName\",\n        \"registrationNumber\",\n        \"erpCode\",\n        \"siteId\",\n        \"status\",\n        \"model\",\n        \"make\",\n\n        // Certificate expiry date fields\n        \"pollutionCertificateExpiry\",\n        \"fitnessCertificateExpiry\",\n        \"insuranceExpiry\",\n        \"permitExpiryDate\",\n        \"motorVehicleTaxDue\",\n      ],\n      include: [{ model: db.Site, as: \"site\", attributes: [\"name\"] }],\n      limit,\n    }),\n    db.SiteInventory.findAll({\n      where: {\n        ...whereClause,\n        status: { [Op.in]: [\"Low Stock\", \"Out of Stock\"] },\n      },\n      include: [\n        { model: db.Site, attributes: [\"name\"] },\n        {\n          model: db.Item,\n          attributes: [\"name\", \"shortName\"],\n          include: [{ model: db.Unit, attributes: [\"name\", \"shortName\"] }],\n        },\n      ],\n      limit,\n    }),\n    db.Requisition.count({ where: { ...whereClause, status: \"pending\" } }),\n    db.MaintenanceLog.count({\n      where: { status: \"scheduled\", date: { [Op.lt]: new Date() } },\n    }),\n  ]);\n\n  return {\n    certificateExpiries,\n    lowStockAlerts,\n    pendingApprovals,\n    maintenanceOverdue,\n  };\n};\n\nconst getRecentActivities = async (filters = {}) => {\n  const { siteId, limit = 20 } = filters;\n  const whereClause = {};\n  // if (siteId) whereClause.siteId = siteId;\n\n  const [recentRequisitions, recentTransfers, recentIssues, recentMaintenance] =\n    await Promise.all([\n      db.Requisition.findAll({\n        where: whereClause,\n        attributes: [\n          \"id\",\n          \"requisitionNo\",\n          \"requestedFor\",\n          \"chargeType\",\n          \"requestPriority\",\n          \"dueDate\",\n          \"status\",\n        ],\n        include: [\n          { model: db.Site, as: \"requestingSite\", attributes: [\"name\"] },\n          { model: db.User, as: \"preparedBy\", attributes: [\"name\"] },\n        ],\n        order: [[\"createdAt\", \"DESC\"]],\n        limit: limit / 4,\n      }),\n      db.MachineTransfer.findAll({\n        where: whereClause,\n        attributes: [\n          \"id\",\n          \"name\",\n          \"destinationSiteId\",\n          \"requestType\",\n          \"status\",\n          \"dispatchedAt\",\n          \"transportDetails\",\n        ],\n        include: [\n          { model: db.Site, as: \"currentSite\", attributes: [\"name\"] },\n          { model: db.Machinery, as: \"machine\", attributes: [\"machineName\"] },\n        ],\n        order: [[\"createdAt\", \"DESC\"]],\n        limit: limit / 4,\n      }),\n      db.MaterialIssue.findAll({\n        where: whereClause,\n        attributes: [\n          \"id\",\n          \"issueNumber\",\n          \"issueType\",\n          \"otherSiteId\",\n          \"issueDate\",\n          \"status\",\n          \"approvedAt\",\n        ],\n        include: [{ model: db.Site, as: \"fromSite\", attributes: [\"name\"] }],\n        order: [[\"createdAt\", \"DESC\"]],\n        limit: limit / 4,\n      }),\n      db.MaintenanceLog.findAll({\n        where: whereClause,\n        attributes: [\"id\", \"type\", \"cost\", \"date\", \"status\", \"title\"],\n        include: [\n          {\n            model: db.Machinery,\n            as: \"machine\",\n            attributes: [\"machineName\", \"id\"],\n          },\n        ],\n        order: [[\"createdAt\", \"DESC\"]],\n        limit: limit / 4,\n      }),\n    ]);\n\n  return {\n    recentRequisitions,\n    recentTransfers,\n    recentIssues,\n    recentMaintenance,\n  };\n};\n\nconst getMachineStatus = async (filters = {}) => {\n  const { siteId, categoryId } = filters;\n  const whereClause = {};\n  // if (siteId) whereClause.siteId = siteId;\n  // if (categoryId) whereClause.machineCategoryId = categoryId;\n\n  const [statusBreakdown, siteWiseBreakdown, categoryWiseBreakdown] =\n    await Promise.all([\n      db.Machinery.findAll({\n        attributes: [\n          \"status\",\n          [Sequelize.fn(\"COUNT\", Sequelize.col(\"id\")), \"count\"],\n        ],\n        where: whereClause,\n        group: [\"status\"],\n      }),\n      db.Machinery.findAll({\n        attributes: [\n          \"siteId\",\n          \"Machinery.status\",\n          [Sequelize.fn(\"COUNT\", Sequelize.col(\"Machinery.id\")), \"count\"],\n        ],\n        where: whereClause,\n        include: [{ model: db.Site, as: \"site\", attributes: [\"name\"] }],\n        group: [\"siteId\", \"Machinery.status\", \"site.id\", \"site.name\"],\n      }),\n      db.Machinery.findAll({\n        attributes: [\n          \"machineCategoryId\",\n          \"Machinery.status\",\n          [Sequelize.fn(\"COUNT\", Sequelize.col(\"Machinery.id\")), \"count\"],\n        ],\n        where: whereClause,\n        include: [\n          {\n            model: db.MachineCategory,\n            as: \"machineCategory\",\n            attributes: [\"name\"],\n          },\n        ],\n        group: [\n          \"machineCategoryId\",\n          \"Machinery.status\",\n          \"machineCategory.id\",\n          \"machineCategory.name\",\n        ],\n      }),\n    ]);\n\n  return {\n    statusBreakdown,\n    siteWiseBreakdown,\n    categoryWiseBreakdown,\n  };\n};\n\nconst getSitesSummary = async (filters = {}) => {\n  const { departmentId, limit, offset } = filters;\n  const whereClause = {};\n  if (departmentId) whereClause.departmentId = departmentId;\n\n  // Optimize: Use subqueries to count related records instead of loading all objects\n  const sites = await db.Site.findAll({\n    where: whereClause,\n    attributes: [\n      \"id\",\n      \"name\",\n      \"code\",\n      \"status\",\n      \"departmentId\",\n      [\n        Sequelize.literal(`(\n          SELECT COUNT(*)\n          FROM machineries AS \"machine\"\n          WHERE \"machine\".\"siteId\" = \"Site\".\"id\"\n        )`),\n        \"totalMachines\",\n      ],\n      [\n        Sequelize.literal(`(\n          SELECT COUNT(*)\n          FROM machineries AS \"machine\"\n          WHERE \"machine\".\"siteId\" = \"Site\".\"id\"\n          AND \"machine\".\"status\" = 'In Use'\n        )`),\n        \"activeMachines\",\n      ],\n      [\n        Sequelize.literal(`(\n          SELECT COUNT(*)\n          FROM users AS \"user\"\n          WHERE \"user\".\"siteId\" = \"Site\".\"id\"\n        )`),\n        \"totalUsers\",\n      ],\n    ],\n    include: [{ model: db.Department, attributes: [\"name\"] }],\n    limit: limit ? parseInt(limit) : undefined,\n    offset: offset ? parseInt(offset) : undefined,\n  });\n\n  const sitesSummary = sites.map((site) => ({\n    id: site.id,\n    name: site.name,\n    code: site.code,\n    status: site.status,\n    department: site.Department?.name,\n    totalMachines: parseInt(site.getDataValue(\"totalMachines\") || 0),\n    activeMachines: parseInt(site.getDataValue(\"activeMachines\") || 0),\n    totalUsers: parseInt(site.getDataValue(\"totalUsers\") || 0),\n  }));\n\n  return sitesSummary;\n};\n\nconst getInventoryAlerts = async (filters = {}) => {\n  const { siteId, severity, limit = 20 } = filters;\n  const whereClause = {};\n  // if (siteId) whereClause.siteId = siteId;\n  // if (severity) whereClause.status = severity;\n\n  const alerts = await db.SiteInventory.findAll({\n    where: {\n      ...whereClause,\n      status: { [Op.in]: [\"Low Stock\", \"Out of Stock\"] },\n    },\n    include: [\n      { model: db.Site, attributes: [\"name\", \"code\"] },\n      { model: db.Item, include: [{ model: db.Unit }] },\n    ],\n    order: [[\"quantity\", \"ASC\"]],\n    limit: parseInt(limit),\n  });\n\n  return alerts;\n};\n\nconst getMaintenanceDue = async (filters = {}) => {\n  const { siteId, days = 30, limit = 20 } = filters;\n  const whereClause = {};\n  // if (siteId) whereClause.siteId = siteId;\n\n  const futureDate = new Date();\n  futureDate.setDate(futureDate.getDate() + parseInt(days));\n\n  const maintenanceDue = await db.MaintenanceLog.findAll({\n    where: {\n      status: \"scheduled\",\n      date: { [Op.between]: [new Date(), futureDate] },\n    },\n    include: [\n      {\n        model: db.Machinery,\n        as: \"machine\",\n        where: whereClause,\n        include: [{ model: db.Site, as: \"site\" }],\n      },\n    ],\n    order: [[\"date\", \"ASC\"]],\n    limit: parseInt(limit),\n  });\n\n  return maintenanceDue;\n};\n\nconst getProcurementPending = async (filters = {}) => {\n  const { siteId, status = \"pending\", limit = 20 } = filters;\n  const whereClause = { status };\n\n  const procurements = await db.Procurement.findAll({\n    // where: whereClause,\n    include: [\n      {\n        model: db.Requisition,\n        include: [\n          {\n            model: db.Site,\n            as: \"requestingSite\",\n            where: siteId ? { id: siteId } : {},\n          },\n        ],\n      },\n      { model: db.Vendor },\n    ],\n    order: [[\"createdAt\", \"DESC\"]],\n    limit: parseInt(limit),\n  });\n\n  const totalValue = await db.Procurement.sum(\"totalAmount\", {\n    where: whereClause,\n  });\n\n  return {\n    procurements,\n    totalValue: totalValue || 0,\n    count: procurements.length,\n  };\n};\n\nconst getPaymentsOutstanding = async (filters = {}) => {\n  const { siteId, limit = 50, offset = 0 } = filters;\n  const whereClause = { status: { [Op.in]: [\"SENT\", \"PARTIALLY_PAID\"] } };\n\n  // Calculate total outstanding amount using DB aggregation to avoid fetching all invoices\n  // We need to sum up invoice amounts and subtract paid amounts\n  const invoicesForTotal = await db.Invoice.findAll({\n    where: whereClause,\n    attributes: [\"id\", \"amount\"],\n    include: [\n      {\n        model: db.Procurement,\n        as: \"procurement\",\n        attributes: [],\n        required: true,\n        include: [\n          {\n            model: db.Requisition,\n            attributes: [],\n            required: true,\n            include: [\n              {\n                model: db.Site,\n                as: \"requestingSite\",\n                attributes: [],\n                where: siteId ? { id: siteId } : {},\n                required: true,\n              },\n            ],\n          },\n        ],\n      },\n      {\n        model: db.Payment,\n        as: \"payments\",\n        attributes: [\"amount\"],\n      },\n    ],\n  });\n\n  // Calculate total outstanding from the lighter query\n  const totalOutstanding = invoicesForTotal.reduce((sum, invoice) => {\n    const paidAmount =\n      invoice.payments?.reduce(\n        (pSum, payment) => pSum + parseFloat(payment.amount),\n        0\n      ) || 0;\n    return sum + (parseFloat(invoice.amount) - paidAmount);\n  }, 0);\n\n  // Fetch paginated invoices for display\n  const invoices = await db.Invoice.findAll({\n    where: whereClause,\n    include: [\n      {\n        model: db.Procurement,\n        as: \"procurement\",\n        include: [\n          {\n            model: db.Requisition,\n            include: [\n              {\n                model: db.Site,\n                as: \"requestingSite\",\n                where: siteId ? { id: siteId } : {},\n              },\n            ],\n          },\n        ],\n      },\n      { model: db.Payment, as: \"payments\" },\n    ],\n    order: [[\"invoiceDate\", \"ASC\"]],\n    limit: parseInt(limit),\n    offset: parseInt(offset),\n  });\n\n  return {\n    invoices,\n    totalOutstanding,\n    count: invoices.length, // This is count of current page. If total count is needed, we need distinct count query.\n  };\n};\n\nconst getExpensesMonthly = async (filters = {}) => {\n  const { siteId, months = 12 } = filters;\n  const whereClause = {};\n  // if (siteId) whereClause.siteId = siteId;\n\n  const startDate = new Date();\n  startDate.setMonth(startDate.getMonth() - parseInt(months));\n\n  const [procurementExpenses, maintenanceExpenses] = await Promise.all([\n    db.Procurement.findAll({\n      attributes: [\n        [\n          Sequelize.fn(\"DATE_TRUNC\", \"month\", Sequelize.col(\"createdAt\")),\n          \"month\",\n        ],\n        [Sequelize.fn(\"SUM\", Sequelize.col(\"totalAmount\")), \"totalAmount\"],\n      ],\n      where: {\n        createdAt: { [Op.gte]: startDate },\n        status: { [Op.in]: [\"delivered\", \"paid\"] },\n      },\n      group: [Sequelize.fn(\"DATE_TRUNC\", \"month\", Sequelize.col(\"createdAt\"))],\n      order: [\n        [\n          Sequelize.fn(\"DATE_TRUNC\", \"month\", Sequelize.col(\"createdAt\")),\n          \"ASC\",\n        ],\n      ],\n    }),\n    db.MaintenanceLog.findAll({\n      attributes: [\n        [Sequelize.fn(\"DATE_TRUNC\", \"month\", Sequelize.col(\"date\")), \"month\"],\n        [Sequelize.fn(\"SUM\", Sequelize.col(\"cost\")), \"totalCost\"],\n      ],\n      where: {\n        date: { [Op.gte]: startDate },\n        status: \"completed\",\n      },\n      include: [\n        {\n          model: db.Machinery,\n          as: \"machine\",\n          where: whereClause,\n          attributes: [],\n        },\n      ],\n      group: [Sequelize.fn(\"DATE_TRUNC\", \"month\", Sequelize.col(\"date\"))],\n      order: [\n        [Sequelize.fn(\"DATE_TRUNC\", \"month\", Sequelize.col(\"date\")), \"ASC\"],\n      ],\n    }),\n  ]);\n\n  return {\n    procurementExpenses,\n    maintenanceExpenses,\n  };\n};\n\n// ============================================\n// CORE METRICS (SITE OVERVIEW)\n// ============================================\n\nconst getSiteOverview = async (siteId, filters = {}) => {\n  if (!siteId) {\n    throw new Error(\"Site ID is required for site users\");\n  }\n\n  const { dateRange } = filters;\n  const dateFilter = {};\n  if (dateRange?.startDate && dateRange?.endDate) {\n    dateFilter.createdAt = {\n      [Op.between]: [dateRange.startDate, dateRange.endDate],\n    };\n  }\n\n  const [\n    // Site Inventory Status\n    totalInventoryItems,\n    lowStockItems,\n    outOfStockItems,\n    // inventoryValue,\n\n    // Site Machines\n    totalMachines,\n    activeMachines,\n    machineStatusBreakdown,\n\n    // Site Personnel\n    totalUsers,\n    activeUsers,\n  ] = await Promise.all([\n    // Total items in stock at their site\n    db.SiteInventory.count({ where: { siteId } }),\n\n    // Low stock items count\n    db.SiteInventory.count({ where: { siteId, status: \"Low Stock\" } }),\n\n    // Out of stock items count\n    db.SiteInventory.count({ where: { siteId, status: \"Out of Stock\" } }),\n\n    // Inventory value calculation\n    // db.SiteInventory.findAll({\n    //   attributes: [\n    //     [\n    //       Sequelize.fn(\n    //         \"SUM\",\n    //         Sequelize.literal(\n    //           \"quantity * (SELECT price FROM items WHERE items.id = SiteInventory.itemId)\"\n    //         )\n    //       ),\n    //       \"totalValue\",\n    //     ],\n    //   ],\n    //   where: { siteId },\n    //   raw: true,\n    // }),\n\n    // Total machines at their site\n    db.Machinery.count({ where: { siteId } }),\n\n    // Active machines count\n    db.Machinery.count({ where: { siteId, status: \"In Use\" } }),\n\n    // Machines by status breakdown\n    db.Machinery.findAll({\n      attributes: [\n        \"status\",\n        [Sequelize.fn(\"COUNT\", Sequelize.col(\"id\")), \"count\"],\n      ],\n      where: { siteId },\n      group: [\"status\"],\n    }),\n\n    // Total users/employees at their site\n    db.User.count({ where: { siteId } }),\n\n    // Active users count\n    db.User.count({ where: { siteId, status: \"active\" } }),\n  ]);\n\n  return {\n    inventory: {\n      totalItems: totalInventoryItems,\n      lowStockItems,\n      outOfStockItems,\n      // totalValue: inventoryValue[0]?.totalValue || 0,\n      totalValue: 0,\n    },\n    machines: {\n      totalMachines,\n      activeMachines,\n      statusBreakdown: machineStatusBreakdown,\n    },\n    personnel: {\n      totalUsers,\n      activeUsers,\n    },\n  };\n};\n\n// ============================================\n// OPERATIONAL ACTIVITIES\n// ============================================\n\nconst getSiteRequisitions = async (siteId, filters = {}) => {\n  if (!siteId) {\n    throw new Error(\"Site ID is required for site users\");\n  }\n\n  const { limit = 20, status } = filters;\n  const whereClause = { requestingSiteId: siteId };\n  if (status) whereClause.status = status;\n\n  const [pendingRequisitions, recentRequisitions, requisitionStats] =\n    await Promise.all([\n      // Pending requisitions from their site\n      db.Requisition.count({\n        where: { requestingSiteId: siteId, status: \"pending\" },\n      }),\n\n      // Recent requisitions created by their site\n      db.Requisition.findAll({\n        where: whereClause,\n        attributes: [\n          \"id\",\n          \"requisitionNo\",\n          \"requestedFor\",\n          \"chargeType\",\n          \"requestPriority\",\n          \"dueDate\",\n          \"status\",\n          \"createdAt\",\n        ],\n        include: [\n          { model: db.User, as: \"preparedBy\", attributes: [\"name\"] },\n          {\n            model: db.RequisitionItem,\n            as: \"items\",\n            include: [{ model: db.Item, attributes: [\"name\", \"shortName\"] }],\n          },\n        ],\n        order: [[\"createdAt\", \"DESC\"]],\n        limit,\n      }),\n\n      // Requisition approval status stats\n      db.Requisition.findAll({\n        attributes: [\n          \"status\",\n          [Sequelize.fn(\"COUNT\", Sequelize.col(\"id\")), \"count\"],\n        ],\n        where: { requestingSiteId: siteId },\n        group: [\"status\"],\n      }),\n    ]);\n\n  return {\n    pendingCount: pendingRequisitions,\n    recentRequisitions,\n    statusBreakdown: requisitionStats,\n  };\n};\n\nconst getSiteMaterialIssues = async (siteId, filters = {}) => {\n  if (!siteId) {\n    throw new Error(\"Site ID is required for site users\");\n  }\n\n  const { limit = 20, status } = filters;\n  const whereClause = { siteId: siteId };\n  if (status) whereClause.status = status;\n\n  const [pendingIssues, recentIssues] = await Promise.all([\n    // Pending material issues from their site\n    db.MaterialIssue.count({\n      where: { siteId: siteId, status: \"pending\" },\n    }),\n\n    // Recent material issues from their site\n    db.MaterialIssue.findAll({\n      where: whereClause,\n      attributes: [\n        \"id\",\n        \"issueNumber\",\n        \"issueType\",\n        \"otherSiteId\",\n        \"issueDate\",\n        \"status\",\n        \"approvedAt\",\n      ],\n      include: [\n        { model: db.Site, as: \"toSite\", attributes: [\"name\"] },\n        {\n          model: db.MaterialIssueItem,\n          as: \"items\",\n          include: [{ model: db.Item, attributes: [\"name\", \"shortName\"] }],\n        },\n      ],\n      // order: [[\"createdAt\", \"DESC\"]],\n      limit,\n    }),\n  ]);\n\n  return {\n    pendingCount: pendingIssues,\n    recentIssues,\n  };\n};\n\nconst getSiteTransfers = async (siteId, filters = {}) => {\n  if (!siteId) {\n    throw new Error(\"Site ID is required for site users\");\n  }\n\n  const { limit = 20, status } = filters;\n  const whereClause = { currentSiteId: siteId };\n  if (status) whereClause.status = status;\n\n  const [pendingTransfers, recentTransfers, transferStats] = await Promise.all([\n    // Pending outgoing transfers\n    db.MachineTransfer.count({\n      where: { currentSiteId: siteId, status: \"Pending\" },\n    }),\n\n    // Machine transfers initiated from their site\n    db.MachineTransfer.findAll({\n      where: whereClause,\n      attributes: [\n        \"id\",\n        \"name\",\n        \"destinationSiteId\",\n        \"requestType\",\n        \"status\",\n        \"dispatchedAt\",\n        \"transportDetails\",\n        \"createdAt\",\n      ],\n      include: [\n        { model: db.Site, as: \"destinationSite\", attributes: [\"name\"] },\n        {\n          model: db.Machinery,\n          as: \"machine\",\n          attributes: [\"machineName\", \"registrationNumber\"],\n        },\n      ],\n      order: [[\"createdAt\", \"DESC\"]],\n      limit,\n    }),\n\n    // Transfer status tracking\n    db.MachineTransfer.findAll({\n      attributes: [\n        \"status\",\n        [Sequelize.fn(\"COUNT\", Sequelize.col(\"id\")), \"count\"],\n      ],\n      where: { currentSiteId: siteId },\n      group: [\"status\"],\n    }),\n  ]);\n\n  return {\n    pendingCount: pendingTransfers,\n    recentTransfers,\n    statusBreakdown: transferStats,\n  };\n};\n\n// ============================================\n// ALERTS & NOTIFICATIONS\n// ============================================\n\nconst getSiteInventoryAlerts = async (siteId, filters = {}) => {\n  if (!siteId) {\n    throw new Error(\"Site ID is required for site users\");\n  }\n\n  const { limit = 20 } = filters;\n\n  const [lowStockAlerts, outOfStockAlerts, approachingMinimumAlerts] =\n    await Promise.all([\n      // Low stock items at their site\n      db.SiteInventory.findAll({\n        where: { siteId, status: \"Low Stock\" },\n        include: [\n          {\n            model: db.Item,\n            attributes: [\"name\", \"shortName\"],\n            include: [{ model: db.Unit, attributes: [\"name\", \"shortName\"] }],\n          },\n        ],\n        order: [[\"quantity\", \"ASC\"]],\n        limit,\n      }),\n\n      // Out of stock items\n      db.SiteInventory.findAll({\n        where: { siteId, status: \"Out of Stock\" },\n        include: [\n          {\n            model: db.Item,\n            attributes: [\"name\", \"shortName\"],\n            include: [{ model: db.Unit, attributes: [\"name\", \"shortName\"] }],\n          },\n        ],\n        limit,\n      }),\n\n      // Items approaching minimum levels (quantity <= minimumLevel * 1.2)\n      db.SiteInventory.findAll({\n        where: {\n          siteId,\n          status: \"In Stock\",\n          // [Op.and]: [\n          //   Sequelize.where(\n          //     Sequelize.col(\"quantity\"),\n          //     Op.lte,\n          //     Sequelize.literal(\"minimumLevel * 1.2\")\n          //   ),\n          // ],\n        },\n        include: [\n          {\n            model: db.Item,\n            attributes: [\"name\", \"shortName\"],\n            include: [{ model: db.Unit, attributes: [\"name\", \"shortName\"] }],\n          },\n        ],\n        // order: [[Sequelize.literal(\"quantity / minimumLevel\"), \"ASC\"]],\n        limit,\n      }),\n    ]);\n\n  return {\n    lowStock: lowStockAlerts,\n    outOfStock: outOfStockAlerts,\n    approachingMinimum: approachingMinimumAlerts,\n  };\n};\n\nconst getSiteMachineAlerts = async (siteId, filters = {}) => {\n  if (!siteId) {\n    throw new Error(\"Site ID is required for site users\");\n  }\n\n  const { days = 30, limit = 20 } = filters;\n  const alertDate = new Date();\n  alertDate.setDate(alertDate.getDate() + parseInt(days));\n\n  const [\n    certificateExpiries,\n    insuranceExpiries,\n    permitExpiries,\n    maintenanceOverdue,\n  ] = await Promise.all([\n    // Certificate expiries for machines at their site\n    db.Machinery.findAll({\n      where: {\n        siteId,\n        [Op.or]: [\n          { fitnessCertificateExpiry: { [Op.lte]: alertDate } },\n          { pollutionCertificateExpiry: { [Op.lte]: alertDate } },\n        ],\n      },\n      attributes: [\n        \"id\",\n        \"machineName\",\n        \"registrationNumber\",\n        \"erpCode\",\n        \"status\",\n        \"fitnessCertificateExpiry\",\n        \"pollutionCertificateExpiry\",\n      ],\n      order: [[\"fitnessCertificateExpiry\", \"ASC\"]],\n      limit,\n    }),\n\n    // Insurance expiries\n    db.Machinery.findAll({\n      where: {\n        siteId,\n        insuranceExpiry: { [Op.lte]: alertDate },\n      },\n      attributes: [\n        \"id\",\n        \"machineName\",\n        \"registrationNumber\",\n        \"erpCode\",\n        \"status\",\n        \"insuranceExpiry\",\n      ],\n      order: [[\"insuranceExpiry\", \"ASC\"]],\n      limit,\n    }),\n\n    // Permit expiries\n    db.Machinery.findAll({\n      where: {\n        siteId,\n        permitExpiryDate: { [Op.lte]: alertDate },\n      },\n      attributes: [\n        \"id\",\n        \"machineName\",\n        \"registrationNumber\",\n        \"erpCode\",\n        \"status\",\n        \"permitExpiryDate\",\n      ],\n      order: [[\"permitExpiryDate\", \"ASC\"]],\n      limit,\n    }),\n\n    // Maintenance overdue for their machines\n    db.MaintenanceLog.findAll({\n      where: {\n        status: \"scheduled\",\n        date: { [Op.lt]: new Date() },\n      },\n      include: [\n        {\n          model: db.Machinery,\n          as: \"machine\",\n          where: { siteId },\n          attributes: [\"id\", \"machineName\", \"registrationNumber\", \"erpCode\"],\n        },\n      ],\n      order: [[\"date\", \"ASC\"]],\n      limit,\n    }),\n  ]);\n\n  return {\n    certificateExpiries,\n    insuranceExpiries,\n    permitExpiries,\n    maintenanceOverdue,\n  };\n};\n\nconst getSiteInventoryStatus = async (siteId, filters = {}) => {\n  if (!siteId) {\n    throw new Error(\"Site ID is required for site users\");\n  }\n\n  const { categoryId: itemGroupId, limit = 50, offset = 0 } = filters;\n  const whereClause = { siteId };\n\n  const inventoryOverview = await db.SiteInventory.findAll({\n    where: whereClause,\n    include: [\n      {\n        model: db.Item,\n        attributes: [\"name\", \"shortName\", \"itemGroupId\"],\n        where: itemGroupId ? { itemGroupId } : {},\n        include: [\n          { model: db.Unit, attributes: [\"name\", \"shortName\"] },\n          { model: db.ItemGroup, attributes: [\"name\"] },\n        ],\n      },\n    ],\n    order: [[\"quantity\", \"ASC\"]],\n    limit: parseInt(limit),\n    offset: parseInt(offset),\n  });\n\n  // Group by status\n  const statusBreakdown = await db.SiteInventory.findAll({\n    attributes: [\n      \"status\",\n      [Sequelize.fn(\"COUNT\", Sequelize.col(\"id\")), \"count\"],\n      [Sequelize.fn(\"SUM\", Sequelize.col(\"quantity\")), \"totalQuantity\"],\n    ],\n    where: whereClause,\n    group: [\"status\"],\n  });\n\n  return {\n    inventoryOverview,\n    statusBreakdown,\n  };\n};\n\nconst getSiteMachineStatus = async (siteId, filters = {}) => {\n  if (!siteId) {\n    throw new Error(\"Site ID is required for site users\");\n  }\n\n  const { categoryId } = filters;\n  const whereClause = { siteId };\n  if (categoryId) whereClause.machineCategoryId = categoryId;\n\n  const [statusBreakdown, categoryWiseBreakdown] = await Promise.all([\n    // Machine status breakdown for this site\n    db.Machinery.findAll({\n      attributes: [\n        \"status\",\n        [Sequelize.fn(\"COUNT\", Sequelize.col(\"id\")), \"count\"],\n      ],\n      where: whereClause,\n      group: [\"status\"],\n    }),\n\n    // Category-wise breakdown for machines at this site\n    db.Machinery.findAll({\n      attributes: [\n        \"machineCategoryId\",\n        \"Machinery.status\",\n        [Sequelize.fn(\"COUNT\", Sequelize.col(\"Machinery.id\")), \"count\"],\n      ],\n      where: whereClause,\n      include: [\n        {\n          model: db.MachineCategory,\n          as: \"machineCategory\",\n          attributes: [\"name\"],\n        },\n      ],\n      group: [\n        \"machineCategoryId\",\n        \"Machinery.status\",\n        \"machineCategory.id\",\n        \"machineCategory.name\",\n      ],\n    }),\n  ]);\n\n  return {\n    statusBreakdown,\n    categoryWiseBreakdown,\n  };\n};\n\nconst getSiteExpenses = async (siteId, filters = {}) => {\n  if (!siteId) {\n    throw new Error(\"Site ID is required for site users\");\n  }\n\n  const { months = 12 } = filters;\n  const startDate = new Date();\n  startDate.setMonth(startDate.getMonth() - parseInt(months));\n\n  const [procurementExpenses, maintenanceExpenses] = await Promise.all([\n    // Procurement expenses for requisitions from this site\n    db.Procurement.findAll({\n      attributes: [\n        [\n          Sequelize.fn(\n            \"DATE_TRUNC\",\n            \"month\",\n            Sequelize.col(\"Procurement.createdAt\")\n          ),\n          \"month\",\n        ],\n        [Sequelize.fn(\"SUM\", Sequelize.col(\"totalAmount\")), \"totalAmount\"],\n      ],\n      where: {\n        createdAt: { [Op.gte]: startDate },\n        status: { [Op.in]: [\"delivered\", \"paid\"] },\n      },\n      include: [\n        {\n          model: db.Requisition,\n          where: { requestingSiteId: siteId },\n          attributes: [],\n        },\n      ],\n      group: [\n        Sequelize.fn(\n          \"DATE_TRUNC\",\n          \"month\",\n          Sequelize.col(\"Procurement.createdAt\")\n        ),\n      ],\n      order: [\n        [\n          Sequelize.fn(\n            \"DATE_TRUNC\",\n            \"month\",\n            Sequelize.col(\"Procurement.createdAt\")\n          ),\n          \"ASC\",\n        ],\n      ],\n    }),\n\n    // Maintenance expenses for machines at this site\n    db.MaintenanceLog.findAll({\n      attributes: [\n        [Sequelize.fn(\"DATE_TRUNC\", \"month\", Sequelize.col(\"date\")), \"month\"],\n        [Sequelize.fn(\"SUM\", Sequelize.col(\"cost\")), \"totalCost\"],\n      ],\n      where: {\n        date: { [Op.gte]: startDate },\n        status: \"completed\",\n      },\n      include: [\n        {\n          model: db.Machinery,\n          as: \"machine\",\n          where: { siteId },\n          attributes: [],\n        },\n      ],\n      group: [Sequelize.fn(\"DATE_TRUNC\", \"month\", Sequelize.col(\"date\"))],\n      order: [\n        [Sequelize.fn(\"DATE_TRUNC\", \"month\", Sequelize.col(\"date\")), \"ASC\"],\n      ],\n    }),\n  ]);\n\n  return {\n    procurementExpenses,\n    maintenanceExpenses,\n  };\n};\n\nconst getSiteMaintenanceDue = async (siteId, filters = {}) => {\n  if (!siteId) {\n    throw new Error(\"Site ID is required for site users\");\n  }\n\n  const { days = 30, limit = 20 } = filters;\n  const futureDate = new Date();\n  futureDate.setDate(futureDate.getDate() + parseInt(days));\n\n  const maintenanceDue = await db.MaintenanceLog.findAll({\n    where: {\n      status: \"scheduled\",\n      date: { [Op.between]: [new Date(), futureDate] },\n    },\n    include: [\n      {\n        model: db.Machinery,\n        as: \"machine\",\n        where: { siteId },\n        attributes: [\"id\", \"machineName\", \"registrationNumber\", \"erpCode\"],\n      },\n    ],\n    order: [[\"date\", \"ASC\"]],\n    limit: parseInt(limit),\n  });\n\n  return maintenanceDue;\n};\n\nconst getSiteInfo = async (siteId) => {\n  if (!siteId) {\n    throw new Error(\"Site ID is required for site users\");\n  }\n\n  const siteInfo = await db.Site.findByPk(siteId, {\n    include: [{ model: db.Department, attributes: [\"name\"] }],\n    attributes: [\n      \"id\",\n      \"name\",\n      \"code\",\n      \"address\",\n      \"pincode\",\n      \"mobileNumber\",\n      \"status\",\n      \"type\",\n    ],\n  });\n\n  if (!siteInfo) {\n    throw new Error(\"Site not found\");\n  }\n\n  return siteInfo;\n};\n\nmodule.exports = {\n  getOverview,\n  getAlerts,\n  getRecentActivities,\n  getMachineStatus,\n  getSitesSummary,\n  getInventoryAlerts,\n  getMaintenanceDue,\n  getProcurementPending,\n  getPaymentsOutstanding,\n  getExpensesMonthly,\n\n  getSiteOverview,\n  getSiteRequisitions,\n  getSiteMaterialIssues,\n  getSiteTransfers,\n  getSiteInventoryAlerts,\n  getSiteMachineAlerts,\n  getSiteMachineStatus,\n  getSiteInventoryStatus,\n  getSiteMaintenanceDue,\n  getSiteExpenses,\n  getSiteInfo,\n};\n","const Joi = require(\"joi\");\n\nconst dashboardFiltersSchema = Joi.object({\n  siteId: Joi.number().integer().positive().optional(),\n  departmentId: Joi.number().integer().positive().optional(),\n  categoryId: Joi.number().integer().positive().optional(),\n  dateRange: Joi.object({\n    startDate: Joi.date().optional(),\n    endDate: Joi.date().optional()\n  }).optional(),\n  limit: Joi.number().integer().min(1).max(100).optional(),\n  days: Joi.number().integer().min(1).max(365).optional(),\n  months: Joi.number().integer().min(1).max(24).optional(),\n  status: Joi.string().optional(),\n  severity: Joi.string().valid('Low Stock', 'Out of Stock').optional()\n});\n\nmodule.exports = {\n  dashboardFiltersSchema,\n};","const { Notification } = require(\"./../../models\");\nconst createNotification = async ({\n  eventType,\n  eventAction,\n  referenceId,\n  siteId,\n  createdBy,\n  roles,\n  title,\n  description,\n}) => {\n  const notification = await Notification.create({\n    eventType,\n    eventAction,\n    referenceId,\n    siteId,\n    title,\n    description,\n    createdBy,\n  });\n\n  // Associate roles to receive this notification\n  if (roles?.length) {\n    await notification.setRoles(roles);\n  }\n};\n\nmodule.exports = createNotification;\n","const FileService = require('./file.service');\n\nexports.uploadFile = async (req, res) => {\n  const { folder, fileName } = req.body\n  const result = await FileService.uploadFile(req.file, folder, fileName);\n  res.sendResponse(result, \"File uploaded successfully\");\n};\n\nexports.deleteFile = async (req, res) => {\n  await FileService.deleteFile(req.params.publicId);\n  res.sendResponse(null, \"File deleted successfully\");\n};","const Router = require('express').Router();\nconst FileController = require('./file.controller');\nconst upload = require('../../middlewares/cloudinaryUpload');\nconst asyncMiddleware = require('../../middlewares/asyncMiddleware');\n\n// Upload File\nRouter.post(\n  '/upload',\n  upload.single('file'),\n  asyncMiddleware(FileController.uploadFile)\n);\n\n// Delete File\nRouter.delete(\n  '/delete/:publicId',\n  asyncMiddleware(FileController.deleteFile)\n);\n\nmodule.exports = Router;","const cloudinary = require(\"../../utils/cloudinary\");\n\n\nexports.uploadFile = async (file, folder, fileName) => {\n  if (!file) throw new Error('No file uploaded');\n  const directory = folder ? folder + \"/\" + fileName : \"uploads\"\n\n  const result = await cloudinary.uploader.upload(file.path, {\n    folder: directory,\n    use_filename: true,\n    unique_filename: false,\n    resource_type: 'auto'\n  });\n\n  return {\n    fileUrl: result.secure_url,\n    publicId: result.public_id\n  };\n};\n\nexports.deleteFile = async (publicId) => {\n  await cloudinary.uploader.destroy(publicId);\n};","const inventoryService = require(\"./inventory.service\");\n\nconst createInventory = async (req, res) => {\n  const inventory = await inventoryService.createInventory(req.body);\n  res.sendResponse(inventory, \"Inventory created successfully\");\n};\n\nconst updateInventory = async (req, res) => {\n  const inventory = await inventoryService.updateInventory(\n    req.params.id,\n    req.body\n  );\n  res.sendResponse(inventory, \"Inventory updated successfully\");\n};\n\nconst deleteInventory = async (req, res) => {\n  await inventoryService.deleteInventory(req.params.id);\n  res.sendResponse(null, \"Inventory deleted successfully\");\n};\n\nconst getInventoryById = async (req, res) => {\n  const inventory = await inventoryService.getInventoryById(req.params.id);\n  res.sendResponse(inventory, \"Inventory fetched successfully\");\n};\n\nconst getAllInventories = async (req, res) => {\n  const result = await inventoryService.getAggregatedInventoryForAdmin(\n    req.user.siteId\n  );\n  return res.sendResponse(result, \"Aggregated inventory for admin\");\n  if (req.user.siteId) {\n  } else {\n    const filters = { siteId: req.user.siteId };\n    const inventories = await inventoryService.getAllInventories(filters);\n    return res.sendResponse(inventories, \"Inventories fetched successfully\");\n  }\n};\n\nconst getInventoryDetailsByItemId = async (req, res) => {\n  const { itemId } = req.params;\n  const { siteId } = req.user;\n  const inventoryDetails = await inventoryService.inventoryDetailsByItemId({\n    itemId,\n    siteId,\n  });\n  res.sendResponse(inventoryDetails, \"Inventory details fetched successfully\");\n};\n\nconst getInventoryBySiteId = async (req, res) => {\n  const inventory = await inventoryService.getInventoryBySiteId(\n    req.params.siteId\n  );\n  res.sendResponse(inventory, \"Inventory fetched successfully\");\n};\n\nconst getItemGroupsAndItemsBySiteId = async (req, res) => {\n  const inventory = await inventoryService.getItemGroupsAndItemsBySiteId(\n    req.params.siteId\n  );\n  res.sendResponse(inventory, \"Inventory fetched successfully\");\n};\n\nconst getStockLogsByItem = async (req, res) => {\n  const { itemId } = req.params;\n  const { siteId } = req.user;\n  const logs = await inventoryService.getStockLogsByItem(itemId, siteId);\n  res.sendResponse(logs, \"Stock logs fetched successfully\");\n};\n\nconst getStockStatusBulk = async (req, res) => {\n  const siteId = req.query.siteId || req.user.siteId;\n  const { itemIds } = req.query;\n  const stockStatus = await inventoryService.getStockStatusBulk(\n    siteId,\n    itemIds.split(\",\")\n  );\n  res.sendResponse(stockStatus, \"Stock status fetched successfully\");\n};\n\nconst getStockLogReference = async (req, res) => {\n  const { sourceId, sourceType, itemId } = req.query;\n  const logs = await inventoryService.getStockLogReference(sourceId, sourceType, itemId);\n  res.sendResponse(logs, \"Stock logs fetched successfully\");\n};\n\nmodule.exports = {\n  createInventory,\n  updateInventory,\n  deleteInventory,\n  getInventoryById,\n  getAllInventories,\n  getInventoryDetailsByItemId,\n  getInventoryBySiteId,\n  getItemGroupsAndItemsBySiteId,\n  getStockLogsByItem,\n  getStockStatusBulk,\n  getStockLogReference\n};\n","const express = require(\"express\");\nconst router = express.Router();\nconst inventoryController = require(\"./inventory.controller\");\nconst asyncMiddleware = require(\"./../../middlewares/asyncMiddleware\");\nconst { createInventorySchema, updateInventorySchema } = require(\"./inventory.validator\");\nconst validateRequest = require(\"./../../middlewares/validateRequest\");\n\nrouter.post(\"/\", validateRequest(createInventorySchema), asyncMiddleware(inventoryController.createInventory));\nrouter.put(\"/:id\", validateRequest(updateInventorySchema), asyncMiddleware(inventoryController.updateInventory));\nrouter.delete(\"/:id\", asyncMiddleware(inventoryController.deleteInventory));\nrouter.get(\"/:id\", asyncMiddleware(inventoryController.getInventoryById));\nrouter.get(\"/\", asyncMiddleware(inventoryController.getAllInventories));\nrouter.get(\"/item/:itemId\", asyncMiddleware(inventoryController.getInventoryDetailsByItemId));\nrouter.get(\"/items/sites/:siteId\", asyncMiddleware(inventoryController.getItemGroupsAndItemsBySiteId));\nrouter.get(\"/sites/:siteId\", asyncMiddleware(inventoryController.getInventoryBySiteId));\nrouter.get(\"/stock-log/:itemId\", asyncMiddleware(inventoryController.getStockLogsByItem));\nrouter.get(\"/reference/stock-log\", asyncMiddleware(inventoryController.getStockLogReference));\nrouter.get(\"/stock-status/bulk\", asyncMiddleware(inventoryController.getStockStatusBulk));\n\nmodule.exports = router;\n","const db = require(\"./../../models\");\nconst { Sequelize } = require(\"sequelize\");\n\nconst createInventory = async (data) => {\n  const { siteId, itemId } = data;\n  const existing = await db.SiteInventory.findOne({\n    where: { siteId, itemId },\n  });\n  if (existing) {\n    //increase the quantity if inventory already exists\n    existing.quantity += data.quantity;\n    await existing.save();\n    //Update StockLog\n    // await db.StockLog.create({\n    //   itemId,\n    //   siteId,\n    //   change: data.quantity,\n    //   type: \"Increase\",\n    //   sourceType: \"Inventory\",\n    //   sourceId: existing.id, // Assuming you want to link the log to the inventory\n    // });\n    return existing;\n  }\n  const newInventory = await db.SiteInventory.create(data);\n  //Update StockLog\n  // await db.StockLog.create({\n  //   itemId: newInventory.itemId,\n  //   siteId: newInventory.siteId,\n  //   change: newInventory.quantity,\n  //   type: \"Adjustment\",\n  //   sourceType: \"Inventory\",\n  //   sourceId: newInventory.id,\n  // });\n  return newInventory;\n};\n\nconst updateInventory = async (id, data) => {\n  const inventory = await db.SiteInventory.findByPk(id);\n  if (!inventory) throw new Error(\"Inventory not found\");\n  return await inventory.update(data);\n};\n\nconst deleteInventory = async (id) => {\n  const inventory = await db.SiteInventory.findByPk(id);\n  if (!inventory) throw new Error(\"Inventory not found\");\n  return await inventory.destroy();\n};\n\nconst getInventoryById = async (id) => {\n  return await db.SiteInventory.findByPk(id, {\n    include: [\n      { model: db.Site },\n      { model: db.Item, include: [db.Unit, db.ItemGroup] },\n    ],\n  });\n};\n\nconst getAllInventories = async () => {\n  return await db.SiteInventory.findAll({\n    include: [\n      { model: db.Site },\n      { model: db.Item, include: [db.Unit, db.ItemGroup] },\n    ],\n  });\n};\n\nconst getAggregatedInventoryForAdmin = async (siteId) => {\n  const where = {};\n  if (siteId) {\n    where.siteId = siteId;\n  }\n  const results = await db.SiteInventory.findAll({\n    where,\n    attributes: [\n      \"itemId\",\n      [Sequelize.fn(\"SUM\", Sequelize.col(\"quantity\")), \"totalQuantity\"],\n      [Sequelize.fn(\"SUM\", Sequelize.col(\"lockedQuantity\")), \"totalLockedQuantity\"],\n    ],\n    include: [\n      {\n        model: db.Item,\n        attributes: [\"name\", \"partNumber\", \"hsnCode\"],\n        include: [\n          { model: db.Unit, attributes: [\"name\"] },\n          { model: db.ItemGroup, attributes: [\"name\"] },\n        ],\n      },\n    ],\n    group: [\"itemId\", \"Item.id\", \"Item->Unit.id\", \"Item->ItemGroup.id\"],\n  });\n\n  // return results.map((record) => ({\n  //   itemId: record.itemId,\n  //   itemName: record.Item.name,\n  //   totalQuantity: parseFloat(record.get(\"totalQuantity\")),\n  //   unit: record.Item.Unit.name,\n  //   itemGroup: record.Item.ItemGroup.name\n  // }));\n\n  return results;\n};\n\nasync function inventoryDetailsByItemId(params) {\n  const { itemId } = params;\n  const where = { itemId };\n  if (params.siteId) {\n    where[\"siteId\"] = params.siteId;\n  }\n  return await db.SiteInventory.findAll({\n    where,\n    include: [\n      { model: db.Site },\n      { model: db.Item, include: [db.Unit, db.ItemGroup] },\n    ],\n  });\n}\n\nasync function getInventoryBySiteId(siteId) {\n  return await db.SiteInventory.findAll({\n    where: { siteId },\n    include: [{ model: db.Item, include: [db.Unit, db.ItemGroup] }],\n  });\n}\n\n// Find list of Item groups and items of a site invenotry\nasync function getItemGroupsAndItemsBySiteId(siteId) {\n  return await db.ItemGroup.findAll({\n    include: [\n      {\n        model: db.Item,\n        required: true,\n        include: [\n          {\n            model: db.Unit,\n          },\n          {\n            model: db.SiteInventory,\n            required: true,\n            where: { siteId }, // filter by siteId\n            attributes: [\"quantity\"], // optional: don't fetch inventory details if not needed\n          },\n        ],\n      },\n    ],\n  });\n}\n\nconst getStockLogsByItem = async (itemId, siteId) => {\n  const where = { itemId };\n  if (siteId) {\n    where.siteId = siteId;\n  }\n  const logs = await db.StockLog.findAll({\n    where: where,\n    include: [\n      {\n        model: db.Site,\n        attributes: [\"id\", \"name\"],\n      },\n      {\n        model: db.User,\n        attributes: [\"id\", \"name\"],\n      },\n    ],\n    order: [[\"createdAt\", \"DESC\"]],\n  });\n\n  // Format reference dynamically\n  const formattedLogs = await Promise.all(\n    logs.map(async (log) => {\n      let reference = \"\";\n\n      switch (log.sourceType) {\n        case \"Issue\":\n          const issue = await db.MaterialIssue.findByPk(log.sourceId);\n          if (issue) {\n            if (issue.issueType === \"Site Transfer\") {\n              const toSite = await db.Site.findByPk(issue.otherSiteId);\n              reference = `Transfer to ${toSite?.name || \"another site\"}`;\n            } else {\n              reference = `by ${issue.issueNumber}`;\n            }\n          }\n          break;\n\n        case \"Requisition\":\n          const req = await db.Requisition.findByPk(log.sourceId);\n          if (req) reference = `by ${req.requisitionNo}`;\n          break;\n\n        case \"Procurement\":\n          const po = await db.Procurement.findByPk(log.sourceId);\n          if (po) reference = `By ${po.procurementNo}`;\n          break;\n\n        default:\n          reference = log.sourceType || \"-\";\n      }\n\n      return {\n        dateTime: log.createdAt,\n        type: log.type,\n        quantity: log.change,\n        site: log.Site?.name || \"-\",\n        reference,\n        sourceType: log.sourceType,\n        itemId: log.itemId,\n        sourceId: log.sourceId,\n        user: log.User?.name || \"-\",\n      };\n    })\n  );\n\n  return formattedLogs;\n};\n\nconst getStockStatusBulk = async (siteId, itemIds) => {\n  const inventories = await db.SiteInventory.findAll({\n    where: { siteId, itemId: itemIds.map((id) => parseInt(id)) },\n  });\n\n  // Process and return the stock status\n  return inventories.map((inventory) => {\n    const availableQuantity = inventory.quantity - (inventory.lockedQuantity || 0);\n    return {\n      itemId: inventory.itemId,\n      quantity: inventory.quantity,\n      lockedQuantity: inventory.lockedQuantity || 0,\n      availableQuantity: availableQuantity,\n      status: availableQuantity > 0 ? \"In Stock\" : \"Out of Stock\",\n    };\n  });\n};\n\nconst getStockLogReference = async (sourceId, sourceType, itemId) => {\n  switch (sourceType) {\n    case \"Issue\":\n\n      const issueItem = await db.MaterialIssueItem.findOne({\n        where: { materialIssueId: sourceId, itemId },\n        include: [\n          {\n            model: db.MaterialIssue,\n            attributes: [\"issueNumber\", \"issueType\", \"otherSiteId\"],\n          },\n          {\n            model: db.Machinery,\n            as: \"machine\",\n            attributes: [\"machineName\", \"registrationNumber\"],\n          },\n          {\n            model: db.Site,\n            attributes: [\"name\"],\n            as: \"fromSite\"\n          },\n          {\n            model: db.Site,\n            attributes: [\"name\"],\n            as: \"toSite\"\n          },\n        ],\n      });\n      if (issueItem) return { issueItem, machinery: issueItem.Machinery };\n      break;\n\n    case \"Requisition\":\n      const reqItem = await db.RequisitionItem.findOne({ where: { requisitionId: sourceId, itemId } });\n      if (reqItem) return { reqItem };\n      break;\n\n    case \"Procurement\":\n      const poItem = await db.ProcurementItem.findOne({\n        where: {\n          procurementId: sourceId,\n          itemId\n        },\n        include: [{\n          model: db.Procurement,\n          attributes: ['procurementNo'] // Select the specific column here\n        }],\n        raw: true,\n        nest: true // This keeps the object structure clean\n      });\n\n      if (poItem) return { poItem };\n      break;\n\n    default:\n      return sourceType || \"-\";\n  }\n};\n\nmodule.exports = {\n  createInventory,\n  updateInventory,\n  deleteInventory,\n  getInventoryById,\n  getAllInventories,\n  getAggregatedInventoryForAdmin,\n  inventoryDetailsByItemId,\n  getInventoryBySiteId,\n  getItemGroupsAndItemsBySiteId,\n  getStockLogsByItem,\n  getStockStatusBulk,\n  getStockLogReference\n};\n","const Joi = require(\"joi\");\n\nconst createInventorySchema = Joi.object({\n  siteId: Joi.number().integer().positive().required(),\n  itemId: Joi.number().integer().positive().required(),\n  quantity: Joi.number().precision(2).required(),\n});\n\nconst updateInventorySchema = Joi.object({\n  siteId: Joi.number().integer().positive(),\n  itemId: Joi.number().integer().positive(),\n  quantity: Joi.number().precision(2),\n});\n\nmodule.exports = {\n  createInventorySchema,\n  updateInventorySchema,\n};\n","// controllers/invoice.controller.js\nconst invoiceService = require('./invoice.service');\n\nconst createInvoice = async (req, res) => {\n  const data = { ...req.body };\n  if (data.items && typeof data.items === \"string\") {\n    try {\n      data.items = JSON.parse(data.items);\n    } catch (error) {\n      console.error(\"Failed to parse items:\", error);\n    }\n  }\n  const invoice = await invoiceService.createInvoice(data, req.fileData);\n  res.sendResponse(invoice, 'Invoice created successfully');\n};\n\nconst createPayment = async (req, res) => {\n  const payment = await invoiceService.createPayment(req.body);\n  res.sendResponse(payment, 'Payment created successfully');\n};\n\nconst acceptInvoice = async (req, res) => {\n  const invoice = await invoiceService.acceptInvoice(req.params.id, req.user);\n  res.sendResponse(invoice, \"Invoice accepted and inventory updated\");\n};\n\nmodule.exports = {\n  createInvoice,\n  createPayment,\n  acceptInvoice,\n  // Add other controller methods\n};","// routes/invoice.routes.js\nconst router = require(\"express\").Router();\nconst asyncMiddleware = require(\"../../middlewares/asyncMiddleware\");\nconst validateRequest = require(\"../../middlewares/validateRequest\");\nconst invoiceController = require(\"./invoice.controller\");\nconst {\n  fileUploadMiddleware,\n  upload,\n} = require(\"../../middlewares/fileUploadMiddleware\");\n\nconst fileFields = [\"files\"];\nconst {\n  createInvoiceSchema,\n  updateInvoiceSchema,\n  createPaymentSchema,\n} = require(\"./invoice.validator\");\n\n// Invoice routes\nrouter.post(\n  \"/invoices\",\n  upload.fields(fileFields.map((name) => ({ name, maxCount: 1 }))),\n  fileUploadMiddleware(fileFields, \"mani\", \"invoices\"),\n  (req, res, next) => {\n    if (req.body.items && typeof req.body.items === \"string\") {\n      try {\n        req.body.items = JSON.parse(req.body.items);\n      } catch (e) {\n        console.error(\"Failed to parse items JSON:\", e);\n      }\n    }\n    next();\n  },\n  validateRequest(createInvoiceSchema),\n  asyncMiddleware(invoiceController.createInvoice)\n);\n\nrouter.post(\n  \"/invoices/:id/payments\",\n  validateRequest(createPaymentSchema),\n  asyncMiddleware(invoiceController.createPayment)\n);\n\nrouter.post(\n  \"/invoices/:id/accept\",\n  asyncMiddleware(invoiceController.acceptInvoice)\n);\n\n// Add other invoice routes (GET, PUT, DELETE) as needed\n\nmodule.exports = router;\n","// services/invoice.service.js\nconst { Op } = require(\"sequelize\");\nconst db = require(\"./../../models\");\n// const pdfService = require('./pdf.service');\n// const storageService = require('./storage.service');\n\nconst createInvoice = async (data, fileData) => {\n  const transaction = await db.sequelize.transaction();\n  try {\n    // 1. Create Invoice\n    const invoice = await db.Invoice.create(\n      { ...data, files: fileData },\n      { transaction }\n    );\n\n    // 2. Process Invoice Items (if provided)\n    if (data.items && Array.isArray(data.items)) {\n      for (const item of data.items) {\n        // Create InvoiceItem\n        await db.InvoiceItem.create(\n          {\n            invoiceId: invoice.id,\n            procurementItemId: item.procurementItemId,\n            quantity: item.quantity,\n            rate: item.rate,\n            amount: item.amount,\n          },\n          { transaction }\n        );\n\n        // Update ProcurementItem receivedQuantity\n        const procurementItem = await db.ProcurementItem.findByPk(\n          item.procurementItemId,\n          { transaction }\n        );\n\n        if (procurementItem) {\n          await procurementItem.increment(\"receivedQuantity\", {\n            by: item.quantity,\n            transaction,\n          });\n        }\n      }\n    }\n\n    // 3. Check if Procurement is fully delivered\n    // Fetch all items for this procurement\n    const procurementItems = await db.ProcurementItem.findAll({\n      where: { procurementId: data.procurementId },\n      transaction,\n    });\n\n    const allDelivered = procurementItems.every(\n      (item) => item.receivedQuantity >= item.quantity\n    );\n\n    if (allDelivered) {\n      await db.Procurement.update(\n        { status: \"delivered\" },\n        { where: { id: data.procurementId }, transaction }\n      );\n    }\n\n    await transaction.commit();\n    return invoice;\n  } catch (error) {\n    await transaction.rollback();\n    throw error;\n  }\n};\n\nconst createPayment = async (data) => {\n  const transaction = await db.sequelize.transaction();\n  try {\n    const invoice = await db.Invoice.findByPk(data.invoiceId, {\n      include: [{ model: db.Procurement, as: \"procurement\" }],\n    });\n\n    if (!invoice) {\n      throw new Error(\"Invoice not found\");\n    }\n\n    // Create payment\n    const payment = await db.Payment.create(\n      {\n        invoiceId: data.invoiceId,\n        paymentDate: data.paymentDate,\n        amount: data.amount,\n        paymentMethod: data.paymentMethod,\n        referenceNumber: data.referenceNumber,\n        remarks: data.remarks,\n        status: \"COMPLETED\",\n      },\n      { transaction }\n    );\n\n    // Generate payment slip PDF\n    // const pdfBuffer = await pdfService.generatePaymentSlip({\n    //   payment,\n    //   invoice,\n    //   vendor: invoice.vendor,\n    //   procurement: invoice.procurement\n    // });\n\n    // Upload to storage\n    // const slipUrl = await storageService.uploadPaymentSlip(\n    //   `payments/${payment.id}.pdf`,\n    //   pdfBuffer\n    // );\n\n    // Update payment with slip URL\n    await payment.update({ slipUrl: \"\" }, { transaction });\n\n    // Update invoice status if fully paid\n    const totalPaid = await db.Payment.sum(\"amount\", {\n      where: { invoiceId: invoice.id, status: \"COMPLETED\" },\n    });\n\n    if (totalPaid >= invoice.totalAmount) {\n      await invoice.update({ status: \"PAID\" }, { transaction });\n    } else if (totalPaid > 0) {\n      await invoice.update({ status: \"PARTIALLY_PAID\" }, { transaction });\n    }\n\n    await transaction.commit();\n    return await db.Payment.findByPk(payment.id, {\n      include: [{ model: db.Invoice, as: \"invoice\" }],\n    });\n  } catch (error) {\n    await transaction.rollback();\n    throw error;\n  }\n};\n\nconst acceptInvoice = async (id, user) => {\n  const transaction = await db.sequelize.transaction();\n  try {\n    const invoice = await db.Invoice.findByPk(id, {\n      include: [\n        {\n          model: db.InvoiceItem,\n          as: \"items\",\n          include: [\n            {\n              model: db.ProcurementItem,\n              include: [db.RequisitionItem],\n            },\n          ],\n        },\n      ],\n      transaction,\n    });\n\n    if (!invoice) throw new Error(\"Invoice not found\");\n    if (invoice.isInventoryUpdated)\n      throw new Error(\"Inventory already updated for this invoice\");\n\n    // Get Virtual Site\n    let virtualSite = await db.Site.findOne({\n      where: { type: \"virtual\" },\n      attributes: [\"id\"],\n      transaction,\n    });\n\n    if (!virtualSite?.id) {\n      const department = await db.Department.findOne({\n        where: { name: \"Mechanical\" },\n        transaction,\n      });\n      virtualSite = await db.Site.create(\n        {\n          name: \"Virtual\",\n          type: \"virtual\",\n          departmentId: department.id,\n          address: \"NA\",\n        },\n        { transaction }\n      );\n    }\n\n    // Update Inventory for each item\n    for (const item of invoice.items) {\n      await updateInventory(\n        {\n          siteId: virtualSite.id,\n          itemId: item.ProcurementItem.RequisitionItem.itemId,\n          change: item.quantity,\n          type: \"IN\",\n          sourceType: \"Procurement\",\n          sourceId: invoice.procurementId,\n          userId: user.id,\n        },\n        transaction\n      );\n    }\n\n    await invoice.update({ isInventoryUpdated: true }, { transaction });\n    await transaction.commit();\n    return invoice;\n  } catch (error) {\n    await transaction.rollback();\n    throw error;\n  }\n};\n\n// Helper function for inventory updates (copied/shared from procurement service)\n// ideally this should be in a shared inventory service\nconst updateInventory = async (data, transaction) => {\n  // Update SiteInventory\n  const [inventory] = await db.SiteInventory.findOrCreate({\n    where: {\n      siteId: data.siteId,\n      itemId: data.itemId,\n    },\n    defaults: { quantity: 0 },\n    transaction,\n  });\n\n  const newQuantity =\n    data.type === \"IN\"\n      ? inventory.quantity + data.change\n      : inventory.quantity - data.change;\n\n  // Simple status check\n  const status = newQuantity <= 0 ? \"Out of Stock\" : \"In Stock\";\n\n  await inventory.update(\n    {\n      quantity: newQuantity,\n      status: status,\n    },\n    { transaction }\n  );\n\n  // Create StockLog\n  await db.StockLog.create(data, { transaction });\n};\n\nmodule.exports = {\n  createInvoice,\n  createPayment,\n  acceptInvoice,\n  // Add other CRUD operations as needed\n};\n","// validators/invoice.validator.js\nconst Joi = require(\"joi\");\n\nconst createInvoiceSchema = Joi.object({\n  procurementId: Joi.number().integer().positive().required(),\n  invoiceNumber: Joi.string().required(),\n  invoiceDate: Joi.date().required(),\n  amount: Joi.number().precision(2).positive().required(),\n  files: Joi.array().items(Joi.string().uri()).optional(),\n  notes: Joi.string(),\n  items: Joi.array()\n    .items(\n      Joi.object({\n        procurementItemId: Joi.number().integer().positive().required(),\n        quantity: Joi.number().integer().positive().required(),\n        rate: Joi.number().positive().required(),\n        amount: Joi.number().positive().required(),\n      })\n    )\n    .optional(),\n});\n\nconst updateInvoiceSchema = createInvoiceSchema.keys({\n  status: Joi.string().valid(\n    \"DRAFT\",\n    \"SENT\",\n    \"PAID\",\n    \"PARTIALLY_PAID\",\n    \"CANCELLED\"\n  ),\n});\n\nconst createPaymentSchema = Joi.object({\n  invoiceId: Joi.number().integer().positive().required(),\n  paymentDate: Joi.date().required(),\n  amount: Joi.number().positive().required(),\n  paymentMethod: Joi.string()\n    .valid(\"CASH\", \"CHEQUE\", \"BANK_TRANSFER\", \"ONLINE_PAYMENT\", \"OTHER\")\n    .required(),\n  referenceNumber: Joi.string(),\n  remarks: Joi.string(),\n});\n\nmodule.exports = {\n  createInvoiceSchema,\n  updateInvoiceSchema,\n  createPaymentSchema,\n};\n","const { Op, or } = require(\"sequelize\");\nconst db = require(\"./../../models\");\nconst ROLES = require(\"../../utils/roles\");\nconst createNotification = require(\"../events\");\n\nconst createEntry = async (req, res) => {\n  const entry = await db.LogbookEntry.create({\n    ...req.body,\n    createdBy: req.user.id,\n    status: \"Pending\",\n  });\n\n  const fullEntry = await db.LogbookEntry.findByPk(entry.id, {\n    include: [\n      {\n        model: db.Machinery,\n        as: \"machine\",\n        attributes: [\n          \"id\",\n          \"machineName\",\n          \"machineNumber\",\n          \"registrationNumber\",\n          \"erpCode\",\n        ],\n      },\n      { model: db.User, as: \"creater\", attributes: [\"id\", \"name\"] },\n      { model: db.Site, as: \"site\", attributes: [\"id\", \"name\"] },\n    ],\n  });\n\n  // Notify Project Manager\n  await createNotification({\n    eventType: \"LogbookEntry\",\n    eventAction: \"Created\",\n    referenceId: fullEntry.id,\n    siteId: fullEntry.siteId,\n    createdBy: req.user.id,\n    roles: [ROLES.PROJECT_MANAGER],\n    title: \"New Logbook Entry Created\",\n    description: `A new logbook entry (${fullEntry.name}) has been created for machine ${fullEntry.machine?.machineName} at site ${fullEntry.site?.name}. Needs approval.`,\n  });\n\n  res.sendResponse(fullEntry, \"Logbook entry created. Pending approval.\");\n};\n\nconst approveEntry = async (req, res) => {\n  const { id } = req.params;\n  const entry = await db.LogbookEntry.findByPk(id, {\n    include: [{ model: db.Machinery, as: \"machine\" }],\n  });\n\n  if (!entry) return res.sendError({ message: \"Entry not found\" }, 404);\n  if (entry.status !== \"Pending\") return res.sendError({ message: \"Entry already processed\" }, 400);\n\n  await db.sequelize.transaction(async (t) => {\n    entry.status = \"Approved\";\n    entry.approvedById = req.user.id;\n    entry.approvedAt = new Date();\n    await entry.save({ transaction: t });\n\n    // Update Machinery totals\n    await db.Machinery.update(\n      {\n        totalKmRun: entry.totalRunKM || 0,\n        totalHoursRun: entry.closingHrsMeter || 0,\n      },\n      { where: { id: entry.machineId }, transaction: t }\n    );\n  });\n\n  // Notify relevant users\n  await createNotification({\n    eventType: \"LogbookEntry\",\n    eventAction: \"Approved\",\n    referenceId: entry.id,\n    siteId: entry.siteId,\n    createdBy: req.user.id,\n    roles: [ROLES.STORE_MANAGER, ROLES.SITE_INCHARGE],\n    title: \"Logbook Entry Approved\",\n    description: `Logbook entry ${entry.name} has been approved by Project Manager.`,\n  });\n\n  res.sendResponse(entry, \"Logbook entry approved\");\n};\n\nconst rejectEntry = async (req, res) => {\n  const { id } = req.params;\n  const { rejectionRemarks } = req.body;\n  const entry = await db.LogbookEntry.findByPk(id);\n\n  if (!entry) return res.sendError({ message: \"Entry not found\" }, 404);\n  if (entry.status !== \"Pending\") return res.sendError({ message: \"Entry already processed\" }, 400);\n\n  entry.status = \"Rejected\";\n  entry.rejectedById = req.user.id;\n  entry.rejectedAt = new Date();\n  entry.rejectionRemarks = rejectionRemarks;\n  await entry.save();\n\n  // Notify relevant users\n  await createNotification({\n    eventType: \"LogbookEntry\",\n    eventAction: \"Rejected\",\n    referenceId: entry.id,\n    siteId: entry.siteId,\n    createdBy: req.user.id,\n    roles: [ROLES.STORE_MANAGER, ROLES.SITE_INCHARGE],\n    title: \"Logbook Entry Rejected\",\n    description: `Logbook entry ${entry.name} has been rejected. Remarks: ${rejectionRemarks || \"None\"}`,\n  });\n\n  res.sendResponse(entry, \"Logbook entry rejected\");\n};\n\nconst allEntry = async (req, res) => {\n  const { machineId, date } = req.query;\n  const { siteId } = req.user;\n  const whereClause = {};\n\n  if (siteId) {\n    whereClause.siteId = siteId;\n  }\n  if (machineId) whereClause.machineId = machineId;\n  if (date) whereClause.date = date;\n\n  const entries = await db.LogbookEntry.findAll({\n    where: whereClause,\n    attributes: [\n      \"id\",\n      \"name\",\n      \"date\",\n      \"totalRunKM\",\n      \"dieselAvgKM\",\n      \"dieselIssue\",\n      \"totalRunHrsMeter\",\n      \"dieselAvgHrsMeter\",\n      \"dieselOpeningBalance\",\n      \"dieselClosingBalance\",\n      \"openingKmReading\",\n      \"closingKmReading\",\n      \"openingHrsMeter\",\n      \"closingHrsMeter\",\n      \"machineId\", // Added\n      \"siteId\", // Added\n      \"workingDetails\", // Added\n      \"status\", // Added\n    ],\n    include: [\n      {\n        model: db.Machinery,\n        as: \"machine\",\n        attributes: [\"id\", \"machineName\", \"erpCode\"], // Added id\n      },\n      { model: db.Site, as: \"site\", attributes: [\"id\", \"name\"] },\n    ],\n    order: [[\"createdAt\", \"DESC\"]],\n  });\n  res.sendResponse(entries);\n};\n\nconst entryDetails = async (req, res) => {\n  const { siteId } = req.user;\n  const entry = await db.LogbookEntry.findByPk(req.params.id, {\n    include: [\n      {\n        model: db.Machinery,\n        as: \"machine\",\n        attributes: [\n          \"id\",\n          \"machineName\",\n          \"machineNumber\",\n          \"registrationNumber\",\n          \"erpCode\",\n        ],\n      },\n      { model: db.User, as: \"creater\", attributes: [\"id\", \"name\"] },\n      { model: db.User, as: \"approvedBy\", attributes: [\"id\", \"name\"] },\n      { model: db.User, as: \"rejectedBy\", attributes: [\"id\", \"name\"] },\n      { model: db.Site, as: \"site\", attributes: [\"id\", \"name\", \"address\"] },\n    ],\n    where: {},\n  });\n  if (!entry)\n    return res.sendError(\n      { message: \"Entry not found\", name: \"NotFoundError\" },\n      404\n    );\n  res.sendResponse(entry);\n};\n\nconst updateEntry = async (req, res) => {\n  const updated = await db.LogbookEntry.update(req.body, {\n    where: { id: req.params.id },\n  });\n  res.sendResponse(updated, \"Logbook entry updated\");\n};\n\nconst deleteEntry = async (req, res) => {\n  await db.LogbookEntry.destroy({ where: { id: req.params.id } });\n  res.sendResponse({}, \"Logbook entry deleted\");\n};\n\nconst allEntryV2 = async (req, res) => {\n  const {\n    machineId,\n    date,\n    page = 1,\n    limit = 20,\n    orderBy = \"date\",\n    orderDirection = \"DESC\",\n    search = \"\",\n  } = req.query;\n\n  const { siteId } = req.user;\n  const user = req.user;\n  const offset = (page - 1) * limit;\n\n  const whereClause = {};\n\n  // Site Filtering Logic\n  if (siteId && !user.siteId) {\n    whereClause.siteId = siteId;\n  } else if (!siteId && user.siteId) {\n    whereClause.siteId = user.siteId;\n  }\n\n  if (machineId) whereClause.machineId = machineId;\n  if (date) whereClause.date = date;\n\n  // Main Query\n  const { rows: entries, count } = await db.LogbookEntry.findAndCountAll({\n    where: whereClause,\n    include: [\n      {\n        model: db.Machinery,\n        as: \"machine\",\n        attributes: [\n          \"id\",\n          \"machineName\",\n          \"machineNumber\",\n          \"registrationNumber\",\n          \"erpCode\",\n        ],\n        where: search\n          ? {\n            [Op.or]: [\n              { machineName: { [Op.iLike]: `%${search}%` } },\n              { machineNumber: { [Op.iLike]: `%${search}%` } },\n              { registrationNumber: { [Op.iLike]: `%${search}%` } },\n            ],\n          }\n          : undefined,\n      },\n      {\n        model: db.User,\n        as: \"creater\",\n        attributes: [\"id\", \"name\"],\n      },\n      {\n        model: db.Site,\n        as: \"site\",\n        attributes: [\"id\", \"name\"],\n      },\n    ],\n    order: [[orderBy, orderDirection]],\n    offset,\n    limit,\n  });\n\n  res.sendResponse({\n    data: entries,\n    currentPage: Number(page),\n    totalPages: Math.ceil(count / limit),\n    totalCount: count,\n  });\n};\n\nconst allMachines = async (req, res) => {\n  // const { siteId } = req.user;\n  const siteId = req.query.siteId || req.user.siteId; // Use query param or user context\n  const { fn, col } = db.Sequelize;\n  const whereClause = {};\n\n  if (siteId) {\n    whereClause.siteId = siteId;\n  }\n  const machines = await db.Machinery.findAll({\n    attributes: [\n      \"id\",\n      \"machineName\",\n      \"machineNumber\",\n      \"registrationNumber\",\n      \"erpCode\",\n      // Aggregate sums from the joined LogbookEntry\n      [\n        fn(\"COALESCE\", fn(\"SUM\", col(\"logbookEntries.dieselIssue\")), 0),\n        \"sumDieselIssue\",\n      ],\n      [\n        fn(\"COALESCE\", fn(\"SUM\", col(\"logbookEntries.totalRunKM\")), 0),\n        \"sumTotalRunKM\",\n      ],\n      [\n        fn(\"COALESCE\", fn(\"SUM\", col(\"logbookEntries.totalRunHrsMeter\")), 0),\n        \"sumTotalRunHrsMeter\",\n      ],\n      [col(\"site.name\"), \"siteName\"],\n      [col(\"site.address\"), \"siteLocation\"],\n      [col(\"site.id\"), \"siteId\"],\n    ],\n    where: whereClause, // machinery filter (e.g., siteId on Machinery if applicable)\n    include: [\n      {\n        model: db.LogbookEntry,\n        as: \"logbookEntries\",\n        attributes: [], // no row-level attributes; we only want aggregates\n        required: false, // LEFT JOIN\n        // where: siteId ? { siteId } : undefined, // restrict joined rows by site if needed\n      },\n      {\n        model: db.Site,\n        as: \"site\",\n        attributes: [],\n      },\n    ],\n    group: [\n      \"Machinery.id\",\n      \"Machinery.machineName\",\n      \"Machinery.machineNumber\",\n      \"Machinery.registrationNumber\",\n      \"Machinery.erpCode\",\n      \"site.name\",\n      \"site.address\",\n      \"site.id\",\n    ],\n    order: [[\"machineName\", \"ASC\"]],\n    subQuery: false,\n  });\n\n  res.sendResponse(machines);\n};\nmodule.exports = {\n  createEntry,\n  allEntry,\n  entryDetails,\n  updateEntry,\n  deleteEntry,\n  allEntryV2,\n  allMachines,\n  approveEntry,\n  rejectEntry,\n};\n","const express = require(\"express\");\nconst logbookController = require(\"./logbook.controller\");\nconst validateRequest = require(\"../../middlewares/validateRequest\");\nconst asyncMiddleware = require(\"../../middlewares/asyncMiddleware\");\nconst hasRole = require(\"./../../middlewares/hasRole\");\nconst ROLES = require(\"../../utils/roles\");\n\nconst router = express.Router();\n\nrouter.post(\"/logbook\", hasRole([ROLES.SITE_INCHARGE, ROLES.STORE_MANAGER, ROLES.PROJECT_MANAGER]), asyncMiddleware(logbookController.createEntry));\nrouter.get(\"/logbook\", asyncMiddleware(logbookController.allEntry));\nrouter.get(\"/logbook/site/machines\", asyncMiddleware(logbookController.allMachines));\nrouter.get(\"/logbook/:id\", asyncMiddleware(logbookController.entryDetails));\nrouter.post(\"/logbook/:id/approve\", hasRole([ROLES.PROJECT_MANAGER]), asyncMiddleware(logbookController.approveEntry));\nrouter.post(\"/logbook/:id/reject\", hasRole([ROLES.PROJECT_MANAGER]), asyncMiddleware(logbookController.rejectEntry));\nrouter.put(\"/logbook/:id\", hasRole([ROLES.SITE_INCHARGE, ROLES.STORE_MANAGER, ROLES.PROJECT_MANAGER]), asyncMiddleware(logbookController.updateEntry));\nrouter.delete(\"/logbook/:id\", hasRole([ROLES.SITE_INCHARGE, ROLES.STORE_MANAGER, ROLES.PROJECT_MANAGER]), asyncMiddleware(logbookController.deleteEntry));\n\nmodule.exports = router;","const TransferService = require(\"./transfer.service\");\n\nconst requestTransfer = async (req, res) => {\n  const user = req.user;\n  const {\n    machineId,\n    currentSiteId,\n    destinationSiteId,\n    reason,\n    requestType,\n    buyerDetails,\n    scrapDetails,\n    vehicleType,\n    transportDetails,\n  } = req.body;\n  if (user.siteId != currentSiteId) {\n    return res.sendError(\n      {\n        message: \"You are not allowed to request transfer from this site\",\n        name: \"AuthorizationError\",\n      },\n      403\n    );\n  }\n  const transfer = await TransferService.requestTransfer(\n    machineId,\n    currentSiteId,\n    destinationSiteId,\n    reason,\n    user.id,\n    requestType,\n    buyerDetails,\n    scrapDetails,\n    transportDetails,\n    vehicleType\n  );\n  res.sendResponse(transfer, \"Transfer request created\", 201);\n};\n\nconst approveTranfer = async (req, res) => {\n  const { id } = req.params;\n  const approvedBy = req.user.id;\n  const { remarks } = req.body;\n  const transfer = await TransferService.approveTranfer(\n    id,\n    approvedBy,\n    remarks\n  );\n  res.sendResponse(transfer, \"Transfer approved\");\n};\n\nconst rejectTransfer = async (req, res) => {\n  const { id } = req.params;\n  const rejectedBy = req.user.id;\n  const { remarks } = req.body;\n  const transfer = await TransferService.rejectTransfer(\n    id,\n    remarks,\n    rejectedBy,\n  );\n  res.sendResponse(transfer, \"Transfer rejected\");\n};\n\nconst dispatchMachine = async (req, res) => {\n  const user = req.user;\n  const { id } = req.params;\n  const {\n    vehicleNumber,\n    driverName,\n    mobileNumber,\n    remarks,\n    fuelGaugeReading,\n    odometerReading,\n    itemsIncluded,\n    hrsMeter,\n  } = req.body;\n  const transportDetails = { vehicleNumber, driverName, mobileNumber };\n  const transferData = {\n    transportDetails,\n    remarks,\n    fuelGaugeReading,\n    odometerReading,\n    itemsIncluded: JSON.parse(itemsIncluded),\n    hrsMeter,\n    files: req.fileData?.files,\n  };\n  const transfer = await TransferService.dispatchMachine(\n    id,\n    user.id,\n    user.siteId,\n    transferData\n  );\n  res.sendResponse(transfer, \"Machine dispatched\");\n};\n\nconst receiveMachine = async (req, res) => {\n  const user = req.user;\n  const { id } = req.params;\n  const { remarks, itemsReceived } = req.body;\n  const transfer = await TransferService.receiveMachine(\n    id,\n    user.id,\n    remarks,\n    user.siteId,\n    itemsReceived\n  );\n  res.sendResponse(transfer, \"Machine received\");\n};\n\nconst transferHistory = async (req, res) => {\n  const user = req.user;\n  const { status } = req.query;\n  const transfers = await TransferService.transferHistory(status, user.siteId);\n  res.sendResponse(transfers);\n};\n\nconst transferHistoryOfMachine = async (req, res) => {\n  const { machineId } = req.params;\n  const history = await TransferService.transferHistoryOfMachine(machineId);\n  res.sendResponse(history);\n};\n\nconst dispachtedList = async (req, res) => {\n  const user = req.user;\n  const transfers = await TransferService.dispachtedList(user.siteId);\n  res.sendResponse(transfers);\n};\n\nconst approvedList = async (req, res) => {\n  const user = req.user;\n  const transfers = await TransferService.approvedList(user.siteId);\n  res.sendResponse(transfers);\n};\n\nconst getTransferById = async (req, res) => {\n  const { id } = req.params;\n  const transfer = await TransferService.getTransferById(id);\n  res.sendResponse(transfer);\n};\n\nmodule.exports = {\n  requestTransfer,\n  approveTranfer,\n  dispatchMachine,\n  receiveMachine,\n  transferHistory,\n  transferHistoryOfMachine,\n  rejectTransfer,\n  dispachtedList,\n  approvedList,\n  getTransferById,\n};\n","const express = require(\"express\");\nconst transferController = require(\"./transfer.controller\");\nconst validateRequest = require(\"../../middlewares/validateRequest\");\nconst asyncMiddleware = require(\"../../middlewares/asyncMiddleware\");\nconst hasRole = require(\"../../middlewares/hasRole\");\nconst {\n  fileUploadMiddleware,\n  upload,\n} = require(\"../../middlewares/fileUploadMiddleware\");\n\nconst router = express.Router();\nconst fileFields = [\"files\"];\n\nrouter.post(\n  \"/transfer\",\n  hasRole([4, 5, 6]),\n  asyncMiddleware(transferController.requestTransfer)\n);\nrouter.get(\n  \"/transfer/:id\",\n  asyncMiddleware(transferController.getTransferById)\n);\nrouter.put(\n  \"/transfer/:id/approve\",\n  hasRole([1, 2, 3]),\n  asyncMiddleware(transferController.approveTranfer)\n);\nrouter.put(\n  \"/transfer/:id/reject\",\n  hasRole([1, 2, 3]),\n  asyncMiddleware(transferController.rejectTransfer)\n);\nrouter.put(\n  \"/transfer/:id/dispatch\",\n  hasRole([4, 5, 6]),\n  upload.fields(fileFields.map((name) => ({ name, maxCount: 5 }))),\n  fileUploadMiddleware(fileFields, \"mani\", \"transfer\"),\n  asyncMiddleware(transferController.dispatchMachine)\n);\nrouter.put(\n  \"/transfer/:id/receive\",\n  hasRole([4, 5, 6]),\n  asyncMiddleware(transferController.receiveMachine)\n);\nrouter.get(\"/transfers\", asyncMiddleware(transferController.transferHistory));\nrouter.get(\n  \"/transfers/machine/:machineId\",\n  asyncMiddleware(transferController.transferHistoryOfMachine)\n);\nrouter.get(\n  \"/transfers/dispatched\",\n  hasRole([4, 5, 6]),\n  asyncMiddleware(transferController.dispachtedList)\n);\nrouter.get(\n  \"/transfers/approved\",\n  hasRole([4, 5, 6]),\n  asyncMiddleware(transferController.approvedList)\n);\n\nrouter.post(\n  \"/file/upload\",\n  upload.fields(fileFields.map((name) => ({ name, maxCount: 5 }))),\n  fileUploadMiddleware(fileFields, \"mani\", \"transfer\"),\n  async (req, res) => {\n    res\n      .status(200)\n      .json({ files: req.fileData, message: \"Files uploaded successfully\" });\n  }\n);\n\nmodule.exports = router;\n","const { Op } = require(\"sequelize\");\nconst db = require(\"./../../models\");\nconst createNotification = require(\"../events\");\nconst ROLES = require(\"../../utils/roles\");\n\nconst userDetails = async (id) => {\n  return db.User.findByPk(id);\n};\n\nconst siteDetail = async (id) => {\n  return db.Site.findByPk(id);\n};\n\nconst requestTransfer = async (\n  machineId,\n  currentSiteId,\n  destinationSiteId,\n  reason,\n  requestedBy,\n  requestType,\n  buyerDetails,\n  scrapDetails,\n  transportDetails,\n  vehicleType\n) => {\n  const transfer = await db.MachineTransfer.create({\n    machineId,\n    currentSiteId,\n    destinationSiteId,\n    reason,\n    requestedBy,\n    requestType,\n    buyerDetails,\n    scrapDetails,\n    transportDetails,\n    vehicleType,\n  });\n  if (requestType == \"Site Transfer\") {\n    await db.Machinery.update(\n      { status: \"In Transfer\" },\n      { where: { id: machineId } }\n    );\n  }\n  const currentSite = await siteDetail(currentSiteId);\n  const destinationSite = await siteDetail(destinationSiteId || 0);\n  let title = \"\";\n  let description = \"\";\n\n  if (requestType === \"Site Transfer\") {\n    title = \"Machine Transfer Requested\";\n    description = `Machine transfer requested from Site ${currentSite.name} to Site ${destinationSite.name}.`;\n  } else if (requestType === \"Sell Machine\") {\n    title = \"Machine Sell Requested\";\n    description = `Request to sell machine from Site ${currentSite.name}.`;\n  } else if (requestType === \"Scrap Machine\") {\n    title = \"Machine Scrap Requested\";\n    description = `Request to scrap machine from Site ${currentSite.name}.`;\n  }\n\n  await createNotification({\n    eventType: \"MachineTransfer\",\n    eventAction: \"Requested\",\n    referenceId: transfer.id,\n    siteId: currentSiteId,\n    createdBy: requestedBy,\n    roles: [ROLES.ADMIN, ROLES.MECHANICAL_HEAD, ROLES.MECHANICAL_MANAGER, ROLES.SITE_INCHARGE, ROLES.STORE_MANAGER, ROLES.PROJECT_MANAGER], // example roles\n    title,\n    description,\n  });\n\n  return transfer;\n};\n\nconst approveTranfer = async (id, approvedBy, remarks) => {\n  const transfer = await db.MachineTransfer.findByPk(id);\n  if (!transfer) {\n    throw new Error(\"Transfer not found\");\n  }\n  if (transfer.status !== \"Pending\") {\n    throw new Error(\"Transfer not pending\");\n  }\n  transfer.status = \"Approved\";\n  transfer.approvedBy = approvedBy;\n  transfer.approveRemarks = remarks;\n  transfer.approvedAt = new Date();\n  await transfer.save();\n  if (\n    transfer.requestType === \"Sell Machine\" ||\n    transfer.requestType === \"Scrap Machine\"\n  ) {\n    const machine = await db.Machinery.findByPk(transfer.machineId);\n    if (transfer.requestType === \"Sell Machine\") {\n      machine.status = \"Sold\";\n    }\n    if (transfer.requestType === \"Scrap Machine\") {\n      machine.status = \"Scrap\";\n    }\n    machine.siteId = null;\n    await machine.save();\n  }\n\n  let title = \"\";\n  let description = \"\";\n  const currentSite = await siteDetail(transfer.currentSiteId);\n  if (transfer.requestType === \"Site Transfer\") {\n    title = \"Machine Transfer Approved\";\n    description = `Transfer #${transfer.name} approved from Site ${currentSite.name}.`;\n  } else if (transfer.requestType === \"Sell Machine\") {\n    title = \"Machine Sell Approved\";\n    description = `Machine sell request approved for machine #${transfer.name}.`;\n  } else if (transfer.requestType === \"Scrap Machine\") {\n    title = \"Machine Scrap Approved\";\n    description = `Scrap request approved for machine #${transfer.name}.`;\n  }\n\n  await createNotification({\n    eventType: \"MachineTransfer\",\n    eventAction: \"Approved\",\n    referenceId: transfer.id,\n    siteId: transfer.currentSiteId,\n    createdBy: approvedBy,\n    roles: [ROLES.SITE_INCHARGE, ROLES.STORE_MANAGER, ROLES.PROJECT_MANAGER, ROLES.ADMIN, ROLES.MECHANICAL_HEAD, ROLES.MECHANICAL_MANAGER],\n    title,\n    description,\n  });\n\n  return transfer;\n};\n\nconst dispatchMachine = async (id, dispatchedBy, userSiteId, updatedData) => {\n  const transfer = await db.MachineTransfer.findByPk(id);\n  if (!transfer) {\n    throw new Error(\"Transfer not found\");\n  }\n  if (transfer.status !== \"Approved\") {\n    throw new Error(\"Transfer not approved yet\");\n  }\n  if (transfer.currentSiteId !== userSiteId) {\n    throw new Error(\"You are not allowed to dispatch this transfer\");\n  }\n  Object.assign(transfer, {\n    status: \"Dispatched\",\n    fuelGaugeReading: updatedData.fuelGaugeReading,\n    odometerReading: updatedData.odometerReading,\n    itemsIncluded: updatedData.itemsIncluded,\n    dispatchRemarks: updatedData.remarks,\n    dispatchedBy,\n    transportDetails: updatedData.transportDetails,\n    dispatchedAt: new Date(),\n    files: updatedData.files,\n    hrsMeter: updatedData.hrsMeter,\n  });\n\n  await transfer.save();\n  const currentSite = await siteDetail(transfer.currentSiteId);\n\n  if (transfer.requestType === \"Site Transfer\") {\n    await createNotification({\n      eventType: \"MachineTransfer\",\n      eventAction: \"Dispatched\",\n      referenceId: transfer.id,\n      siteId: transfer.currentSiteId,\n      createdBy: dispatchedBy,\n      roles: [\n        ROLES.STORE_MANAGER,\n        ROLES.SITE_INCHARGE,\n        ROLES.PROJECT_MANAGER,\n        ROLES.ADMIN,\n        ROLES.MECHANICAL_HEAD,\n        ROLES.MECHANICAL_MANAGER,\n      ], // example roles\n      title: \"Machine Dispatched\",\n      description: `Machine dispatched from Site ${currentSite.name} for transfer #${transfer.name}.`,\n    });\n  }\n\n  return transfer;\n};\n\nconst receiveMachine = async (id, receivedBy, remarks, userSiteId, itemsReceived) => {\n  const transfer = await db.MachineTransfer.findByPk(id);\n  if (!transfer) {\n    throw new Error(\"Transfer not found\");\n  }\n  if (transfer.status !== \"Dispatched\") {\n    throw new Error(\"Transfer not dispatched yet\");\n  }\n  if (transfer.destinationSiteId !== userSiteId) {\n    throw new Error(\"You are not allowed to dispatch this transfer\");\n  }\n  transfer.status = \"Received\";\n  transfer.receivedBy = receivedBy;\n  transfer.finalRemarks = remarks;\n  transfer.receivedAt = new Date();\n  transfer.itemsReceived = itemsReceived;\n  await transfer.save();\n  // Update the machine's siteId to the destination siteId\n  await db.Machinery.update(\n    { siteId: transfer.destinationSiteId, status: \"In Use\" },\n    { where: { id: transfer.machineId } }\n  );\n\n  const destinationSite = await siteDetail(transfer.destinationSiteId);\n\n  if (transfer.requestType === \"Site Transfer\") {\n    await createNotification({\n      eventType: \"MachineTransfer\",\n      eventAction: \"Received\",\n      referenceId: transfer.id,\n      siteId: transfer.destinationSiteId,\n      createdBy: receivedBy,\n      roles: [\n        ROLES.STORE_MANAGER,\n        ROLES.SITE_INCHARGE,\n        ROLES.PROJECT_MANAGER,\n        ROLES.ADMIN,\n        ROLES.MECHANICAL_HEAD,\n        ROLES.MECHANICAL_MANAGER,\n      ], // example roles\n      title: \"Machine Received\",\n      description: `Machine received at Site ${destinationSite.name} for transfer #${transfer.name}.`,\n    });\n  }\n\n  return transfer;\n};\n\nconst rejectTransfer = async (id, rejectionRemarks, rejectedBy) => {\n  const transfer = await db.MachineTransfer.findByPk(id);\n  if (!transfer) {\n    throw new Error(\"Transfer not found\");\n  }\n  if (transfer.status !== \"Pending\") {\n    throw new Error(\"Transfer not pending\");\n  }\n  transfer.status = \"Rejected\";\n  transfer.rejectionRemarks = rejectionRemarks;\n  transfer.rejectedBy = rejectedBy;\n  transfer.rejectedAt = new Date();\n  await transfer.save();\n  await db.Machinery.update(\n    { status: \"In Use\" },\n    { where: { id: transfer.machineId } }\n  );\n  let title = \"\";\n  let description = \"\";\n  const currentSite = await siteDetail(transfer.currentSiteId);\n\n  if (transfer.requestType === \"Site Transfer\") {\n    title = \"Machine Transfer Rejected\";\n    description = `Transfer #${transfer.name} from Site ${currentSite.name} rejected.`;\n  } else if (transfer.requestType === \"Sell Machine\") {\n    title = \"Machine Sell Rejected\";\n    description = `Sell request for machine #${transfer.machineId} was rejected.`;\n  } else if (transfer.requestType === \"Scrap Machine\") {\n    title = \"Machine Scrap Rejected\";\n    description = `Scrap request for machine #${transfer.machineId} was rejected.`;\n  }\n\n  await createNotification({\n    eventType: \"MachineTransfer\",\n    eventAction: \"Rejected\",\n    referenceId: transfer.id,\n    siteId: transfer.currentSiteId,\n    createdBy: rejectedBy,\n    roles: [ROLES.SITE_INCHARGE, ROLES.STORE_MANAGER, ROLES.PROJECT_MANAGER, ROLES.ADMIN, ROLES.MECHANICAL_HEAD, ROLES.MECHANICAL_MANAGER],\n    title,\n    description,\n  });\n\n  return transfer;\n};\nconst transferHistory = async (status, siteId) => {\n  const whereClause = {};\n\n  // Apply status filter if provided\n  if (status) {\n    whereClause.status = status;\n  }\n\n  if (siteId) {\n    whereClause[Op.or] = [\n      { currentSiteId: siteId },\n      { destinationSiteId: siteId },\n    ];\n    // }\n  }\n\n  // If no siteId (admin), show all (with optional status filter only)\n  const transfers = await db.MachineTransfer.findAll({\n    where: whereClause,\n    include: [\n      { model: db.Machinery, as: \"machine\", attributes: [\"machineName\"] },\n      { model: db.Site, as: \"currentSite\", attributes: [\"id\", \"name\"] },\n      { model: db.Site, as: \"destinationSite\", attributes: [\"id\", \"name\"] },\n    ],\n    order: [[\"createdAt\", \"DESC\"]],\n  });\n\n  return transfers;\n};\n\nconst transferHistoryV2 = async ({\n  status,\n  siteId,\n  searchQuery,\n  page = 1,\n  limit = 10,\n  sortBy = \"createdAt\",\n  sortOrder = \"DESC\",\n}) => {\n  const offset = (page - 1) * limit;\n  const whereClause = {};\n\n  // Filter by status if provided\n  if (status) {\n    whereClause.status = status;\n  }\n\n  // Filter by siteId (either current or destination)\n  if (siteId) {\n    whereClause[Op.or] = [\n      { currentSiteId: siteId },\n      { destinationSiteId: siteId },\n    ];\n  }\n\n  // Search clause\n  const searchFilter = searchQuery\n    ? {\n      [Op.or]: [\n        { reason: { [Op.like]: `%${searchQuery}%` } },\n        { approveRemarks: { [Op.like]: `%${searchQuery}%` } },\n        { dispatchRemarks: { [Op.like]: `%${searchQuery}%` } },\n        { rejectionRemarks: { [Op.like]: `%${searchQuery}%` } },\n        { finalRemarks: { [Op.like]: `%${searchQuery}%` } },\n        { \"$machine.machineName$\": { [Op.like]: `%${searchQuery}%` } },\n        { \"$currentSite.name$\": { [Op.like]: `%${searchQuery}%` } },\n        { \"$destinationSite.name$\": { [Op.like]: `%${searchQuery}%` } },\n      ],\n    }\n    : {};\n\n  const { count, rows } = await db.MachineTransfer.findAndCountAll({\n    where: {\n      ...whereClause,\n      ...searchFilter,\n    },\n    include: [\n      { model: db.Machinery, as: \"machine\", attributes: [\"id\", \"machineName\"] },\n      { model: db.Site, as: \"currentSite\", attributes: [\"id\", \"name\"] },\n      { model: db.Site, as: \"destinationSite\", attributes: [\"id\", \"name\"] },\n      { model: db.User, as: \"requester\", attributes: [\"id\", \"name\"] },\n      { model: db.User, as: \"approver\", attributes: [\"id\", \"name\"] },\n      { model: db.User, as: \"dispatcher\", attributes: [\"id\", \"name\"] },\n      { model: db.User, as: \"receiver\", attributes: [\"id\", \"name\"] },\n    ],\n    limit,\n    offset,\n    order: [[sortBy, sortOrder]],\n  });\n\n  return {\n    data: rows,\n    totalCount: count,\n    totalPages: Math.ceil(count / limit),\n    currentPage: Number(page),\n  };\n};\n\nconst transferHistoryOfMachine = async (machineId) => {\n  const history = await db.MachineTransfer.findAll({\n    where: { machineId },\n    order: [[\"createdAt\", \"DESC\"]],\n  });\n  return history;\n};\n\nconst dispachtedList = async (siteId) => {\n  const transfers = await db.MachineTransfer.findAll({\n    where: { status: \"Dispatched\", destinationSiteId: siteId },\n    include: [\n      { model: db.Machinery, as: \"machine\", attributes: [\"machineName\"] },\n      { model: db.Site, as: \"currentSite\", attributes: [\"id\", \"name\"] },\n      { model: db.Site, as: \"destinationSite\", attributes: [\"id\", \"name\"] },\n      { model: db.User, as: \"requester\", attributes: [\"id\", \"name\"] },\n      { model: db.User, as: \"approver\", attributes: [\"id\", \"name\"] },\n      { model: db.User, as: \"dispatcher\", attributes: [\"id\", \"name\"] },\n      { model: db.User, as: \"receiver\", attributes: [\"id\", \"name\"] },\n    ],\n  });\n  return transfers;\n};\n\nconst approvedList = async (siteId) => {\n  const transfers = await db.MachineTransfer.findAll({\n    where: { status: \"Approved\", currentSiteId: siteId },\n    include: [\n      { model: db.Machinery, as: \"machine\", attributes: [\"machineName\"] },\n      { model: db.Site, as: \"currentSite\", attributes: [\"id\", \"name\"] },\n      { model: db.Site, as: \"destinationSite\", attributes: [\"id\", \"name\"] },\n      { model: db.User, as: \"requester\", attributes: [\"id\", \"name\"] },\n      { model: db.User, as: \"approver\", attributes: [\"id\", \"name\"] },\n      { model: db.User, as: \"dispatcher\", attributes: [\"id\", \"name\"] },\n      { model: db.User, as: \"receiver\", attributes: [\"id\", \"name\"] },\n    ],\n  });\n  return transfers;\n};\n\nconst getTransferById = async (id) => {\n  const transfer = await db.MachineTransfer.findByPk(id, {\n    include: [\n      {\n        model: db.Machinery,\n        as: \"machine\",\n        attributes: [\n          \"machineName\",\n          \"registrationNumber\",\n          \"erpCode\",\n          \"machineNumber\",\n          \"machineCode\",\n          \"serialNumber\",\n          \"model\",\n          \"chassisNumber\",\n          \"engineNumber\",\n        ],\n      },\n      { model: db.Site, as: \"currentSite\", attributes: [\"id\", \"name\", \"code\"] },\n      {\n        model: db.Site,\n        as: \"destinationSite\",\n        attributes: [\"id\", \"name\", \"code\"],\n      },\n      { model: db.User, as: \"requester\", attributes: [\"id\", \"name\"] },\n      { model: db.User, as: \"approver\", attributes: [\"id\", \"name\"] },\n      { model: db.User, as: \"dispatcher\", attributes: [\"id\", \"name\"] },\n      { model: db.User, as: \"receiver\", attributes: [\"id\", \"name\"] },\n    ],\n  });\n  return transfer;\n};\n\nmodule.exports = {\n  requestTransfer,\n  approveTranfer,\n  dispatchMachine,\n  receiveMachine,\n  transferHistory,\n  transferHistoryOfMachine,\n  rejectTransfer,\n  dispachtedList,\n  approvedList,\n  getTransferById,\n};\n","const machineryService = require(\"./machinery.service\");\n\nasync function createMachinery(req, res) {\n  const machineryData = { ...req.body, ...req.fileData };\n  const machinery = await machineryService.createMachinery(machineryData);\n  res.sendResponse(machinery, \"Machinery created successfully\", 201);\n}\n\nasync function updateMachinery(req, res) {\n  const machineryData = { ...req.body, ...req.fileData };\n  const machinery = await machineryService.updateMachinery(\n    req.params.id,\n    machineryData\n  );\n  res.sendResponse(machinery, \"Machinery updated successfully\");\n}\nasync function getAllMachinery(req, res) {\n  const machineryList = await machineryService.getAllMachinery(\n    req.user.siteId ?? req.query.siteId,\n    req.query.searchQuery,\n    req.query.activity\n  );\n  res.sendResponse(machineryList, \"Machinery list retrieved successfully\");\n}\n\nasync function getMachineryById(req, res) {\n  const machinery = await machineryService.getMachineryById(req.params.id);\n  if (!machinery) {\n    const error = new Error();\n    error.message = \"Machinery not found\";\n    error.name = \"ResourceNotFoundError\";\n    error.statusCode = 404;\n    throw error;\n  }\n  res.sendResponse(machinery, \"Machinery retrieved successfully\");\n}\nasync function getMachineryLogEntries(req, res) {\n  const machinery = await machineryService.getMachineryLogEntries(req.params.id);\n  if (!machinery) {\n    const error = new Error();\n    error.message = \"Machinery not found\";\n    error.name = \"ResourceNotFoundError\";\n    error.statusCode = 404;\n    throw error;\n  }\n  res.sendResponse(machinery, \"Machinery retrieved successfully\");\n}\n\nasync function deleteMachinery(req, res) {\n  await machineryService.deleteMachinery(req.params.id);\n  res.sendResponse(null, \"Machinery deleted successfully\");\n}\n\nasync function restoreMachinery(req, res) {\n  const machinery = await machineryService.restoreMachinery(req.params.id);\n  res.sendResponse(machinery, \"Machinery restored successfully\");\n}\n\nmodule.exports = {\n  createMachinery,\n  getAllMachinery,\n  getMachineryById,\n  updateMachinery,\n  deleteMachinery,\n  restoreMachinery,\n  getMachineryLogEntries,\n};\n","const express = require(\"express\");\nconst machineryController = require(\"./machinery.controller\");\nconst validateRequest = require(\"../../middlewares/validateRequest\");\nconst asyncMiddleware = require(\"../../middlewares/asyncMiddleware\");\nconst {\n  createMachinerySchema,\n  updateMachinerySchema,\n} = require(\"./machinery.validator\");\nconst {\n  upload,\n  fileUploadMiddleware,\n} = require(\"../../middlewares/fileUploadMiddleware\");\nconst { getExistingFiles } = require(\"./machinery.service\");\nconst hasRole = require(\"../../middlewares/hasRole\");\n\nconst router = express.Router();\n\n// Define file fields to be uploaded\nconst fileFields = [\n  \"fitnessCertificateFile\",\n  \"pollutionCertificateFile\",\n  \"insuranceFile\",\n  \"permitFile\",\n  \"nationalPermitFile\",\n  \"motorVehicleTaxFile\",\n  \"machineImageFile\",\n];\n\n// Apply the middleware to handle file uploads before validation & controller\nrouter.post(\n  \"/\",\n  hasRole([1, 2, 3]),\n  upload.fields(fileFields.map((name) => ({ name, maxCount: 1 }))),\n  fileUploadMiddleware(fileFields, \"mani\", \"machinery\"),\n  validateRequest(createMachinerySchema),\n  asyncMiddleware(machineryController.createMachinery)\n);\n\nrouter.put(\n  \"/:id\",\n  hasRole([1, 2, 3]),\n  upload.fields(fileFields.map((name) => ({ name, maxCount: 1 }))),\n  fileUploadMiddleware(fileFields, \"mani\", \"machinery\", getExistingFiles),\n  validateRequest(updateMachinerySchema),\n  asyncMiddleware(machineryController.updateMachinery)\n);\n\nrouter.get(\"/\", asyncMiddleware(machineryController.getAllMachinery));\nrouter.get(\"/:id\", asyncMiddleware(machineryController.getMachineryById));\nrouter.get(\"/:id/log-entries\", asyncMiddleware(machineryController.getMachineryLogEntries));\nrouter.delete(\"/:id\", hasRole([1, 2, 3]), asyncMiddleware(machineryController.deleteMachinery));\nmodule.exports = router;\n","const { fn, col } = require(\"sequelize\");\nconst db = require(\"../../models\");\n\nconst REQUIRED_FIELDS_BY_TYPE = {\n  Vehicle: [\"erpCode\", \"registrationNumber\", \"machineNumber\", \"model\", \"make\"],\n  Machine: [\"erpCode\", \"machineNumber\", \"capacity\", \"make\", \"yom\"],\n  Drilling: [\"erpCode\", \"serialNumber\", \"model\", \"make\", \"unitPerHour\"],\n};\n\nclass CustomError extends Error {\n  constructor(message, statusCode) {\n    super(message);\n    this.statusCode = statusCode;\n  }\n}\n\nmodule.exports = {\n  async createMachinery(machineryData) {\n    const transaction = await db.sequelize.transaction();\n    try {\n      const machinery = await db.Machinery.create(machineryData, {\n        transaction,\n      });\n      await transaction.commit();\n      return machinery;\n    } catch (error) {\n      await transaction.rollback();\n      throw new CustomError(\n        error.original.sqlMessage || \"Failed to create machinery\",\n        500\n      );\n    }\n  },\n\n  async getAllMachinery(siteId, searchQuery) {\n    // Prepare WHERE conditions\n    const where = {};\n    if (siteId) where.siteId = siteId;\n\n    if (searchQuery) {\n      const likeQuery = { [db.Sequelize.Op.like]: `%${searchQuery}%` };\n      where[db.Sequelize.Op.or] = [\n        { machineName: likeQuery },\n        { erpCode: likeQuery },\n        { machineCode: likeQuery },\n        { serialNumber: likeQuery },\n        { registrationNumber: likeQuery },\n      ];\n    }\n\n    // Prepare INCLUDE option once\n    const include = [\n      {\n        model: db.PrimaryCategory,\n        as: \"primaryCategory\",\n        attributes: [\"name\", \"id\"],\n      },\n      {\n        model: db.MachineCategory,\n        as: \"machineCategory\",\n        attributes: [\"name\", \"id\"],\n      },\n      {\n        model: db.Site,\n        as: \"site\",\n        attributes: [\"name\", \"id\", \"code\", \"address\"],\n      },\n    ];\n\n    const attributes = [\n      \"id\",\n      \"erpCode\",\n      \"machineName\",\n      \"status\",\n      \"siteId\",\n      \"machineCode\",\n      \"machineNumber\",\n      \"registrationNumber\",\n      \"chassisNumber\",\n      \"engineNumber\",\n      \"serialNumber\",\n      \"model\",\n      // \"make\",\n      // \"yom\",\n      // \"fitnessCertificateExpiry\",\n      // \"motorVehicleTaxDue\",\n      // \"permitExpiryDate\",\n      // \"nationalPermitExpiry\",\n      // \"insuranceExpiry\",\n      // \"pollutionCertificateExpiry\",\n      \"isActive\",\n    ];\n\n    // Fire single query\n    return await db.Machinery.findAll({ where, include, attributes });\n  },\n\n  async getAllMachineryV2(siteId, searchQuery, page = 1, limit = 10) {\n    const { Op } = db.Sequelize;\n    const offset = (page - 1) * limit;\n\n    const whereClause = {\n      ...(searchQuery && {\n        [Op.or]: [\n          { machineName: { [Op.like]: `%${searchQuery}%` } },\n          { erpCode: { [Op.like]: `%${searchQuery}%` } },\n          { machineCode: { [Op.like]: `%${searchQuery}%` } },\n          { serialNumber: { [Op.like]: `%${searchQuery}%` } },\n          { registrationNumber: { [Op.like]: `%${searchQuery}%` } },\n        ],\n      }),\n      ...(siteId && { siteId }),\n    };\n\n    const { count, rows } = await db.Machinery.findAndCountAll({\n      where: whereClause,\n      include: [\n        {\n          model: db.PrimaryCategory,\n          as: \"primaryCategory\",\n          attributes: [\"id\", \"name\"],\n        },\n        {\n          model: db.MachineCategory,\n          as: \"machineCategory\",\n          attributes: [\"id\", \"name\"],\n        },\n        {\n          model: db.Site,\n          as: \"site\",\n          attributes: [\"id\", \"name\", \"code\", \"address\"],\n        },\n      ],\n      limit,\n      offset,\n      order: [[\"createdAt\", \"DESC\"]],\n    });\n\n    return {\n      data: rows,\n      totalCount: count,\n      totalPages: Math.ceil(count / limit),\n      currentPage: Number(page),\n    };\n  },\n\n  async getMachineryById(machineryId) {\n    const machine = await db.Machinery.findByPk(machineryId, {\n      include: [\n        { model: db.PrimaryCategory, as: \"primaryCategory\" },\n        { model: db.MachineCategory, as: \"machineCategory\" },\n        { model: db.Site, as: \"site\" },\n      ],\n    });\n    if (!machine) {\n      const error = new Error();\n      error.message = \"Machinery not found\";\n      error.name = \"ResourceNotFoundError\";\n      error.statusCode = 404;\n      throw error;\n    }\n    const sums = await db.LogbookEntry.findOne({\n      attributes: [\n        [fn(\"COALESCE\", fn(\"SUM\", col(\"dieselIssue\")), 0), \"sumDieselIssue\"],\n        [fn(\"COALESCE\", fn(\"SUM\", col(\"totalRunKM\")), 0), \"sumTotalRunKM\"],\n        [\n          fn(\"COALESCE\", fn(\"SUM\", col(\"totalRunHrsMeter\")), 0),\n          \"sumTotalRunHrsMeter\",\n        ],\n      ],\n      where: {\n        machineId: machineryId, // assuming your LogbookEntry has a machineryId foreign key\n      },\n      raw: true, // returns plain object instead of Sequelize instance\n    });\n\n    return { ...machine?.dataValues, ...sums };\n  },\n  async getMachineryLogEntries(machineryId) {\n    const machineLogs = await db.LogbookEntry.findAll({\n      where: {\n        machineId: machineryId, // assuming your LogbookEntry has a machineryId foreign key\n      },\n      order: [[\"createdAt\", \"DESC\"]],\n    });\n    return machineLogs;\n  },\n\n  async updateMachinery(machineryId, machineryUpdates) {\n    const machinery = await db.Machinery.findByPk(machineryId);\n    if (!machinery) return null;\n    return await machinery.update(machineryUpdates);\n  },\n\n  async deleteMachinery(machineryId) {\n    const machinery = await db.Machinery.findByPk(machineryId);\n    if (!machinery) return null;\n    await machinery.destroy();\n    return true;\n  },\n  async getExistingFiles(machineId) {\n    const machine = await db.Machinery.findByPk(machineId, {\n      attributes: [\n        \"fitnessCertificateFile\",\n        \"pollutionCertificateFile\",\n        \"insuranceFile\",\n        \"permitFile\",\n        \"nationalPermitFile\",\n      ],\n    });\n    return machine ? machine.toJSON() : {};\n  },\n};\n","const Joi = require(\"joi\");\n\nconst createMachinerySchema = Joi.object({\n  primaryCategoryId: Joi.number().integer().positive().required(), // Foreign Key for PrimaryCategory\n  machineCategoryId: Joi.number().integer().positive().required(), // Foreign Key for MachineCategory\n  erpCode: Joi.string().trim().allow(null).optional(),\n  registrationNumber: Joi.string().trim().allow(null).optional(),\n  machineNumber: Joi.string().trim().allow(null).optional(),\n  machineCode: Joi.string().trim().allow(null).optional(),\n  chassisNumber: Joi.string().trim().allow(null).optional(),\n  engineNumber: Joi.string().trim().allow(null).optional(),\n  serialNumber: Joi.string().trim().allow(null).optional(),\n  model: Joi.string().trim().allow(null).optional(),\n  make: Joi.string().trim().allow(null).optional(),\n  yom: Joi.number()\n    .integer()\n    .min(1900)\n    .max(new Date().getFullYear())\n    .allow(null).optional(),\n  purchaseDate: Joi.date().iso().allow(null).optional(),\n  capacity: Joi.string().trim().allow(null).optional(),\n  ownerName: Joi.string().trim().allow(null).optional(),\n  ownerType: Joi.string().valid(\"Company\", \"Individual\").allow(null).optional(),\n  siteId: Joi.number().integer().positive().allow(null).optional(),\n  isActive: Joi.boolean().default(true),\n  machineName: Joi.string().trim().allow(null).optional(),\n  fitnessCertificateExpiry: Joi.date().iso().allow(null).optional(),\n  motorVehicleTaxDue: Joi.date().iso().allow(null).optional(),\n  permitExpiryDate: Joi.date().iso().allow(null).optional(),\n  nationalPermitExpiry: Joi.date().iso().allow(null).optional(),\n  insuranceExpiry: Joi.date().iso().allow(null).optional(),\n  pollutionCertificateExpiry: Joi.date().iso().allow(null).optional(),\n  status: Joi.string()\n    .valid(\"Idle\", \"In Use\", \"In Transfer\", \"Sold\", \"Scrap\")\n    .default(\"Idle\"),\n\n  //  Allow file fields (Joi.any())\n  fitnessCertificateFile: Joi.any(),\n  pollutionCertificateFile: Joi.any(),\n  insuranceFile: Joi.any(),\n  permitFile: Joi.any(),\n  nationalPermitFile: Joi.any(),\n  motorVehicleTaxFile: Joi.any(),\n  machineImageFile: Joi.any(),\n});\n\nconst updateMachinerySchema = Joi.object({\n  primaryCategoryId: Joi.number().integer().positive(), // Foreign Key for PrimaryCategory\n  machineCategoryId: Joi.number().integer().positive(), // Foreign Key for MachineCategory\n  erpCode: Joi.string().trim(),\n  registrationNumber: Joi.string().trim(),\n  machineNumber: Joi.string().trim(),\n  machineCode: Joi.string().trim(),\n  chassisNumber: Joi.string().trim(),\n  engineNumber: Joi.string().trim(),\n  serialNumber: Joi.string().trim(),\n  model: Joi.string().trim(),\n  make: Joi.string().trim(),\n  yom: Joi.number().integer().min(1900).max(new Date().getFullYear()),\n  purchaseDate: Joi.date().iso(),\n  capacity: Joi.string().trim(),\n  ownerName: Joi.string().trim(),\n  ownerType: Joi.string().valid(\"Company\", \"Individual\"),\n  siteId: Joi.number().integer().positive(),\n  isActive: Joi.boolean(),\n  machineName: Joi.string().trim(),\n  fitnessCertificateExpiry: Joi.date().iso(),\n  motorVehicleTaxDue: Joi.date().iso(),\n  permitExpiryDate: Joi.date().iso(),\n  nationalPermitExpiry: Joi.date().iso(),\n  insuranceExpiry: Joi.date().iso(),\n  pollutionCertificateExpiry: Joi.date().iso(),\n  status: Joi.string().valid(\"Idle\", \"In Use\", \"In Transfer\", \"Sold\", \"Scrap\"),\n});\n\nmodule.exports = {\n  createMachinerySchema,\n  updateMachinerySchema,\n};\n","const machineryItemCodeService = require(\"./machineryItemCode.service\");\n\nasync function createMachineryItemCode(req, res) {\n  const itemCode = await machineryItemCodeService.createMachineryItemCode(req.body);\n  res.sendResponse(itemCode, \"Machinery Item Code created successfully\", 201);\n}\n\nasync function getAllMachineryItemCodes(req, res) {\n  const itemCodes = await machineryItemCodeService.getAllMachineryItemCodes();\n  res.sendResponse(itemCodes, \"Machinery Item Codes retrieved successfully\");\n}\n\nasync function getMachineryItemCodeById(req, res) {\n  const itemCode = await machineryItemCodeService.getMachineryItemCodeById(req.params.id);\n  if (!itemCode) {\n    const error = new Error();\n    error.message = \"Machinery Item Code not found\";\n    error.name = \"ResourceNotFoundError\";\n    error.statusCode = 404;\n    throw error;\n  }\n  res.sendResponse(itemCode, \"Machinery Item Code retrieved successfully\");\n}\n\nasync function updateMachineryItemCode(req, res) {\n  const itemCode = await machineryItemCodeService.updateMachineryItemCode(req.params.id, req.body);\n  res.sendResponse(itemCode, \"Machinery Item Code updated successfully\");\n}\n\nasync function deleteMachineryItemCode(req, res) {\n  await machineryItemCodeService.deleteMachineryItemCode(req.params.id);\n  res.sendResponse(null, \"Machinery Item Code deleted successfully\");\n}\n\nasync function restoreMachineryItemCode(req, res) {\n  const itemCode = await machineryItemCodeService.restoreMachineryItemCode(req.params.id);\n  res.sendResponse(itemCode, \"Machinery Item Code restored successfully\");\n}\n\nmodule.exports = {\n  createMachineryItemCode,\n  getAllMachineryItemCodes,\n  getMachineryItemCodeById,\n  updateMachineryItemCode,\n  deleteMachineryItemCode,\n  restoreMachineryItemCode,\n};\n","const express = require(\"express\");\nconst machineryItemCodeController = require(\"./machineryItemCode.controller\");\nconst validateRequest = require(\"../../middlewares/validateRequest\");\nconst schemas = require(\"./machineryItemCode.validator\");\nconst asyncMiddleware = require(\"../../middlewares/asyncMiddleware\");\n\nconst router = express.Router();\n\nrouter.post(\n  \"/\",\n  validateRequest(schemas.createMachineryItemCodeSchema),\n  asyncMiddleware(machineryItemCodeController.createMachineryItemCode)\n);\nrouter.get(\n  \"/\",\n  asyncMiddleware(machineryItemCodeController.getAllMachineryItemCodes)\n);\nrouter.get(\n  \"/:id\",\n  asyncMiddleware(machineryItemCodeController.getMachineryItemCodeById)\n);\nrouter.put(\n  \"/:id\",\n  validateRequest(schemas.updateMachineryItemCodeSchema),\n  asyncMiddleware(machineryItemCodeController.updateMachineryItemCode)\n);\nrouter.delete(\n  \"/:id\",\n  asyncMiddleware(machineryItemCodeController.deleteMachineryItemCode)\n);\nrouter.post(\n  \"/:id/restore\",\n  asyncMiddleware(machineryItemCodeController.restoreMachineryItemCode)\n);\n\nmodule.exports = router;\n","const db = require(\"../../models\");\n\nasync function createMachineryItemCode(data) {\n  return await db.MachineryItemCode.create(data);\n}\n\nasync function getAllMachineryItemCodes() {\n  return await db.MachineryItemCode.findAll();\n}\n\nasync function getMachineryItemCodeById(id) {\n  return await db.MachineryItemCode.findByPk(id);\n}\n\nasync function updateMachineryItemCode(id, data) {\n  const itemCode = await getMachineryItemCodeById(id);\n  if (!itemCode) throw new Error(\"Machinery Item Code not found\");\n  return await itemCode.update(data);\n}\n\nasync function deleteMachineryItemCode(id) {\n  return await db.MachineryItemCode.destroy({ where: { id } });\n}\n\nasync function restoreMachineryItemCode(id) {\n  return await db.MachineryItemCode.restore({ where: { id } });\n}\n\nmodule.exports = {\n  createMachineryItemCode,\n  getAllMachineryItemCodes,\n  getMachineryItemCodeById,\n  updateMachineryItemCode,\n  deleteMachineryItemCode,\n  restoreMachineryItemCode,\n};\n","const Joi = require(\"joi\");\n\nconst createMachineryItemCodeSchema = Joi.object({\n  code: Joi.string().min(1).max(50).required().messages({\n    \"string.base\": \"Code must be a string\",\n    \"string.empty\": \"Code is required\",\n    \"string.min\": \"Code must be at least 1 character\",\n    \"string.max\": \"Code must not exceed 50 characters\",\n    \"any.required\": \"Code is required\",\n  }),\n  name: Joi.string().min(1).max(100).required().messages({\n    \"string.base\": \"Name must be a string\",\n    \"string.empty\": \"Name is required\",\n    \"string.min\": \"Name must be at least 1 character\",\n    \"string.max\": \"Name must not exceed 100 characters\",\n    \"any.required\": \"Name is required\",\n  }),\n  remarks: Joi.string().optional().allow(\"\").messages({\n    \"string.base\": \"Remarks must be a string\",\n  }),\n});\n\nconst updateMachineryItemCodeSchema = Joi.object({\n  code: Joi.string().min(1).max(50).optional(),\n  name: Joi.string().min(1).max(100).optional(),\n  remarks: Joi.string().optional().allow(\"\"),\n});\n\nmodule.exports = {\n  createMachineryItemCodeSchema,\n  updateMachineryItemCodeSchema,\n};\n","const machineServiceIntervalService = require('./machineServiceInterval.service');\n\nconst getMachineServiceIntervals = async (req, res) => {\n  try {\n    const { machineId } = req.params;\n    const intervals = await machineServiceIntervalService.getMachineServiceIntervals(machineId);\n    res.sendResponse(intervals, \"Machine service intervals retrieved successfully\");\n  } catch (error) {\n    res.sendError(error.message, 500);\n  }\n};\n\nconst getMachineServiceIntervalById = async (req, res) => {\n  try {\n    const { id } = req.params;\n    const interval = await machineServiceIntervalService.getMachineServiceIntervalById(id);\n    if (!interval) {\n      return res.sendError(\"Machine service interval not found\", 404);\n    }\n    res.sendResponse(interval, \"Machine service interval retrieved successfully\");\n  } catch (error) {\n    res.sendError(error.message, 500);\n  }\n};\n\nconst createMachineServiceInterval = async (req, res) => {\n  try {\n    const interval = await machineServiceIntervalService.createMachineServiceInterval(req.body);\n    res.sendResponse(interval, \"Machine service interval created successfully\");\n  } catch (error) {\n    res.sendError(error.message, 500);\n  }\n};\n\nconst updateMachineServiceInterval = async (req, res) => {\n  try {\n    const { id } = req.params;\n    const interval = await machineServiceIntervalService.updateMachineServiceInterval(id, req.body);\n    res.sendResponse(interval, \"Machine service interval updated successfully\");\n  } catch (error) {\n    res.sendError(error.message, 500);\n  }\n};\n\nconst deleteMachineServiceInterval = async (req, res) => {\n  try {\n    const { id } = req.params;\n    await machineServiceIntervalService.deleteMachineServiceInterval(id);\n    res.sendResponse(null, \"Machine service interval deleted successfully\");\n  } catch (error) {\n    res.sendError(error.message, 500);\n  }\n};\n\nconst getDueMachineServiceIntervals = async (req, res) => {\n  try {\n    const intervals = await machineServiceIntervalService.getDueMachineServiceIntervals();\n    res.sendResponse(intervals, \"Due machine service intervals retrieved successfully\");\n  } catch (error) {\n    res.sendError(error.message, 500);\n  }\n};\n\nconst calculateNextServiceForMachine = async (req, res) => {\n  try {\n    const { machineId } = req.params;\n    const intervals = await machineServiceIntervalService.calculateNextServiceForMachine(machineId);\n    res.sendResponse(intervals, \"Next service calculations retrieved successfully\");\n  } catch (error) {\n    res.sendError(error.message, 500);\n  }\n};\n\nmodule.exports = {\n  getMachineServiceIntervals,\n  getMachineServiceIntervalById,\n  createMachineServiceInterval,\n  updateMachineServiceInterval,\n  deleteMachineServiceInterval,\n  getDueMachineServiceIntervals,\n  calculateNextServiceForMachine\n};\n","const express = require(\"express\");\nconst router = express.Router();\nconst machineServiceIntervalController = require(\"./machineServiceInterval.controller\");\nconst validateRequest = require(\"../../middlewares/validateRequest\");\nconst asyncMiddleware = require(\"../../middlewares/asyncMiddleware\");\nconst {\n  createMachineServiceIntervalSchema,\n  updateMachineServiceIntervalSchema,\n} = require(\"./machineServiceInterval.validator\");\n\n// Routes for machine service intervals\nrouter.get(\n  \"/machine/:machineId\",\n  asyncMiddleware(machineServiceIntervalController.getMachineServiceIntervals)\n);\nrouter.get(\n  \"/due\",\n  asyncMiddleware(\n    machineServiceIntervalController.getDueMachineServiceIntervals\n  )\n);\nrouter.get(\n  \"/next/:machineId\",\n  asyncMiddleware(\n    machineServiceIntervalController.calculateNextServiceForMachine\n  )\n);\nrouter.get(\n  \"/:id\",\n  asyncMiddleware(\n    machineServiceIntervalController.getMachineServiceIntervalById\n  )\n);\nrouter.post(\n  \"/\",\n  validateRequest(createMachineServiceIntervalSchema),\n  asyncMiddleware(machineServiceIntervalController.createMachineServiceInterval)\n);\nrouter.put(\n  \"/:id\",\n  validateRequest(updateMachineServiceIntervalSchema),\n  asyncMiddleware(machineServiceIntervalController.updateMachineServiceInterval)\n);\nrouter.delete(\n  \"/:id\",\n  asyncMiddleware(machineServiceIntervalController.deleteMachineServiceInterval)\n);\n\nmodule.exports = router;\n","const { Op } = require('sequelize');\nconst db = require('../../models');\n\nconst getMachineServiceIntervals = async (machineId) => {\n  return await db.MachineServiceInterval.findAll({\n    where: { \n      machineId,\n      isActive: true\n    },\n    order: [['serviceType', 'ASC']]\n  });\n};\n\nconst getMachineServiceIntervalById = async (id) => {\n  return await db.MachineServiceInterval.findByPk(id);\n};\n\nconst createMachineServiceInterval = async (data) => {\n  // Calculate next service value based on last service value + interval\n  if (data.lastServiceValue && data.intervalValue) {\n    data.nextServiceValue = data.lastServiceValue + data.intervalValue;\n  }\n\n  return await db.MachineServiceInterval.create(data);\n};\n\nconst updateMachineServiceInterval = async (id, data) => {\n  const interval = await db.MachineServiceInterval.findByPk(id);\n  if (!interval) throw new Error('Machine service interval not found');\n\n  // Calculate next service value based on last service value + interval\n  if (data.lastServiceValue && data.intervalValue) {\n    data.nextServiceValue = data.lastServiceValue + data.intervalValue;\n  } else if (data.intervalValue && interval.lastServiceValue) {\n    data.nextServiceValue = interval.lastServiceValue + data.intervalValue;\n  }\n\n  return await interval.update(data);\n};\n\nconst deleteMachineServiceInterval = async (id) => {\n  const interval = await db.MachineServiceInterval.findByPk(id);\n  if (!interval) throw new Error('Machine service interval not found');\n\n  return await interval.destroy();\n};\n\nconst getDueMachineServiceIntervals = async () => {\n  const now = new Date();\n  const dueIntervals = await db.MachineServiceInterval.findAll({\n    where: {\n      isActive: true,\n      [Op.or]: [\n        // Due based on hours\n        {\n          intervalType: 'hours',\n          nextServiceValue: {\n            [Op.lte]: db.sequelize.literal('(SELECT COALESCE(MAX(closingHrsMeter), 0) FROM logbook_entries WHERE machineId = MachineServiceInterval.machineId)')\n          }\n        },\n        // Due based on kilometers\n        {\n          intervalType: 'kilometers',\n          nextServiceValue: {\n            [Op.lte]: db.sequelize.literal('(SELECT COALESCE(MAX(closingKmReading), 0) FROM logbook_entries WHERE machineId = MachineServiceInterval.machineId)')\n          }\n        },\n        // Due based on calendar date\n        {\n          intervalType: 'calendar',\n          nextServiceDate: {\n            [Op.lte]: now\n          }\n        }\n      ]\n    },\n    include: [{ model: db.Machinery, as: 'machine' }]\n  });\n\n  return dueIntervals;\n};\n\nconst calculateNextServiceForMachine = async (machineId) => {\n  // Get all service intervals for the machine\n  const intervals = await db.MachineServiceInterval.findAll({\n    where: { machineId, isActive: true }\n  });\n\n  // For each interval, calculate if it's due based on current readings\n  const results = [];\n  for (const interval of intervals) {\n    let isDue = false;\n    let currentValue = null;\n    let remaining = null;\n\n    if (interval.intervalType === 'hours' || interval.intervalType === 'kilometers') {\n      // Get the latest logbook entry for the machine to get current reading\n      const latestLogbook = await db.LogbookEntry.findOne({\n        where: { machineId },\n        order: [['date', 'DESC']]\n      });\n\n      if (latestLogbook) {\n        currentValue = interval.intervalType === 'hours' ? latestLogbook.closingHrsMeter : latestLogbook.closingKmReading;\n        \n        if (currentValue && interval.nextServiceValue) {\n          remaining = interval.nextServiceValue - currentValue;\n          isDue = currentValue >= interval.nextServiceValue;\n        }\n      }\n    } else if (interval.intervalType === 'calendar') {\n      // For calendar-based intervals\n      if (interval.nextServiceDate) {\n        currentValue = new Date();\n        remaining = (new Date(interval.nextServiceDate) - new Date()) / (1000 * 60 * 60 * 24); // days remaining\n        isDue = new Date() >= new Date(interval.nextServiceDate);\n      }\n    }\n\n    results.push({\n      ...interval.toJSON(),\n      isDue,\n      currentValue,\n      remaining\n    });\n  }\n\n  return results;\n};\n\nmodule.exports = {\n  getMachineServiceIntervals,\n  getMachineServiceIntervalById,\n  createMachineServiceInterval,\n  updateMachineServiceInterval,\n  deleteMachineServiceInterval,\n  getDueMachineServiceIntervals,\n  calculateNextServiceForMachine\n};\n","const Joi = require(\"joi\");\n\nconst createMachineServiceIntervalSchema = Joi.object({\n  machineId: Joi.number().integer().required(),\n  serviceType: Joi.string().required(),\n  intervalHours: Joi.number().integer().optional(),\n  intervalKm: Joi.number().integer().optional(),\n  intervalCalendarDays: Joi.number().integer().optional(),\n  isActive: Joi.boolean().optional(),\n  notes: Joi.string().optional().allow(null, \"\"),\n});\n\nconst updateMachineServiceIntervalSchema = Joi.object({\n  machineId: Joi.number().integer().optional(),\n  serviceType: Joi.string().optional(),\n  intervalHours: Joi.number().integer().optional(),\n  intervalKm: Joi.number().integer().optional(),\n  intervalCalendarDays: Joi.number().integer().optional(),\n  isActive: Joi.boolean().optional(),\n  notes: Joi.string().optional().allow(null, \"\"),\n}).min(1); // At least one field must be provided for update\n\nmodule.exports = {\n  createMachineServiceIntervalSchema,\n  updateMachineServiceIntervalSchema,\n};\n","// controllers/maintanance.controller.js\nconst maintananceService = require('./maintanance.service');\n\n// Maintenance Logs\nconst getMaintenanceLogById = async (req, res) => {\n  const log = await maintananceService.getMaintenanceLogById(req.params.id);\n  res.sendResponse(log, \"Maintenance log fetched successfully\");\n};\n\nconst createMaintenanceLog = async (req, res) => {\n  const log = await maintananceService.createMaintenanceLog(req.body);\n  res.sendResponse(log, \"Maintenance log created successfully\");\n};\n\nconst updateMaintenanceLog = async (req, res) => {\n  const log = await maintananceService.updateMaintenanceLog(req.params.id, req.body);\n  res.sendResponse(log, \"Maintenance log updated successfully\");\n};\n\nconst getMaintenanceLogsByMachine = async (req, res) => {\n  const logs = await maintananceService.getMaintenanceLogsByMachine(req.params.machineId);\n  res.sendResponse(logs, \"Maintenance logs fetched successfully\");\n};\n\n// Scheduled Maintenance\nconst getScheduledMaintenanceById = async (req, res) => {\n  const scheduled = await maintananceService.getScheduledMaintenanceById(req.params.id);\n  res.sendResponse(scheduled, \"Scheduled maintenance fetched successfully\");\n};\n\nconst createScheduledMaintenance = async (req, res) => {\n  const scheduled = await maintananceService.createScheduledMaintenance(req.body);\n  res.sendResponse(scheduled, \"Scheduled maintenance created successfully\");\n};\n\nconst updateScheduledMaintenance = async (req, res) => {\n  const scheduled = await maintananceService.updateScheduledMaintenance(req.params.id, req.body);\n  res.sendResponse(scheduled, \"Scheduled maintenance updated successfully\");\n};\n\nconst completeScheduledMaintenance = async (req, res) => {\n  const scheduled = await maintananceService.updateScheduledMaintenance(req.params.id, { status: 'completed' });\n  res.sendResponse(scheduled, \"Scheduled maintenance marked as completed successfully\");\n};\n\nconst getScheduledMaintenancesByMachine = async (req, res) => {\n  const schedules = await maintananceService.getScheduledMaintenancesByMachine(req.params.machineId);\n  res.sendResponse(schedules, \"Scheduled maintenance list fetched successfully\");\n};\n\nconst getMaintenanceStatsByMachine = async (req, res) => {\n    const stats = await maintananceService.getMaintenanceStatsByMachine(req.params.machineId);\n    res.sendResponse(stats, \"Maintenance stats fetched successfully\");\n};\n\n// New controller functions for maintenance summary and alerts\nconst getLastMaintenanceByMachine = async (req, res) => {\n  const lastMaintenance = await maintananceService.getLastMaintenanceByMachine(req.params.machineId);\n  res.sendResponse(lastMaintenance, \"Last maintenance fetched successfully\");\n};\n\nconst getNextMaintenanceByMachine = async (req, res) => {\n  const nextMaintenance = await maintananceService.getNextMaintenanceByMachine(req.params.machineId);\n  res.sendResponse(nextMaintenance, \"Next maintenance fetched successfully\");\n};\n\nconst getMaintenanceAlerts = async (req, res) => {\n  const alerts = await maintananceService.getMaintenanceAlerts(req.params.machineId);\n  res.sendResponse(alerts, \"Maintenance alerts fetched successfully\");\n};\n\nconst getMaintenanceSummaryByMachine = async (req, res) => {\n  const summary = await maintananceService.getMaintenanceSummaryByMachine(req.params.machineId);\n  res.sendResponse(summary, \"Maintenance summary fetched successfully\");\n};\n\nmodule.exports = {\n  getMaintenanceLogById,\n  createMaintenanceLog,\n  updateMaintenanceLog,\n  getMaintenanceLogsByMachine,\n  getScheduledMaintenanceById,\n  createScheduledMaintenance,\n  updateScheduledMaintenance,\n completeScheduledMaintenance,\n  getScheduledMaintenancesByMachine,\n  getMaintenanceStatsByMachine,\n  getLastMaintenanceByMachine,\n  getNextMaintenanceByMachine,\n  getMaintenanceAlerts,\n  getMaintenanceSummaryByMachine\n};\n","// routes/maintanance.routes.js\nconst express = require('express');\nconst router = express.Router();\nconst maintananceController = require('./maintanance.controller');\nconst validateRequest = require('./../../middlewares/validateRequest');\nconst {\n  createMaintenanceLogSchema,\n  updateMaintenanceLogSchema,\n  createScheduledMaintenanceSchema,\n  updateScheduledMaintenanceSchema,\n} = require('./maintanance.validator');\nconst asyncMiddleware = require('./../../middlewares/asyncMiddleware');\n\n// Maintenance Logs\nrouter.get('/logs/:id', asyncMiddleware(maintananceController.getMaintenanceLogById));\nrouter.post('/logs', validateRequest(createMaintenanceLogSchema), asyncMiddleware(maintananceController.createMaintenanceLog));\nrouter.put('/logs/:id', validateRequest(updateMaintenanceLogSchema), asyncMiddleware(maintananceController.updateMaintenanceLog));\nrouter.get('/logs/machine/:machineId', asyncMiddleware(maintananceController.getMaintenanceLogsByMachine));\n\n// Scheduled Maintenance\nrouter.get('/scheduled/:id', asyncMiddleware(maintananceController.getScheduledMaintenanceById));\nrouter.post('/scheduled', validateRequest(createScheduledMaintenanceSchema), asyncMiddleware(maintananceController.createScheduledMaintenance));\nrouter.put('/scheduled/:id', validateRequest(updateScheduledMaintenanceSchema), asyncMiddleware(maintananceController.updateScheduledMaintenance));\nrouter.put('/scheduled/:id/complete', asyncMiddleware(maintananceController.completeScheduledMaintenance));\nrouter.get('/scheduled/machine/:machineId', asyncMiddleware(maintananceController.getScheduledMaintenancesByMachine));\n\n// Maintenance Stats\nrouter.get('/stats/:machineId', asyncMiddleware(maintananceController.getMaintenanceStatsByMachine));\n\n// New routes for maintenance summary and alerts\nrouter.get('/last-maintenance/:machineId', asyncMiddleware(maintananceController.getLastMaintenanceByMachine));\nrouter.get('/next-maintenance/:machineId', asyncMiddleware(maintananceController.getNextMaintenanceByMachine));\nrouter.get('/alerts/:machineId', asyncMiddleware(maintananceController.getMaintenanceAlerts));\nrouter.get('/summary/:machineId', asyncMiddleware(maintananceController.getMaintenanceSummaryByMachine));\n\n// Machine Service Interval routes\nconst machineServiceIntervalRoutes = require('./machineServiceInterval.routes');\nrouter.use('/intervals', machineServiceIntervalRoutes);\n\n\nmodule.exports = router;\n","// services/maintanance.service.js\nconst { Op } = require('sequelize');\nconst db = require('./../../models'); // assuming you have index.js exporting all models\nconst { MaintenanceLog } = db;\n\n// Maintenance Logs\nconst getMaintenanceLogById = async (id) => {\n    return await MaintenanceLog.findByPk(id);\n};\n\nconst createMaintenanceLog = async (data) => {\n    return await MaintenanceLog.create(data);\n};\n\nconst updateMaintenanceLog = async (id, data) => {\n    const log = await MaintenanceLog.findByPk(id);\n    if (!log) throw new Error('Maintenance log not found');\n    return await log.update(data);\n};\n\nconst getMaintenanceLogsByMachine = async (machineId) => {\n    return await MaintenanceLog.findAll({ \n        where: { machineId }, \n        order: [['date', 'DESC']] \n    });\n};\n\n// Scheduled Maintenance functions - now using MaintenanceLog model\nconst getScheduledMaintenanceById = async (id) => {\n    return await MaintenanceLog.findByPk(id);\n};\n\nconst createScheduledMaintenance = async (data) => {\n    // Set default status to 'scheduled' for scheduled maintenance\n    data.status = 'scheduled';\n    return await MaintenanceLog.create(data);\n};\n\nconst updateScheduledMaintenance = async (id, data) => {\n    const scheduled = await MaintenanceLog.findByPk(id);\n    if (!scheduled) throw new Error('Maintenance log not found');\n    \n    // If status is being updated to completed, update the status\n    if (data.status === 'completed') {\n        data.status = 'completed';\n        data.lastAlertDate = new Date(); // Mark when it was completed\n    }\n    \n    return await scheduled.update(data);\n};\n\nconst getScheduledMaintenancesByMachine = async (machineId) => {\n    return await MaintenanceLog.findAll({ \n        where: { \n            machineId,\n            status: { [Op.in]: ['scheduled', 'overdue', 'due_today'] }\n        }, \n        order: [['dueDate', 'ASC']] \n    });\n};\n\n// New functions for maintenance summary and alerts\nconst getLastMaintenanceByMachine = async (machineId) => {\n    return await MaintenanceLog.findOne({\n        where: { machineId },\n        order: [['date', 'DESC']],\n        include: [{ model: db.Machinery, as: 'machine' }]\n    });\n};\n\nconst getNextMaintenanceByMachine = async (machineId) => {\n    const now = new Date();\n    return await MaintenanceLog.findOne({\n        where: {\n            machineId,\n            status: { [Op.in]: ['scheduled', 'overdue', 'due_today'] },\n            dueDate: { [Op.gte]: now }\n        },\n        order: [['dueDate', 'ASC']],\n        include: [{ model: db.Machinery, as: 'machine' }]\n    });\n};\n\nconst getMaintenanceAlerts = async (machineId) => {\n    const now = new Date();\n    const tomorrow = new Date();\n    tomorrow.setDate(now.getDate() + 1);\n    const weekLater = new Date();\n    weekLater.setDate(now.getDate() + 7);\n    \n    const alerts = await MaintenanceLog.findAll({\n        where: {\n            machineId,\n            status: { [Op.in]: ['scheduled', 'overdue', 'due_today'] },\n            dueDate: { [Op.gte]: now },\n            dueDate: { [Op.lte]: weekLater }\n        },\n        order: [['dueDate', 'ASC']],\n        include: [{ model: db.Machinery, as: 'machine' }]\n    });\n    \n    // Add alert status based on due date\n    return alerts.map(alert => {\n        const alertDate = new Date(alert.dueDate);\n        let status = 'upcoming';\n        if (alertDate.toDateString() === now.toDateString()) {\n            status = 'due_today';\n        } else if (alertDate < new Date(now.getFullYear(), now.getMonth(), now.getDate() + 2)) {\n            status = 'due_soon';\n        }\n        return {\n            ...alert.toJSON(),\n            alertStatus: status\n        };\n    });\n};\n\nconst getMaintenanceSummaryByMachine = async (machineId) => {\n    const now = new Date();\n    const [lastMaintenance, nextMaintenance] = await Promise.all([\n        getLastMaintenanceByMachine(machineId),\n        getNextMaintenanceByMachine(machineId)\n    ]);\n    \n    // Get maintenance alerts for the next 7 days\n    const alerts = await getMaintenanceAlerts(machineId);\n    \n    // Get total maintenance count\n    const totalMaintenanceCount = await MaintenanceLog.count({ where: { machineId } });\n    \n    // Get overdue maintenance\n    const overdueCount = await MaintenanceLog.count({\n        where: {\n            machineId,\n            dueDate: { [Op.lt]: now },\n            status: { [Op.in]: ['scheduled', 'due_today'] } // Only count scheduled or due_today as overdue, not completed ones\n        }\n    });\n    \n    return {\n        lastMaintenance: lastMaintenance ? lastMaintenance : null,\n        nextMaintenance: nextMaintenance ? nextMaintenance : null,\n        alerts,\n        totalMaintenanceCount,\n        overdueCount\n    };\n};\n\nconst getMaintenanceStatsByMachine = async (machineId) => {\n    const now = new Date();\n    const startOfYear = new Date(now.getFullYear(), 0, 1);\n\n    const totalRecords = await MaintenanceLog.count({ where: { machineId } });\n\n    const lastMaintenance = await MaintenanceLog.findOne({\n        where: { machineId },\n        order: [['date', 'DESC']],\n    });\n\n    const nextScheduled = await MaintenanceLog.findOne({\n        where: {\n            machineId,\n            status: { [Op.in]: ['scheduled', 'overdue', 'due_today'] },\n            dueDate: { [Op.gte]: now }\n        },\n        order: [['dueDate', 'ASC']],\n    });\n\n    const totalCostYTDResult = await MaintenanceLog.findAll({\n        where: {\n            machineId,\n            date: { [Op.gte]: startOfYear },\n        },\n        attributes: ['cost'],\n    });\n\n    const totalCostYTD = totalCostYTDResult.reduce((sum, log) => sum + parseFloat(log.cost || 0), 0);\n\n    const typeCounts = await MaintenanceLog.findAll({\n        where: { machineId },\n        attributes: ['type'],\n    });\n\n    const counts = {\n        repair: 0,\n        preventive: 0,\n        inspection: 0,\n        oil_change: 0,\n        parts_replacement: 0,\n    };\n\n    typeCounts.forEach((log) => {\n        if (counts[log.type] !== undefined) {\n            counts[log.type]++;\n        }\n    });\n\n    return {\n        totalRecords,\n        lastMaintenanceDate: lastMaintenance ? lastMaintenance.date : null,\n        nextScheduledDate: nextScheduled ? nextScheduled.dueDate : null,\n        totalCostYTD: parseFloat(totalCostYTD.toFixed(2)),\n        typeCounts: counts,\n    };\n};\n\n\nmodule.exports = {\n    getMaintenanceLogById,\n    createMaintenanceLog,\n    updateMaintenanceLog,\n    getMaintenanceLogsByMachine,\n    getScheduledMaintenanceById,\n    createScheduledMaintenance,\n    updateScheduledMaintenance,\n    getScheduledMaintenancesByMachine,\n    getLastMaintenanceByMachine,\n    getNextMaintenanceByMachine,\n    getMaintenanceAlerts,\n    getMaintenanceSummaryByMachine,\n    getMaintenanceStatsByMachine\n};\n","// validators/maintanance.validator.js\nconst Joi = require(\"joi\");\n\n// Maintenance Log validation - now includes all fields for all maintenance types\nconst createMaintenanceLogSchema = Joi.object({\n  machineId: Joi.number().integer().positive().required(),\n  type: Joi.string()\n    .valid(\n      \"servicing\",\n      \"custom\",\n      \"hydraulic_service\",\n      \"engine_service\",\n    )\n    .optional()\n    .allow(null, \"\"),\n  date: Joi.date().optional().allow(null),\n  title: Joi.string().required(),\n  description: Joi.string().optional().allow(null, \"\"),\n  parts: Joi.string().optional().allow(null, \"\"),\n  cost: Joi.number().precision(2).optional().allow(null),\n  technician: Joi.string().optional().allow(null, \"\"),\n  status: Joi.string()\n    .valid(\"completed\", \"in_progress\", \"scheduled\", \"overdue\", \"due_today\")\n    .required(),\n  kilometersAtService: Joi.number().integer().optional().allow(null),\n  hoursAtService: Joi.number().integer().optional().allow(null),\n  vendorAndPartsDetails: Joi.array().items(Joi.object()).optional().allow(null),\n  dueDate: Joi.date().optional().allow(null),\n  estimatedHours: Joi.number().optional().allow(null),\n  estimatedCost: Joi.number().precision(2).optional().allow(null),\n  priority: Joi.string()\n    .valid(\"low\", \"medium\", \"high\")\n    .optional()\n    .allow(null)\n    .default(\"medium\"),\n  assignedTo: Joi.string().optional().allow(null, \"\"),\n  lastAlertDate: Joi.date().optional().allow(null),\n});\n\nconst updateMaintenanceLogSchema = Joi.object({\n  machineId: Joi.number().integer().positive().optional(),\n  type: Joi.string()\n    .valid(\n      \"servicing\",\n      \"custom\",\n      \"hydraulic_service\",\n      \"engine_service\",\n    )\n    .optional()\n    .allow(null, \"\"),\n  date: Joi.date().optional().allow(null),\n  title: Joi.string().optional().allow(null, \"\"),\n  description: Joi.string().optional().allow(null, \"\"),\n  parts: Joi.string().optional().allow(null, \"\"),\n  cost: Joi.number().precision(2).optional().allow(null),\n  technician: Joi.string().optional().allow(null, \"\"),\n  status: Joi.string()\n    .valid(\"completed\", \"in_progress\", \"scheduled\", \"overdue\", \"due_today\")\n    .optional(),\n  kilometersAtService: Joi.number().integer().optional().allow(null),\n  hoursAtService: Joi.number().integer().optional().allow(null),\n  vendorAndPartsDetails: Joi.array().items(Joi.object()).optional().allow(null),\n  dueDate: Joi.date().optional().allow(null),\n  estimatedHours: Joi.number().optional().allow(null),\n  estimatedCost: Joi.number().precision(2).optional().allow(null),\n  priority: Joi.string().valid(\"low\", \"medium\", \"high\").optional().allow(null),\n  assignedTo: Joi.string().optional().allow(null, \"\"),\n  lastAlertDate: Joi.date().optional().allow(null),\n});\n\n// Scheduled Maintenance validation - now uses the same schema as maintenance log\nconst createScheduledMaintenanceSchema = Joi.object({\n  machineId: Joi.number().integer().positive().required(),\n  title: Joi.string().required(),\n  type: Joi.string()\n    .valid(\n      \"servicing\",\n      \"custom\",\n      \"hydraulic_service\",\n      \"engine_service\",\n    )\n    .optional()\n    .allow(null, \"\"),\n  dueDate: Joi.date().required(),\n  estimatedHours: Joi.number().optional().allow(null),\n  estimatedCost: Joi.number().precision(2).optional().allow(null),\n  priority: Joi.string()\n    .valid(\"low\", \"medium\", \"high\")\n    .optional()\n    .default(\"medium\"),\n  assignedTo: Joi.string().optional().allow(null, \"\"),\n  status: Joi.string()\n    .valid(\"scheduled\", \"overdue\", \"due_today\")\n    .optional()\n    .default(\"scheduled\"),\n  description: Joi.string().optional().allow(null, \"\"),\n  parts: Joi.string().optional().allow(null, \"\"),\n  cost: Joi.number().precision(2).optional().allow(null),\n  technician: Joi.string().optional().allow(null, \"\"),\n  hoursAtService: Joi.number().integer().optional().allow(null),\n  vendorAndPartsDetails: Joi.array().items(Joi.object()).optional().allow(null),\n});\n\nconst updateScheduledMaintenanceSchema = Joi.object({\n  machineId: Joi.number().integer().positive().optional(),\n  title: Joi.string().optional().allow(null, \"\"),\n  type: Joi.string()\n    .valid(\n      \"servicing\",\n      \"custom\",\n      \"hydraulic_service\",\n      \"engine_service\",\n    )\n    .optional()\n    .allow(null, \"\"),\n  dueDate: Joi.date().optional().allow(null),\n  estimatedHours: Joi.number().optional().allow(null),\n  estimatedCost: Joi.number().precision(2).optional().allow(null),\n  priority: Joi.string().valid(\"low\", \"medium\", \"high\").optional().allow(null),\n  assignedTo: Joi.string().optional().allow(null, \"\"),\n  status: Joi.string()\n    .valid(\"completed\", \"in_progress\", \"scheduled\", \"overdue\", \"due_today\")\n    .optional(),\n  description: Joi.string().optional().allow(null, \"\"),\n  parts: Joi.string().optional().allow(null, \"\"),\n  cost: Joi.number().precision(2).optional().allow(null),\n  technician: Joi.string().optional().allow(null, \"\"),\n  hoursAtService: Joi.number().integer().optional().allow(null),\n  vendorAndPartsDetails: Joi.array().items(Joi.object()).optional().allow(null),\n  lastAlertDate: Joi.date().optional().allow(null),\n  date: Joi.date().optional().allow(null),\n});\n\nmodule.exports = {\n  createMaintenanceLogSchema,\n  updateMaintenanceLogSchema,\n  createScheduledMaintenanceSchema,\n  updateScheduledMaintenanceSchema,\n};\n","const service = require(\"./issue.service\");\n\nconst createMaterialIssue = async (req, res) => {\n  const userId = req.user.id;\n  const data = await service.createMaterialIssue(req.body, userId);\n  res.sendResponse(data, \"Material issue created successfully\");\n};\n\nconst getMaterialIssueById = async (req, res) => {\n  const data = await service.getMaterialIssueById(req.params.id);\n  res.sendResponse(data, \"Material issue fetched successfully\");\n};\n\nconst getAllMaterialIssues = async (req, res) => {\n  const user = req.user\n  const data = await service.getAllMaterialIssues(user.siteId);\n  res.sendResponse(data, \"Material issues fetched successfully\");\n};\n\nconst getMaterialIssuesBySite = async (req, res) => {\n  const data = await service.getMaterialIssuesBySite(req.params.siteId);\n  res.sendResponse(data, \"Material issues fetched successfully\");\n};\n\nconst approveMaterialIssue = async (req, res) => {\n  const { issueId } = req.params;\n  const userId = req.user.id;\n  const data = await service.approveMaterialIssue(issueId, userId);\n  res.sendResponse(data, \"Material issue approved successfully\");\n};\n\nconst dispatchMaterialIssue = async (req, res) => {\n  const { issueId } = req.params;\n  const userId = req.user.id;\n  const data = await service.dispatchMaterialIssue(issueId, userId);\n  res.sendResponse(data, \"Material issue dispatched and stock deducted\");\n};\n\nconst receiveMaterialIssue = async (req, res) => {\n  const { issueId } = req.params;\n  const userId = req.user.id;\n  const data = await service.receiveMaterialIssue(issueId, userId);\n  res.sendResponse(data, \"Material issue received and stock updated\");\n};\n\nconst issueForConsumption = async (req, res) => {\n  const { issueId } = req.params;\n  const userId = req.user.id;\n  const data = await service.issueForConsumption(issueId, userId);\n  res.sendResponse(data, \"Material issued and consumed successfully\");\n};\n\nconst rejectMaterialIssue = async (req, res) => {\n  const { issueId } = req.params;\n  const { rejectionReason } = req.body;\n  const userId = req.user.id;\n\n  const data = await service.rejectMaterialIssue(issueId, userId, rejectionReason);\n  res.sendResponse(data, \"Material issue rejected successfully\");\n};\n\n\n\nmodule.exports = {\n  createMaterialIssue,\n  getMaterialIssueById,\n  getAllMaterialIssues,\n  getMaterialIssuesBySite,\n  approveMaterialIssue,\n  dispatchMaterialIssue,\n  receiveMaterialIssue,\n  issueForConsumption,\n  rejectMaterialIssue\n};\n","const express = require(\"express\");\nconst router = express.Router();\nconst controller = require(\"./issue.controller\");\nconst validateRequest = require(\"../../middlewares/validateRequest\");\nconst asyncMiddleware = require(\"../../middlewares/asyncMiddleware\");\nconst { createMaterialIssueSchema } = require(\"./issue.validator\");\n\nrouter.post(\n  \"/\",\n  validateRequest(createMaterialIssueSchema),\n  asyncMiddleware(controller.createMaterialIssue)\n);\n\nrouter.get(\"/:id\", asyncMiddleware(controller.getMaterialIssueById));\n\nrouter.get(\"/\", asyncMiddleware(controller.getAllMaterialIssues));\n\nrouter.post(\n  \"/:issueId/approve\",\n  asyncMiddleware(controller.approveMaterialIssue)\n);\n\n// Dispatch material issue (for Site Transfer - deducts stock)\nrouter.post(\n  \"/:issueId/dispatch\",\n  asyncMiddleware(controller.dispatchMaterialIssue)\n);\n\n// Receive material issue (for Site Transfer - adds stock to destination)\nrouter.post(\n  \"/:issueId/receive\",\n  asyncMiddleware(controller.receiveMaterialIssue)\n);\n\n// Issue material for consumption (deducts stock and marks as consumed)\nrouter.post(\n  \"/:issueId/consume\",\n  asyncMiddleware(controller.issueForConsumption)\n);\n\nrouter.post(\n  \"/:issueId/reject\",\n  asyncMiddleware(controller.rejectMaterialIssue)\n);\n\nmodule.exports = router;\n","const db = require(\"./../../models\");\nconst ROLES = require(\"../../utils/roles\");\nconst createNotification = require(\"../events\");\nconst { Op, col, fn } = require(\"sequelize\");\n\nconst userDetails = async (id) => {\n  return db.User.findByPk(id);\n};\n\nconst siteDetail = async (id) => {\n  return db.Site.findByPk(id);\n};\n\nconst createMaterialIssue = async (data, issuedById) => {\n  const issue = await db.sequelize.transaction(async (t) => {\n    const { items, ...issueData } = data;\n\n    // Check stock and lock quantities for each item\n    for (const item of items) {\n      const { itemId, quantity } = item;\n      const siteId = issueData.siteId;\n\n      const inventory = await db.SiteInventory.findOne({\n        where: { siteId, itemId },\n        transaction: t,\n      });\n\n      if (!inventory || inventory.quantity - inventory.lockedQuantity < quantity) {\n        throw new Error(\n          `Insufficient available stock at site ${siteId} for item ${itemId}. Available: ${inventory ? inventory.quantity - inventory.lockedQuantity : 0\n          }`\n        );\n      }\n\n      inventory.lockedQuantity += quantity;\n      await inventory.save({ transaction: t });\n    }\n\n    const issue = await db.MaterialIssue.create(\n      { ...issueData, issuedById, issuedAt: new Date() },\n      { transaction: t }\n    );\n\n    const itemData = items.map((item) => ({\n      ...item,\n      materialIssueId: issue.id,\n    }));\n\n    await db.MaterialIssueItem.bulkCreate(itemData, { transaction: t });\n\n    return await db.MaterialIssue.findByPk(issue.id, {\n      transaction: t,\n    });\n  });\n\n  const fromSite = await siteDetail(issue.siteId);\n  console.log(fromSite)\n  await createNotification({\n    eventType: \"MaterialIssue\",\n    eventAction: \"Requested\",\n    referenceId: issue.id,\n    siteId: issue.siteId,\n    createdBy: issue.createdById,\n    roles: [ROLES.STORE_MANAGER, ROLES.PROJECT_MANAGER],\n    title: \"Material Issue Requested\",\n    description: `A new material issue (#${issue.issueNumber}) has been created from site ${fromSite?.name}.`,\n  });\n\n  return issue;\n};\n\nconst getMaterialIssueById = async (id) => {\n  return await db.MaterialIssue.findByPk(id, {\n    include: [\n      {\n        model: db.Requisition,\n        as: \"requisition\",\n        attributes: [\"id\", \"requisitionNo\"],\n      },\n      { model: db.User, as: \"issuedBy\", attributes: [\"id\", \"name\", \"email\"] },\n      { model: db.User, as: \"approvedBy\", attributes: [\"id\", \"name\", \"email\"] },\n      {\n        model: db.User,\n        as: \"dispatchedBy\",\n        attributes: [\"id\", \"name\", \"email\"],\n      },\n      { model: db.User, as: \"receivedBy\", attributes: [\"id\", \"name\", \"email\"] },\n      { model: db.User, as: \"rejectedBy\", attributes: [\"id\", \"name\", \"email\"] },\n      { model: db.User, as: \"consumedBy\", attributes: [\"id\", \"name\", \"email\"] },\n      { model: db.Site, as: \"fromSite\", attributes: [\"id\", \"name\", \"code\"] },\n      { model: db.Site, as: \"toSite\", attributes: [\"id\", \"name\", \"code\"] },\n      {\n        model: db.MaterialIssueItem,\n        as: \"items\",\n        include: [\n          { model: db.Item, include: { model: db.Unit } },\n          {\n            model: db.Machinery,\n            as: \"machine\",\n            attributes: [\n              \"id\",\n              \"machineName\",\n              \"registrationNumber\",\n              \"erpCode\",\n              \"machineNumber\",\n            ],\n          },\n        ],\n      },\n    ],\n  });\n};\n\nconst getAllMaterialIssues = async (siteId) => {\n  if (siteId) {\n    return await db.MaterialIssue.findAll({\n      attributes: [\n        \"id\",\n        \"issueNumber\",\n        \"issueDate\",\n        \"status\",\n        \"issueType\",\n        [fn(\"COUNT\", col(\"items.id\")), \"itemCount\"],\n        // Add fromSite and toSite attributes\n        [col(\"fromSite.name\"), \"fromSiteName\"],\n        [col(\"fromSite.code\"), \"fromSiteCode\"],\n        [col(\"toSite.name\"), \"toSiteName\"],\n        [col(\"toSite.code\"), \"toSiteCode\"],\n      ],\n      include: [\n        {\n          model: db.MaterialIssueItem,\n          attributes: [], // Keep empty for aggregation\n          as: \"items\",\n        },\n        {\n          model: db.Site,\n          as: \"fromSite\",\n          attributes: [], // Set to empty since we're selecting in main attributes\n        },\n        {\n          model: db.Site,\n          as: \"toSite\",\n          attributes: [], // Set to empty since we're selecting in main attributes\n        },\n      ],\n      group: [\n        \"MaterialIssue.id\",\n        \"MaterialIssue.issueNumber\",\n        \"MaterialIssue.issueDate\",\n        \"MaterialIssue.status\",\n        \"MaterialIssue.issueType\",\n        \"fromSite.id\",\n        \"fromSite.name\",\n        \"fromSite.code\",\n        \"toSite.id\",\n        \"toSite.name\",\n        \"toSite.code\",\n      ],\n      order: [[\"issueDate\", \"DESC\"]],\n      where: {\n        [Op.or]: [{ otherSiteId: siteId }, { siteId: siteId }],\n      },\n      subQuery: false,\n    });\n  }\n  return await db.MaterialIssue.findAll({\n    attributes: [\n      \"id\",\n      \"issueNumber\",\n      \"issueDate\",\n      \"status\",\n      \"issueType\",\n      [fn(\"COUNT\", col(\"items.id\")), \"itemCount\"],\n      // Add fromSite and toSite attributes\n      [col(\"fromSite.name\"), \"fromSiteName\"],\n      [col(\"fromSite.code\"), \"fromSiteCode\"],\n      [col(\"toSite.name\"), \"toSiteName\"],\n      [col(\"toSite.code\"), \"toSiteCode\"],\n    ],\n    include: [\n      {\n        model: db.MaterialIssueItem,\n        attributes: [], // Keep empty for aggregation\n        as: \"items\",\n      },\n      {\n        model: db.Site,\n        as: \"fromSite\",\n        attributes: [], // Set to empty since we're selecting in main attributes\n      },\n      {\n        model: db.Site,\n        as: \"toSite\",\n        attributes: [], // Set to empty since we're selecting in main attributes\n      },\n    ],\n    group: [\n      \"MaterialIssue.id\",\n      \"MaterialIssue.issueNumber\",\n      \"MaterialIssue.issueDate\",\n      \"MaterialIssue.status\",\n      \"MaterialIssue.issueType\",\n      \"fromSite.id\",\n      \"fromSite.name\",\n      \"fromSite.code\",\n      \"toSite.id\",\n      \"toSite.name\",\n      \"toSite.code\",\n    ],\n    order: [[\"issueDate\", \"DESC\"]],\n    subQuery: false,\n  });\n};\n\n//  {\n//           \"id\": 44,\n//           \"issueNumber\": \"ISS-044\",\n//           \"issueDate\": \"2025-07-12T16:35:00.000Z\",\n//           \"issueType\": \"Site Transfer\",\n//           \"status\": \"Approved\",\n//           \"siteId\": 73,\n//           \"otherSiteId\": 34,\n//           \"requisitionId\": 76,\n//           \"approvedById\": 7,\n//           \"approvedAt\": \"2025-07-12T11:06:37.444Z\",\n//           \"issuedById\": 21,\n//           \"issuedAt\": \"2025-07-12T11:05:45.638Z\",\n//           \"consumedById\": null,\n//           \"consumedAt\": null,\n//           \"dispatchedById\": null,\n//           \"dispatchedAt\": null,\n//           \"receivedById\": null,\n//           \"receivedAt\": null,\n//           \"rejectedById\": null,\n//           \"rejectedAt\": null,\n//           \"rejectionReason\": null,\n//           \"createdAt\": \"2025-07-12T11:05:45.638Z\",\n//           \"updatedAt\": \"2025-07-12T11:06:37.444Z\",\n//           \"items\": [\n//               {\n//                   \"id\": 76,\n//                   \"materialIssueId\": 44,\n//                   \"itemId\": 21,\n//                   \"quantity\": 1000,\n//                   \"issueTo\": \"Other Site\",\n//                   \"siteId\": 73,\n//                   \"otherSiteId\": 34,\n//                   \"machineId\": null,\n//                   \"Item\": {\n//                       \"id\": 21,\n//                       \"name\": \"Petrol\",\n//                       \"shortName\": \"Petrol\",\n//                       \"partNumber\": \"\",\n//                       \"hsnCode\": \"\",\n//                       \"itemGroupId\": 12,\n//                       \"unitId\": 5\n//                   },\n//                   \"fromSite\": {\n//                       \"id\": 73,\n//                       \"name\": \"Bijepur Road Project Bargarh Odisha Project Site\",\n//                       \"code\": \"SITE-073\",\n//                       \"address\": \"Bijepur Road Project Bargarh Odisha Project Site\",\n//                       \"pincode\": \"768018\",\n//                       \"mobileNumber\": \"08292696711\",\n//                       \"departmentId\": 1,\n//                       \"status\": \"active\",\n//                       \"createdAt\": \"2025-05-12T07:21:11.039Z\",\n//                       \"updatedAt\": \"2025-05-12T07:21:11.204Z\",\n//                       \"deletedAt\": null\n//                   },\n//                   \"toSite\": {\n//                       \"id\": 34,\n//                       \"name\": \"NTPC Patratu, Ramgarh\",\n//                       \"code\": \"SITE-034\",\n//                       \"address\": \"NTPC Patratu, Ramgarh, Jharkhand Project Site\",\n//                       \"pincode\": \"829118\",\n//                       \"mobileNumber\": \"8210765404\",\n//                       \"departmentId\": 1,\n//                       \"status\": \"active\",\n//                       \"createdAt\": \"2025-05-09T06:14:13.615Z\",\n//                       \"updatedAt\": \"2025-05-22T17:27:20.815Z\",\n//                       \"deletedAt\": null\n//                   }\n//               }\n//           ]\n//       },\n\nconst getMaterialIssuesBySite = async (siteId) => {\n  return await db.MaterialIssue.findAll({\n    include: [\n      {\n        model: db.MaterialIssueItem,\n        as: \"items\",\n        include: [{ model: db.Item }],\n      },\n    ],\n    where: {\n      fromSiteId: siteId,\n    },\n  });\n};\n\nconst approveMaterialIssue = async (issueId, approvedById) => {\n  return await db.sequelize.transaction(async (t) => {\n    const issue = await db.MaterialIssue.findByPk(issueId, {\n      transaction: t,\n    });\n\n    if (!issue) throw new Error(\"Material Issue not found\");\n    if (issue.status !== \"Pending\") throw new Error(\"Issue already processed\");\n\n    issue.status = \"Approved\";\n    issue.approvedById = approvedById;\n    issue.approvedAt = new Date();\n    await issue.save({ transaction: t });\n\n    await createNotification({\n      eventType: \"MaterialIssue\",\n      eventAction: \"Approved\",\n      referenceId: issue.id,\n      siteId: issue.siteId,\n      createdBy: issue.approvedById,\n      roles: [ROLES.STORE_MANAGER],\n      title: \"Material Issue Approved\",\n      description: `Material issue #${issue.issueNumber} has been approved.`,\n    });\n\n    return issue;\n  });\n};\n\nconst dispatchMaterialIssue = async (issueId, dispatchedById) => {\n  return await db.sequelize.transaction(async (t) => {\n    const issue = await db.MaterialIssue.findByPk(issueId, {\n      include: [{ model: db.MaterialIssueItem, as: \"items\" }],\n      transaction: t,\n    });\n\n    if (!issue) throw new Error(\"Material Issue not found\");\n    if (issue.status !== \"Approved\") throw new Error(\"Issue not approved\");\n\n    if (issue.issueType !== \"Site Transfer\")\n      throw new Error(\"Invalid issue type\");\n\n    for (const item of issue.items) {\n      const { itemId, quantity, siteId } = item;\n\n      const fromInventory = await db.SiteInventory.findOne({\n        where: { siteId, itemId },\n        transaction: t,\n      });\n\n      if (!fromInventory || fromInventory.quantity < quantity) {\n        throw new Error(\n          `Insufficient stock at site ${siteId} for item ${itemId}`\n        );\n      }\n\n      fromInventory.quantity -= quantity;\n      fromInventory.lockedQuantity -= quantity; // Release lock upon dispatch\n      if (fromInventory.lockedQuantity < 0) fromInventory.lockedQuantity = 0; // Guard against negative\n      await fromInventory.save({ transaction: t });\n\n      await db.StockLog.create(\n        {\n          siteId,\n          itemId,\n          change: -quantity,\n          type: \"OUT\",\n          sourceType: \"Issue\",\n          sourceId: issue.id,\n        },\n        { transaction: t }\n      );\n    }\n    issue.status = \"Dispatched\";\n    issue.dispatchedById = dispatchedById;\n    issue.dispatchedAt = new Date();\n    await issue.save({ transaction: t });\n\n    await createNotification({\n      eventType: \"MaterialIssue\",\n      eventAction: \"Dispatched\",\n      referenceId: issue.id,\n      siteId: issue.siteId,\n      createdBy: issue.dispatchedById,\n      roles: [ROLES.STORE_MANAGER],\n      title: \"Material Issue Dispatched\",\n      description: `Material issue #${issue.issueNumber} has been dispatched.`,\n    });\n\n    return issue;\n  });\n};\n\nconst receiveMaterialIssue = async (issueId, receivedById) => {\n  return await db.sequelize.transaction(async (t) => {\n    const issue = await db.MaterialIssue.findByPk(issueId, {\n      include: [{ model: db.MaterialIssueItem, as: \"items\" }],\n      transaction: t,\n    });\n\n    if (!issue) throw new Error(\"Material Issue not found\");\n    if (issue.status !== \"Dispatched\")\n      throw new Error(\"Issue not dispatched yet\");\n\n    if (issue.issueType !== \"Site Transfer\")\n      throw new Error(\"Invalid issue type\");\n\n    for (const item of issue.items) {\n      const { itemId, quantity, otherSiteId } = item;\n\n      const toInventory = await db.SiteInventory.findOne({\n        where: { siteId: otherSiteId, itemId },\n        transaction: t,\n      });\n\n      if (toInventory) {\n        toInventory.quantity += quantity;\n        await toInventory.save({ transaction: t });\n      } else {\n        await db.SiteInventory.create(\n          {\n            siteId: otherSiteId,\n            itemId,\n            quantity,\n            minimumLevel: 0,\n            status: \"In Stock\",\n          },\n          { transaction: t }\n        );\n      }\n\n      await db.StockLog.create(\n        {\n          siteId: otherSiteId,\n          itemId,\n          change: quantity,\n          type: \"IN\",\n          sourceType: \"Issue\",\n          sourceId: issue.id,\n        },\n        { transaction: t }\n      );\n    }\n\n    issue.status = \"Received\";\n    issue.receivedById = receivedById;\n    issue.receivedAt = new Date();\n    await issue.save({ transaction: t });\n\n    await createNotification({\n      eventType: \"MaterialIssue\",\n      eventAction: \"Received\",\n      referenceId: issue.id,\n      siteId: issue.siteId,\n      createdBy: issue.receivedById,\n      roles: [ROLES.STORE_MANAGER],\n      title: \"Material Issue Received\",\n      description: `Material issue #${issue.issueNumber} has been received.`,\n    });\n\n    return issue;\n  });\n};\n\nconst issueForConsumption = async (issueId, consumedById) => {\n  return await db.sequelize.transaction(async (t) => {\n    const issue = await db.MaterialIssue.findByPk(issueId, {\n      include: [{ model: db.MaterialIssueItem, as: \"items\" }],\n      transaction: t,\n    });\n\n    if (!issue) throw new Error(\"Material Issue not found\");\n    if (issue.status !== \"Approved\") throw new Error(\"Issue not approved\");\n    if (issue.issueType !== \"Consumption\")\n      throw new Error(\"Invalid issue type\");\n\n    for (const item of issue.items) {\n      const { itemId, quantity, siteId } = item;\n\n      const inventory = await db.SiteInventory.findOne({\n        where: { siteId, itemId },\n        transaction: t,\n      });\n\n      if (!inventory || inventory.quantity < quantity) {\n        throw new Error(\n          `Insufficient stock at site ${siteId} for item ${itemId}`\n        );\n      }\n\n      inventory.quantity -= quantity;\n      inventory.lockedQuantity -= quantity; // Release lock upon consumption\n      if (inventory.lockedQuantity < 0) inventory.lockedQuantity = 0; // Guard against negative\n      await inventory.save({ transaction: t });\n\n      await db.StockLog.create(\n        {\n          siteId,\n          itemId,\n          change: -quantity,\n          type: \"OUT\",\n          sourceType: \"Consumption\",\n          sourceId: issue.id,\n        },\n        { transaction: t }\n      );\n    }\n\n    issue.status = \"Consumed\";\n    issue.consumedById = consumedById;\n    issue.consumedAt = new Date();\n    await issue.save({ transaction: t });\n\n    await createNotification({\n      eventType: \"MaterialIssue\",\n      eventAction: \"Consumed\",\n      referenceId: issue.id,\n      siteId: issue.siteId,\n      createdBy: issue.consumedById,\n      roles: [ROLES.STORE_MANAGER],\n      title: \"Material Consumed\",\n      description: `Material issue #${issue.issueNumber} has been consumed.`,\n    });\n\n    return issue;\n  });\n};\n\nconst rejectMaterialIssue = async (issueId, rejectedById, rejectionReason) => {\n  return await db.sequelize.transaction(async (t) => {\n    const issue = await db.MaterialIssue.findByPk(issueId, { transaction: t });\n\n    if (!issue) throw new Error(\"Material Issue not found\");\n    if (\n      [\"Rejected\", \"Approved\", \"Dispatched\", \"Received\", \"Consumed\"].includes(\n        issue.status\n      )\n    ) {\n      throw new Error(\n        `Cannot reject. Issue already in '${issue.status}' state`\n      );\n    }\n\n    issue.status = \"Rejected\";\n    issue.rejectedById = rejectedById;\n    issue.rejectedAt = new Date();\n    issue.rejectionReason = rejectionReason;\n\n    await issue.save({ transaction: t });\n\n    // Release locked quantities\n    const issueItems = await db.MaterialIssueItem.findAll({\n      where: { materialIssueId: issueId },\n      transaction: t,\n    });\n\n    for (const item of issueItems) {\n      const { itemId, quantity, siteId } = item;\n      const inventory = await db.SiteInventory.findOne({\n        where: { siteId, itemId },\n        transaction: t,\n      });\n\n      if (inventory) {\n        inventory.lockedQuantity -= quantity;\n        if (inventory.lockedQuantity < 0) inventory.lockedQuantity = 0;\n        await inventory.save({ transaction: t });\n      }\n    }\n\n    await createNotification({\n      eventType: \"MaterialIssue\",\n      eventAction: \"Rejected\",\n      referenceId: issue.id,\n      siteId: issue.siteId,\n      createdBy: rejectedById,\n      roles: [ROLES.STORE_MANAGER],\n      title: \"Material Issue Rejected\",\n      description: `Material issue #${issue.issueNumber\n        } has been rejected. Reason: ${rejectionReason || \"Not specified\"}.`,\n    });\n\n    return issue;\n  });\n};\n\nmodule.exports = {\n  createMaterialIssue,\n  getMaterialIssueById,\n  getAllMaterialIssues,\n  dispatchMaterialIssue,\n  receiveMaterialIssue,\n  getMaterialIssuesBySite,\n  approveMaterialIssue,\n  issueForConsumption,\n  rejectMaterialIssue,\n};\n","const Joi = require(\"joi\");\n\nconst issueItemSchema = Joi.object({\n  itemId: Joi.number().integer().required(),\n  quantity: Joi.number().positive().required(),\n  issueTo: Joi.string().allow(null, \"\"),\n  machineId: Joi.number().allow(null),\n  siteId: Joi.number().required(),\n  otherSiteId: Joi.number().allow(null),\n});\n\nconst createMaterialIssueSchema = Joi.object({\n  issueDate: Joi.date().required(),\n  issueType: Joi.string().valid(\"Consumption\", \"Site Transfer\").required(),\n  status: Joi.string().optional(),\n  siteId: Joi.number().required(),\n  otherSiteId: Joi.number().allow(null),\n  items: Joi.array().items(issueItemSchema).min(1).required(),\n  requisitionId: Joi.number().allow(null),\n});\n\nmodule.exports = {\n  createMaterialIssueSchema,\n};\n","const notificationService = require(\"./notification.service\");\n\nconst getAllNotifications = async (req, res) => {\n  const userId = req.user.id;\n  const user = req.user;\n  const whereClause = {};\n  if (user.siteId) {\n    whereClause.siteId = user.siteId;\n  }\n  const notifications = await notificationService.getNotificationsForUser(\n    userId,\n    whereClause\n  );\n  res.sendResponse(notifications, \"Notifications fetched successfully\");\n};\n\nconst markAsRead = async (req, res) => {\n  const userId = req.user.id;\n  const notificationId = req.params.id;\n  await notificationService.markNotificationAsRead(userId, Number(notificationId));\n  res.sendResponse({}, \"Notification marked as read\");\n};\n\nconst markAllAsRead = async (req, res) => {\n  const userId = req.user.id;\n  await notificationService.markAllNotificationsAsRead(userId);\n  res.sendResponse({}, \"All notifications marked as read\");\n};\n\nmodule.exports = {\n  getAllNotifications,\n  markAsRead,\n  markAllAsRead,\n};\n","const express = require(\"express\");\nconst router = express.Router();\nconst notificationController = require(\"./notification.controller\");\nconst asyncMiddleware = require(\"./../../middlewares/asyncMiddleware\");\n\n// GET /notifications/\nrouter.get(\n  \"/notifications/\",\n  asyncMiddleware(notificationController.getAllNotifications)\n);\n\n// POST /notifications/:id/read\nrouter.post(\n  \"/notifications/:id/read\",\n  asyncMiddleware(notificationController.markAsRead)\n);\n\n// POST /notifications/mark-all\nrouter.post(\n  \"/notifications/read-all\",\n  asyncMiddleware(notificationController.markAllAsRead)\n);\n\nmodule.exports = router;\n","const db = require(\"./../../models\");\n\nconst getNotificationsForUser = async (userId, whereClause = {}) => {\n  const notifications = await db.Notification.findAll({\n    where: whereClause,\n    include: [\n      {\n        model: db.NotificationReadStatus,\n        where: { userId },\n        required: false,\n        as: \"readStatuses\",\n      },\n    ],\n    order: [[\"createdAt\", \"DESC\"]],\n  });\n\n  return notifications.map((n) => ({\n    id: n.id,\n    title: n.title,\n    description: n.description,\n    eventType: n.eventType,\n    eventAction: n.eventAction,\n    createdAt: n.createdAt,\n    referenceId: n.referenceId,\n    read: n.readStatuses?.length > 0,\n  }));\n};\n\nconst markNotificationAsRead = async (userId, notificationId) => {\n  const [readStatus, created] = await db.NotificationReadStatus.findOrCreate({\n    where: { userId, notificationId },\n    defaults: { readAt: new Date() },\n  });\n\n  if (!created) {\n    readStatus.readAt = new Date();\n    await readStatus.save();\n  }\n\n  return true;\n};\n\nconst markAllNotificationsAsRead = async (userId) => {\n  const allNotifications = await db.Notification.findAll({\n    attributes: [\"id\"],\n  });\n\n  const readStatusData = allNotifications.map((n) => ({\n    userId,\n    notificationId: n.id,\n    readAt: new Date(),\n  }));\n\n  await db.NotificationReadStatus.bulkCreate(readStatusData, {\n    ignoreDuplicates: true,\n  });\n\n  return true;\n};\n\nmodule.exports = {\n  getNotificationsForUser,\n  markNotificationAsRead,\n  markAllNotificationsAsRead,\n};\n","const procurementService = require(\"./procurement.service\");\n\nconst createProcurement = async (req, res) => {\n  const procurement = await procurementService.createProcurement(req.body);\n  res.sendResponse(procurement, \"Procurement created successfully\");\n};\n\nconst getProcurement = async (req, res) => {\n  const procurement = await procurementService.getProcurementById(\n    req.params.id\n  );\n  res.sendResponse(procurement);\n};\n\nconst updateStatus = async (req, res) => {\n  await procurementService.updateProcurementStatus(\n    req.params.id,\n    req.body.status,\n    req.user\n  );\n  res.sendResponse(null, \"Procurement status updated\");\n};\n\nconst listProcurements = async (req, res) => {\n  const procurements = await procurementService.listProcurements(req.query);\n  res.sendResponse(procurements);\n};\n\nconst updatePayment = async (req, res) => {\n  await procurementService.updatePaymentStatus(req.params.id, req.body);\n  res.sendResponse(null, \"Payment status updated\");\n};\n\nconst getSummary = async (req, res) => {\n  const summary = await procurementService.getProcurementSummary();\n  res.sendResponse(summary);\n};\n\nconst getInventoryMovement = async (req, res) => {\n  const movement = await procurementService.getInventoryMovement(req.params.id);\n  res.sendResponse(movement);\n};\n\nconst getRequisitionWithRemainingItems = async (req, res) => {\n  const requisition = await procurementService.getRequisitionWithRemainingItems(req.params.id);\n  res.sendResponse(requisition);\n};\n\nconst deleteProcurement = async (req, res) => {\n  const procurement = await procurementService.deleteProcurement(req.params.id);\n  res.sendResponse(procurement, \"Procurement deleted successfully\");\n};\n\nconst createFromComparison = async (req, res) => {\n  const { comparisonId, vendorId, selections } = req.body;\n  const userId = req.user.id;\n  const procurements =\n    await procurementService.createProcurementsFromComparison(\n      comparisonId,\n      userId,\n      vendorId,\n      selections\n    );\n  res.sendResponse(\n    procurements,\n    \"Procurements created successfully from comparison\"\n  );\n};\n\nmodule.exports = {\n  createProcurement,\n  getProcurement,\n  updateStatus,\n  listProcurements,\n  updatePayment,\n  getSummary,\n  getInventoryMovement,\n  getRequisitionWithRemainingItems,\n  deleteProcurement,\n  createFromComparison,\n};\n","const router = require(\"express\").Router();\nconst asyncMiddleware = require(\"../../middlewares/asyncMiddleware\");\nconst procurementController = require(\"./procurement.controller\");\nconst validateRequest = require(\"../../middlewares/validateRequest\");\nconst {\n  createProcurementSchema,\n  updateStatusSchema,\n  listProcurementsSchema,\n  updatePaymentSchema,\n} = require(\"./procurement.validator\");\n\nrouter.post(\n  \"/procurements\",\n  validateRequest(createProcurementSchema),\n  asyncMiddleware(procurementController.createProcurement)\n);\n\nrouter.get(\n  \"/procurements/:id\",\n  asyncMiddleware(procurementController.getProcurement)\n);\n\nrouter.put(\n  \"/procurements/:id/status\",\n  validateRequest(updateStatusSchema),\n  asyncMiddleware(procurementController.updateStatus)\n);\n\n// Add to existing routes\nrouter.get(\n  \"/procurements\",\n  validateRequest(listProcurementsSchema),\n  asyncMiddleware(procurementController.listProcurements)\n);\n\nrouter.put(\n  \"/procurements/:id/payment\",\n  validateRequest(updatePaymentSchema),\n  asyncMiddleware(procurementController.updatePayment)\n);\n\n// Optional: Delete procurement (if needed)\nrouter.delete(\n  \"/procurements/:id\",\n  asyncMiddleware(procurementController.deleteProcurement)\n);\n\nrouter.get(\n  \"/procurements/summary\",\n  asyncMiddleware(procurementController.getSummary)\n);\n\nrouter.get(\n  \"/procurements/:id/inventory-movement\",\n  asyncMiddleware(procurementController.getInventoryMovement)\n);\n\n// Route to get requisition with remaining items\nrouter.get(\n  \"/requisitions/:id/remaining-items\",\n  asyncMiddleware(procurementController.getRequisitionWithRemainingItems)\n);\n\nrouter.post(\n  \"/procurements/create-from-comparison\",\n  asyncMiddleware(procurementController.createFromComparison)\n);\n\nmodule.exports = router;\n","const { sequelize } = require(\"../../models\");\nconst { Op } = require(\"sequelize\");\nconst db = require(\"../../models\");\n\n// Generate procurement number (e.g., PRC-2025-0001)\nconst generateProcurementNo = async () => {\n  const count = await db.Procurement.count();\n  return `PRC-${new Date().getTime()}-${(count + 1)\n    .toString()\n    .padStart(4, \"0\")}`;\n};\n\nconst createProcurement = async (data) => {\n  return await sequelize.transaction(async (t) => {\n    // Step 1: Handle Vendor (existing or new)\n    // const vendor = await handleVendor(data.vendor, t);\n\n    // Step 2: Create Procurement\n    const procurementNo = await generateProcurementNo();\n    const procurement = await db.Procurement.create(\n      {\n        ...data,\n        procurementNo,\n        status: \"ordered\",\n      },\n      { transaction: t }\n    );\n\n    // Step 3: Create Procurement Items\n    const procurementItems = await db.ProcurementItem.bulkCreate(\n      data.items.map((item) => ({\n        ...item,\n        procurementId: procurement.id,\n        amount: item.quantity * item.rate,\n      })),\n      { transaction: t }\n    );\n\n    // Step 4: Update Total Amount\n    const totalAmount = procurementItems.reduce(\n      (sum, item) => sum + Number(item.amount),\n      0\n    );\n    await procurement.update({ totalAmount }, { transaction: t });\n\n    return procurement;\n  });\n};\n\n// Vendor Handler (separate function for clarity)\nconst handleVendor = async (vendorData, transaction) => {\n  if (typeof vendorData === \"number\") {\n    // Existing vendor (ID provided)\n    const vendor = await db.Vendor.findByPk(vendorData, { transaction });\n    if (!vendor) throw new Error(\"Vendor not found\");\n    return vendor;\n  } else if (vendorData && typeof vendorData === \"object\") {\n    // New vendor (details provided)\n    return await db.Vendor.create(\n      {\n        name: vendorData.name,\n        email: vendorData.email || null,\n        contactPerson: vendorData.contactPerson || null,\n        phone: vendorData.phone || null,\n        address: vendorData.address || null,\n      },\n      { transaction }\n    );\n  } else {\n    throw new Error(\"Invalid vendor data format\");\n  }\n};\nconst getProcurementById = async (id) => {\n  return await db.Procurement.findByPk(id, {\n    include: [\n      { model: db.Vendor },\n      { model: db.Requisition },\n      {\n        model: db.ProcurementItem,\n        include: {\n          model: db.RequisitionItem,\n          include: { model: db.Item, include: { model: db.Unit } },\n        },\n      },\n      {\n        model: db.Invoice,\n        as: \"invoices\",\n        include: [\n          { model: db.Payment, as: \"payments\" },\n          {\n            model: db.InvoiceItem,\n            as: \"items\",\n            include: [\n              {\n                model: db.ProcurementItem,\n                include: {\n                  model: db.RequisitionItem,\n                  include: { model: db.Item },\n                },\n              },\n            ],\n          },\n        ],\n      },\n    ],\n  });\n};\n\nconst listProcurements = async (filters = {}) => {\n  const { status, startDate, endDate, vendorId, page, limit } = filters;\n\n  const where = {};\n  if (status) where.status = status;\n  if (vendorId) where.vendorId = vendorId;\n  if (startDate && endDate) {\n    where.createdAt = { [Op.between]: [startDate, endDate] };\n  }\n  // return await db.Procurement.findAndCountAll({\n  return await db.Procurement.findAll({\n    where,\n    include: [\n      { model: db.Vendor, attributes: [\"name\"] },\n      { model: db.Requisition, attributes: [\"requisitionNo\"] },\n      // {\n      //   model: db.ProcurementItem,\n      //   include: {\n      //     model: db.RequisitionItem,\n      //     include: { model: db.Item, include: { model: db.Unit } },\n      //   },\n      // },\n    ],\n    // limit,\n    // offset: (page - 1) * limit,\n    order: [[\"createdAt\", \"DESC\"]],\n  });\n};\n\nconst updatePaymentStatus = async (id, paymentData) => {\n  return await db.Procurement.update(\n    {\n      isPaid: paymentData.paymentStatus,\n      paymentDate: paymentData.paymentStatus\n        ? paymentData.paymentDate || new Date()\n        : null,\n    },\n    { where: { id } }\n  );\n};\n\nconst getProcurementSummary = async () => {\n  const [statusCounts, monthlySpending, topVendors] = await Promise.all([\n    // Status distribution\n    db.Procurement.count({\n      group: [\"status\"],\n      attributes: [\"status\", [db.sequelize.fn(\"COUNT\", \"id\"), \"count\"]],\n    }),\n\n    // Monthly spending (last 6 months)\n    db.Procurement.findAll({\n      where: {\n        createdAt: {\n          [Op.gte]: new Date(new Date() - 180 * 24 * 60 * 60 * 1000), // 6 months\n        },\n      },\n      attributes: [\n        [\n          db.sequelize.fn(\"DATE_TRUNC\", \"month\", db.sequelize.col(\"createdAt\")),\n          \"month\",\n        ],\n        [db.sequelize.fn(\"SUM\", db.sequelize.col(\"totalAmount\")), \"total\"],\n      ],\n      group: [\"month\"],\n      order: [[\"month\", \"ASC\"]],\n    }),\n\n    // Top 5 vendors by spending\n    db.Procurement.findAll({\n      attributes: [\n        [db.sequelize.col(\"Vendor.name\"), \"vendorName\"],\n        [db.sequelize.fn(\"SUM\", db.sequelize.col(\"totalAmount\")), \"totalSpent\"],\n      ],\n      include: [\n        {\n          model: db.Vendor,\n          attributes: [],\n        },\n      ],\n      group: [\"Vendor.id\"],\n      order: [[db.sequelize.literal(\"totalSpent\"), \"DESC\"]],\n      limit: 5,\n    }),\n  ]);\n\n  return {\n    statusDistribution: statusCounts,\n    monthlySpending,\n    topVendors,\n  };\n};\n\nconst updateProcurementStatus = async (id, status, user) => {\n  return await sequelize.transaction(async (t) => {\n    const procurement = await db.Procurement.findByPk(id, {\n      include: [\n        {\n          model: db.ProcurementItem,\n          include: [db.RequisitionItem],\n        },\n        { model: db.Requisition },\n      ],\n      transaction: t,\n    });\n\n    // Process inventory based on the new status workflow\n    if (status === \"accepted_at_virtual_site\") {\n      // When items are accepted at virtual site, add them to virtual site inventory\n      let virtualSite = await db.Site.findOne({\n        where: { type: \"virtual\" },\n        attributes: [\"id\"],\n      });\n      if (!virtualSite?.id) {\n        const department = await db.Department.findOne({\n          where: { name: \"Mechanical\" },\n        });\n        virtualSite = await db.Site.create({\n          name: \"Virtual\",\n          type: \"virtual\",\n          departmentId: department.id,\n          address: \"NA\",\n        });\n      }\n\n      for (const item of procurement.ProcurementItems) {\n        // Add items to virtual site inventory\n        await updateInventory(\n          {\n            siteId: virtualSite.id, // Virtual site inventory\n            itemId: item.RequisitionItem.itemId,\n            change: item.quantity,\n            type: \"IN\",\n            sourceType: \"Procurement\",\n            sourceId: id,\n            userId: user.id, // Assuming you have auth\n          },\n          t\n        );\n      }\n    } else if (status === \"in_transit_to_requested_site\") {\n      // When items are sent to requested site, move from virtual site to requested site\n      let virtualSite = await db.Site.findOne({\n        where: { type: \"virtual\" },\n        attributes: [\"id\"],\n      });\n      if (!virtualSite?.id) {\n        const department = await db.Department.findOne({\n          where: { name: \"Mechanical\" },\n        });\n        virtualSite = await db.Site.create({\n          name: \"Virtual\",\n          type: \"virtual\",\n          departmentId: department.id,\n          address: \"NA\",\n        });\n      }\n\n      for (const item of procurement.ProcurementItems) {\n        // Remove items from virtual site inventory\n        await updateInventory(\n          {\n            siteId: virtualSite.id, // Virtual site inventory\n            itemId: item.RequisitionItem.itemId,\n            change: item.quantity,\n            type: \"OUT\",\n            sourceType: \"Procurement\",\n            sourceId: id,\n            userId: user.id,\n          },\n          t\n        );\n\n        // Add items to requested site inventory (temporarily, until final delivery)\n        await updateInventory(\n          {\n            siteId: procurement.Requisition.requestingSiteId,\n            itemId: item.RequisitionItem.itemId,\n            change: item.quantity,\n            type: \"IN\",\n            sourceType: \"Procurement\",\n            sourceId: id,\n            userId: user.id,\n          },\n          t\n        );\n      }\n    } else if (status === \"delivered\") {\n      // When items are delivered, ensure they are properly in the requested site inventory\n      // This could be the final acceptance at the requested site\n      let virtualSite = await db.Site.findOne({\n        where: { type: \"virtual\" },\n        attributes: [\"id\"],\n      });\n      if (!virtualSite?.id) {\n        const department = await db.Department.findOne({\n          where: { name: \"Mechanical\" },\n        });\n        virtualSite = await db.Site.create({\n          name: \"Virtual\",\n          type: \"virtual\",\n          departmentId: department.id,\n          address: \"NA\",\n        });\n      }\n\n      for (const item of procurement.ProcurementItems) {\n        // Final confirmation - ensure items are properly tracked at requested site\n        // This could be a reconciliation step to ensure inventory accuracy\n        await updateInventory(\n          {\n            siteId: procurement.Requisition.requestingSiteId,\n            itemId: item.RequisitionItem.itemId,\n            change: item.quantity,\n            type: \"IN\", // Confirming final delivery\n            sourceType: \"Requisition\",\n            sourceId: procurement.requisitionId,\n            userId: user.id,\n          },\n          t\n        );\n      }\n    }\n\n    return await procurement.update({ status }, { transaction: t });\n  });\n};\n\n// Helper function for inventory updates\nconst updateInventory = async (data, transaction) => {\n  // Update SiteInventory\n  const [inventory] = await db.SiteInventory.findOrCreate({\n    where: {\n      siteId: data.siteId,\n      itemId: data.itemId,\n    },\n    defaults: { quantity: 0 },\n    transaction,\n  });\n\n  const newQuantity =\n    data.type === \"IN\"\n      ? inventory.quantity + data.change\n      : inventory.quantity - data.change;\n\n  await inventory.update(\n    {\n      quantity: newQuantity,\n      status: calculateStockStatus(newQuantity, inventory.minimumLevel),\n    },\n    { transaction }\n  );\n\n  // Create StockLog\n  await db.StockLog.create(data, { transaction });\n};\n\nconst calculateStockStatus = (quantity, minimumLevel) => {\n  if (quantity <= 0) return \"Out of Stock\";\n  if (quantity < minimumLevel) return \"Low Stock\";\n  return \"In Stock\";\n};\n\nconst getInventoryMovement = async (sourceId) => {\n  const movement = await db.StockLog.findAll({\n    where: { sourceId: sourceId, sourceType: \"Procurement\" },\n    include: [db.Item, db.Site],\n  });\n  return movement;\n};\n\nconst getRequisitionWithRemainingItems = async (id) => {\n  const requisition = await db.Requisition.findByPk(id, {\n    include: [\n      {\n        model: db.RequisitionItem,\n        as: \"items\",\n        include: [{ model: db.Item }],\n      },\n      {\n        model: db.Procurement,\n        as: \"procurements\",\n        include: [\n          {\n            model: db.ProcurementItem,\n            as: \"items\", // Assuming you have ProcurementItem model\n          },\n        ],\n      },\n      {\n        model: db.MaterialIssue,\n        as: \"materialIssues\",\n        include: [\n          {\n            model: db.MaterialIssueItem,\n            as: \"items\",\n          },\n        ],\n      },\n      { model: db.User, as: \"preparedBy\", attributes: [\"id\", \"name\", \"email\"] },\n      {\n        model: db.Site,\n        as: \"requestingSite\",\n        attributes: [\"id\", \"name\", \"code\"],\n      },\n    ],\n  });\n\n  if (!requisition) {\n    return null;\n  }\n\n  // Maps to store quantities per item\n  const procuredQuantities = new Map();\n  const issuedQuantities = new Map();\n\n  // Calculate total procured quantities per item\n  requisition.procurements.forEach((procurement) => {\n    if (procurement.items) {\n      procurement.items.forEach((item) => {\n        const currentQty = procuredQuantities.get(item.itemId) || 0;\n        procuredQuantities.set(item.itemId, currentQty + item.quantity);\n      });\n    }\n  });\n\n  // Calculate total issued quantities per item\n  requisition.materialIssues.forEach((materialIssue) => {\n    if (materialIssue.items) {\n      materialIssue.items.forEach((item) => {\n        const currentQty = issuedQuantities.get(item.itemId) || 0;\n        issuedQuantities.set(item.itemId, currentQty + item.quantity);\n      });\n    }\n  });\n\n  // Calculate remaining items with quantities > 0\n  const remainingItems = [];\n\n  requisition.items.forEach((item) => {\n    const itemId = item.itemId;\n    const originalQty = item.quantity;\n    const procuredQty = procuredQuantities.get(itemId) || 0;\n    const issuedQty = issuedQuantities.get(itemId) || 0;\n\n    const remainingQty = originalQty - procuredQty - issuedQty;\n\n    if (remainingQty > 0) {\n      remainingItems.push({\n        id: item.id,\n        requisitionId: item.requisitionId,\n        itemId: item.itemId,\n        quantity: remainingQty,\n        originalQuantity: originalQty,\n        procuredQuantity: procuredQty,\n        issuedQuantity: issuedQty,\n        Item: item.Item,\n      });\n    }\n  });\n\n  // Return only necessary details\n  return {\n    id: requisition.id,\n    requisitionNo: requisition.requisitionNo,\n    requestedAt: requisition.requestedAt,\n    requestingSiteId: requisition.requestingSiteId,\n    requestedFor: requisition.requestedFor,\n    chargeType: requisition.chargeType,\n    requestPriority: requisition.requestPriority,\n    dueDate: requisition.dueDate,\n    status: requisition.status,\n    preparedBy: requisition.preparedBy,\n    requestingSite: requisition.requestingSite,\n    items: remainingItems,\n    // Optional: Include summary for reference\n    summary: {\n      totalItems: requisition.items.length,\n      remainingItems: remainingItems.length,\n      fullyFulfilledItems: requisition.items.length - remainingItems.length,\n    },\n  };\n};\n\nconst deleteProcurement = async (id) => {\n  return await sequelize.transaction(async (t) => {\n    const procurement = await db.Procurement.findByPk(id, {\n      include: [\n        {\n          model: db.ProcurementItem,\n          include: [db.RequisitionItem],\n        },\n        { model: db.Requisition },\n      ],\n      transaction: t,\n    });\n\n    if (!procurement) {\n      throw new Error(\"Procurement not found\");\n    }\n\n    // If procurement status is \"delivered\", we need to reverse inventory changes\n    if (procurement.status === \"delivered\") {\n      let mainSite = await db.Site.findOne({\n        where: { type: \"virtual\" },\n        attributes: [\"id\"],\n      });\n      if (!mainSite?.id) {\n        const department = await db.Department.findOne({\n          where: { name: \"Mechanical\" },\n        });\n        mainSite = await db.Site.create({\n          name: \"Virtual\",\n          type: \"virtual\",\n          departmentId: department.id,\n          address: \"NA\",\n        });\n      }\n\n      for (const item of procurement.ProcurementItems) {\n        // 1. Remove from destination site (reverse the IN transaction)\n        await updateInventory(\n          {\n            siteId: procurement.Requisition.requestingSiteId,\n            itemId: item.RequisitionItem.itemId,\n            change: item.quantity,\n            type: \"OUT\", // Reverse the IN transaction\n            sourceType: \"Procurement\",\n            sourceId: id,\n            userId: null, // No user for deletion\n          },\n          t\n        );\n\n        // 2. Remove from MAIN inventory (reverse the OUT transaction)\n        await updateInventory(\n          {\n            siteId: mainSite.id, // Main inventory\n            itemId: item.RequisitionItem.itemId,\n            change: item.quantity,\n            type: \"IN\", // Reverse the OUT transaction\n            sourceType: \"Procurement\",\n            sourceId: id,\n            userId: null, // No user for deletion\n          },\n          t\n        );\n\n        // 3. Add back to main inventory (reverse the IN transaction)\n        await updateInventory(\n          {\n            siteId: mainSite.id, // Main inventory\n            itemId: item.RequisitionItem.itemId,\n            change: item.quantity,\n            type: \"OUT\", // Reverse the IN transaction\n            sourceType: \"Procurement\",\n            sourceId: id,\n            userId: null, // No user for deletion\n          },\n          t\n        );\n      }\n    }\n\n    // Delete procurement items first (due to foreign key constraints)\n    await db.ProcurementItem.destroy({\n      where: { procurementId: id },\n      transaction: t,\n    });\n\n    // Then delete the procurement itself\n    await procurement.destroy({ transaction: t });\n\n    return procurement;\n  });\n};\n\nconst createProcurementsFromComparison = async (comparisonId, userId, targetVendorId = null, selections = null) => {\n  return await sequelize.transaction(async (t) => {\n    // 1. Fetch the comparison with items and their rates\n    const comparison = await db.QuotationComparison.findByPk(comparisonId, {\n      include: [\n        {\n          model: db.QuotationComparisonItem,\n          as: \"items\",\n          include: [\n            {\n              model: db.QuotationComparisonRate,\n              as: \"rates\",\n            },\n          ],\n        },\n      ],\n      transaction: t,\n    });\n\n    if (!comparison) throw new Error(\"Comparison not found\");\n    if (comparison.status !== \"approved\" && comparison.status !== \"locked\") {\n      throw new Error(\n        \"Comparison must be approved or locked before creating procurement\"\n      );\n    }\n\n    // 2. Group items by vendor\n    const itemsByVendor = {};\n    for (const item of comparison.items) {\n      // Priority: 1. Passed selections map (as string or number key), 2. Database selectedVendorId\n      const currentSelectionId = (selections && (selections[item.id] || selections[String(item.id)])) || item.selectedVendorId;\n\n      if (!currentSelectionId) continue;\n\n      // If targeting a specific vendor, only process items for that vendor\n      if (targetVendorId && parseInt(currentSelectionId) !== parseInt(targetVendorId)) continue;\n\n      if (!itemsByVendor[currentSelectionId]) {\n        itemsByVendor[currentSelectionId] = [];\n      }\n\n      // Find the rate for this vendor\n      const rateRecord = item.rates.find(\n        (r) => r.vendorId === parseInt(currentSelectionId)\n      );\n      if (!rateRecord) continue;\n\n      itemsByVendor[currentSelectionId].push({\n        requisitionItemId: item.requisitionItemId,\n        itemId: item.itemId,\n        quantity: item.quantity,\n        rate: rateRecord.rate,\n        amount: rateRecord.amount,\n      });\n    }\n\n    // 3. Create a procurement for each vendor\n    const createdProcurements = [];\n    for (const [vendorId, items] of Object.entries(itemsByVendor)) {\n      const procurementNo = await generateProcurementNo();\n      const procurement = await db.Procurement.create(\n        {\n          requisitionId: comparison.requisitionId,\n          vendorId: parseInt(vendorId),\n          status: \"ordered\",\n          procurementNo,\n          quotationComparisonId: comparison.id,\n        },\n        { transaction: t }\n      );\n\n      const procurementItems = await db.ProcurementItem.bulkCreate(\n        items.map((item) => ({\n          ...item,\n          procurementId: procurement.id,\n        })),\n        { transaction: t }\n      );\n\n      const totalAmount = procurementItems.reduce(\n        (sum, item) => sum + Number(item.amount),\n        0\n      );\n      await procurement.update({ totalAmount }, { transaction: t });\n\n      createdProcurements.push(procurement);\n    }\n\n    // 4. Lock the comparison if not already\n    if (comparison.status !== \"locked\") {\n      await comparison.update({ status: \"locked\" }, { transaction: t });\n    }\n\n    return createdProcurements;\n  });\n};\n\nmodule.exports = {\n  createProcurement,\n  getProcurementById,\n  updateProcurementStatus,\n  listProcurements,\n  updatePaymentStatus,\n  getProcurementSummary,\n  getInventoryMovement,\n  getRequisitionWithRemainingItems,\n  deleteProcurement,\n  createProcurementsFromComparison,\n};\n","const Joi = require(\"joi\");\n\nconst createProcurementSchema = Joi.object({\n  requisitionId: Joi.number().integer().positive().required(),\n  vendorId: Joi.number().integer().positive().required(),\n  expectedDelivery: Joi.date().iso().required(),\n  notes: Joi.string(),\n  quotationComparisonId: Joi.number().integer().positive(),\n  totalAmount: Joi.number().precision(2).positive().required(),\n  items: Joi.array()\n    .items(\n      Joi.object({\n        requisitionItemId: Joi.number().integer().positive().required(),\n        itemId: Joi.number().integer().positive().required(),\n        quantity: Joi.number().integer().positive().required(),\n        rate: Joi.number().precision(2).positive().required(),\n        amount: Joi.number().precision(2).positive().required(),\n      })\n    )\n    .min(1)\n    .required(),\n});\n//   vendor: Joi.alternatives()\n//     .try(\n//       // Option 1: Full vendor object (for new vendors)\n//       Joi.object({\n//         name: Joi.string().required().min(2).max(100),\n//         email: Joi.string().email().required(),\n//         contactPerson: Joi.string().required(),\n//         phone: Joi.string().pattern(/^[+]?[\\d\\s-]{8,15}$/),\n//         address: Joi.string().max(200),\n//       }).required(),\n\n//       // Option 2: Just vendor ID (for existing vendors)\n//       Joi.number().integer().positive().required()\n//     )\n//     .required()\n//     .error(\n//       new Error(\"Either vendor ID or complete vendor details must be provided\")\n//     ),\n// }).xor(\"vendorId\", \"vendor\"); // Ensure only one vendor reference method is used\n\nconst updateStatusSchema = Joi.object({\n  status: Joi.string()\n    .valid(\n      \"pending\",\n      \"ordered\",\n      \"delivered\",\n      \"paid\",\n      \"cancelled\",\n      \"accepted_at_virtual_site\",\n      \"in_transit_to_requested_site\"\n    )\n    .required(),\n});\n\nconst listProcurementsSchema = Joi.object({\n  status: Joi.string().valid(\n    \"pending\",\n    \"ordered\",\n    \"delivered\",\n    \"paid\",\n    \"cancelled\",\n    \"accepted_at_virtual_site\",\n    \"in_transit_to_requested_site\"\n  ),\n  startDate: Joi.date().iso(),\n  endDate: Joi.date().iso(),\n  vendorId: Joi.number().integer().positive(),\n  page: Joi.number().integer().positive().default(1),\n  limit: Joi.number().integer().positive().default(10),\n});\n\nconst updatePaymentSchema = Joi.object({\n  paymentStatus: Joi.boolean().required(), // true=paid, false=unpaid\n  paymentDate: Joi.date().iso(),\n});\n\nmodule.exports = {\n  createProcurementSchema,\n  updateStatusSchema,\n  listProcurementsSchema,\n  updatePaymentSchema,\n};\n","const quotationComparisonService = require(\"./quotationComparison.service\");\n\nconst createComparison = async (req, res) => {\n  const { requisitionId } = req.body;\n  const userId = req.user.id;\n\n  const comparison = await quotationComparisonService.createComparison(\n    requisitionId,\n    userId\n  );\n  res.sendResponse(comparison, \"Quotation comparison created successfully\");\n};\n\nconst getComparison = async (req, res) => {\n  const comparison = await quotationComparisonService.getComparisonWithDetails(\n    req.params.id\n  );\n  res.sendResponse(comparison);\n};\n\nconst addVendor = async (req, res) => {\n  const { id } = req.params; // comparison id\n  const { vendorId } = req.body;\n\n  const vendor = await quotationComparisonService.addVendorToComparison(\n    id,\n    vendorId\n  );\n  res.sendResponse(vendor, \"Vendor added to comparison\");\n};\n\nconst updateRate = async (req, res) => {\n  const { id, itemId } = req.params; // comparison id and item id\n  const { vendorId, rate, remarks } = req.body;\n\n  const rateRecord = await quotationComparisonService.updateRate(\n    id,\n    itemId,\n    vendorId,\n    rate,\n    remarks\n  );\n  res.sendResponse(rateRecord, \"Rate updated successfully\");\n};\n\nconst selectVendorForItem = async (req, res) => {\n  const { id, itemId } = req.params; // comparison id and item id\n  const { vendorId } = req.body;\n\n  const item = await quotationComparisonService.selectVendorForItem(\n    id,\n    itemId,\n    vendorId\n  );\n  res.sendResponse(item, \"Vendor selected for item\");\n};\n\nconst selectVendorForAllItems = async (req, res) => {\n  const { id } = req.params; // comparison id\n  const { vendorId } = req.body;\n\n  const items = await quotationComparisonService.selectVendorForAllItems(\n    id,\n    vendorId\n  );\n  res.sendResponse(items, \"Vendor selected for all items\");\n};\n\nconst selectVendors = async (req, res) => {\n  const { id } = req.params; // comparison id\n  const { selections } = req.body;\n\n  const results = await quotationComparisonService.bulkSelectVendors(\n    id,\n    selections\n  );\n  res.sendResponse(results, \"Selections saved successfully\");\n};\n\nconst submitComparison = async (req, res) => {\n  const { id } = req.params;\n  const userId = req.user.id;\n  const { remarks } = req.body;\n\n  const comparison = await quotationComparisonService.submitComparison(\n    id,\n    userId,\n    remarks\n  );\n  res.sendResponse(comparison, \"Comparison submitted successfully\");\n};\n\nconst approveComparison = async (req, res) => {\n  const { id } = req.params;\n  const userId = req.user.id;\n  const { remarks } = req.body;\n\n  const comparison = await quotationComparisonService.approveComparison(\n    id,\n    userId,\n    remarks\n  );\n  res.sendResponse(comparison, \"Comparison approved successfully\");\n};\n\nconst lockComparison = async (req, res) => {\n  const { id } = req.params;\n  const { remarks } = req.body;\n\n  const comparison = await quotationComparisonService.lockComparison(\n    id,\n    remarks\n  );\n  res.sendResponse(comparison, \"Comparison locked successfully\");\n};\n\nconst getComparisonsForRequisition = async (req, res) => {\n  const comparisons =\n    await quotationComparisonService.getComparisonsForRequisition(\n      req.params.requisitionId\n    );\n  res.sendResponse(comparisons);\n};\n\nconst getAllComparisons = async (req, res) => {\n  const comparisons = await quotationComparisonService.getAllComparisons();\n  res.sendResponse(comparisons);\n};\n\nconst removeVendor = async (req, res) => {\n  const { id, vendorId } = req.params; // comparison id and vendor id\n\n  const result = await quotationComparisonService.removeVendorFromComparison(\n    id,\n    parseInt(vendorId)\n  );\n  res.sendResponse(result, \"Vendor removed from comparison\");\n};\n\nconst removeItem = async (req, res) => {\n  const { id, itemId } = req.params; // comparison id and item id\n\n  const result = await quotationComparisonService.removeItem(\n    parseInt(id),\n    parseInt(itemId)\n  );\n  res.sendResponse(result, \"Item removed from comparison\");\n};\n\nconst bulkUpdate = async (req, res) => {\n  const { id } = req.params; // comparison id\n  const { rates, quantities } = req.body;\n\n  const result = await quotationComparisonService.bulkUpdate(parseInt(id), {\n    rates,\n    quantities,\n  });\n  res.sendResponse(result, \"Bulk update completed successfully\");\n};\n\nconst deleteComparison = async (req, res) => {\n  const result = await quotationComparisonService.deleteComparison(\n    parseInt(req.params.id)\n  );\n  res.sendResponse(result, \"Quotation comparison deleted successfully\");\n};\n\nconst uploadVendorAttachment = async (req, res) => {\n  const { comparisonId, vendorId } = req.params;\n  const userId = req.user.id;\n  // Check if file was uploaded\n  if (!req.fileData || !req.fileData.files) {\n    return res.status(400).json({\n      success: false,\n      message: \"No file uploaded\",\n    });\n  }\n\n  // Get the first file from the files array\n  const file = Array.isArray(req.fileData.files)\n    ? req.fileData.files[0]\n    : req.fileData.files;\n\n  const attachmentData = {\n    comparisonId: parseInt(comparisonId),\n    vendorId: parseInt(vendorId),\n    file: file,\n    uploadedById: userId,\n  };\n\n  const attachment = await quotationComparisonService.uploadVendorAttachment(\n    attachmentData\n  );\n  res.sendResponse(attachment, \"Attachment uploaded successfully\");\n};\n\nconst getVendorAttachments = async (req, res) => {\n  const { comparisonId, vendorId } = req.params;\n\n  const attachments = await quotationComparisonService.getVendorAttachments(\n    parseInt(comparisonId),\n    parseInt(vendorId)\n  );\n  res.sendResponse(attachments);\n};\n\nconst deleteAttachment = async (req, res) => {\n  const { comparisonId, vendorId } = req.params; // Removed attachmentId since we're storing one per vendor\n\n  const result = await quotationComparisonService.deleteAttachment(\n    parseInt(comparisonId),\n    parseInt(vendorId)\n  );\n  res.sendResponse(result, \"Attachment deleted successfully\");\n};\n\nconst downloadAttachment = async (req, res) => {\n  const { comparisonId, vendorId } = req.params; // Removed attachmentId since we're storing one per vendor\n\n  const attachment = await quotationComparisonService.getAttachmentById(\n    parseInt(comparisonId),\n    parseInt(vendorId)\n  );\n\n  if (!attachment || !attachment.attachmentFilePath) {\n    return res.status(404).json({\n      success: false,\n      message: \"Attachment not found\",\n    });\n  }\n\n  // Redirect to the Cloudinary URL for download\n  res.redirect(attachment.attachmentFilePath);\n};\n\nmodule.exports = {\n  createComparison,\n  getComparison,\n  addVendor,\n  updateRate,\n  selectVendorForItem,\n  selectVendorForAllItems,\n  selectVendors,\n  submitComparison,\n  approveComparison,\n  lockComparison,\n  getComparisonsForRequisition,\n  getAllComparisons,\n  removeVendor,\n  removeItem,\n  bulkUpdate,\n  deleteComparison,\n  uploadVendorAttachment,\n  getVendorAttachments,\n  deleteAttachment,\n  downloadAttachment,\n};\n","const router = require(\"express\").Router();\nconst asyncMiddleware = require(\"../../middlewares/asyncMiddleware\");\nconst quotationComparisonController = require(\"./quotationComparison.controller\");\nconst validateRequest = require(\"../../middlewares/validateRequest\");\nconst auth = require(\"../../middlewares/tokenValidator\");\nconst hasRole = require(\"../../middlewares/hasRole\");\nconst {\n  fileUploadMiddleware,\n  upload,\n} = require(\"../../middlewares/fileUploadMiddleware\");\nconst {\n  createQuotationComparisonSchema,\n  addVendorSchema,\n  updateRateSchema,\n  selectVendorForItemSchema,\n  selectVendorForAllItemsSchema,\n  selectVendorsSchema,\n  submitComparisonSchema,\n  approveComparisonSchema,\n  lockComparisonSchema,\n  bulkUpdateSchema,\n  removeVendorSchema,\n  getRequisitionComparisonsSchema,\n  deleteComparisonSchema,\n  getVendorAttachmentsSchema,\n  deleteAttachmentSchema,\n  downloadAttachmentSchema,\n} = require(\"./quotationComparison.validator\");\n\n// Routes\n// Create a new quotation comparison from a requisition\nrouter.post(\n  \"/\",\n  auth,\n  hasRole([2, 3]), // Mechanical Head, Mechanical Manager\n  validateRequest(createQuotationComparisonSchema),\n  asyncMiddleware(quotationComparisonController.createComparison)\n);\n\n// Get a specific quotation comparison\nrouter.get(\n  \"/:id\",\n  auth,\n  asyncMiddleware(quotationComparisonController.getComparison)\n);\n\n// Add vendor to comparison\nrouter.post(\n  \"/:id/vendors\",\n  auth,\n  validateRequest(addVendorSchema),\n  asyncMiddleware(quotationComparisonController.addVendor)\n);\n\n// Remove vendor from comparison\nrouter.delete(\n  \"/:id/vendors/:vendorId\",\n  auth,\n  // validateRequest(removeVendorSchema),\n  asyncMiddleware(quotationComparisonController.removeVendor)\n);\n\n// Update rate for a specific item and vendor\nrouter.put(\n  \"/:id/items/:itemId/rates\",\n  auth,\n  validateRequest(updateRateSchema),\n  asyncMiddleware(quotationComparisonController.updateRate)\n);\n\n// Select vendor for an item\nrouter.put(\n  \"/:id/items/:itemId/vendor\",\n  auth,\n  validateRequest(selectVendorForItemSchema),\n  asyncMiddleware(quotationComparisonController.selectVendorForItem)\n);\n\n// Select vendor for all items in comparison\nrouter.post(\n  \"/:id/select-vendor-for-all\",\n  auth,\n  validateRequest(selectVendorForAllItemsSchema),\n  asyncMiddleware(quotationComparisonController.selectVendorForAllItems)\n);\n\n// Bulk select vendors for items\nrouter.put(\n  \"/:id/bulk-select\",\n  auth,\n  validateRequest(selectVendorsSchema),\n  asyncMiddleware(quotationComparisonController.selectVendors)\n);\n\n// Submit comparison for approval\nrouter.put(\n  \"/:id/submit\",\n  auth,\n  hasRole([2, 3]), // Mechanical Head, Mechanical Manager\n  validateRequest(submitComparisonSchema),\n  asyncMiddleware(quotationComparisonController.submitComparison)\n);\n\n// Approve comparison\nrouter.put(\n  \"/:id/approve\",\n  auth,\n  hasRole([1]), // Admin\n  validateRequest(approveComparisonSchema),\n  asyncMiddleware(quotationComparisonController.approveComparison)\n);\n\n// Lock comparison after final approval\nrouter.put(\n  \"/:id/lock\",\n  auth,\n  hasRole([1]), // Admin\n  validateRequest(lockComparisonSchema),\n  asyncMiddleware(quotationComparisonController.lockComparison)\n);\n\n// Get all comparisons for a requisition\nrouter.get(\n  \"/requisition/:requisitionId\",\n  auth,\n  // validateRequest(getRequisitionComparisonsSchema),\n  asyncMiddleware(quotationComparisonController.getComparisonsForRequisition)\n);\n\n// Get all comparisons\nrouter.get(\"/\", auth, asyncMiddleware(quotationComparisonController.getAllComparisons));\n\n// Remove item from comparison\nrouter.delete(\n  \"/:id/items/:itemId\",\n  auth,\n  asyncMiddleware(quotationComparisonController.removeItem)\n);\n\n// Bulk update rates and quantities\nrouter.put(\n  \"/:id/bulk-update\",\n  auth,\n  validateRequest(bulkUpdateSchema),\n  asyncMiddleware(quotationComparisonController.bulkUpdate)\n);\n\n// Delete quotation comparison\nrouter.delete(\n  \"/:id\",\n  auth,\n  // validateRequest(deleteComparisonSchema),\n  asyncMiddleware(quotationComparisonController.deleteComparison)\n);\n\n// Upload vendor attachment\nrouter.post(\n  \"/:comparisonId/vendors/:vendorId/attachments\",\n  auth,\n  upload.fields([{ name: \"files\", maxCount: 5 }]),\n  fileUploadMiddleware([\"files\"], \"quotationComparison\", \"vendor-attachments\"),\n  asyncMiddleware(quotationComparisonController.uploadVendorAttachment)\n);\n\n// Get vendor attachments\nrouter.get(\n  \"/:comparisonId/vendors/:vendorId/attachments\",\n  auth,\n  // validateRequest(getVendorAttachmentsSchema),\n  asyncMiddleware(quotationComparisonController.getVendorAttachments)\n);\n\n// Delete attachment\nrouter.delete(\n  \"/:comparisonId/vendors/:vendorId/attachments\",\n  auth,\n  // validateRequest(deleteAttachmentSchema),\n  asyncMiddleware(quotationComparisonController.deleteAttachment)\n);\n\n// Download attachment\nrouter.get(\n  \"/:comparisonId/vendors/:vendorId/attachments/download\",\n  auth,\n  // validateRequest(downloadAttachmentSchema),\n  asyncMiddleware(quotationComparisonController.downloadAttachment)\n);\n\nmodule.exports = router;\n","const db = require(\"../../models\");\nconst { Op } = require(\"sequelize\");\nconst cloudinary = require(\"../../utils/cloudinary\");\nconst fs = require(\"fs\");\n\nclass QuotationComparisonService {\n  // Create a new quotation comparison from a requisition\n  async createComparison(requisitionId, userId) {\n    try {\n      // Get the requisition with items\n      const requisition = await db.Requisition.findByPk(requisitionId, {\n        include: [\n          {\n            model: db.RequisitionItem,\n            as: \"items\",\n            include: [\n              {\n                model: db.Item,\n                include: { model: db.Unit },\n              },\n            ],\n          },\n        ],\n      });\n\n      if (!requisition) {\n        throw new Error(\"Requisition not found\");\n      }\n\n      // Create the quotation comparison\n      const comparison = await db.QuotationComparison.create({\n        requisitionId: requisitionId,\n        submittedById: userId,\n        status: \"draft\",\n      });\n\n      // Create comparison items from requisition items\n      for (const reqItem of requisition.items) {\n        await db.QuotationComparisonItem.create({\n          comparisonId: comparison.id,\n          requisitionItemId: reqItem.id,\n          itemId: reqItem.itemId,\n          description:\n            reqItem.Item.name ||\n            reqItem.Item.description ||\n            `Item ${reqItem.itemId}`,\n          unit: reqItem.Item.Unit.name || \"NOS\", // Default to NOS if no unit\n          quantity: reqItem.quantity,\n        });\n      }\n\n      // Return the comparison with items\n      return await this.getComparisonWithDetails(comparison.id);\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  // Get comparison with all details\n  async getComparisonWithDetails(id) {\n    try {\n      const comparison = await db.QuotationComparison.findByPk(id, {\n        include: [\n          {\n            model: db.Requisition,\n            as: \"requisition\",\n            include: [\n              {\n                model: db.Site,\n                as: \"requestingSite\",\n              },\n            ],\n          },\n          {\n            model: db.User,\n            as: \"submittedBy\",\n            attributes: [\"id\", \"name\", \"email\"],\n          },\n          {\n            model: db.User,\n            as: \"approvedBy\",\n            attributes: [\"id\", \"name\", \"email\"],\n          },\n          {\n            model: db.QuotationComparisonItem,\n            as: \"items\",\n            include: [\n              {\n                model: db.Item,\n                as: \"item\",\n                attributes: [\"id\", \"name\"],\n                include: { model: db.Unit },\n              },\n              {\n                model: db.QuotationComparisonRate,\n                as: \"rates\",\n                include: [\n                  {\n                    model: db.Vendor,\n                    as: \"vendor\",\n                    attributes: [\n                      \"id\",\n                      \"name\",\n                      \"email\",\n                      \"contactPerson\",\n                      \"phone\",\n                    ],\n                  },\n                ],\n              },\n            ],\n            order: [[db.QuotationComparisonRate, \"id\", \"ASC\"]],\n          },\n          {\n            model: db.QuotationComparisonVendor,\n            as: \"vendors\",\n            include: [\n              {\n                model: db.Vendor,\n                as: \"vendor\",\n              },\n            ],\n          },\n        ],\n      });\n\n      if (!comparison) {\n        throw new Error(\"Quotation comparison not found\");\n      }\n\n      // Calculate totals and update lowest rates\n      await this.calculateTotalsAndLowestRates(comparison.id);\n\n      // Re-fetch with updated data\n      return await db.QuotationComparison.findByPk(id, {\n        include: [\n          {\n            model: db.Requisition,\n            as: \"requisition\",\n            include: [\n              {\n                model: db.Site,\n                as: \"requestingSite\",\n              },\n            ],\n          },\n          {\n            model: db.User,\n            as: \"submittedBy\",\n            attributes: [\"id\", \"name\", \"email\"],\n          },\n          {\n            model: db.User,\n            as: \"approvedBy\",\n            attributes: [\"id\", \"name\", \"email\"],\n          },\n          {\n            model: db.QuotationComparisonItem,\n            as: \"items\",\n            include: [\n              {\n                model: db.Item,\n                as: \"item\",\n                attributes: [\"id\", \"name\"],\n                include: { model: db.Unit },\n              },\n              {\n                model: db.QuotationComparisonRate,\n                as: \"rates\",\n                include: [\n                  {\n                    model: db.Vendor,\n                    as: \"vendor\",\n                    attributes: [\n                      \"id\",\n                      \"name\",\n                      \"email\",\n                      \"contactPerson\",\n                      \"phone\",\n                    ],\n                  },\n                ],\n              },\n            ],\n            order: [[db.QuotationComparisonRate, \"id\", \"ASC\"]],\n          },\n          {\n            model: db.QuotationComparisonVendor,\n            as: \"vendors\",\n            include: [\n              {\n                model: db.Vendor,\n                as: \"vendor\",\n              },\n            ],\n          },\n        ],\n      });\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  // Add vendor to comparison\n  async addVendorToComparison(comparisonId, vendorId) {\n    try {\n      const vendor = await db.Vendor.findByPk(vendorId);\n      if (!vendor) {\n        throw new Error(\"Vendor not found\");\n      }\n\n      const existingVendor = await db.QuotationComparisonVendor.findOne({\n        where: {\n          comparisonId,\n          vendorId,\n        },\n      });\n\n      if (existingVendor) {\n        throw new Error(\"Vendor already added to this comparison\");\n      }\n\n      const comparisonVendor = await db.QuotationComparisonVendor.create({\n        comparisonId,\n        vendorId,\n        vendorName: vendor.name,\n      });\n\n      return comparisonVendor;\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  // Update rate for a specific item and vendor\n  async updateRate(\n    comparisonId,\n    comparisonItemId,\n    vendorId,\n    rate,\n    remarks = null\n  ) {\n    try {\n      const comparisonItem = await db.QuotationComparisonItem.findByPk(\n        comparisonItemId\n      );\n\n      if (!comparisonItem || comparisonItem.comparisonId != comparisonId) {\n        throw new Error(\"Invalid comparison item\");\n      }\n\n      // Check if vendor exists in this comparison\n      const comparisonVendor = await db.QuotationComparisonVendor.findOne({\n        where: {\n          comparisonId,\n          vendorId,\n        },\n      });\n\n      if (!comparisonVendor) {\n        throw new Error(\"Vendor not associated with this comparison\");\n      }\n\n      const amount = parseFloat(rate) * comparisonItem.quantity;\n\n      // Check if rate record already exists\n      let rateRecord = await db.QuotationComparisonRate.findOne({\n        where: {\n          comparisonItemId,\n          vendorId,\n        },\n      });\n\n      if (rateRecord) {\n        // Update existing rate\n        await rateRecord.update({\n          rate: parseFloat(rate),\n          amount: parseFloat(amount),\n          remarks,\n        });\n      } else {\n        // Create new rate\n        rateRecord = await db.QuotationComparisonRate.create({\n          comparisonItemId,\n          vendorId,\n          rate: parseFloat(rate),\n          amount: parseFloat(amount),\n          remarks,\n        });\n      }\n\n      // Calculate totals and update lowest rates\n      await this.calculateTotalsAndLowestRates(comparisonId);\n\n      return rateRecord;\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  // Calculate totals and mark lowest rates\n  async calculateTotalsAndLowestRates(comparisonId) {\n    try {\n      // Get all items for this comparison\n      const items = await db.QuotationComparisonItem.findAll({\n        where: { comparisonId },\n        include: [\n          {\n            model: db.QuotationComparisonRate,\n            as: \"rates\",\n            include: [\n              {\n                model: db.Vendor,\n                as: \"vendor\",\n              },\n            ],\n          },\n        ],\n      });\n\n      // Reset all isLowest flags\n      await db.QuotationComparisonRate.update(\n        { isLowest: false },\n        {\n          where: {\n            comparisonItemId: { [Op.in]: items.map((item) => item.id) },\n          },\n        }\n      );\n\n      // Calculate totals for each vendor and find lowest rates\n      const vendorTotals = {};\n\n      for (const item of items) {\n        // Find the lowest rate for this item\n        if (item.rates && item.rates.length > 0) {\n          // Sort rates by amount to find the lowest\n          const sortedRates = [...item.rates].sort(\n            (a, b) => a.amount - b.amount\n          );\n          const lowestRate = sortedRates[0];\n\n          // Mark the lowest rate\n          await db.QuotationComparisonRate.update(\n            { isLowest: true },\n            { where: { id: lowestRate.id } }\n          );\n\n          // Add to vendor totals\n          for (const rate of item.rates) {\n            if (!vendorTotals[rate.vendorId]) {\n              vendorTotals[rate.vendorId] = 0;\n            }\n            vendorTotals[rate.vendorId] += parseFloat(rate.amount);\n          }\n        }\n      }\n\n      // Update vendor totals\n      for (const [vendorId, total] of Object.entries(vendorTotals)) {\n        await db.QuotationComparisonVendor.update(\n          { totalAmount: total },\n          {\n            where: {\n              comparisonId,\n              vendorId,\n            },\n          }\n        );\n      }\n\n      // Calculate overall total (lowest rate for each item)\n      let overallTotal = 0;\n      for (const item of items) {\n        if (item.rates && item.rates.length > 0) {\n          const lowestRate = item.rates.reduce(\n            (lowest, rate) => (rate.amount < lowest.amount ? rate : lowest),\n            item.rates[0]\n          );\n          overallTotal += parseFloat(lowestRate.amount);\n        }\n      }\n\n      // Update comparison total\n      await db.QuotationComparison.update(\n        { totalAmount: overallTotal },\n        { where: { id: comparisonId } }\n      );\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  // Select vendor for a specific item\n  async selectVendorForItem(comparisonId, comparisonItemId, vendorId) {\n    try {\n      const comparisonItem = await db.QuotationComparisonItem.findByPk(\n        comparisonItemId\n      );\n      if (!comparisonItem || comparisonItem.comparisonId != comparisonId) {\n        throw new Error(\"Invalid comparison item\");\n      }\n\n      // Check if vendor exists in this comparison\n      const comparisonVendor = await db.QuotationComparisonVendor.findOne({\n        where: {\n          comparisonId,\n          vendorId,\n        },\n      });\n\n      if (!comparisonVendor) {\n        throw new Error(\"Vendor not associated with this comparison\");\n      }\n\n      // Update the selected vendor for this item\n      await comparisonItem.update({\n        selectedVendorId: vendorId,\n        selected: true,\n      });\n\n      return comparisonItem;\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  // Select vendor for multiple items in comparison (Bulk)\n  async bulkSelectVendors(comparisonId, selections) {\n    try {\n      const results = [];\n      const itemIds = Object.keys(selections);\n\n      for (const itemId of itemIds) {\n        const vendorId = selections[itemId];\n        const item = await this.selectVendorForItem(\n          parseInt(comparisonId),\n          parseInt(itemId),\n          parseInt(vendorId)\n        );\n        results.push(item);\n      }\n\n      return results;\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  // Select vendor for all items in comparison\n  async selectVendorForAllItems(comparisonId, vendorId) {\n    try {\n      // Check if vendor exists in this comparison\n      const comparisonVendor = await db.QuotationComparisonVendor.findOne({\n        where: {\n          comparisonId,\n          vendorId,\n        },\n      });\n\n      if (!comparisonVendor) {\n        throw new Error(\"Vendor not associated with this comparison\");\n      }\n\n      // Get all items for this comparison\n      const items = await db.QuotationComparisonItem.findAll({\n        where: { comparisonId },\n      });\n\n      if (items.length === 0) {\n        throw new Error(\"No items found in this comparison\");\n      }\n\n      // Update all items to use the selected vendor\n      for (const item of items) {\n        await item.update({\n          selectedVendorId: vendorId,\n          selected: true,\n        });\n      }\n\n      // Return updated items\n      return items;\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  // Submit comparison for approval\n  async submitComparison(comparisonId, userId, remarks = null) {\n    try {\n      const comparison = await db.QuotationComparison.findByPk(comparisonId);\n      if (!comparison) {\n        throw new Error(\"Comparison not found\");\n      }\n\n      if (comparison.status !== \"draft\") {\n        throw new Error(\"Comparison can only be submitted from draft status\");\n      }\n\n      await comparison.update({\n        status: \"submitted\",\n        submittedById: userId,\n        submittedAt: new Date(),\n        submissionRemarks: remarks || comparison.submissionRemarks,\n        remarks: remarks || comparison.remarks,\n      });\n\n      return comparison;\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  // Approve comparison\n  async approveComparison(comparisonId, userId, remarks = null) {\n    try {\n      const comparison = await db.QuotationComparison.findByPk(comparisonId);\n      if (!comparison) {\n        throw new Error(\"Comparison not found\");\n      }\n\n      if (comparison.status !== \"submitted\") {\n        throw new Error(\"Comparison must be submitted before approval\");\n      }\n\n      await comparison.update({\n        status: \"approved\",\n        approvedById: userId,\n        approvedAt: new Date(),\n        approvalRemarks: remarks || comparison.approvalRemarks,\n        remarks: remarks || comparison.remarks,\n      });\n\n      return comparison;\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  // Lock comparison after final approval\n  async lockComparison(comparisonId, remarks = null) {\n    try {\n      const comparison = await db.QuotationComparison.findByPk(comparisonId);\n      if (!comparison) {\n        throw new Error(\"Comparison not found\");\n      }\n\n      if (comparison.status !== \"approved\") {\n        throw new Error(\"Comparison must be approved before locking\");\n      }\n\n      await comparison.update({\n        status: \"locked\",\n        lockRemarks: remarks || comparison.lockRemarks,\n        remarks: remarks || comparison.remarks,\n      });\n\n      return comparison;\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  // Get all comparisons for a requisition\n  async getComparisonsForRequisition(requisitionId) {\n    try {\n      return await db.QuotationComparison.findAll({\n        where: { requisitionId },\n        include: [\n          {\n            model: db.User,\n            as: \"submittedBy\",\n            attributes: [\"id\", \"name\", \"email\"],\n          },\n          {\n            model: db.User,\n            as: \"approvedBy\",\n            attributes: [\"id\", \"name\", \"email\"],\n          },\n          {\n            model: db.QuotationComparisonVendor,\n            as: \"vendors\",\n            include: [\n              {\n                model: db.Vendor,\n                as: \"vendor\",\n              },\n            ],\n          },\n        ],\n        order: [[\"createdAt\", \"DESC\"]],\n      });\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  // Get all comparisons\n  async getAllComparisons() {\n    try {\n      return await db.QuotationComparison.findAll({\n        attributes: [\"id\", \"requisitionId\", \"status\", \"createdAt\", \"comparisonNo\", \"totalAmount\"],\n        include: [\n          {\n            model: db.Requisition,\n            as: \"requisition\",\n            attributes: [\"requisitionNo\"],\n          },\n          {\n            model: db.QuotationComparisonVendor,\n            as: \"vendors\",\n            attributes: [\"vendorName\", \"totalAmount\"],\n          },\n        ],\n        order: [[\"createdAt\", \"DESC\"]],\n      });\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  // Remove vendor from comparison\n  async removeVendorFromComparison(comparisonId, vendorId) {\n    try {\n      // Check if vendor exists in this comparison\n      const comparisonVendor = await db.QuotationComparisonVendor.findOne({\n        where: {\n          comparisonId,\n          vendorId,\n        },\n      });\n\n      if (!comparisonVendor) {\n        throw new Error(\"Vendor not associated with this comparison\");\n      }\n\n      // Delete all rate records for this vendor in this comparison\n      const items = await db.QuotationComparisonItem.findAll({\n        where: { comparisonId },\n      });\n\n      for (const item of items) {\n        await db.QuotationComparisonRate.destroy({\n          where: {\n            comparisonItemId: item.id,\n            vendorId: vendorId,\n          },\n        });\n      }\n\n      // Delete the vendor from the comparison\n      await db.QuotationComparisonVendor.destroy({\n        where: {\n          comparisonId,\n          vendorId,\n        },\n      });\n\n      // Calculate totals and update lowest rates after removing vendor\n      await this.calculateTotalsAndLowestRates(comparisonId);\n\n      return { message: \"Vendor removed successfully\" };\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  // Remove item from comparison\n  async removeItem(comparisonId, itemId) {\n    try {\n      // Check if the item exists and belongs to the comparison\n      const item = await db.QuotationComparisonItem.findByPk(itemId);\n      if (!item || item.comparisonId !== comparisonId) {\n        throw new Error(\"Item not found in this comparison\");\n      }\n\n      // Delete all rate records associated with this item\n      await db.QuotationComparisonRate.destroy({\n        where: {\n          comparisonItemId: itemId,\n        },\n      });\n\n      // Delete the item itself\n      await db.QuotationComparisonItem.destroy({\n        where: {\n          id: itemId,\n          comparisonId: comparisonId,\n        },\n      });\n\n      // Recalculate totals and update lowest rates after removing item\n      await this.calculateTotalsAndLowestRates(comparisonId);\n\n      return { message: \"Item removed successfully\" };\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  // Bulk update rates and quantities\n  async bulkUpdate(comparisonId, data) {\n    try {\n      const { rates = [], quantities = [] } = data;\n\n      // Update rates\n      for (const rateData of rates) {\n        const { itemId, vendorId, rate, remarks = null } = rateData;\n\n        // Verify the item belongs to the comparison\n        const comparisonItem = await db.QuotationComparisonItem.findByPk(\n          itemId\n        );\n        if (!comparisonItem || comparisonItem.comparisonId !== comparisonId) {\n          throw new Error(`Item ${itemId} not found in this comparison`);\n        }\n\n        // Check if vendor exists in this comparison\n        const comparisonVendor = await db.QuotationComparisonVendor.findOne({\n          where: {\n            comparisonId,\n            vendorId,\n          },\n        });\n\n        if (!comparisonVendor) {\n          throw new Error(\n            `Vendor ${vendorId} not associated with this comparison`\n          );\n        }\n\n        // Calculate amount\n        const amount = parseFloat(rate) * comparisonItem.quantity;\n\n        // Check if rate record already exists\n        let rateRecord = await db.QuotationComparisonRate.findOne({\n          where: {\n            comparisonItemId: itemId,\n            vendorId,\n          },\n        });\n\n        if (rateRecord) {\n          // Update existing rate\n          await rateRecord.update({\n            rate: parseFloat(rate),\n            amount: parseFloat(amount),\n            remarks,\n          });\n        } else {\n          // Create new rate\n          await db.QuotationComparisonRate.create({\n            comparisonItemId: itemId,\n            vendorId,\n            rate: parseFloat(rate),\n            amount: parseFloat(amount),\n            remarks,\n          });\n        }\n      }\n      // Update quantities\n      for (const quantityData of quantities) {\n        const { itemId, quantity } = quantityData;\n\n        // Verify the item belongs to the comparison\n        const comparisonItem = await db.QuotationComparisonItem.findByPk(\n          itemId\n        );\n\n        if (!comparisonItem || comparisonItem.comparisonId !== comparisonId) {\n          throw new Error(`Item ${itemId} not found in this comparison`);\n        }\n\n        // Update the quantity\n        await comparisonItem.update({\n          quantity: parseFloat(quantity),\n        });\n\n        // Update amounts for all rates of this item based on the new quantity\n        const ratesForItem = await db.QuotationComparisonRate.findAll({\n          where: {\n            comparisonItemId: itemId,\n          },\n        });\n\n        for (const rate of ratesForItem) {\n          const newAmount = rate.rate * parseFloat(quantity);\n          await rate.update({\n            amount: parseFloat(newAmount),\n          });\n        }\n      }\n\n      // Calculate totals and update lowest rates after all updates\n      await this.calculateTotalsAndLowestRates(comparisonId);\n\n      return { message: \"Bulk update completed successfully\" };\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  // Delete quotation comparison\n  async deleteComparison(id) {\n    try {\n      const comparison = await db.QuotationComparison.findByPk(id);\n      if (!comparison) {\n        throw new Error(\"Quotation comparison not found\");\n      }\n      // Delete all related records in the correct order to respect foreign key constraints\n      // First delete rates\n      await db.QuotationComparisonRate.destroy({\n        where: {\n          comparisonItemId: {\n            [Op.in]: db.sequelize.literal(\n              `(SELECT id FROM quotation_comparison_items WHERE \"comparisonId\" = ${id})`\n            ),\n          },\n        },\n      });\n\n      // Then delete comparison items\n      await db.QuotationComparisonItem.destroy({\n        where: { comparisonId: id },\n      });\n      // Then delete vendors associated with this comparison\n      await db.QuotationComparisonVendor.destroy({\n        where: { comparisonId: id },\n      });\n\n      // Finally delete the comparison itself\n      await db.QuotationComparison.destroy({\n        where: { id },\n      });\n\n      return { message: \"Quotation comparison deleted successfully\" };\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  // Upload vendor attachment\n  async uploadVendorAttachment(attachmentData) {\n    try {\n      const { comparisonId, vendorId, file, uploadedById } = attachmentData;\n\n      // Check if the vendor is associated with the comparison\n      const comparisonVendor = await db.QuotationComparisonVendor.findOne({\n        where: {\n          comparisonId,\n          vendorId,\n        },\n      });\n\n      if (!comparisonVendor) {\n        throw new Error(\"Vendor not associated with this comparison\");\n      }\n\n      // Update the comparison vendor record with attachment details\n      await comparisonVendor.update({\n        attachmentFilePath: file, // Store Cloudinary URL\n        attachmentUploadedAt: new Date(),\n        attachmentUploadedById: uploadedById,\n      });\n\n      // Return the updated vendor record with attachment details\n      return await db.QuotationComparisonVendor.findByPk(comparisonVendor.id, {\n        include: [\n          {\n            model: db.Vendor,\n            as: \"vendor\",\n          },\n          {\n            model: db.User,\n            as: \"attachmentUploadedBy\",\n            attributes: [\"id\", \"name\", \"email\"],\n          },\n        ],\n      });\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  // Get vendor attachments - now returns the attachment info from the vendor record\n  async getVendorAttachments(comparisonId, vendorId) {\n    try {\n      // Check if the vendor is associated with the comparison\n      const comparisonVendor = await db.QuotationComparisonVendor.findOne({\n        where: {\n          comparisonId,\n          vendorId,\n        },\n        include: [\n          {\n            model: db.Vendor,\n            as: \"vendor\",\n          },\n          {\n            model: db.User,\n            as: \"attachmentUploadedBy\",\n            attributes: [\"id\", \"name\", \"email\"],\n          },\n        ],\n      });\n\n      if (!comparisonVendor) {\n        throw new Error(\"Vendor not associated with this comparison\");\n      }\n      // Return the attachment information if it exists\n      if (comparisonVendor.attachmentFilePath) {\n        return [comparisonVendor]; // Return as array for consistency\n      } else {\n        return []; // Return empty array if no attachment\n      }\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  // Delete attachment\n  async deleteAttachment(comparisonId, vendorId) {\n    try {\n      // Check if the vendor is associated with the comparison\n      const comparisonVendor = await db.QuotationComparisonVendor.findOne({\n        where: {\n          comparisonId,\n          vendorId,\n        },\n      });\n\n      if (!comparisonVendor) {\n        throw new Error(\"Vendor not associated with this comparison\");\n      }\n\n      // If there's an attachment, delete it from Cloudinary\n      if (comparisonVendor.attachmentFilePath) {\n        // Extract public ID from the Cloudinary URL for deletion\n        const publicId = comparisonVendor.attachmentFilePath\n          .split(\"/\")\n          .pop()\n          .split(\".\")[0];\n        await cloudinary.uploader.destroy(publicId);\n      }\n\n      // Clear the attachment fields in the database\n      await comparisonVendor.update({\n        attachmentFileName: null,\n        attachmentFilePath: null,\n        attachmentFileSize: null,\n        attachmentMimeType: null,\n        attachmentUploadedAt: null,\n        attachmentUploadedById: null,\n      });\n\n      return { message: \"Attachment deleted successfully\" };\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  // Get attachment by vendorId (since we're storing one attachment per vendor)\n  async getAttachmentByVendorId(comparisonId, vendorId) {\n    try {\n      const comparisonVendor = await db.QuotationComparisonVendor.findOne({\n        where: {\n          comparisonId,\n          vendorId,\n        },\n        include: [\n          {\n            model: db.Vendor,\n            as: \"vendor\",\n          },\n          {\n            model: db.User,\n            as: \"attachmentUploadedBy\",\n            attributes: [\"id\", \"name\", \"email\"],\n          },\n        ],\n      });\n\n      return comparisonVendor;\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  // Get attachment by ID (for download functionality)\n  async getAttachmentById(comparisonId, vendorId) {\n    try {\n      const comparisonVendor = await db.QuotationComparisonVendor.findOne({\n        where: {\n          comparisonId,\n          vendorId,\n        },\n        include: [\n          {\n            model: db.Vendor,\n            as: \"vendor\",\n          },\n          {\n            model: db.User,\n            as: \"attachmentUploadedBy\",\n            attributes: [\"id\", \"name\", \"email\"],\n          },\n        ],\n      });\n\n      return comparisonVendor;\n    } catch (error) {\n      throw error;\n    }\n  }\n}\n\nmodule.exports = new QuotationComparisonService();\n","const Joi = require(\"joi\");\n\nconst createQuotationComparisonSchema = Joi.object({\n  requisitionId: Joi.number().integer().positive().required(),\n});\n\nconst addVendorSchema = Joi.object({\n  vendorId: Joi.number().integer().positive().required(),\n});\n\nconst updateRateSchema = Joi.object({\n  vendorId: Joi.number().integer().positive().required(),\n  rate: Joi.number().precision(2).positive().required(),\n  remarks: Joi.string().allow(\"\").optional(),\n});\n\nconst selectVendorForItemSchema = Joi.object({\n  vendorId: Joi.number().integer().positive().required(),\n});\n\nconst selectVendorForAllItemsSchema = Joi.object({\n  vendorId: Joi.number().integer().positive().required(),\n});\n\nconst selectVendorsSchema = Joi.object({\n  selections: Joi.object().pattern(\n    Joi.string().regex(/^\\d+$/),\n    Joi.number().integer().positive()\n  ).required(),\n});\n\nconst submitComparisonSchema = Joi.object({\n  remarks: Joi.string().allow(\"\").optional(),\n});\n\nconst approveComparisonSchema = Joi.object({\n  remarks: Joi.string().allow(\"\").optional(),\n});\n\nconst lockComparisonSchema = Joi.object({\n  remarks: Joi.string().allow(\"\").optional(),\n});\n\nconst updateComparisonStatusSchema = Joi.object({\n  status: Joi.string().valid(\"draft\", \"submitted\", \"approved\", \"locked\").required(),\n});\n\nconst listComparisonsSchema = Joi.object({\n  status: Joi.string().valid(\"draft\", \"submitted\", \"approved\", \"locked\"),\n  requisitionId: Joi.number().integer().positive(),\n  page: Joi.number().integer().positive().default(1),\n  limit: Joi.number().integer().positive().default(10),\n});\n\nconst removeVendorSchema = Joi.object({\n  vendorId: Joi.number().integer().positive().required(),\n});\n\nconst updateItemQuantitySchema = Joi.object({\n  quantity: Joi.number().integer().positive().required(),\n});\n\nconst bulkUpdateSchema = Joi.object({\n  rates: Joi.array().items(\n    Joi.object({\n      itemId: Joi.number().integer().positive().required(),\n      vendorId: Joi.number().integer().positive().required(),\n      rate: Joi.number().precision(2).positive().required(),\n      remarks: Joi.string().allow(\"\").optional(),\n    })\n  ),\n  quantities: Joi.array().items(\n    Joi.object({\n      itemId: Joi.number().integer().positive().required(),\n      quantity: Joi.number().integer().positive().required(),\n    })\n  ),\n});\n\nconst getRequisitionComparisonsSchema = Joi.object({\n  requisitionId: Joi.number().integer().positive().required(),\n});\n\nconst deleteComparisonSchema = Joi.object();\n\nconst removeItemSchema = Joi.object();\n\nconst getVendorAttachmentsSchema = Joi.object();\n\nconst deleteAttachmentSchema = Joi.object();\n\nconst uploadVendorAttachmentSchema = Joi.object();\n\nconst downloadAttachmentSchema = Joi.object();\n\nmodule.exports = {\n  createQuotationComparisonSchema,\n  addVendorSchema,\n  updateRateSchema,\n  selectVendorForItemSchema,\n  selectVendorForAllItemsSchema,\n  selectVendorsSchema,\n  submitComparisonSchema,\n  approveComparisonSchema,\n  lockComparisonSchema,\n  updateComparisonStatusSchema,\n  listComparisonsSchema,\n  removeVendorSchema,\n  updateItemQuantitySchema,\n  bulkUpdateSchema,\n  getRequisitionComparisonsSchema,\n  deleteComparisonSchema,\n  removeItemSchema,\n  getVendorAttachmentsSchema,\n  deleteAttachmentSchema,\n  downloadAttachmentSchema,\n  uploadVendorAttachmentSchema,\n};\n","const reportsService = require(\"./reports.service\");\n\n// Machine Management Reports\nconst getMachineUtilization = async (req, res) => {\n  const report = await reportsService.getMachineUtilization(req.query);\n  res.sendResponse(report, \"Machine utilization report retrieved successfully\");\n};\n\nconst getMachineMaintenanceReport = async (req, res) => {\n  const report = await reportsService.getMachineMaintenanceReport(req.query);\n  res.sendResponse(report, \"Machine maintenance report retrieved successfully\");\n};\n\nconst getMachineTransferReport = async (req, res) => {\n  const report = await reportsService.getMachineTransferReport(req.query);\n  res.sendResponse(report, \"Machine transfer report retrieved successfully\");\n};\n\nconst getMachineComplianceReport = async (req, res) => {\n  const report = await reportsService.getMachineComplianceReport(req.query);\n  res.sendResponse(report, \"Machine compliance report retrieved successfully\");\n};\n\nconst getLogbookReport = async (req, res) => {\n  const report = await reportsService.getLogbookReport(req.query);\n  res.sendResponse(report, \"Logbook report retrieved successfully\");\n};\n\n// Inventory Management Reports\nconst getInventoryStockReport = async (req, res) => {\n  const report = await reportsService.getInventoryStockReport(req.query);\n  res.sendResponse(report, \"Inventory stock report retrieved successfully\");\n};\n\nconst getInventoryConsumptionReport = async (req, res) => {\n  const report = await reportsService.getInventoryConsumptionReport(req.query);\n  res.sendResponse(report, \"Inventory consumption report retrieved successfully\");\n};\n\nconst getInventoryTransferReport = async (req, res) => {\n  const report = await reportsService.getInventoryTransferReport(req.query);\n  res.sendResponse(report, \"Inventory transfer report retrieved successfully\");\n};\n\nconst getInventoryValuationReport = async (req, res) => {\n  const report = await reportsService.getInventoryValuationReport(req.query);\n  res.sendResponse(report, \"Inventory valuation report retrieved successfully\");\n};\n\n// Procurement & Financial Reports\nconst getProcurementSummaryReport = async (req, res) => {\n  const report = await reportsService.getProcurementSummaryReport(req.query);\n  res.sendResponse(report, \"Procurement summary report retrieved successfully\");\n};\n\nconst getProcurementVendorReport = async (req, res) => {\n  const report = await reportsService.getProcurementVendorReport(req.query);\n  res.sendResponse(report, \"Procurement vendor report retrieved successfully\");\n};\n\nconst getPaymentStatusReport = async (req, res) => {\n  const report = await reportsService.getPaymentStatusReport(req.query);\n  res.sendResponse(report, \"Payment status report retrieved successfully\");\n};\n\nconst getInvoiceAgingReport = async (req, res) => {\n  const report = await reportsService.getInvoiceAgingReport(req.query);\n  res.sendResponse(report, \"Invoice aging report retrieved successfully\");\n};\n\n// Operational Reports\nconst getSitePerformanceReport = async (req, res) => {\n  const report = await reportsService.getSitePerformanceReport(req.query);\n  res.sendResponse(report, \"Site performance report retrieved successfully\");\n};\n\nconst getRequisitionAnalysisReport = async (req, res) => {\n  const report = await reportsService.getRequisitionAnalysisReport(req.query);\n  res.sendResponse(report, \"Requisition analysis report retrieved successfully\");\n};\n\nconst getUserActivityReport = async (req, res) => {\n  const report = await reportsService.getUserActivityReport(req.query);\n  res.sendResponse(report, \"User activity report retrieved successfully\");\n};\n\n// Additional Reports\nconst getAssetDepreciationReport = async (req, res) => {\n  const report = await reportsService.getAssetDepreciationReport(req.query);\n  res.sendResponse(report, \"Asset depreciation report retrieved successfully\");\n};\n\nconst getMaintenanceCostAnalysis = async (req, res) => {\n  const report = await reportsService.getMaintenanceCostAnalysis(req.query);\n  res.sendResponse(report, \"Maintenance cost analysis retrieved successfully\");\n};\n\nconst getFuelConsumptionReport = async (req, res) => {\n  const report = await reportsService.getFuelConsumptionReport(req.query);\n  res.sendResponse(report, \"Fuel consumption report retrieved successfully\");\n};\n\nconst getVendorPerformanceReport = async (req, res) => {\n  const report = await reportsService.getVendorPerformanceReport(req.query);\n  res.sendResponse(report, \"Vendor performance report retrieved successfully\");\n};\n\nmodule.exports = {\n  // Machine Management Reports\n  getMachineUtilization,\n  getMachineMaintenanceReport,\n  getMachineTransferReport,\n  getMachineComplianceReport,\n  getLogbookReport,\n  \n  // Inventory Management Reports\n  getInventoryStockReport,\n  getInventoryConsumptionReport,\n  getInventoryTransferReport,\n  getInventoryValuationReport,\n  \n  // Procurement & Financial Reports\n  getProcurementSummaryReport,\n  getProcurementVendorReport,\n  getPaymentStatusReport,\n  getInvoiceAgingReport,\n  \n  // Operational Reports\n  getSitePerformanceReport,\n  getRequisitionAnalysisReport,\n  getUserActivityReport,\n  \n  // Additional Reports\n  getAssetDepreciationReport,\n  getMaintenanceCostAnalysis,\n  getFuelConsumptionReport,\n  getVendorPerformanceReport\n};","const router = require(\"express\").Router();\nconst asyncMiddleware = require(\"../../middlewares/asyncMiddleware\");\nconst reportsController = require(\"./reports.controller\");\nconst validateRequest = require(\"../../middlewares/validateRequest\");\nconst { reportsFiltersSchema } = require(\"./reports.validator\");\n\n// Machine Management Reports\nrouter.get(\"/reports/machine-utilization\", validateRequest(reportsFiltersSchema, 'query'), asyncMiddleware(reportsController.getMachineUtilization));\nrouter.get(\"/reports/machine-maintenance\", validateRequest(reportsFiltersSchema, 'query'), asyncMiddleware(reportsController.getMachineMaintenanceReport));\nrouter.get(\"/reports/machine-transfer\", validateRequest(reportsFiltersSchema, 'query'), asyncMiddleware(reportsController.getMachineTransferReport));\nrouter.get(\"/reports/machine-compliance\", validateRequest(reportsFiltersSchema, 'query'), asyncMiddleware(reportsController.getMachineComplianceReport));\nrouter.get(\"/reports/logbook\", validateRequest(reportsFiltersSchema, 'query'), asyncMiddleware(reportsController.getLogbookReport));\n\n// Inventory Management Reports\nrouter.get(\"/reports/inventory-stock\", validateRequest(reportsFiltersSchema, 'query'), asyncMiddleware(reportsController.getInventoryStockReport));\nrouter.get(\"/reports/inventory-consumption\", validateRequest(reportsFiltersSchema, 'query'), asyncMiddleware(reportsController.getInventoryConsumptionReport));\nrouter.get(\"/reports/inventory-transfer\", validateRequest(reportsFiltersSchema, 'query'), asyncMiddleware(reportsController.getInventoryTransferReport));\nrouter.get(\"/reports/inventory-valuation\", validateRequest(reportsFiltersSchema, 'query'), asyncMiddleware(reportsController.getInventoryValuationReport));\n\n// Procurement & Financial Reports\nrouter.get(\"/reports/procurement-summary\", validateRequest(reportsFiltersSchema, 'query'), asyncMiddleware(reportsController.getProcurementSummaryReport));\nrouter.get(\"/reports/procurement-vendor\", validateRequest(reportsFiltersSchema, 'query'), asyncMiddleware(reportsController.getProcurementVendorReport));\nrouter.get(\"/reports/payment-status\", validateRequest(reportsFiltersSchema, 'query'), asyncMiddleware(reportsController.getPaymentStatusReport));\nrouter.get(\"/reports/invoice-aging\", validateRequest(reportsFiltersSchema, 'query'), asyncMiddleware(reportsController.getInvoiceAgingReport));\n\n// Operational Reports\nrouter.get(\"/reports/site-performance\", validateRequest(reportsFiltersSchema, 'query'), asyncMiddleware(reportsController.getSitePerformanceReport));\nrouter.get(\"/reports/requisition-analysis\", validateRequest(reportsFiltersSchema, 'query'), asyncMiddleware(reportsController.getRequisitionAnalysisReport));\nrouter.get(\"/reports/user-activity\", validateRequest(reportsFiltersSchema, 'query'), asyncMiddleware(reportsController.getUserActivityReport));\n\n// Additional Reports\nrouter.get(\"/reports/asset-depreciation\", validateRequest(reportsFiltersSchema, 'query'), asyncMiddleware(reportsController.getAssetDepreciationReport));\nrouter.get(\"/reports/maintenance-cost-analysis\", validateRequest(reportsFiltersSchema, 'query'), asyncMiddleware(reportsController.getMaintenanceCostAnalysis));\nrouter.get(\"/reports/fuel-consumption\", validateRequest(reportsFiltersSchema, 'query'), asyncMiddleware(reportsController.getFuelConsumptionReport));\nrouter.get(\"/reports/vendor-performance\", validateRequest(reportsFiltersSchema, 'query'), asyncMiddleware(reportsController.getVendorPerformanceReport));\n\nmodule.exports = router;","const { Op } = require(\"sequelize\");\nconst db = require(\"../../models\");\nconst { sequelize } = require(\"../../models\");\n\n// Machine Management Reports\nconst getMachineUtilization = async (filters = {}) => {\n  const { startDate, endDate, siteId, machineId, status } = filters;\n\n  const whereClause = {};\n  if (siteId) whereClause.siteId = siteId;\n  if (machineId) whereClause.machineId = machineId;\n  if (startDate && endDate) {\n    whereClause.date = {\n      [Op.between]: [startDate, endDate],\n    };\n  }\n\n  const logbookEntries = await db.LogbookEntry.findAll({\n    where: whereClause,\n    include: [\n      {\n        model: db.Machinery,\n        as: \"machine\",\n        include: [{ model: db.Site, as: \"site\" }],\n      },\n    ],\n    order: [[\"date\", \"DESC\"]],\n  });\n\n  // Calculate utilization metrics\n  const utilizationData = logbookEntries.map((entry) => {\n    const runningHours = entry.totalRunHrsMeter || 0;\n    const runningKM = entry.totalRunKM || 0;\n    const dieselConsumption = entry.dieselIssue || 0;\n    const efficiency = runningHours > 0 ? runningKM / runningHours : 0;\n\n    return {\n      date: entry.date,\n      machine: entry.machine,\n      runningHours,\n      runningKM,\n      dieselConsumption,\n      efficiency,\n      dieselAvgKM: entry.dieselAvgKM || 0,\n      dieselAvgHrsMeter: entry.dieselAvgHrsMeter || 0,\n    };\n  });\n\n  return {\n    data: utilizationData,\n    summary: {\n      totalEntries: logbookEntries.length,\n      totalRunningHours: utilizationData.reduce(\n        (sum, item) => sum + item.runningHours,\n        0\n      ),\n      totalRunningKM: utilizationData.reduce(\n        (sum, item) => sum + item.runningKM,\n        0\n      ),\n      totalDieselConsumption: utilizationData.reduce(\n        (sum, item) => sum + item.dieselConsumption,\n        0\n      ),\n      averageEfficiency:\n        utilizationData.length > 0\n          ? utilizationData.reduce((sum, item) => sum + item.efficiency, 0) /\n            utilizationData.length\n          : 0,\n    },\n  };\n};\n\nconst getMachineMaintenanceReport = async (filters = {}) => {\n  const { startDate, endDate, siteId, machineId, status, type } = filters;\n\n  const whereClause = {};\n  if (machineId) whereClause.machineId = machineId;\n  if (status) whereClause.status = status;\n  if (type) whereClause.type = type;\n  if (startDate && endDate) {\n    whereClause.date = {\n      [Op.between]: [startDate, endDate],\n    };\n  }\n\n  const maintenanceLogs = await db.MaintenanceLog.findAll({\n    where: whereClause,\n    include: [\n      {\n        model: db.Machinery,\n        as: \"machine\",\n        include: [{ model: db.Site, as: \"site\" }],\n        where: siteId ? { siteId } : {},\n      },\n    ],\n    order: [[\"date\", \"DESC\"]],\n  });\n\n  const summary = {\n    totalMaintenance: maintenanceLogs.length,\n    totalCost: maintenanceLogs.reduce(\n      (sum, log) => sum + (parseFloat(log.cost) || 0),\n      0\n    ),\n    completedMaintenance: maintenanceLogs.filter(\n      (log) => log.status === \"completed\"\n    ).length,\n    pendingMaintenance: maintenanceLogs.filter(\n      (log) => log.status === \"in_progress\"\n    ).length,\n    scheduledMaintenance: maintenanceLogs.filter(\n      (log) => log.status === \"scheduled\"\n    ).length,\n    byType: {},\n  };\n\n  // Group by maintenance type\n  maintenanceLogs.forEach((log) => {\n    const type = log.type || \"Unknown\";\n    if (!summary.byType[type]) {\n      summary.byType[type] = { count: 0, cost: 0 };\n    }\n    summary.byType[type].count++;\n    summary.byType[type].cost += parseFloat(log.cost) || 0;\n  });\n\n  return {\n    data: maintenanceLogs,\n    summary,\n  };\n};\n\nconst getMachineTransferReport = async (filters = {}) => {\n  const {\n    startDate,\n    endDate,\n    machineId,\n    currentSiteId,\n    destinationSiteId,\n    status,\n    requestType,\n  } = filters;\n\n  const whereClause = {};\n  if (machineId) whereClause.machineId = machineId;\n  if (currentSiteId) whereClause.currentSiteId = currentSiteId;\n  if (destinationSiteId) whereClause.destinationSiteId = destinationSiteId;\n  if (status) whereClause.status = status;\n  if (requestType) whereClause.requestType = requestType;\n  if (startDate && endDate) {\n    whereClause.createdAt = {\n      [Op.between]: [startDate, endDate],\n    };\n  }\n\n  const transfers = await db.MachineTransfer.findAll({\n    where: whereClause,\n    include: [\n      { model: db.Machinery, as: \"machine\" },\n      { model: db.Site, as: \"currentSite\" },\n      { model: db.Site, as: \"destinationSite\" },\n      { model: db.User, as: \"requester\" },\n      { model: db.User, as: \"approver\" },\n    ],\n    order: [[\"createdAt\", \"DESC\"]],\n  });\n\n  const summary = {\n    totalTransfers: transfers.length,\n    byStatus: {},\n    byType: {},\n    averageProcessingTime: 0,\n  };\n\n  transfers.forEach((transfer) => {\n    // Group by status\n    const status = transfer.status;\n    if (!summary.byStatus[status]) summary.byStatus[status] = 0;\n    summary.byStatus[status]++;\n\n    // Group by type\n    const type = transfer.requestType;\n    if (!summary.byType[type]) summary.byType[type] = 0;\n    summary.byType[type]++;\n  });\n\n  return {\n    data: transfers,\n    summary,\n  };\n};\n\nconst getMachineComplianceReport = async (filters = {}) => {\n  const { siteId, expiring_within_days = 30 } = filters;\n\n  const whereClause = {};\n  if (siteId) whereClause.siteId = siteId;\n\n  const currentDate = new Date();\n  const futureDate = new Date();\n  futureDate.setDate(currentDate.getDate() + parseInt(expiring_within_days));\n\n  const machines = await db.Machinery.findAll({\n    where: whereClause,\n    include: [{ model: db.Site, as: \"site\" }],\n  });\n\n  const complianceData = machines.map((machine) => {\n    const compliance = {\n      machine,\n      expiring: [],\n      expired: [],\n    };\n\n    // Check various compliance dates\n    const complianceFields = [\n      \"fitnessCertificateExpiry\",\n      \"motorVehicleTaxDue\",\n      \"permitExpiryDate\",\n      \"nationalPermitExpiry\",\n      \"insuranceExpiry\",\n      \"pollutionCertificateExpiry\",\n    ];\n\n    complianceFields.forEach((field) => {\n      const expiryDate = machine[field];\n      if (expiryDate) {\n        const expiry = new Date(expiryDate);\n        if (expiry < currentDate) {\n          compliance.expired.push({\n            type: field,\n            date: expiryDate,\n            daysOverdue: Math.floor(\n              (currentDate - expiry) / (1000 * 60 * 60 * 24)\n            ),\n          });\n        } else if (expiry <= futureDate) {\n          compliance.expiring.push({\n            type: field,\n            date: expiryDate,\n            daysUntilExpiry: Math.floor(\n              (expiry - currentDate) / (1000 * 60 * 60 * 24)\n            ),\n          });\n        }\n      }\n    });\n\n    return compliance;\n  });\n\n  const summary = {\n    totalMachines: machines.length,\n    machinesWithExpiredDocs: complianceData.filter(\n      (item) => item.expired.length > 0\n    ).length,\n    machinesWithExpiringDocs: complianceData.filter(\n      (item) => item.expiring.length > 0\n    ).length,\n    totalExpiredDocs: complianceData.reduce(\n      (sum, item) => sum + item.expired.length,\n      0\n    ),\n    totalExpiringDocs: complianceData.reduce(\n      (sum, item) => sum + item.expiring.length,\n      0\n    ),\n  };\n\n  return {\n    data: complianceData,\n    summary,\n  };\n};\n\nconst getLogbookReport = async (filters = {}) => {\n  const { startDate, endDate, siteId, machineId } = filters;\n\n  const whereClause = {};\n  if (siteId) whereClause.siteId = siteId;\n  if (machineId) whereClause.machineId = machineId;\n  if (startDate && endDate) {\n    whereClause.date = {\n      [Op.between]: [startDate, endDate],\n    };\n  }\n\n  const logbookEntries = await db.LogbookEntry.findAll({\n    where: whereClause,\n    include: [\n      { model: db.Machinery, as: \"machine\" },\n      { model: db.Site, as: \"site\" },\n      { model: db.User, as: \"creater\" },\n    ],\n    order: [[\"date\", \"DESC\"]],\n  });\n\n  const summary = {\n    totalEntries: logbookEntries.length,\n    totalDieselConsumed: logbookEntries.reduce(\n      (sum, entry) => sum + (entry.dieselIssue || 0),\n      0\n    ),\n    totalKMRun: logbookEntries.reduce(\n      (sum, entry) => sum + (entry.totalRunKM || 0),\n      0\n    ),\n    totalHoursRun: logbookEntries.reduce(\n      (sum, entry) => sum + (entry.totalRunHrsMeter || 0),\n      0\n    ),\n    averageDieselEfficiency: 0,\n  };\n\n  const validEntries = logbookEntries.filter(\n    (entry) => entry.totalRunKM > 0 && entry.dieselIssue > 0\n  );\n  if (validEntries.length > 0) {\n    summary.averageDieselEfficiency =\n      validEntries.reduce(\n        (sum, entry) => sum + entry.totalRunKM / entry.dieselIssue,\n        0\n      ) / validEntries.length;\n  }\n\n  return {\n    data: logbookEntries,\n    summary,\n  };\n};\n\n// Inventory Management Reports\nconst getInventoryStockReport = async (filters = {}) => {\n  const { siteId, itemId, status, lowStock = false } = filters;\n\n  const whereClause = {};\n  if (siteId) whereClause.siteId = siteId;\n  if (itemId) whereClause.itemId = itemId;\n  if (status) whereClause.status = status;\n  if (lowStock) {\n    whereClause[Op.and] = [\n      sequelize.where(\n        sequelize.col(\"quantity\"),\n        Op.lte,\n        sequelize.col(\"minimumLevel\")\n      ),\n    ];\n  }\n\n  const inventory = await db.SiteInventory.findAll({\n    where: whereClause,\n    include: [\n      { model: db.Site },\n      {\n        model: db.Item,\n        include: [{ model: db.ItemGroup }, { model: db.Unit }],\n      },\n    ],\n  });\n\n  const summary = {\n    totalItems: inventory.length,\n    lowStockItems: inventory.filter(\n      (item) => item.quantity <= item.minimumLevel\n    ).length,\n    outOfStockItems: inventory.filter((item) => item.quantity === 0).length,\n    totalValue: 0, // Would need item prices to calculate\n    byStatus: {},\n  };\n\n  inventory.forEach((item) => {\n    const status = item.status;\n    if (!summary.byStatus[status]) summary.byStatus[status] = 0;\n    summary.byStatus[status]++;\n  });\n\n  return {\n    data: inventory,\n    summary,\n  };\n};\n\nconst getInventoryConsumptionReport = async (filters = {}) => {\n  const { startDate, endDate, siteId, itemId } = filters;\n\n  const whereClause = {\n    type: \"OUT\",\n  };\n  if (siteId) whereClause.siteId = siteId;\n  if (itemId) whereClause.itemId = itemId;\n  if (startDate && endDate) {\n    whereClause.createdAt = {\n      [Op.between]: [startDate, endDate],\n    };\n  }\n\n  const consumptionLogs = await db.StockLog.findAll({\n    where: whereClause,\n    include: [\n      { model: db.Site },\n      {\n        model: db.Item,\n        include: [{ model: db.ItemGroup }, { model: db.Unit }],\n      },\n      { model: db.User },\n    ],\n    order: [[\"createdAt\", \"DESC\"]],\n  });\n\n  // Group by item and calculate totals\n  const consumptionByItem = {};\n  consumptionLogs.forEach((log) => {\n    const itemId = log.itemId;\n    if (!consumptionByItem[itemId]) {\n      consumptionByItem[itemId] = {\n        item: log.Item,\n        totalConsumed: 0,\n        transactions: [],\n      };\n    }\n    consumptionByItem[itemId].totalConsumed += Math.abs(log.change);\n    consumptionByItem[itemId].transactions.push(log);\n  });\n\n  const summary = {\n    totalTransactions: consumptionLogs.length,\n    totalItemsConsumed: Object.keys(consumptionByItem).length,\n    totalQuantityConsumed: consumptionLogs.reduce(\n      (sum, log) => sum + Math.abs(log.change),\n      0\n    ),\n  };\n\n  return {\n    data: consumptionLogs,\n    byItem: consumptionByItem,\n    summary,\n  };\n};\n\nconst getInventoryTransferReport = async (filters = {}) => {\n  const { startDate, endDate, siteId, otherSiteId, status } = filters;\n\n  const whereClause = {\n    issueType: \"Site Transfer\",\n  };\n  if (siteId) whereClause.siteId = siteId;\n  if (otherSiteId) whereClause.otherSiteId = otherSiteId;\n  if (status) whereClause.status = status;\n  if (startDate && endDate) {\n    whereClause.createdAt = {\n      [Op.between]: [startDate, endDate],\n    };\n  }\n\n  const transfers = await db.MaterialIssue.findAll({\n    where: whereClause,\n    include: [\n      { model: db.Site, as: \"fromSite\" },\n      { model: db.Site, as: \"toSite\" },\n      {\n        model: db.MaterialIssueItem,\n        as: \"items\",\n        include: [\n          {\n            model: db.Item,\n            include: [{ model: db.ItemGroup }, { model: db.Unit }],\n          },\n        ],\n      },\n    ],\n    order: [[\"createdAt\", \"DESC\"]],\n  });\n\n  const summary = {\n    totalTransfers: transfers.length,\n    byStatus: {},\n    totalItemsTransferred: 0,\n  };\n\n  transfers.forEach((transfer) => {\n    const status = transfer.status;\n    if (!summary.byStatus[status]) summary.byStatus[status] = 0;\n    summary.byStatus[status]++;\n\n    summary.totalItemsTransferred += transfer.items.reduce(\n      (sum, item) => sum + item.quantity,\n      0\n    );\n  });\n\n  return {\n    data: transfers,\n    summary,\n  };\n};\n\nconst getInventoryValuationReport = async (filters = {}) => {\n  const { siteId, itemGroupId } = filters;\n\n  const whereClause = {};\n  if (siteId) whereClause.siteId = siteId;\n\n  const inventory = await db.SiteInventory.findAll({\n    where: whereClause,\n    include: [\n      {\n        model: db.Item,\n        include: [\n          {\n            model: db.ItemGroup,\n            where: itemGroupId ? { id: itemGroupId } : {},\n          },\n          { model: db.Unit },\n        ],\n      },\n      { model: db.Site },\n    ],\n  });\n\n  // Note: This would need item prices from procurement or a separate price table\n  // For now, returning quantity-based valuation\n  const valuationData = inventory.map((item) => ({\n    site: item.Site,\n    item: item.Item,\n    quantity: item.quantity,\n    minimumLevel: item.minimumLevel,\n    status: item.status,\n    // estimatedValue: item.quantity * (item.Item.lastPurchasePrice || 0)\n  }));\n\n  const summary = {\n    totalItems: inventory.length,\n    totalQuantity: inventory.reduce((sum, item) => sum + item.quantity, 0),\n    // totalValue: valuationData.reduce((sum, item) => sum + item.estimatedValue, 0),\n    lowStockValue: valuationData.filter(\n      (item) => item.quantity <= item.minimumLevel\n    ).length,\n  };\n\n  return {\n    data: valuationData,\n    summary,\n  };\n};\n\n// Procurement & Financial Reports\nconst getProcurementSummaryReport = async (filters = {}) => {\n  const { startDate, endDate, vendorId, status } = filters;\n\n  const whereClause = {};\n  if (vendorId) whereClause.vendorId = vendorId;\n  if (status) whereClause.status = status;\n  if (startDate && endDate) {\n    whereClause.createdAt = {\n      [Op.between]: [startDate, endDate],\n    };\n  }\n\n  const procurements = await db.Procurement.findAll({\n    where: whereClause,\n    include: [\n      { model: db.Vendor },\n      { model: db.Requisition },\n      { model: db.ProcurementItem },\n    ],\n    order: [[\"createdAt\", \"DESC\"]],\n  });\n\n  const summary = {\n    totalProcurements: procurements.length,\n    totalAmount: procurements.reduce(\n      (sum, proc) => sum + (parseFloat(proc.totalAmount) || 0),\n      0\n    ),\n    byStatus: {},\n    byVendor: {},\n  };\n\n  procurements.forEach((proc) => {\n    // Group by status\n    const status = proc.status;\n    if (!summary.byStatus[status]) {\n      summary.byStatus[status] = { count: 0, amount: 0 };\n    }\n    summary.byStatus[status].count++;\n    summary.byStatus[status].amount += parseFloat(proc.totalAmount) || 0;\n\n    // Group by vendor\n    const vendorName = proc.Vendor?.name || \"Unknown\";\n    if (!summary.byVendor[vendorName]) {\n      summary.byVendor[vendorName] = { count: 0, amount: 0 };\n    }\n    summary.byVendor[vendorName].count++;\n    summary.byVendor[vendorName].amount += parseFloat(proc.totalAmount) || 0;\n  });\n\n  return {\n    data: procurements,\n    summary,\n  };\n};\n\nconst getProcurementVendorReport = async (filters = {}) => {\n  const { startDate, endDate, vendorId } = filters;\n\n  const whereClause = {};\n  if (vendorId) whereClause.vendorId = vendorId;\n  if (startDate && endDate) {\n    whereClause.createdAt = {\n      [Op.between]: [startDate, endDate],\n    };\n  }\n\n  const procurements = await db.Procurement.findAll({\n    where: whereClause,\n    include: [{ model: db.Vendor }, { model: db.ProcurementItem }],\n  });\n\n  // Group by vendor\n  const vendorPerformance = {};\n  procurements.forEach((proc) => {\n    const vendorId = proc.vendorId;\n    if (!vendorPerformance[vendorId]) {\n      vendorPerformance[vendorId] = {\n        vendor: proc.Vendor,\n        totalOrders: 0,\n        totalAmount: 0,\n        onTimeDeliveries: 0,\n        pendingOrders: 0,\n        completedOrders: 0,\n      };\n    }\n\n    const vp = vendorPerformance[vendorId];\n    vp.totalOrders++;\n    vp.totalAmount += parseFloat(proc.totalAmount) || 0;\n\n    if (proc.status === \"delivered\") vp.completedOrders++;\n    if (proc.status === \"pending\") vp.pendingOrders++;\n\n    // Check on-time delivery (if expectedDelivery is set)\n    if (proc.expectedDelivery && proc.status === \"delivered\") {\n      // This would need actual delivery date to calculate properly\n      vp.onTimeDeliveries++;\n    }\n  });\n\n  return {\n    data: Object.values(vendorPerformance),\n    summary: {\n      totalVendors: Object.keys(vendorPerformance).length,\n      totalProcurements: procurements.length,\n      totalAmount: procurements.reduce(\n        (sum, proc) => sum + (parseFloat(proc.totalAmount) || 0),\n        0\n      ),\n    },\n  };\n};\n\nconst getPaymentStatusReport = async (filters = {}) => {\n  const { startDate, endDate, status, paymentMethod } = filters;\n\n  const whereClause = {};\n  if (status) whereClause.status = status;\n  if (paymentMethod) whereClause.paymentMethod = paymentMethod;\n  if (startDate && endDate) {\n    whereClause.paymentDate = {\n      [Op.between]: [startDate, endDate],\n    };\n  }\n\n  const payments = await db.Payment.findAll({\n    where: whereClause,\n    include: [\n      {\n        model: db.Invoice,\n        as: \"invoice\",\n        include: [{ model: db.Procurement, as: \"procurement\" }],\n      },\n    ],\n    order: [[\"paymentDate\", \"DESC\"]],\n  });\n\n  const summary = {\n    totalPayments: payments.length,\n    totalAmount: payments.reduce(\n      (sum, payment) => sum + (parseFloat(payment.amount) || 0),\n      0\n    ),\n    byStatus: {},\n    byMethod: {},\n  };\n\n  payments.forEach((payment) => {\n    // Group by status\n    const status = payment.status;\n    if (!summary.byStatus[status]) {\n      summary.byStatus[status] = { count: 0, amount: 0 };\n    }\n    summary.byStatus[status].count++;\n    summary.byStatus[status].amount += parseFloat(payment.amount) || 0;\n\n    // Group by payment method\n    const method = payment.paymentMethod;\n    if (!summary.byMethod[method]) {\n      summary.byMethod[method] = { count: 0, amount: 0 };\n    }\n    summary.byMethod[method].count++;\n    summary.byMethod[method].amount += parseFloat(payment.amount) || 0;\n  });\n\n  return {\n    data: payments,\n    summary,\n  };\n};\n\nconst getInvoiceAgingReport = async (filters = {}) => {\n  const { vendorId, status } = filters;\n\n  const whereClause = {};\n  if (status) whereClause.status = status;\n\n  const invoices = await db.Invoice.findAll({\n    where: whereClause,\n    include: [\n      {\n        model: db.Procurement,\n        as: \"procurement\",\n        include: [\n          {\n            model: db.Vendor,\n            where: vendorId ? { id: vendorId } : {},\n          },\n        ],\n      },\n      { model: db.Payment, as: \"payments\" },\n    ],\n  });\n\n  const currentDate = new Date();\n  const agingData = invoices.map((invoice) => {\n    const invoiceDate = new Date(invoice.invoiceDate);\n    const daysOld = Math.floor(\n      (currentDate - invoiceDate) / (1000 * 60 * 60 * 24)\n    );\n\n    const totalPaid = invoice.payments.reduce(\n      (sum, payment) => sum + (parseFloat(payment.amount) || 0),\n      0\n    );\n    const remainingAmount = parseFloat(invoice.amount) - totalPaid;\n\n    let agingBucket = \"0-30 days\";\n    if (daysOld > 90) agingBucket = \"90+ days\";\n    else if (daysOld > 60) agingBucket = \"60-90 days\";\n    else if (daysOld > 30) agingBucket = \"30-60 days\";\n\n    return {\n      invoice,\n      daysOld,\n      agingBucket,\n      totalPaid,\n      remainingAmount,\n      isOverdue: daysOld > 30 && remainingAmount > 0,\n    };\n  });\n\n  const summary = {\n    totalInvoices: invoices.length,\n    totalAmount: invoices.reduce(\n      (sum, inv) => sum + (parseFloat(inv.amount) || 0),\n      0\n    ),\n    totalOutstanding: agingData.reduce(\n      (sum, item) => sum + item.remainingAmount,\n      0\n    ),\n    overdueAmount: agingData\n      .filter((item) => item.isOverdue)\n      .reduce((sum, item) => sum + item.remainingAmount, 0),\n    agingBuckets: {},\n  };\n\n  // Calculate aging buckets\n  agingData.forEach((item) => {\n    const bucket = item.agingBucket;\n    if (!summary.agingBuckets[bucket]) {\n      summary.agingBuckets[bucket] = { count: 0, amount: 0 };\n    }\n    summary.agingBuckets[bucket].count++;\n    summary.agingBuckets[bucket].amount += item.remainingAmount;\n  });\n\n  return {\n    data: agingData,\n    summary,\n  };\n};\n\n// Operational Reports\nconst getSitePerformanceReport = async (filters = {}) => {\n  const { startDate, endDate, siteId } = filters;\n\n  const whereClause = {};\n  if (siteId) whereClause.id = siteId;\n\n  const sites = await db.Site.findAll({\n    where: whereClause,\n    include: [{ model: db.Machinery }, { model: db.User }],\n  });\n\n  const performanceData = [];\n\n  for (const site of sites) {\n    // Get requisitions for this site\n    const requisitionWhere = { requestingSiteId: site.id };\n    if (startDate && endDate) {\n      requisitionWhere.createdAt = {\n        [Op.between]: [startDate, endDate],\n      };\n    }\n\n    const requisitions = await db.Requisition.findAll({\n      where: requisitionWhere,\n    });\n\n    // Get material issues for this site\n    const issueWhere = { siteId: site.id };\n    if (startDate && endDate) {\n      issueWhere.createdAt = {\n        [Op.between]: [startDate, endDate],\n      };\n    }\n\n    const materialIssues = await db.MaterialIssue.findAll({\n      where: issueWhere,\n    });\n\n    // Get logbook entries for machines at this site\n    const logbookWhere = { siteId: site.id };\n    if (startDate && endDate) {\n      logbookWhere.date = {\n        [Op.between]: [startDate, endDate],\n      };\n    }\n\n    const logbookEntries = await db.LogbookEntry.findAll({\n      where: logbookWhere,\n    });\n\n    performanceData.push({\n      site,\n      metrics: {\n        totalMachines: site.Machineries.length,\n        activeMachines: site.Machineries.filter((m) => m.status === \"In Use\")\n          .length,\n        totalUsers: site.Users.length,\n        totalRequisitions: requisitions.length,\n        pendingRequisitions: requisitions.filter((r) => r.status === \"pending\")\n          .length,\n        approvedRequisitions: requisitions.filter(\n          (r) => r.status === \"approved\"\n        ).length,\n        totalMaterialIssues: materialIssues.length,\n        totalLogbookEntries: logbookEntries.length,\n        totalDieselConsumed: logbookEntries.reduce(\n          (sum, entry) => sum + (entry.dieselIssue || 0),\n          0\n        ),\n        totalKMRun: logbookEntries.reduce(\n          (sum, entry) => sum + (entry.totalRunKM || 0),\n          0\n        ),\n      },\n    });\n  }\n\n  return {\n    data: performanceData,\n    summary: {\n      totalSites: sites.length,\n      totalMachines: performanceData.reduce(\n        (sum, item) => sum + item.metrics.totalMachines,\n        0\n      ),\n      totalUsers: performanceData.reduce(\n        (sum, item) => sum + item.metrics.totalUsers,\n        0\n      ),\n      totalRequisitions: performanceData.reduce(\n        (sum, item) => sum + item.metrics.totalRequisitions,\n        0\n      ),\n    },\n  };\n};\n\nconst getRequisitionAnalysisReport = async (filters = {}) => {\n  const { startDate, endDate, siteId, status, priority } = filters;\n\n  const whereClause = {};\n  if (siteId) whereClause.requestingSiteId = siteId;\n  if (status) whereClause.status = status;\n  if (priority) whereClause.requestPriority = priority;\n  if (startDate && endDate) {\n    whereClause.createdAt = {\n      [Op.between]: [startDate, endDate],\n    };\n  }\n\n  const requisitions = await db.Requisition.findAll({\n    where: whereClause,\n    include: [\n      { model: db.Site, as: \"requestingSite\" },\n      { model: db.User, as: \"preparedBy\" },\n      { model: db.User, as: \"approvedBy\" },\n      { model: db.RequisitionItem, as: \"items\" },\n    ],\n    order: [[\"createdAt\", \"DESC\"]],\n  });\n\n  const summary = {\n    totalRequisitions: requisitions.length,\n    byStatus: {},\n    byPriority: {},\n    bySite: {},\n    averageProcessingTime: 0,\n    totalItems: 0,\n  };\n\n  // Continuing from where the service left off...\n\n  requisitions.forEach((req) => {\n    // Group by status\n    const status = req.status;\n    if (!summary.byStatus[status]) {\n      summary.byStatus[status] = { count: 0, items: 0 };\n    }\n    summary.byStatus[status].count++;\n    summary.byStatus[status].items += req.items.length;\n\n    // Group by priority\n    const priority = req.requestPriority;\n    if (!summary.byPriority[priority]) {\n      summary.byPriority[priority] = { count: 0, items: 0 };\n    }\n    summary.byPriority[priority].count++;\n    summary.byPriority[priority].items += req.items.length;\n\n    // Group by site\n    const siteName = req.requestingSite?.name || \"Unknown\";\n    if (!summary.bySite[siteName]) {\n      summary.bySite[siteName] = { count: 0, items: 0 };\n    }\n    summary.bySite[siteName].count++;\n    summary.bySite[siteName].items += req.items.length;\n\n    // Calculate processing time for approved requisitions\n    if (req.status === \"approved\" && req.approvedAt) {\n      const processingTime = new Date(req.approvedAt) - new Date(req.createdAt);\n      summary.averageProcessingTime += processingTime;\n    }\n\n    summary.totalItems += req.items.length;\n  });\n\n  // Calculate average processing time in days\n  const approvedRequisitions = requisitions.filter(\n    (r) => r.status === \"approved\" && r.approvedAt\n  );\n  if (approvedRequisitions.length > 0) {\n    summary.averageProcessingTime =\n      summary.averageProcessingTime /\n      approvedRequisitions.length /\n      (1000 * 60 * 60 * 24);\n  }\n\n  return {\n    data: requisitions,\n    summary,\n  };\n};\n\nconst getUserActivityReport = async (filters = {}) => {\n  const { startDate, endDate, userId, siteId, activityType } = filters;\n\n  const whereClause = {};\n  if (userId) whereClause.userId = userId;\n  if (siteId) whereClause.siteId = siteId;\n  if (activityType) whereClause.activityType = activityType;\n  if (startDate && endDate) {\n    whereClause.createdAt = {\n      [Op.between]: [startDate, endDate],\n    };\n  }\n\n  const activities = await db.UserActivity.findAll({\n    where: whereClause,\n    include: [\n      { model: db.User, as: \"user\" },\n      { model: db.Site, as: \"site\" },\n    ],\n    order: [[\"createdAt\", \"DESC\"]],\n  });\n\n  const summary = {\n    totalActivities: activities.length,\n    uniqueUsers: [...new Set(activities.map((a) => a.userId))].length,\n    byActivityType: {},\n    bySite: {},\n    byUser: {},\n  };\n\n  activities.forEach((activity) => {\n    // Group by activity type\n    const type = activity.activityType;\n    if (!summary.byActivityType[type]) summary.byActivityType[type] = 0;\n    summary.byActivityType[type]++;\n\n    // Group by site\n    const siteName = activity.site?.name || \"Unknown\";\n    if (!summary.bySite[siteName]) summary.bySite[siteName] = 0;\n    summary.bySite[siteName]++;\n\n    // Group by user\n    const userName = activity.user?.name || \"Unknown\";\n    if (!summary.byUser[userName]) summary.byUser[userName] = 0;\n    summary.byUser[userName]++;\n  });\n\n  return {\n    data: activities,\n    summary,\n  };\n};\n\nconst getAssetDepreciationReport = async (filters = {}) => {\n  const { siteId, assetType, status } = filters;\n\n  const whereClause = {};\n  if (siteId) whereClause.siteId = siteId;\n  if (assetType) whereClause.assetType = assetType;\n  if (status) whereClause.status = status;\n\n  const assets = await db.Machinery.findAll({\n    where: whereClause,\n    include: [{ model: db.Site, as: \"site\" }],\n  });\n\n  const currentDate = new Date();\n  const depreciationData = assets.map((asset) => {\n    const purchaseDate = new Date(asset.purchaseDate);\n    const ageInYears =\n      (currentDate - purchaseDate) / (1000 * 60 * 60 * 24 * 365);\n    const originalValue = parseFloat(asset.purchaseValue) || 0;\n\n    // Simple straight-line depreciation (assuming 10-year life)\n    const depreciationRate = 0.1; // 10% per year\n    const depreciatedValue = Math.max(\n      0,\n      originalValue * (1 - depreciationRate * ageInYears)\n    );\n    const totalDepreciation = originalValue - depreciatedValue;\n\n    return {\n      asset,\n      originalValue,\n      currentValue: depreciatedValue,\n      totalDepreciation,\n      depreciationRate: depreciationRate * 100,\n      ageInYears: Math.round(ageInYears * 100) / 100,\n    };\n  });\n\n  const summary = {\n    totalAssets: assets.length,\n    totalOriginalValue: depreciationData.reduce(\n      (sum, item) => sum + item.originalValue,\n      0\n    ),\n    totalCurrentValue: depreciationData.reduce(\n      (sum, item) => sum + item.currentValue,\n      0\n    ),\n    totalDepreciation: depreciationData.reduce(\n      (sum, item) => sum + item.totalDepreciation,\n      0\n    ),\n    averageAge:\n      depreciationData.length > 0\n        ? depreciationData.reduce((sum, item) => sum + item.ageInYears, 0) /\n          depreciationData.length\n        : 0,\n  };\n\n  return {\n    data: depreciationData,\n    summary,\n  };\n};\n\nconst getMaintenanceCostAnalysis = async (filters = {}) => {\n  const { startDate, endDate, siteId, machineId, maintenanceType } = filters;\n\n  const whereClause = {};\n  if (siteId) whereClause.siteId = siteId;\n  if (machineId) whereClause.machineId = machineId;\n  if (maintenanceType) whereClause.type = maintenanceType;\n  if (startDate && endDate) {\n    whereClause.date = {\n      [Op.between]: [startDate, endDate],\n    };\n  }\n\n  const maintenanceLogs = await db.MaintenanceLog.findAll({\n    where: whereClause,\n    include: [\n      {\n        model: db.Machinery,\n        as: \"machine\",\n        include: [{ model: db.Site, as: \"site\" }],\n      },\n    ],\n    order: [[\"date\", \"DESC\"]],\n  });\n\n  // Group by machine\n  const costByMachine = {};\n  maintenanceLogs.forEach((log) => {\n    const machineId = log.machineId;\n    if (!costByMachine[machineId]) {\n      costByMachine[machineId] = {\n        machine: log.machine,\n        totalCost: 0,\n        maintenanceCount: 0,\n        lastMaintenance: null,\n        avgCostPerMaintenance: 0,\n        byType: {},\n      };\n    }\n\n    const data = costByMachine[machineId];\n    data.totalCost += parseFloat(log.cost) || 0;\n    data.maintenanceCount++;\n\n    if (\n      !data.lastMaintenance ||\n      new Date(log.date) > new Date(data.lastMaintenance)\n    ) {\n      data.lastMaintenance = log.date;\n    }\n\n    // Group by maintenance type\n    const type = log.type;\n    if (!data.byType[type]) {\n      data.byType[type] = { count: 0, cost: 0 };\n    }\n    data.byType[type].count++;\n    data.byType[type].cost += parseFloat(log.cost) || 0;\n  });\n\n  // Calculate averages\n  Object.values(costByMachine).forEach((data) => {\n    data.avgCostPerMaintenance =\n      data.maintenanceCount > 0 ? data.totalCost / data.maintenanceCount : 0;\n  });\n\n  const summary = {\n    totalMaintenanceRecords: maintenanceLogs.length,\n    totalCost: maintenanceLogs.reduce(\n      (sum, log) => sum + (parseFloat(log.cost) || 0),\n      0\n    ),\n    averageCostPerMaintenance:\n      maintenanceLogs.length > 0\n        ? maintenanceLogs.reduce(\n            (sum, log) => sum + (parseFloat(log.cost) || 0),\n            0\n          ) / maintenanceLogs.length\n        : 0,\n    machinesWithMaintenance: Object.keys(costByMachine).length,\n    highestCostMachine: null,\n    lowestCostMachine: null,\n  };\n\n  const machineData = Object.values(costByMachine);\n  if (machineData.length > 0) {\n    summary.highestCostMachine = machineData.reduce((max, curr) =>\n      curr.totalCost > max.totalCost ? curr : max\n    );\n    summary.lowestCostMachine = machineData.reduce((min, curr) =>\n      curr.totalCost < min.totalCost ? curr : min\n    );\n  }\n\n  return {\n    data: machineData,\n    summary,\n  };\n};\n\nconst getFuelConsumptionReport = async (filters = {}) => {\n  const { startDate, endDate, siteId, machineId } = filters;\n\n  const whereClause = {};\n  if (siteId) whereClause.siteId = siteId;\n  if (machineId) whereClause.machineId = machineId;\n  if (startDate && endDate) {\n    whereClause.date = {\n      [Op.between]: [startDate, endDate],\n    };\n  }\n\n  const logbookEntries = await db.LogbookEntry.findAll({\n    where: whereClause,\n    include: [\n      { model: db.Machinery, as: \"machine\" },\n      { model: db.Site, as: \"site\" },\n    ],\n    order: [[\"date\", \"DESC\"]],\n  });\n\n  // Group by machine\n  const consumptionByMachine = {};\n  logbookEntries.forEach((entry) => {\n    const machineId = entry.machineId;\n    if (!consumptionByMachine[machineId]) {\n      consumptionByMachine[machineId] = {\n        machine: entry.machine,\n        totalFuelConsumed: 0,\n        totalKMRun: 0,\n        totalHoursRun: 0,\n        entries: 0,\n        avgFuelPerKM: 0,\n        avgFuelPerHour: 0,\n        efficiency: 0,\n      };\n    }\n\n    const data = consumptionByMachine[machineId];\n    data.totalFuelConsumed += entry.dieselIssue || 0;\n    data.totalKMRun += entry.totalRunKM || 0;\n    data.totalHoursRun += entry.totalRunHrsMeter || 0;\n    data.entries++;\n  });\n\n  // Calculate averages and efficiency\n  Object.values(consumptionByMachine).forEach((data) => {\n    data.avgFuelPerKM =\n      data.totalKMRun > 0 ? data.totalFuelConsumed / data.totalKMRun : 0;\n    data.avgFuelPerHour =\n      data.totalHoursRun > 0 ? data.totalFuelConsumed / data.totalHoursRun : 0;\n    data.efficiency =\n      data.totalFuelConsumed > 0 ? data.totalKMRun / data.totalFuelConsumed : 0;\n  });\n\n  const summary = {\n    totalEntries: logbookEntries.length,\n    totalFuelConsumed: logbookEntries.reduce(\n      (sum, entry) => sum + (entry.dieselIssue || 0),\n      0\n    ),\n    totalKMRun: logbookEntries.reduce(\n      (sum, entry) => sum + (entry.totalRunKM || 0),\n      0\n    ),\n    totalHoursRun: logbookEntries.reduce(\n      (sum, entry) => sum + (entry.totalRunHrsMeter || 0),\n      0\n    ),\n    averageEfficiency: 0,\n    machinesTracked: Object.keys(consumptionByMachine).length,\n  };\n\n  const machineData = Object.values(consumptionByMachine);\n  if (machineData.length > 0) {\n    summary.averageEfficiency =\n      machineData.reduce((sum, data) => sum + data.efficiency, 0) /\n      machineData.length;\n  }\n\n  return {\n    data: machineData,\n    summary,\n  };\n};\n\nconst getVendorPerformanceReport = async (filters = {}) => {\n  const { startDate, endDate, vendorId, status } = filters;\n\n  const whereClause = {};\n  if (vendorId) whereClause.vendorId = vendorId;\n  if (status) whereClause.status = status;\n  if (startDate && endDate) {\n    whereClause.createdAt = {\n      [Op.between]: [startDate, endDate],\n    };\n  }\n\n  const procurements = await db.Procurement.findAll({\n    where: whereClause,\n    include: [{ model: db.Vendor }, { model: db.ProcurementItem }],\n  });\n\n  // Group by vendor\n  const vendorPerformance = {};\n  procurements.forEach((procurement) => {\n    const vendorId = procurement.vendorId;\n    if (!vendorPerformance[vendorId]) {\n      vendorPerformance[vendorId] = {\n        vendor: procurement.Vendor,\n        totalOrders: 0,\n        totalValue: 0,\n        completedOrders: 0,\n        pendingOrders: 0,\n        cancelledOrders: 0,\n        averageOrderValue: 0,\n        onTimeDeliveryRate: 0,\n        qualityScore: 0,\n      };\n    }\n\n    const perf = vendorPerformance[vendorId];\n    perf.totalOrders++;\n    perf.totalValue += parseFloat(procurement.totalAmount) || 0;\n\n    switch (procurement.status) {\n      case \"delivered\":\n        perf.completedOrders++;\n        break;\n      case \"pending\":\n        perf.pendingOrders++;\n        break;\n      case \"cancelled\":\n        perf.cancelledOrders++;\n        break;\n    }\n  });\n\n  // Calculate metrics\n  Object.values(vendorPerformance).forEach((perf) => {\n    perf.averageOrderValue =\n      perf.totalOrders > 0 ? perf.totalValue / perf.totalOrders : 0;\n    perf.onTimeDeliveryRate =\n      perf.completedOrders > 0\n        ? (perf.completedOrders / perf.totalOrders) * 100\n        : 0;\n    // Quality score could be calculated based on returns, complaints, etc.\n    perf.qualityScore = Math.random() * 100; // Placeholder\n  });\n\n  const summary = {\n    totalVendors: Object.keys(vendorPerformance).length,\n    totalOrders: procurements.length,\n    totalValue: procurements.reduce(\n      (sum, p) => sum + (parseFloat(p.totalAmount) || 0),\n      0\n    ),\n    topPerformer: null,\n    averageOrderValue: 0,\n  };\n\n  const vendorData = Object.values(vendorPerformance);\n  if (vendorData.length > 0) {\n    summary.topPerformer = vendorData.reduce((max, curr) =>\n      curr.onTimeDeliveryRate > max.onTimeDeliveryRate ? curr : max\n    );\n    summary.averageOrderValue = summary.totalValue / summary.totalOrders;\n  }\n\n  return {\n    data: vendorData,\n    summary,\n  };\n};\n\n// Export all functions\nmodule.exports = {\n  // Machine Management Reports\n  getMachineUtilization,\n  getMachineMaintenanceReport,\n  getMachineTransferReport,\n  getMachineComplianceReport,\n  getLogbookReport,\n\n  // Inventory Management Reports\n  getInventoryStockReport,\n  getInventoryConsumptionReport,\n  getInventoryTransferReport,\n  getInventoryValuationReport,\n\n  // Procurement & Financial Reports\n  getProcurementSummaryReport,\n  getProcurementVendorReport,\n  getPaymentStatusReport,\n  getInvoiceAgingReport,\n\n  // Operational Reports\n  getSitePerformanceReport,\n  getRequisitionAnalysisReport,\n  getUserActivityReport,\n\n  // Additional Reports\n  getAssetDepreciationReport,\n  getMaintenanceCostAnalysis,\n  getFuelConsumptionReport,\n  getVendorPerformanceReport,\n};\n","const Joi = require(\"joi\");\n\nconst reportsFiltersSchema = Joi.object({\n  startDate: Joi.date().optional(),\n  endDate: Joi.date()\n    .optional()\n    .when(\"startDate\", {\n      is: Joi.exist(),\n      then: Joi.date().min(Joi.ref(\"startDate\")).required(),\n      otherwise: Joi.optional(),\n    }),\n\n  // Site filters\n  siteId: Joi.number().integer().positive().optional(),\n  currentSiteId: Joi.number().integer().positive().optional(),\n  destinationSiteId: Joi.number().integer().positive().optional(),\n  otherSiteId: Joi.number().integer().positive().optional(),\n\n  // Machine filters\n  machineId: Joi.number().integer().positive().optional(),\n\n  // Item filters\n  itemId: Joi.number().integer().positive().optional(),\n  itemGroupId: Joi.number().integer().positive().optional(),\n\n  // User filters\n  userId: Joi.number().integer().positive().optional(),\n\n  // Vendor filters\n  vendorId: Joi.number().integer().positive().optional(),\n\n  // Status filters\n  status: Joi.string().optional(),\n\n  // Type filters\n  type: Joi.string().optional(),\n  maintenanceType: Joi.string().optional(),\n  requestType: Joi.string().optional(),\n  activityType: Joi.string().optional(),\n  assetType: Joi.string().optional(),\n\n  // Priority filters\n  priority: Joi.string().optional(),\n\n  // Payment filters\n  paymentMethod: Joi.string().optional(),\n\n  // Specific filters\n  lowStock: Joi.boolean().optional(),\n  expiring_within_days: Joi.number().integer().min(1).max(365).optional(),\n\n  // Pagination (optional)\n  page: Joi.number().integer().min(1).optional(),\n  limit: Joi.number().integer().min(1).max(1000).optional(),\n}).unknown(false);\n\nmodule.exports = {\n  reportsFiltersSchema,\n};\n","const requisitionService = require(\"./requisition.service\");\n\nconst createRequisition = async (req, res) => {\n  const requisition = await requisitionService.createRequisition(\n    req.body,\n    req.user.id\n  );\n  res.sendResponse(requisition, \"Requisition created successfully\");\n};\n\nconst getRequisitionById = async (req, res) => {\n  const requisition = await requisitionService.getRequisitionById(\n    req.params.id\n  );\n  res.sendResponse(requisition, \"Requisition fetched successfully\");\n};\n\nconst getAllRequisitions = async (req, res) => {\n  const user = req.user;\n  const siteId = user.siteId;\n  const requisitions = await requisitionService.getAllRequisitions(siteId);\n  res.sendResponse(requisitions, \"Requisitions fetched successfully\");\n};\n\nconst approveRequisition = async (req, res) => {\n  const { requisitionId } = req.params;\n  const userId = req.user.id; // assuming authentication middleware\n  const requisition = await requisitionService.approveRequisition(\n    requisitionId,\n    userId\n  );\n  res.sendResponse(requisition, \"Requisition approved successfully\");\n};\n\nconst pmApproveRequisition = async (req, res) => {\n  const { requisitionId } = req.params;\n  const userId = req.user.id; // assuming authentication middleware\n  const requisition = await requisitionService.pmApproveRequisition(\n    requisitionId,\n    userId\n  );\n  res.sendResponse(requisition, \"Requisition approved by PM successfully\");\n};\nconst hoApproveRequisition = async (req, res) => {\n  const { requisitionId } = req.params;\n  const userId = req.user.id; // assuming authentication middleware\n  const requisition = await requisitionService.hoApproveRequisition(\n    requisitionId,\n    userId\n  );\n  res.sendResponse(requisition, \"Requisition approved by HO successfully\");\n};\n\nconst requisitionDelete = async (req, res) => {\n  const { requisitionId } = req.params;\n  const result = await requisitionService.requisitionDelete(requisitionId);\n  res.sendResponse(result, \"Requisition deleted successfully\");\n};\n\nconst completeRequisition = async (req, res) => {\n  const { requisitionId } = req.params;\n  const userId = req.user.id;\n\n  const data = await requisitionService.completeRequisition(\n    requisitionId,\n    userId\n  );\n  res.sendResponse(data, \"Requisition marked as completed successfully\");\n};\n\nconst rejectRequisition = async (req, res) => {\n  const { requisitionId } = req.params;\n  const { rejectionReason } = req.body;\n  const userId = req.user.id;\n\n  const data = await requisitionService.rejectRequisition(\n    requisitionId,\n    userId,\n    rejectionReason\n  );\n  res.sendResponse(data, \"Requisition rejected successfully\");\n};\n\nconst rejectRequisitionBySite = async (req, res) => {\n  const { id } = req.params;\n  const rejection = await requisitionService.rejectRequisitionBySite(\n    id,\n    req.body,\n    req.user\n  );\n  res.sendResponse(rejection, \"Requisition rejected successfully\");\n};\n\nconst getRequisitionRejections = async (req, res) => {\n  const { id } = req.params;\n  const rejections = await requisitionService.getRequisitionRejections(id);\n  res.sendResponse(rejections, \"Rejections retrieved successfully\");\n};\n\nconst updateItemQuantity = async (req, res) => {\n  const { id } = req.params;\n  const { items } = req.body;\n  const result = await requisitionService.updateItemQuantity(\n    id,\n    items\n  );\n  res.sendResponse(result, \"Item quantity updated successfully\");\n};\n\nmodule.exports = {\n  createRequisition,\n  getRequisitionById,\n  getAllRequisitions,\n  approveRequisition,\n  pmApproveRequisition,\n  hoApproveRequisition,\n  requisitionDelete,\n  completeRequisition,\n  rejectRequisition,\n  rejectRequisitionBySite,\n  getRequisitionRejections,\n  updateItemQuantity,\n};\n","const express = require(\"express\");\nconst router = express.Router();\nconst requisitionController = require(\"./requisition.controller\");\nconst asyncMiddleware = require(\"./../../middlewares/asyncMiddleware\");\nconst validateRequest = require(\"./../../middlewares/validateRequest\");\nconst { createRequisitionSchema } = require(\"./requisition.validator\");\n\nrouter.post(\n  \"/requisitions/\",\n  validateRequest(createRequisitionSchema),\n  asyncMiddleware(requisitionController.createRequisition)\n);\n\nrouter.get(\n  \"/requisitions/:id\",\n  asyncMiddleware(requisitionController.getRequisitionById)\n);\n\nrouter.get(\n  \"/requisitions/\",\n  asyncMiddleware(requisitionController.getAllRequisitions)\n);\n\nrouter.post(\n  \"/requisitions/:requisitionId/approve\",\n  asyncMiddleware(requisitionController.approveRequisition)\n);\nrouter.post(\n  \"/requisitions/:requisitionId/pm-approve\",\n  asyncMiddleware(requisitionController.pmApproveRequisition)\n);\nrouter.post(\n  \"/requisitions/:requisitionId/ho-approve\",\n  asyncMiddleware(requisitionController.hoApproveRequisition)\n);\n\nrouter.delete(\n  \"/requisitions/:requisitionId\",\n  asyncMiddleware(requisitionController.requisitionDelete)\n);\nrouter.post(\n  \"/requisitions/:requisitionId/complete\",\n  asyncMiddleware(requisitionController.completeRequisition)\n);\nrouter.post(\n  \"/requisitions/:requisitionId/reject\",\n  asyncMiddleware(requisitionController.rejectRequisition)\n);\n\nrouter.post(\n  \"/requisitions/:id/site-reject\",\n  asyncMiddleware(requisitionController.rejectRequisitionBySite)\n);\nrouter.put(\n  \"/requisitions/:id/item-quantity-update\",\n  asyncMiddleware(requisitionController.updateItemQuantity)\n);\n\n// Get all site rejections for a requisition\nrouter.get(\n  \"/requisitions/:id/site-rejections\",\n  asyncMiddleware(requisitionController.getRequisitionRejections)\n);\n\nmodule.exports = router;\n","const db = require(\"./../../models\");\nconst ROLES = require(\"../../utils/roles\");\nconst createNotification = require(\"../events\");\n\nconst userDetail = async (id) => {\n  return await db.User.findByPk(id);\n};\n\nconst createRequisition = async (data, userId) => {\n  const requisition = await db.sequelize.transaction(async (t) => {\n    const { items, ...reqData } = data;\n    const requisition = await db.Requisition.create(reqData, {\n      transaction: t,\n    });\n\n    const itemData = items.map((item) => ({\n      requisitionId: requisition.id,\n      itemId: item.itemId,\n      quantity: item.quantity,\n    }));\n\n    await db.RequisitionItem.bulkCreate(itemData, { transaction: t });\n\n    return await db.Requisition.findByPk(requisition.id, {\n      include: [{ model: db.RequisitionItem, as: \"items\" }],\n      transaction: t,\n    });\n  });\n  const user = await userDetail(userId);\n  await createNotification({\n    eventType: \"MaterialRequisition\",\n    eventAction: \"Requested\",\n    referenceId: requisition.id,\n    siteId: requisition.requestingSiteId,\n    createdBy: requisition.preparedById,\n    roles: [ROLES.MECHANICAL_HEAD, ROLES.ADMIN, ROLES.MECHANICAL_MANAGER],\n    title: \"Material Requisition Requested\",\n    description: `New requisition (#${requisition.requisitionNo}) has been created by user #${user.name}.`,\n  });\n\n  return requisition;\n};\n\nconst getRequisitionById = async (id) => {\n  return await db.Requisition.findByPk(id, {\n    include: [\n      { model: db.RequisitionItem, as: \"items\", include: [{ model: db.Item }] },\n      { model: db.User, as: \"preparedBy\", attributes: [\"id\", \"name\", \"email\"] },\n      {\n        model: db.Site,\n        as: \"requestingSite\",\n        attributes: [\"id\", \"name\", \"code\"],\n      },\n      {\n        model: db.User,\n        as: \"approvedByPMUser\",\n        attributes: [\"id\", \"name\", \"email\"],\n      },\n      {\n        model: db.User,\n        as: \"approvedByHOUser\",\n        attributes: [\"id\", \"name\", \"email\"],\n      },\n      { model: db.User, as: \"rejectedBy\", attributes: [\"id\", \"name\", \"email\"] },\n      {\n        model: db.User,\n        as: \"completedBy\",\n        attributes: [\"id\", \"name\", \"email\"],\n      },\n      {\n        model: db.Site,\n        as: \"requestingSite\",\n        attributes: [\"id\", \"name\", \"code\"],\n      },\n      {\n        model: db.MaterialIssue,\n        as: \"materialIssues\",\n        include: [\n          {\n            model: db.User,\n            as: \"issuedBy\",\n            attributes: [\"id\", \"name\", \"email\"],\n          },\n          {\n            model: db.User,\n            as: \"approvedBy\",\n            attributes: [\"id\", \"name\", \"email\"],\n          },\n          {\n            model: db.User,\n            as: \"dispatchedBy\",\n            attributes: [\"id\", \"name\", \"email\"],\n          },\n          {\n            model: db.User,\n            as: \"receivedBy\",\n            attributes: [\"id\", \"name\", \"email\"],\n          },\n          {\n            model: db.Site,\n            as: \"fromSite\",\n            attributes: [\"id\", \"name\", \"code\"],\n          },\n          { model: db.Site, as: \"toSite\", attributes: [\"id\", \"name\", \"code\"] },\n          {\n            model: db.MaterialIssueItem,\n            as: \"items\",\n            include: [{ model: db.Item }],\n          },\n        ],\n      },\n      {\n        model: db.Procurement,\n        as: \"procurements\",\n        include: [\n          {\n            model: db.Vendor,\n          },\n          {\n            model: db.ProcurementItem,\n          },\n        ],\n      },\n      {\n        model: db.RequisitionSiteRejection,\n        as: \"siteRejections\",\n        include: [\n          {\n            model: db.User,\n            as: \"rejectedBy\",\n            attributes: [\"id\", \"name\", \"email\"],\n          },\n        ],\n      },\n    ],\n  });\n};\n\nconst getAllRequisitions = async (siteId) => {\n  const includeOptions = [\n    { model: db.User, as: \"preparedBy\", attributes: [\"id\", \"name\", \"email\"] },\n    {\n      model: db.Site,\n      as: \"requestingSite\",\n      attributes: [\"id\", \"name\", \"code\"],\n    },\n  ];\n  //\"pending\", \"approved\", \"received\", \"rejected\", \"approvedByPm\", \"approvedByHo\", \"completed\"\n  const whereOptions = {};\n  if (siteId) {\n    // OR operation\n    whereOptions[db.Sequelize.Op.or] = [\n      { requestingSiteId: siteId },\n      { status: { [db.Sequelize.Op.in]: [\"approvedByHo\", \"completed\"] } },\n    ];\n  }\n\n  if (!siteId) {\n    whereOptions.status = { [db.Sequelize.Op.notIn]: [\"pending\"] };\n  }\n\n  return await db.Requisition.findAll({\n    where: whereOptions,\n    attributes: [\n      \"id\",\n      \"requisitionNo\",\n      \"status\",\n      \"requestedFor\",\n      \"chargeType\",\n      \"requestPriority\",\n      \"requestedAt\",\n    ],\n    include: includeOptions,\n    order: [[\"requestedAt\", \"DESC\"]],\n  });\n};\nconst approveRequisition = async (requisitionId, userId) => {\n  const requisition = await db.Requisition.findByPk(requisitionId);\n\n  if (!requisition) {\n    throw new Error(\"Requisition not found\");\n  }\n\n  if (requisition.status !== \"pending\") {\n    throw new Error(\"Requisition already processed\");\n  }\n\n  requisition.status = \"approved\";\n  requisition.approvedById = userId;\n  requisition.approvedAt = new Date();\n  await requisition.save();\n  const user = await userDetail(userId);\n  await createNotification({\n    eventType: \"MaterialRequisition\",\n    eventAction: \"Approved\",\n    referenceId: requisition.id,\n    siteId: requisition.requestingSiteId,\n    createdBy: userId,\n    roles: [ROLES.STORE_MANAGER],\n    title: \"Material Requisition Approved\",\n    description: `Requisition (#${requisition.requisitionNo}) has been approved by user #${user.name}.`,\n  });\n\n  return requisition;\n};\n\nconst pmApproveRequisition = async (requisitionId, userId, userName) => {\n  const requisition = await db.Requisition.findByPk(requisitionId, {\n    include: [{ model: db.RequisitionItem, as: \"items\" }],\n  });\n\n  if (!requisition) throw new Error(\"Requisition not found\");\n\n  if (requisition.status !== \"pending\") throw new Error(\"Already processed\");\n\n  requisition.status = \"approvedByPm\";\n  requisition.approvedByPM = userId;\n  requisition.approvedAtPM = new Date();\n  await requisition.save();\n  const user = await userDetail(userId);\n  await createNotification({\n    eventType: \"MaterialRequisition\",\n    eventAction: \"PMApproved\",\n    referenceId: requisition.id,\n    siteId: requisition.requestingSiteId,\n    createdBy: userId,\n    roles: [ROLES.MECHANICAL_HEAD, ROLES.ADMIN, ROLES.MECHANICAL_MANAGER],\n    title: \"Material Requisition PM Approved\",\n    description: `Requisition (#${requisition.requisitionNo}) has been approved by PM #${user.name}.`,\n  });\n\n  return requisition;\n};\n\nconst hoApproveRequisition = async (requisitionId, userId) => {\n  const requisition = await db.Requisition.findByPk(requisitionId, {\n    include: [{ model: db.RequisitionItem, as: \"items\" }],\n  });\n\n  if (!requisition) throw new Error(\"Requisition not found\");\n\n  if (requisition.status !== \"approvedByPm\")\n    throw new Error(\"Requisition must be approved by PM first\");\n\n  requisition.status = \"approvedByHo\";\n  requisition.approvedByHO = userId;\n  requisition.approvedAtHO = new Date();\n  await requisition.save();\n  const user = await userDetail(userId);\n  await createNotification({\n    eventType: \"MaterialRequisition\",\n    eventAction: \"HOApproved\",\n    referenceId: requisition.id,\n    siteId: requisition.requestingSiteId,\n    createdBy: userId,\n    roles: [ROLES.MECHANICAL_HEAD, ROLES.ADMIN, ROLES.MECHANICAL_MANAGER],\n    title: \"Material Requisition HO Approved\",\n    description: `Requisition (#${requisition.requisitionNo}) has been approved by HO #${user.name}.`,\n  });\n\n  return requisition;\n};\n\nconst requisitionDelete = async (requisitionId) => {\n  const requisition = await db.Requisition.findByPk(requisitionId);\n  if (!requisition) throw new Error(\"Requisition not found\");\n\n  await db.sequelize.transaction(async (t) => {\n    await db.RequisitionItem.destroy({\n      where: { requisitionId },\n      transaction: t,\n    });\n    await requisition.destroy({ transaction: t });\n  });\n\n  return { message: \"Requisition deleted successfully\" };\n};\n\nconst completeRequisition = async (requisitionId, userId) => {\n  const requisition = await db.Requisition.findByPk(requisitionId);\n\n  if (!requisition) {\n    throw new Error(\"Requisition not found\");\n  }\n\n  if (requisition.status !== \"approvedByHo\") {\n    throw new Error(\"Only approved requisitions can be marked as completed\");\n  }\n\n  requisition.status = \"completed\";\n  requisition.completedById = userId;\n  requisition.completedAt = new Date();\n  await requisition.save();\n  const user = await userDetail(userId);\n  await createNotification({\n    eventType: \"MaterialRequisition\",\n    eventAction: \"Completed\",\n    referenceId: requisition.id,\n    siteId: requisition.requestingSiteId,\n    createdBy: userId,\n    roles: [ROLES.STORE_MANAGER],\n    title: \"Material Requisition Completed\",\n    description: `Requisition (#${requisition.requisitionNo}) has been marked as completed by user #${user.name}.`,\n  });\n\n  return requisition;\n};\n\nconst rejectRequisition = async (\n  requisitionId,\n  rejectedById,\n  rejectionReason\n) => {\n  const requisition = await db.Requisition.findByPk(requisitionId);\n\n  if (!requisition) {\n    throw new Error(\"Requisition not found\");\n  }\n\n  if ([\"approved\", \"completed\", \"rejected\"].includes(requisition.status)) {\n    throw new Error(\n      `Cannot reject. Requisition is already ${requisition.status}`\n    );\n  }\n\n  requisition.status = \"rejected\";\n  requisition.rejectedById = rejectedById;\n  requisition.rejectedAt = new Date();\n  requisition.rejectionReason = rejectionReason;\n  const user = await userDetail(rejectedById);\n  await requisition.save();\n\n  await createNotification({\n    eventType: \"MaterialRequisition\",\n    eventAction: \"Rejected\",\n    referenceId: requisition.id,\n    siteId: requisition.requestingSiteId,\n    createdBy: rejectedById,\n    roles: [ROLES.STORE_MANAGER],\n    title: \"Material Requisition Rejected\",\n    description: `Requisition (#${requisition.requisitionNo\n      }) has been rejected by user #${user.name}. Reason: ${rejectionReason || \"Not provided\"\n      }`,\n  });\n\n  return requisition;\n};\n\nconst rejectRequisitionBySite = async (requisitionId, rejectionData, user) => {\n  // Get user's site\n  const userWithSite = await db.User.findByPk(user.id, {\n    include: [{ model: db.Site }],\n  });\n  if (!userWithSite || !userWithSite.Site) {\n    throw new Error(\"User must be associated with a site\");\n  }\n\n  // Find the requisition\n  const requisition = await db.Requisition.findByPk(requisitionId);\n\n  if (!requisition) {\n    throw new Error(\"Requisition not found\");\n  }\n  // Check if site is not the requesting site\n  if (userWithSite.siteId === requisition.requestingSiteId) {\n    throw new Error(\"Requesting site cannot reject its own requisition\");\n  }\n\n  // Check if site already rejected this requisition\n  const existingRejection = await db.RequisitionSiteRejection.findOne({\n    where: {\n      requisitionId: requisitionId,\n      siteId: userWithSite.siteId,\n    },\n  });\n\n  if (existingRejection) {\n    throw new Error(\"Site has already rejected this requisition\");\n  }\n\n  // Create the rejection record\n  const rejection = await db.RequisitionSiteRejection.create({\n    requisitionId: requisitionId,\n    siteId: userWithSite.siteId,\n    rejectedById: user.id,\n    rejectionReason: rejectionData.rejectionReason,\n  });\n  return rejection;\n};\n\nconst getRequisitionRejections = async (requisitionId) => {\n  return await db.RequisitionSiteRejection.findAll({\n    where: {\n      requisitionId: requisitionId,\n    },\n    include: [\n      {\n        model: db.Site,\n        as: \"site\",\n        attributes: [\"id\", \"name\", \"location\"],\n      },\n      {\n        model: db.User,\n        as: \"rejectedBy\",\n        attributes: [\"id\", \"name\", \"email\"],\n      },\n    ],\n    order: [[\"rejectedAt\", \"DESC\"]],\n  });\n};\n\nconst updateItemQuantity = async (requisitionId, items) => {\n  return await db.sequelize.transaction(async (t) => {\n    for (const item of items) {\n      const { itemId, newQuantity } = item;\n      const requisitionItem = await db.RequisitionItem.findOne({\n        where: {\n          requisitionId: requisitionId,\n          id: itemId,\n        },\n        transaction: t,\n      });\n      if (!requisitionItem) {\n        throw new Error(\"Requisition item not found\");\n      }\n      requisitionItem.quantity = newQuantity;\n      await requisitionItem.save({ transaction: t });\n    }\n  });\n};\n\nmodule.exports = {\n  createRequisition,\n  getRequisitionById,\n  getAllRequisitions,\n  approveRequisition,\n  pmApproveRequisition,\n  hoApproveRequisition,\n  requisitionDelete,\n  completeRequisition,\n  rejectRequisition,\n  rejectRequisitionBySite,\n  getRequisitionRejections,\n  updateItemQuantity,\n};\n","const Joi = require(\"joi\");\n\nconst requisitionItemSchema = Joi.object({\n  itemId: Joi.number().integer().required(),\n  quantity: Joi.number().positive().required(),\n});\n\nconst createRequisitionSchema = Joi.object({\n  requestedAt: Joi.date().required(),\n  requestingSiteId: Joi.number().required(),\n  requestedFor: Joi.string().required(),\n  chargeType: Joi.string().required(),\n  requestPriority: Joi.string().valid(\"High\", \"Medium\", \"Low\").required(),\n  dueDate: Joi.date().required(),\n  preparedById: Joi.number().required(),\n  items: Joi.array().items(requisitionItemSchema).min(1).required(),\n});\n\nmodule.exports = {\n  createRequisitionSchema,\n};\n","const siteService = require(\"./site.service\");\n\nconst createSite = async (req, res) => {\n  const site = await siteService.createSite(req.body);\n  res.sendResponse(site, \"Site created successfully\");\n};\n\nconst getAllSites = async (req, res) => {\n  const sites = await siteService.getAllSites(req.user.siteId, req.query.searchQuery);\n  res.sendResponse(sites, \"All sites fetched successfully\");\n};\n\nconst getSiteById = async (req, res) => {\n  const site = await siteService.getSiteById(req.params.id);\n  res.sendResponse(site, \"Site fetched successfully\");\n};\n\nconst getVirtualSite = async (req, res) => {\n  const site = await siteService.getVirtualSite();\n  res.sendResponse(site, \"Virtual site fetched successfully\");\n};\n\nconst updateSite = async (req, res) => {\n  const site = await siteService.updateSite(req.params.id, req.body);\n  res.sendResponse(site, \"Site updated successfully\");\n};\n\nconst deleteSite = async (req, res) => {\n  const result = await siteService.deleteSite(req.params.id);\n  res.sendResponse(null, result.message);\n};\nconst restoreSite = async (req, res) => {\n  const result = await siteService.restoreSite(req.params.id);\n  res.sendResponse(null, result.message);\n};\n\n// Get inventory movement logs for a specific site\nconst getSiteInventoryMovement = async (req, res) => {\n  const { id } = req.params;\n  const filters = req.query;\n  const result = await siteService.getSiteInventoryMovement(id, filters);\n  res.sendResponse(result, \"Site inventory movement fetched successfully\");\n};\n\n// Get summary statistics for a specific site\nconst getSiteSummaryStats = async (req, res) => {\n  const { id } = req.params;\n  const stats = await siteService.getSiteSummaryStats(id);\n  res.sendResponse(stats, \"Site summary statistics fetched successfully\");\n};\n\n// Get discrepancy report for a specific site\nconst getDiscrepancyReport = async (req, res) => {\n  const { id } = req.params;\n  const discrepancies = await siteService.getDiscrepancyReport(id);\n  res.sendResponse(discrepancies, \"Discrepancy report fetched successfully\");\n};\n\n// Get procurement summary for virtual site\nconst getVirtualSiteProcurementSummary = async (req, res) => {\n  const summary = await siteService.getVirtualSiteProcurementSummary();\n  res.sendResponse(summary, \"Virtual site procurement summary fetched successfully\");\n};\n\nconst dispatchProcurementItems = async (req, res) => {\n  const result = await siteService.dispatchProcurementItems(req.body);\n  res.sendResponse(result, \"Items dispatched successfully\");\n};\n\nconst getIncomingDispatches = async (req, res) => {\n  const { siteId } = req.user;\n  const dispatches = await siteService.getIncomingDispatches(siteId);\n  res.sendResponse(dispatches, \"Incoming dispatches fetched successfully\");\n};\n\nconst receiveDispatch = async (req, res) => {\n  const { siteId, dispatchId } = req.params;\n  const result = await siteService.receiveDispatch(siteId, dispatchId);\n  res.sendResponse(result, \"Dispatch received successfully\");\n};\n\nmodule.exports = {\n  createSite,\n  getAllSites,\n  getSiteById,\n  getVirtualSite,\n  updateSite,\n  deleteSite,\n  restoreSite,\n  getSiteInventoryMovement,\n  getSiteSummaryStats,\n  getDiscrepancyReport,\n  getVirtualSiteProcurementSummary,\n  dispatchProcurementItems,\n  getIncomingDispatches,\n  receiveDispatch,\n};\n","const express = require(\"express\");\nconst siteController = require(\"./site.controller\");\nconst SiteSchema = require(\"./site.validator\");\nconst validateRequest = require(\"../../middlewares/validateRequest\");\nconst asyncMiddleware = require(\"../../middlewares/asyncMiddleware\");\nconst hasRole = require(\"../../middlewares/hasRole\");\n\nconst router = express.Router();\n\n// Virtual site and inventory movement routes - MUST BE BEFORE /:id\nrouter.get(\"/virtual\", asyncMiddleware(siteController.getVirtualSite));\nrouter.get(\"/virtual/procurement-summary\", asyncMiddleware(siteController.getVirtualSiteProcurementSummary));\nrouter.post(\"/virtual/dispatch\", asyncMiddleware(siteController.dispatchProcurementItems));\n\nrouter.post(\"/\", validateRequest(SiteSchema.createSiteSchema), asyncMiddleware(siteController.createSite));\nrouter.get(\"/\", asyncMiddleware(siteController.getAllSites));\n\nrouter.get(\"/:id/inventory-movement\", asyncMiddleware(siteController.getSiteInventoryMovement));\nrouter.get(\"/:id/summary-stats\", asyncMiddleware(siteController.getSiteSummaryStats));\nrouter.get(\"/:id/discrepancy-report\", asyncMiddleware(siteController.getDiscrepancyReport));\nrouter.get(\"/:siteId/incoming-dispatches\", asyncMiddleware(siteController.getIncomingDispatches));\nrouter.post(\"/:siteId/dispatch/:dispatchId/receive\", asyncMiddleware(siteController.receiveDispatch));\n\nrouter.get(\"/:id\", asyncMiddleware(siteController.getSiteById));\nrouter.put(\"/:id\", hasRole([1, 2, 3]), validateRequest(SiteSchema.updateSiteSchema), asyncMiddleware(siteController.updateSite));\nrouter.delete(\"/:id\", hasRole([1, 2, 3]), asyncMiddleware(siteController.deleteSite));\nrouter.post(\"/:id/restore\", hasRole([1, 2, 3]), asyncMiddleware(siteController.restoreSite));\n\nmodule.exports = router;\n","const db = require(\"../../models\");\nconst { Op, Sequelize, col, fn, literal } = require(\"sequelize\");\n\nconst createSite = async (data) => {\n  const site = await db.Site.create(data);\n  return site;\n};\n\nconst getAllSites = async (siteId, searchQuery) => {\n  // If searchQuery is provided, filter sites by name or code\n  if (searchQuery) {\n    return await db.Site.findAll({\n      where: {\n        [db.Sequelize.Op.or]: [\n          { name: { [db.Sequelize.Op.like]: `%${searchQuery}%` } },\n          { code: { [db.Sequelize.Op.like]: `%${searchQuery}%` } },\n          { address: { [db.Sequelize.Op.like]: `%${searchQuery}%` } },\n        ],\n      },\n      include: [{ model: db.Department, attributes: [\"id\", \"name\"] }],\n    });\n  }\n  return await db.Site.findAll({\n    include: [{ model: db.Department, attributes: [\"id\", \"name\"] }],\n  });\n};\n\nconst getSiteById = async (id) => {\n  const site = await db.Site.findByPk(id, {\n    include: [\n      { model: db.Department, attributes: [\"id\", \"name\"] },\n      {\n        model: db.Machinery,\n        attributes: [\"id\", \"machineName\", \"capacity\", \"ownerName\", \"ownerType\"],\n      },\n    ],\n  });\n  if (!site) {\n    throw new Error(\"Site not found.\");\n  }\n  return site;\n};\n\nconst getVirtualSite = async () => {\n  const virtualSite = await db.Site.findOne({\n    where: { type: \"virtual\" },\n    include: [{ model: db.Department, attributes: [\"id\", \"name\"] }],\n  });\n  return virtualSite;\n};\n\nconst updateSite = async (id, data) => {\n  const site = await db.Site.findByPk(id);\n  if (!site) {\n    throw new Error(\"Site not found.\");\n  }\n  return await site.update(data);\n};\n\nconst deleteSite = async (id) => {\n  const site = await db.Site.findByPk(id);\n  if (!site) {\n    throw new Error(\"Site not found.\");\n  }\n  await site.destroy();\n  return { message: \"Site deleted successfully.\" };\n};\nconst restoreSite = async (id) => {\n  const site = await db.Site.findByPk(id, { paranoid: false }); // Include soft-deleted records\n  if (!site) {\n    throw new Error(\"Site not found.\");\n  }\n  if (!site.deletedAt) {\n    throw new Error(\"Site is not deleted.\");\n  }\n  await site.restore(); // Restores the soft-deleted record\n  return { message: \"Site restored successfully.\" };\n};\n\nconst getAllSitesV2 = async (req, res) => {\n  const {\n    page = 1,\n    limit = 20,\n    search = \"\",\n    sortBy = \"name\",\n    sortOrder = \"ASC\",\n    departmentId,\n    status,\n  } = req.query;\n\n  const offset = (page - 1) * limit;\n  const whereClause = {};\n\n  if (search) {\n    whereClause[Op.or] = [\n      { name: { [Op.iLike]: `%${search}%` } },\n      { code: { [Op.iLike]: `%${search}%` } },\n      { address: { [Op.iLike]: `%${search}%` } },\n    ];\n  }\n\n  if (departmentId) whereClause.departmentId = departmentId;\n  if (status) whereClause.status = status;\n\n  const { count, rows: sites } = await db.Site.findAndCountAll({\n    where: whereClause,\n    include: [{ model: db.Department, attributes: [\"id\", \"name\"] }],\n    order: [[sortBy, sortOrder]],\n    offset,\n    limit,\n  });\n\n  res.sendResponse({\n    data: sites,\n    totalCount: count,\n    totalPages: Math.ceil(count / limit),\n    currentPage: Number(page),\n  });\n};\n\n// Get inventory movement logs for a specific site (especially virtual site)\n\nconst getSiteInventoryMovement = async (siteId, filters = {}) => {\n  const { startDate, endDate, itemType, page = 1, limit = 20 } = filters;\n\n  const whereClause = { siteId };\n  if (startDate && endDate) {\n    whereClause.createdAt = {\n      [Op.between]: [new Date(startDate), new Date(endDate)],\n    };\n  }\n\n  // Define the common grouping attributes\n  const groupAttributes = [\n    \"itemId\",\n    \"sourceType\",\n    \"sourceId\",\n    // We group by these so they appear in the result row\n    col(\"Item.id\"),\n    col(\"Item.name\"),\n    col(\"Item.ItemGroup.id\"),\n    col(\"Item.ItemGroup.name\"),\n  ];\n\n  // 1. Initial Aggregation Query (Modified Attributes)\n  const { count, rows: groupedLogs } = await db.StockLog.findAndCountAll({\n    where: whereClause,\n    attributes: [\n      // Select the grouping columns\n      ...groupAttributes,\n      // Sum the 'change' for 'IN' type movements\n      [\n        fn(\"SUM\", literal(\"CASE WHEN type = 'IN' THEN change ELSE 0 END\")),\n        \"totalIn\",\n      ],\n      // Sum the 'change' for 'OUT' type movements\n      [\n        fn(\"SUM\", literal(\"CASE WHEN type = 'OUT' THEN change ELSE 0 END\")),\n        \"totalOut\",\n      ],\n\n      //  NEW: Capture the earliest date of any IN movement\n      [\n        fn(\n          \"MIN\",\n          literal(\"CASE WHEN type = 'IN' THEN \\\"createdAt\\\" ELSE NULL END\")\n        ),\n        \"firstInDate\",\n      ],\n      //  NEW: Capture the latest date of any IN movement\n      [\n        fn(\n          \"MAX\",\n          literal(\"CASE WHEN type = 'IN' THEN \\\"createdAt\\\" ELSE NULL END\")\n        ),\n        \"latestInDate\",\n      ],\n      //  NEW: Capture the earliest date of any OUT movement\n      [\n        fn(\n          \"MIN\",\n          literal(\"CASE WHEN type = 'OUT' THEN \\\"createdAt\\\" ELSE NULL END\")\n        ),\n        \"firstOutDate\",\n      ],\n      //  NEW: Capture the latest date of any OUT movement\n      [\n        fn(\n          \"MAX\",\n          literal(\"CASE WHEN type = 'OUT' THEN \\\"createdAt\\\" ELSE NULL END\")\n        ),\n        \"latestOutDate\",\n      ],\n    ],\n    include: [\n      {\n        model: db.Item,\n        attributes: [\"id\", \"name\"], // Explicitly select attributes for Item\n        include: [{ model: db.ItemGroup, attributes: [\"id\", \"name\"] }],\n      },\n    ],\n    group: groupAttributes, // Apply grouping\n    order: [\n      // You can order by the latest date across all movements if needed\n      [fn(\"MAX\", col(\"createdAt\")), \"DESC\"],\n    ],\n    limit: parseInt(limit),\n    offset: (parseInt(page) - 1) * parseInt(limit),\n  });\n\n  // 2. Dynamic Formatting for each Grouped Row\n  const formattedLogs = await Promise.all(\n    groupedLogs.map(async (log) => {\n      let reference = \"\";\n      let sourceDescription = null;\n      let destinationDescription = null;\n\n      const logData = log.get({ plain: true }); // Get plain JSON data including aggregated fields\n\n      // Fetch Requisition if needed (moved up for Procurement case to use it)\n      let req = null;\n      if (logData.sourceType === \"Requisition\") {\n        req = await db.Requisition.findByPk(logData.sourceId, {\n          include: [{ model: db.Site, as: \"requestingSite\" }],\n        });\n      }\n      if (logData.sourceType === \"Procurement\" && !req) {\n        req = await db.Procurement.findByPk(logData.sourceId, {\n          include: [\n            {\n              model: db.Requisition,\n              attributes: [\"id\", \"requisitionNo\"],\n              include: [{ model: db.Site, as: \"requestingSite\" }],\n            },\n          ],\n        });\n      }\n\n      // We now rely on the presence of totalIn/totalOut for conditional logic\n      switch (logData.sourceType) {\n        case \"Issue\":\n        case \"Consumption\":\n          const issue = await db.MaterialIssue.findByPk(logData.sourceId, {\n            include: [\n              { model: db.Site, as: \"fromSite\" },\n              { model: db.Site, as: \"toSite\" },\n            ],\n          });\n          if (issue) {\n            if (issue.issueType === \"Site Transfer\") {\n              sourceDescription = issue.fromSite?.name || \"Unknown Site\";\n              destinationDescription = issue.toSite?.name || \"Another Site\";\n              reference = `Transfer by ${issue.issueNumber}`;\n            } else {\n              // Other Issue types (e.g., consumption/adjustments based on issue)\n              sourceDescription = issue.fromSite?.name || \"-\";\n              destinationDescription = \"Consumption\";\n              reference = `Issue by ${issue.issueNumber}`;\n            }\n          }\n          break;\n\n        case \"Requisition\":\n          if (req) {\n            sourceDescription = \"Fulfilling Requisition (Current Site)\";\n            destinationDescription =\n              req.requestingSite?.name || \"Requesting Site\";\n            reference = `Requisition by ${req.requisitionNo}`;\n          }\n          break;\n\n        case \"Procurement\":\n          const po = await db.Procurement.findByPk(logData.sourceId);\n          if (po) {\n            // For Procurement, destination is usually the requesting site (which is the current site's name)\n            // If the Procurement model directly links to the current site (siteId), use that name\n            // Otherwise, Procurement may not have a requestingSite association, so we set it to 'Current Site'\n            sourceDescription = \"Supplier/External Source\";\n            destinationDescription =\n              req?.requestingSite?.name || \"Current Site (Receipt)\";\n            reference = `Procurement by ${po.procurementNo}`;\n          }\n          break;\n\n        case \"Dispatch\":\n          const dispatch = await db.Dispatch.findByPk(logData.sourceId, {\n            include: [\n              {\n                model: db.Procurement,\n                include: [{ model: db.Requisition, include: [{ model: db.Site, as: \"requestingSite\" }] }]\n              }\n            ]\n          });\n\n          if (dispatch && dispatch.Procurement) {\n            const reqSiteName = dispatch.Procurement.Requisition?.requestingSite?.name || \"Unknown Site\";\n            if (logData.type === 'OUT') {\n              // Virtual Site Perspective\n              sourceDescription = \"Virtual Site\";\n              destinationDescription = reqSiteName;\n            } else {\n              // Requesting Site Perspective\n              sourceDescription = \"Virtual Site\";\n              destinationDescription = reqSiteName;\n            }\n            reference = `Dispatch for PO ${dispatch.Procurement.procurementNo} (${dispatch.vehicleNo || 'No Vehicle'})`;\n          }\n          break;\n\n        default:\n          reference = logData.sourceType || \"Other\";\n          sourceDescription =\n            logData.totalOut > 0 ? \"Current Site\" : \"External Source\";\n          destinationDescription =\n            logData.totalIn > 0 ? \"Current Site\" : \"External Destination\";\n      }\n\n      return {\n        ...logData,\n        reference,\n        sourceDescription,\n        destinationDescription,\n\n        //  NEW: Expose the new date fields\n        inDates: logData.firstInDate,\n        outDates: logData.firstOutDate,\n      };\n    })\n  );\n\n  return {\n    data: formattedLogs,\n    totalCount: Array.isArray(count) ? count.length : count,\n    totalPages: Math.ceil(\n      (Array.isArray(count) ? count.length : count) / limit\n    ),\n    currentPage: parseInt(page),\n  };\n};\n// Get summary statistics for a specific site (especially virtual site)\nconst getSiteSummaryStats = async (siteId) => {\n  const [inMovements, outMovements, currentInventory] = await Promise.all([\n    // Total IN movements\n    db.StockLog.sum(\"change\", {\n      where: { siteId, type: \"IN\" },\n    }),\n    // Total OUT movements\n    db.StockLog.sum(\"change\", {\n      where: { siteId, type: \"OUT\" },\n    }),\n    // Current inventory at site\n    db.SiteInventory.sum(\"quantity\", {\n      where: { siteId },\n    }),\n  ]);\n\n  const [inCount, outCount] = await Promise.all([\n    db.StockLog.count({\n      where: { siteId, type: \"IN\" },\n    }),\n    db.StockLog.count({\n      where: { siteId, type: \"OUT\" },\n    }),\n  ]);\n\n  return {\n    totalIn: inMovements || 0,\n    totalOut: outMovements || 0,\n    currentInventory: currentInventory || 0,\n    inTransactionCount: inCount || 0,\n    outTransactionCount: outCount || 0,\n    netMovement: (inMovements || 0) - (outMovements || 0),\n  };\n};\n\n// Get discrepancy report for a site (items that don't match expected vs actual)\nconst getDiscrepancyReport = async (siteId) => {\n  // Find stock logs that might have discrepancies\n  // This looks for cases where items went IN to virtual site but didn't come OUT properly or vice versa\n  const allLogs = await db.StockLog.findAll({\n    where: { siteId },\n    include: [{ model: db.Item }],\n    order: [[\"createdAt\", \"ASC\"]],\n  });\n\n  // Group by item and check for discrepancies\n  const itemMovements = {};\n  allLogs.forEach((log) => {\n    if (!itemMovements[log.itemId]) {\n      itemMovements[log.itemId] = {\n        item: log.Item,\n        inTotal: 0,\n        outTotal: 0,\n        net: 0,\n      };\n    }\n\n    if (log.type === \"IN\") {\n      itemMovements[log.itemId].inTotal += log.change;\n      itemMovements[log.itemId].net += log.change;\n    } else {\n      itemMovements[log.itemId].outTotal += log.change;\n      itemMovements[log.itemId].net -= log.change;\n    }\n  });\n\n  // Filter items with discrepancies (non-zero net at virtual site)\n  const discrepancies = Object.values(itemMovements).filter(\n    (item) => item.net !== 0\n  );\n\n  return discrepancies;\n};\n\n// Get procurement summary for virtual site\nconst getVirtualSiteProcurementSummary = async () => {\n  const virtualSite = await getVirtualSite();\n  if (!virtualSite) {\n    throw new Error(\"Virtual site not found\");\n  }\n\n  // 1. Fetch IN movements (Accepted Procurements)\n  const inMovements = await db.StockLog.findAll({\n    where: {\n      siteId: virtualSite.id,\n      type: \"IN\",\n      sourceType: \"Procurement\",\n    },\n    include: [{ model: db.Item }],\n    order: [[\"createdAt\", \"DESC\"]],\n  });\n\n  // Group movements by procurement source ID\n  const procurementMap = {};\n  const orderedProcurementIds = []; //  Maintain order based on latest movement\n\n  inMovements.forEach((log) => {\n    if (!procurementMap[log.sourceId]) {\n      procurementMap[log.sourceId] = {\n        procurementId: log.sourceId,\n        items: [],\n        totalIn: 0,\n        totalOut: 0,\n        dispatchedItems: {}, // itemId -> quantity\n      };\n      orderedProcurementIds.push(log.sourceId); //  Add to ordered list\n    }\n    procurementMap[log.sourceId].items.push({\n      item: log.Item,\n      change: log.change,\n      type: log.type,\n      createdAt: log.createdAt,\n    });\n    procurementMap[log.sourceId].totalIn += log.change;\n  });\n\n  // Fetch Procurement details (procurementNo, Requisition, Requesting Site) AND Dispatches\n  if (orderedProcurementIds.length > 0) {\n    const procurements = await db.Procurement.findAll({\n      where: { id: orderedProcurementIds },\n      attributes: [\"id\", \"procurementNo\", \"createdAt\"],\n      include: [\n        {\n          model: db.Requisition,\n          attributes: [\"id\", \"requisitionNo\"],\n          include: [{ model: db.Site, as: \"requestingSite\", attributes: [\"id\", \"name\"] }],\n        },\n        {\n          model: db.Dispatch,\n          include: [{ model: db.DispatchItem, as: \"items\" }],\n        },\n      ],\n    });\n\n    procurements.forEach((proc) => {\n      if (procurementMap[proc.id]) {\n        procurementMap[proc.id].procurementNo = proc.procurementNo;\n        procurementMap[proc.id].procurementDate = proc.createdAt;\n        procurementMap[proc.id].requisitionNo = proc.Requisition?.requisitionNo || \"N/A\";\n        procurementMap[proc.id].destinationSite = proc.Requisition?.requestingSite?.name || \"Unknown\";\n\n        // Calculate total dispatched per item\n        if (proc.Dispatches) {\n          proc.Dispatches.forEach((dispatch) => {\n            if (dispatch.items) {\n              dispatch.items.forEach((dItem) => {\n                if (!procurementMap[proc.id].dispatchedItems[dItem.itemId]) {\n                  procurementMap[proc.id].dispatchedItems[dItem.itemId] = 0;\n                }\n                procurementMap[proc.id].dispatchedItems[dItem.itemId] += dItem.quantity;\n                procurementMap[proc.id].totalOut += dItem.quantity;\n              });\n            }\n          });\n        }\n      }\n    });\n  }\n\n  return {\n    virtualSiteId: virtualSite.id,\n    virtualSiteName: virtualSite.name,\n    procurementMovements: orderedProcurementIds.map(id => procurementMap[id]), //  Return in captured order\n    summary: {\n      totalIn: inMovements.reduce((sum, log) => sum + log.change, 0),\n      totalOut: Object.values(procurementMap).reduce((sum, p) => sum + p.totalOut, 0),\n      activeProcurements: orderedProcurementIds.length,\n    },\n  };\n};\n\nconst dispatchProcurementItems = async (data) => {\n  const { procurementId, items, vehicleNo, driverName, remarks } = data; // items: [{ itemId, quantity }]\n\n  const transaction = await db.sequelize.transaction();\n  try {\n    const virtualSite = await getVirtualSite();\n    if (!virtualSite) throw new Error(\"Virtual site not found\");\n\n    const procurement = await db.Procurement.findByPk(procurementId, {\n      include: [\n        {\n          model: db.Requisition,\n          include: [{ model: db.Site, as: \"requestingSite\" }],\n        },\n      ],\n      transaction,\n    });\n\n    if (!procurement) throw new Error(\"Procurement not found\");\n\n    const requestingSite = procurement.Requisition?.requestingSite;\n    if (!requestingSite) throw new Error(\"Requesting site not found for this procurement\");\n\n    // 1. Create Dispatch Record\n    const dispatch = await db.Dispatch.create({\n      vehicleNo,\n      driverName,\n      remarks,\n      procurementId: procurement.id,\n      fromSiteId: virtualSite.id,\n      toSiteId: requestingSite.id\n    }, { transaction });\n\n    for (const item of items) {\n      // 2. Check Virtual Site Inventory\n      const virtualInventory = await db.SiteInventory.findOne({\n        where: { siteId: virtualSite.id, itemId: item.itemId },\n        transaction,\n      });\n\n      if (!virtualInventory || virtualInventory.quantity < item.quantity) {\n        throw new Error(`Insufficient stock for item ID ${item.itemId} in Virtual Site`);\n      }\n\n      // 3. Create Dispatch Item Record\n      await db.DispatchItem.create({\n        dispatchId: dispatch.id,\n        itemId: item.itemId,\n        quantity: item.quantity\n      }, { transaction });\n\n      // 4. Update Virtual Site Inventory (deduct quantity)\n      await virtualInventory.decrement(\"quantity\", { by: item.quantity, transaction });\n\n      // 5. Log OUT from Virtual Site\n      await db.StockLog.create(\n        {\n          siteId: virtualSite.id,\n          itemId: item.itemId,\n          change: item.quantity,\n          type: \"OUT\",\n          sourceType: \"Dispatch\",\n          sourceId: dispatch.id, // Link to Dispatch record\n          userId: null,\n        },\n        { transaction }\n      );\n    }\n\n    await transaction.commit();\n    return { message: \"Items dispatched successfully\", dispatchId: dispatch.id };\n  } catch (error) {\n    await transaction.rollback();\n    throw error;\n  }\n};\n\nconst getIncomingDispatches = async (siteId) => {\n\n  return await db.Dispatch.findAll({\n    where: {\n      toSiteId: siteId,\n      status: \"dispatched\",\n    },\n    include: [\n      {\n        model: db.DispatchItem,\n        as: \"items\",\n        include: [\n          {\n            model: db.Item,\n            attributes: [\"id\", \"name\", \"partNumber\"],\n            include: [{ model: db.Unit, attributes: [\"name\", \"shortName\"] }],\n          },\n        ],\n      },\n      {\n        model: db.Procurement,\n        attributes: [\"procurementNo\"],\n      },\n      {\n        model: db.Site,\n        as: \"fromSite\",\n        attributes: [\"name\"],\n      },\n    ],\n    order: [[\"createdAt\", \"DESC\"]],\n  });\n};\n\nconst receiveDispatch = async (siteId, dispatchId) => {\n  const transaction = await db.sequelize.transaction();\n  try {\n    const dispatch = await db.Dispatch.findOne({\n      where: { id: dispatchId, toSiteId: siteId, status: \"dispatched\" },\n      include: [{ model: db.DispatchItem, as: \"items\" }],\n      transaction,\n    });\n\n    if (!dispatch) {\n      throw new Error(\"Dispatch not found or already received\");\n    }\n\n    for (const dItem of dispatch.items) {\n      // 1. Add to Site Inventory\n      const [inventory, created] = await db.SiteInventory.findOrCreate({\n        where: { siteId: siteId, itemId: dItem.itemId },\n        defaults: { quantity: 0 },\n        transaction,\n      });\n\n      await inventory.increment(\"quantity\", { by: dItem.quantity, transaction });\n\n      // 2. Log IN to Site\n      await db.StockLog.create(\n        {\n          siteId: siteId,\n          itemId: dItem.itemId,\n          change: dItem.quantity,\n          type: \"IN\",\n          sourceType: \"Dispatch\",\n          sourceId: dispatch.id,\n          userId: null, // Could capture user ID if available in context\n        },\n        { transaction }\n      );\n    }\n\n    // 3. Update Dispatch Status\n    await dispatch.update({ status: \"received\" }, { transaction });\n\n    await transaction.commit();\n    return { message: \"Dispatch received successfully\" };\n  } catch (error) {\n    await transaction.rollback();\n    throw error;\n  }\n};\n\nmodule.exports = {\n  createSite,\n  getAllSites,\n  getSiteById,\n  getVirtualSite,\n  updateSite,\n  deleteSite,\n  restoreSite,\n  getAllSitesV2,\n  getSiteInventoryMovement,\n  getSiteSummaryStats,\n  getDiscrepancyReport,\n  getVirtualSiteProcurementSummary,\n  dispatchProcurementItems,\n  getIncomingDispatches,\n  receiveDispatch,\n};\n","const Joi = require(\"joi\");\n\nconst createSiteSchema = Joi.object({\n  name: Joi.string().min(3).max(100).required().messages({\n    \"string.base\": \"Name must be a string\",\n    \"string.empty\": \"Name is required\",\n    \"string.min\": \"Name must be at least 3 characters long\",\n    \"string.max\": \"Name must not exceed 100 characters\",\n    \"any.required\": \"Name is required\",\n  }),\n  // code: Joi.string().min(3).max(100).required().messages({\n  //   \"string.base\": \"Site code must be a string\",\n  //   \"string.empty\": \"Site code is required\",\n  //   \"string.min\": \"Site code must be at least 3 characters long\",\n  //   \"string.max\": \"Site code must not exceed 100 characters\",\n  //   \"any.required\": \"Site code is required\",\n  // }),\n  address: Joi.string().min(3).max(200).required().messages({\n    \"string.base\": \"Site adress must be a string\",\n    \"string.empty\": \"Site adress is required\",\n    \"string.min\": \"Site adress must be at least 3 characters long\",\n    \"string.max\": \"Site adress must not exceed 200 characters\",\n    \"any.required\": \"Site adress is required\",\n  }),\n  departmentId: Joi.number().integer().positive().required().messages({\n    \"number.base\": \"Department ID must be a number\",\n    \"number.integer\": \"Department ID must be an integer\",\n    \"number.positive\": \"Department ID must be a positive number\",\n    \"any.required\": \"Department ID is required\",\n  }),\n  mobileNumber: Joi.string().optional().messages({\n    \"string.base\": \"Mobile number must be a string\",\n    \"string.empty\": \"Mobile number is required\",\n  }),\n  pincode: Joi.string().optional().messages({\n    \"string.base\": \"Pincode must be a string\",\n    \"string.empty\": \"Pincode is required\",\n  }),\n  code: Joi.string()\n    .allow(null, \"\") // allows null and empty string\n    .optional(),\n  status: Joi.string()\n    .valid(\"active\", \"closed\", \"paused\")\n    .default(\"active\")\n    .messages({\n      \"any.only\": 'Status must be one of \"active\", \"closed\", or \"paused\"',\n    }),\n});\n\nconst updateSiteSchema = Joi.object({\n  name: Joi.string().min(3).max(100).optional().messages({\n    \"string.base\": \"Name must be a string\",\n    \"string.empty\": \"Name must not be empty\",\n    \"string.min\": \"Name must be at least 3 characters long\",\n    \"string.max\": \"Name must not exceed 100 characters\",\n  }),\n  // code: Joi.string().min(3).max(100).required().messages({\n  //   \"string.base\": \"Site code must be a string\",\n  //   \"string.empty\": \"Site code is required\",\n  //   \"string.min\": \"Site code must be at least 3 characters long\",\n  //   \"string.max\": \"Site code must not exceed 100 characters\",\n  //   \"any.required\": \"Site code is required\",\n  // }),\n  address: Joi.string().min(3).max(200).required().messages({\n    \"string.base\": \"Site adress must be a string\",\n    \"string.empty\": \"Site adress is required\",\n    \"string.min\": \"Site adress must be at least 3 characters long\",\n    \"string.max\": \"Site adress must not exceed 200 characters\",\n    \"any.required\": \"Site adress is required\",\n  }),\n  mobileNumber: Joi.string().optional().messages({\n    \"string.base\": \"Mobile number must be a string\",\n    \"string.empty\": \"Mobile number is required\",\n  }),\n  departmentId: Joi.number().integer().positive().optional().messages({\n    \"number.base\": \"Department ID must be a number\",\n    \"number.integer\": \"Department ID must be an integer\",\n    \"number.positive\": \"Department ID must be a positive number\",\n  }),\n  status: Joi.string().valid(\"active\", \"closed\", \"paused\").optional().messages({\n    \"any.only\": 'Status must be one of \"active\", \"closed\", or \"paused\"',\n  }),\n  pincode: Joi.string().optional().messages({\n    \"string.base\": \"Pincode must be a string\",\n    \"string.empty\": \"Pincode is required\",\n  }),\n});\n\nmodule.exports = {\n  createSiteSchema,\n  updateSiteSchema,\n};\n","const userService = require(\"./user.service\");\n\nasync function createUser(req, res) {\n  const user = await userService.createUser(req.body);\n  res.sendResponse(user, \"User created successfully\", 201);\n}\n\nasync function getAllUsers(req, res) {\n  const users = await userService.getAllUsers(req.user.siteId);\n  res.sendResponse(users, \"Users retrieved successfully\");\n}\n\nasync function getUserById(req, res) {\n  const user = await userService.getUserById(req.params.id, req.user.siteId);\n  if (!user) {\n    const error = new Error();\n    error.message = \"User not found\";\n    error.name = \"ResourceNotFoundError\";\n    error.statusCode = 404;\n    throw error;\n  }\n  res.sendResponse(user, \"User retrieved successfully\");\n}\n\nasync function updateUser(req, res) {\n  const user = await userService.updateUser(req.params.id, req.body);\n  res.sendResponse(user, \"User updated successfully\");\n}\n\nasync function deleteUser(req, res) {\n  await userService.deleteUser(req.params.id);\n  res.sendResponse(\"User deleted successfully\");\n}\n\nasync function restoreUser(req, res) {\n  const user = await userService.restoreUser(req.params.id);\n  res.sendResponse(user, \"User restored successfully\");\n}\n\nmodule.exports = {\n  createUser,\n  getAllUsers,\n  getUserById,\n  updateUser,\n  deleteUser,\n  restoreUser,\n};\n","const express = require(\"express\");\nconst userController = require(\"./user.controller\");\nconst userSchema = require(\"./user.validator\");\nconst validateRequest = require(\"../../middlewares/validateRequest\");\nconst asyncMiddleware = require(\"../../middlewares/asyncMiddleware\");\nconst hasRole = require(\"../../middlewares/hasRole\");\n\nconst router = express.Router();\n\nrouter.post(\"/\", hasRole([1, 2, 3]), validateRequest(userSchema.createUserSchema), asyncMiddleware(userController.createUser));\nrouter.get(\"/\", asyncMiddleware(userController.getAllUsers));\nrouter.get(\"/:id\", asyncMiddleware(userController.getUserById));\nrouter.put(\"/:id\", hasRole([1, 2, 3]), validateRequest(userSchema.updateUserSchema), asyncMiddleware(userController.updateUser));\nrouter.delete(\"/:id\", hasRole([1, 2, 3]), asyncMiddleware(userController.deleteUser));\nrouter.post(\"/:id/restore\", hasRole([1, 2, 3]), asyncMiddleware(userController.restoreUser));\n\nmodule.exports = router;\n","const { Op } = require(\"sequelize\");\nconst db = require(\"../../models\");\n\nasync function createUser(userData) {\n  return await db.User.create(userData);\n}\n\nasync function getAllUsers(siteId) {\n  return await db.User.findAll({\n    where: siteId ? { siteId } : {},\n    include: [\n      { model: db.Role, attributes: [\"name\", \"id\"] },\n      { model: db.Site, attributes: [\"name\", \"id\"] },\n    ],\n    attributes: { exclude: [\"password\"] },\n  });\n}\n\nasync function getUserById(userId, siteId) {\n  if (!userId) {\n    throw new Error(\"User ID is required\");\n  }\n  const whereCondition = { id: userId };\n\n  if (siteId) {\n    whereCondition.siteId = siteId;\n  }\n  return await db.User.findOne({\n    where: whereCondition,\n    include: [\n      { model: db.Role, attributes: [\"name\", \"id\"] },\n      { model: db.Site },\n    ],\n    attributes: { exclude: [\"password\"] },\n  });\n}\n\nasync function updateUser(userId, updateData) {\n  const user = await db.User.findByPk(userId, {\n    attributes: { exclude: [\"password\"] },\n  });\n  if (!user) {\n    const error = new Error();\n    error.message = \"User not found\";\n    error.name = \"ResourceNotFoundError\";\n    error.statusCode = 404;\n    throw error;\n  }\n  return await user.update(updateData);\n}\n\nasync function deleteUser(userId) {\n  const user = await db.User.findByPk(userId);\n  if (!user) {\n    const error = new Error();\n    error.message = \"User not found\";\n    error.name = \"ResourceNotFoundError\";\n    error.statusCode = 404;\n    throw error;\n  }\n  await user.destroy();\n  return user;\n}\n\nasync function restoreUser(userId) {\n  const user = await db.User.findByPk(userId, { paranoid: false });\n  if (!user) {\n    const error = new Error();\n    error.message = \"User not found\";\n    error.name = \"ResourceNotFoundError\";\n    error.statusCode = 404;\n    throw error;\n  }\n  await user.restore();\n  return user;\n}\n\nasync function getAllUsersV2({\n  siteId,\n  page = 1,\n  limit = 10,\n  orderBy = \"name\",\n  orderDirection = \"ASC\",\n  search = \"\",\n  filters = {},\n}) {\n  const offset = (page - 1) * limit;\n\n  const whereClause = {\n    ...(siteId && { siteId }),\n    ...filters,\n    ...(search && {\n      [Op.or]: [\n        { name: { [Op.iLike]: `%${search}%` } },\n        { email: { [Op.iLike]: `%${search}%` } },\n        { phone: { [Op.iLike]: `%${search}%` } },\n        { code: { [Op.iLike]: `%${search}%` } },\n      ],\n    }),\n  };\n\n  const { count, rows } = await db.User.findAndCountAll({\n    where: whereClause,\n    include: [\n      { model: db.Role, attributes: [\"id\", \"name\"] },\n      { model: db.Site, attributes: [\"id\", \"name\"] },\n    ],\n    order: [[orderBy, orderDirection]],\n    limit,\n    offset,\n  });\n\n  return {\n    data: rows,\n    currentPage: page,\n    totalPages: Math.ceil(count / limit),\n    totalCount: count,\n  };\n}\n\nmodule.exports = {\n  createUser,\n  getAllUsers,\n  getUserById,\n  updateUser,\n  deleteUser,\n  restoreUser,\n  getAllUsersV2,\n};\n","const Joi = require(\"joi\");\n\nconst createUserSchema = Joi.object({\n  name: Joi.string().required().messages({ \"any.required\": \"Name is required\" }),\n  code: Joi.string().required().messages({ \"any.required\": \"Code is required\" }),\n  email: Joi.string().email().required().messages({\n    \"string.email\": \"Invalid email format\",\n    \"any.required\": \"Email is required\",\n  }),\n  phone: Joi.string().required().messages({ \"any.required\": \"Phone is required\" }),\n  imageUrl: Joi.string().uri().optional().messages({ \"string.uri\": \"Invalid image URL\" }),\n  password: Joi.string().min(6).required().messages({\n    \"string.min\": \"Password must be at least 6 characters long\",\n    \"any.required\": \"Password is required\",\n  }),\n  roleId: Joi.number().required().messages({ \"any.required\": \"Role ID is required\" }),\n  departmentId: Joi.number().optional(),\n  siteId: Joi.number().optional(),\n});\n\nconst updateUserSchema = Joi.object({\n  name: Joi.string().optional(),\n  code: Joi.string().optional(),\n  email: Joi.string().email().optional(),\n  phone: Joi.string().optional(),\n  imageUrl: Joi.string().uri().optional(),\n  password: Joi.string().min(6).optional(),\n  roleId: Joi.number().optional(),\n  departmentId: Joi.number().optional(),\n  siteId: Joi.number().optional(),\n});\n\n\nmodule.exports = {\n  createUserSchema,\n  updateUserSchema,\n};\n","const vendorService = require(\"./vendor.service\");\n\nconst createVendor = async (req, res) => {\n  const vendor = await vendorService.createVendor(req.body);\n  res.sendResponse(vendor, \"Vendor created successfully\");\n};\n\nconst getAllVendors = async (req, res) => {\n  const vendors = await vendorService.getAllVendors(req.query);\n  res.sendResponse(vendors);\n};\n\nconst getVendorById = async (req, res) => {\n  const vendor = await vendorService.getVendorById(req.params.id);\n  res.sendResponse(vendor);\n};\n\nconst updateVendor = async (req, res) => {\n  const vendor = await vendorService.updateVendor(req.params.id, req.body);\n  res.sendResponse(vendor, \"Vendor updated successfully\");\n};\n\nconst deleteVendor = async (req, res) => {\n  await vendorService.deleteVendor(req.params.id);\n  res.sendResponse(null, \"Vendor deleted successfully\");\n};\n\nmodule.exports = {\n  createVendor,\n  getAllVendors,\n  getVendorById,\n  updateVendor,\n  deleteVendor\n};","const router = require(\"express\").Router();\nconst asyncMiddleware = require(\"../../middlewares/asyncMiddleware\");\nconst vendorController = require(\"./vendor.controller\");\nconst validateRequest = require(\"../../middlewares/validateRequest\");\nconst { createVendorSchema, updateVendorSchema } = require(\"./vendor.validator\");\n\nrouter.post(\"/vendors\", validateRequest(createVendorSchema), asyncMiddleware(vendorController.createVendor));\nrouter.get(\"/vendors\", asyncMiddleware(vendorController.getAllVendors));\nrouter.get(\"/vendors/:id\", asyncMiddleware(vendorController.getVendorById));\nrouter.put(\"/vendors/:id\", validateRequest(updateVendorSchema), asyncMiddleware(vendorController.updateVendor));\nrouter.delete(\"/vendors/:id\", asyncMiddleware(vendorController.deleteVendor));\n\nmodule.exports = router;","const { Op } = require(\"sequelize\");\nconst db = require(\"./../../models\");\n\nconst createVendor = async (data) => {\n  return await db.Vendor.create(data);\n};\n\nconst getAllVendors = async (query = {}) => {\n  const { page = 1, limit = 10, search, isActive } = query;\n  const offset = (page - 1) * limit;\n\n  const where = {};\n  if (search) {\n    where[Op.or] = [\n      { name: { [Op.iLike]: `%${search}%` } },\n      { email: { [Op.iLike]: `%${search}%` } },\n    ];\n  }\n  if (isActive !== undefined) where.isActive = isActive;\n\n  //   return await db.Vendor.findAndCountAll({\n  //     where,\n  //     limit: +limit,\n  //     offset,\n  //     order: [['name', 'ASC']]\n  //   });\n  return await db.Vendor.findAll({\n    where,\n    limit: +limit,\n    offset,\n    order: [[\"name\", \"ASC\"]],\n  });\n};\n\nconst getVendorById = async (id) => {\n  return await db.Vendor.findByPk(id);\n};\n\nconst updateVendor = async (id, data) => {\n  const vendor = await db.Vendor.findByPk(id);\n  if (!vendor) throw new Error(\"Vendor not found\");\n  return await vendor.update(data);\n};\n\nconst deleteVendor = async (id) => {\n  const vendor = await db.Vendor.findByPk(id);\n  if (!vendor) throw new Error(\"Vendor not found\");\n  return await vendor.destroy();\n};\n\nmodule.exports = {\n  createVendor,\n  getAllVendors,\n  getVendorById,\n  updateVendor,\n  deleteVendor,\n};\n","const Joi = require(\"joi\");\n\nconst createVendorSchema = Joi.object({\n  name: Joi.string().min(2).max(100).required(),\n  email: Joi.string().email().required(),\n  contactPerson: Joi.string().required(),\n  phone: Joi.string().pattern(/^[\\+]?[(]?[0-9]{3}[)]?[-\\s\\.]?[0-9]{3}[-\\s\\.]?[0-9]{4,6}$/),\n  address: Joi.string().allow(null, \"\").max(500),\n  isActive: Joi.boolean().default(true)\n});\n\nconst updateVendorSchema = createVendorSchema.keys({\n  email: Joi.string().email()\n});\n\nmodule.exports = { createVendorSchema, updateVendorSchema };","const cloudinary = require('cloudinary').v2;\n\ncloudinary.config({\n    cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\n    api_key: process.env.CLOUDINARY_API_KEY,\n    api_secret: process.env.CLOUDINARY_API_SECRET,\n});\n\nmodule.exports = cloudinary;","const winston = require('winston');\n\nconst logger = winston.createLogger({\n  level: 'info',  // Lowest level of messages to log\n  format: winston.format.combine(\n    winston.format.timestamp({\n      format: 'YYYY-MM-DD HH:mm:ss'\n    }),\n    winston.format.json()\n  ),\n  transports: [\n    // Console transport for logging in the console\n    // new winston.transports.Console({\n    //   format: winston.format.combine(\n    //     winston.format.colorize(),\n    //     winston.format.simple()\n    //   )\n    // }),\n    // File transport for errors\n    new winston.transports.File({\n      filename: 'errors.log',\n      level: 'error',  // Only logs messages with level 'error'\n      format: winston.format.combine(\n        winston.format.timestamp({\n          format: 'YYYY-MM-DD HH:mm:ss'\n        }),\n        winston.format.json()\n      )\n    }),\n    // File transport for warnings\n    new winston.transports.File({\n      filename: 'warnings.log',\n      level: 'warn',  // Only logs messages with level 'warn'\n      format: winston.format.combine(\n        winston.format.timestamp({\n          format: 'YYYY-MM-DD HH:mm:ss'\n        }),\n        winston.format.json()\n      )\n    })\n  ],\n});\n\nmodule.exports = logger;","// roles.js\nmodule.exports = {\n  ADMIN: 1,\n  MECHANICAL_HEAD: 2,\n  MECHANICAL_MANAGER: 3,\n  SITE_INCHARGE: 4,\n  STORE_MANAGER: 5,\n  PROJECT_MANAGER: 6,\n};\n","module.exports = require(\"bcryptjs\");","module.exports = require(\"cloudinary\");","module.exports = require(\"cookie-parser\");","module.exports = require(\"cors\");","module.exports = require(\"dotenv\");","module.exports = require(\"express\");","module.exports = require(\"express-rate-limit\");","module.exports = require(\"helmet\");","module.exports = require(\"joi\");","module.exports = require(\"jsonwebtoken\");","module.exports = require(\"moment\");","module.exports = require(\"multer\");","module.exports = require(\"multer-storage-cloudinary\");","module.exports = require(\"node-cron\");","module.exports = require(\"sequelize\");","module.exports = require(\"sequelize-joi\");","module.exports = require(\"winston\");","module.exports = require(\"fs\");","module.exports = require(\"path\");","module.exports = require(\"process\");","module.exports = require(\"stream\");","module.exports = require(\"zlib\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const express = require(\"express\");\nconst cors = require(\"cors\");\nconst cookieParser = require(\"cookie-parser\");\nconst responseFormatter = require(\"./middlewares/responseFormatter\");\nconst errorHandler = require(\"./middlewares/errorHandler\");\nconst tokenValidator = require(\"./middlewares/tokenValidator\");\nconst helmet = require(\"helmet\");\nconst rateLimit = require(\"express-rate-limit\");\nrequire(\"dotenv\").config();\nconst Cron = require(\"node-cron\");\n\nconst transferRoutes = require(\"./src/machineTransfer/transfer.routes\");\nconst logbookRoutes = require(\"./src/logbook/logbook.routes\");\nconst materialRequisitionRoutes = require(\"./src/requisition/requisition.routes\");\nconst notificationRoutes = require(\"./src/notification/notification.routes\");\n\nconst startCronJobs = require(\"./src/cronJobs/index\");\nstartCronJobs();\n\nconst app = express();\nconst apiLimiter = rateLimit({\n  windowMs: 60 * 1000, // 15 minutes\n  // windowMs: 15 * 60 * 1000, // 15 minutes\n  max: 500, // Limit each IP to 100 requests per windowMs\n  standardHeaders: true, // Send rate limit info in `RateLimit-*` headers\n  legacyHeaders: false, // Disable the `X-RateLimit-*` headers\n  message: \"Too many requests from this IP, please try again later.\",\n});\n// app.use(\"/api\", apiLimiter);\napp.use(helmet());\napp.use(cookieParser());\napp.use(express.json());\n\napp.use(\n  cors({\n    origin: [\"http://localhost:5173\", \"https://erp.glimstarai.com\", \"https://bpc-erp.vercel.app\"], // Your frontend URL\n    credentials: true, // Allow cookies and headers to be sent\n    methods: [\"GET\", \"HEAD\", \"OPTIONS\", \"POST\", \"PUT\", \"DELETE\", \"PATCH\"], //\n  })\n);\n\n//External APIs\nCron.schedule(\"*/10 * * * *\", () => {\n  fetch(\"https://cpc-erp-server.onrender.com/test\", {\n    method: \"GET\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n  });\n});\napp.get(\"/test\", (req, res) => {\n  res.send(\"Hello world!\");\n});\napp.use(responseFormatter); // Response Formatter\napp.use(\"/api/auth/\", require(\"./src/auth/auth.routes\"));\n\napp.use(tokenValidator);\n\napp.use(\"/api/sites/\", require(\"./src/site/site.routes\"));\napp.use(\"/api/users/\", require(\"./src/user/user.routes\"));\napp.use(\"/api/machinery/\", require(\"./src/machinery/machinery.routes\"));\napp.use(\"/api/category/\", require(\"./src/category/category.routes\"));\napp.use(\n  \"/api/machinery-item-codes/\",\n  require(\"./src/machineryItemCode/machineryItemCode.routes\")\n);\napp.use(\"/api/\", [\n  transferRoutes,\n  logbookRoutes,\n  materialRequisitionRoutes,\n  notificationRoutes,\n  require(\"./src/ItemGroup/itemGroup.routes\"),\n  require(\"./src/Item/item.routes\"),\n  require(\"./src/Unit/unit.routes\"),\n  require(\"./src/procurement/procurement.routes\"),\n  require(\"./src/vendor/vendor.routes\"),\n  require(\"./src/invoice/invoice.routes\"),\n  require(\"./src/dashboard/dashboard.routes\"),\n  require(\"./src/reports/reports.routes\"),\n]);\napp.use(\n  \"/api/quotation-comparison/\",\n  require(\"./src/quotationComparison/quotationComparison.routes\")\n);\napp.use(\"/api/maintanance/\", require(\"./src/maintanance/maintanance.routes\"));\napp.use(\"/api/material-issues/\", require(\"./src/materialIssue/issue.routes\"));\napp.use(\"/api/inventory/\", require(\"./src/inventory/inventory.routes\"));\napp.use(\"/api/files/\", require(\"./src/file/file.routes\"));\n\n//Public Routes\n\n//--------ProtectedRoutes----------------------\n\napp.use(errorHandler);\nconst PORT = process.env.PORT || 3000;\napp.listen(PORT, () => {\n  console.log(`Server running on port ${PORT}`);\n});\n\n"],"names":["webpackEmptyContext","req","e","Error","code","keys","resolve","id","module","exports","map","webpackContext","webpackContextResolve","__webpack_require__","o","Object","prod","username","process","env","DB_USERNAME","password","DB_PASSWORD","database","DB_NAME","host","DB_HOST","dialect","DB_DIALECT","logging","dev","port","DB_PORT","dialectOptions","ssl","require","rejectUnauthorized","handler","async","res","next","err","multer","cloudinary","upload","storage","params","folder","allowedFormats","public_id","file","statusCode","sendError","Readable","config","cloud_name","CLOUDINARY_CLOUD_NAME","api_key","CLOUDINARY_API_KEY","api_secret","CLOUDINARY_API_SECRET","memoryStorage","uploadFileToCloudinary","field","oldFileUrl","publicId","split","pop","uploader","destroy","Promise","reject","stream","upload_stream","error","result","url","secure_url","from","buffer","pipe","fileUploadMiddleware","fileFields","subFolder","getExistingFiles","files","fileData","uploadPath","existingFiles","undefined","toArray","maybeArray","Array","isArray","uploadPromises","length","oldForField","forEach","idx","oldUrl","push","then","uploaded","all","aggregated","urls","status","send","message","allowedRoles","user","includes","roleId","name","zlib","handleCompression","response","acceptEncoding","headers","jsonResponse","JSON","stringify","gzip","compressedData","setHeader","sendResponse","data","timestamp","Date","toISOString","stack","details","jwt","db","token","cookies","decoded","verify","JWT_SECRET","User","findByPk","clearCookie","httpOnly","secure","sameSite","tokenProvided","validateRequest","schema","source","dataToValidate","validate","convert","abortEarly","detail","join","sequelize","DataTypes","Department","define","type","INTEGER","primaryKey","autoIncrement","STRING","allowNull","tableName","timestamps","paranoid","associate","models","belongsTo","foreignKey","hasMany","Site","Dispatch","vehicleNo","driverName","remarks","procurementId","fromSiteId","toSiteId","ENUM","defaultValue","Procurement","as","DispatchItem","dispatchId","itemId","quantity","Item","Invoice","invoiceNumber","unique","invoiceDate","DATE","amount","DECIMAL","JSONB","notes","TEXT","isInventoryUpdated","BOOLEAN","Payment","InvoiceItem","invoiceId","procurementItemId","rate","ProcurementItem","shortName","partNumber","hsnCode","itemGroupId","unitId","ItemGroup","Unit","SiteInventory","itemType","LogbookEntry","date","machineId","siteId","location","dieselOpeningBalance","FLOAT","dieselIssue","dieselClosingBalance","openingKmReading","closingKmReading","openingHrsMeter","closingHrsMeter","workingDetails","createdBy","totalRunKM","dieselAvgKM","totalRunHrsMeter","dieselAvgHrsMeter","approvedById","approvedAt","rejectedById","rejectedAt","rejectionRemarks","hooks","afterCreate","logbookEntry","options","newName","String","padStart","update","transaction","Machinery","MachineCategory","primaryCategoryId","averageBase","standardKmRun","standardMileage","standardHrsRun","ltrPerHour","useFor","machineType","unitPerHour","isApplicable","other","PrimaryCategory","onDelete","MachineServiceInterval","references","model","key","onUpdate","serviceType","intervalHours","intervalKm","intervalCalendarDays","isActive","MachineTransfer","currentSiteId","destinationSiteId","requestType","vehicleType","selfCarryingVehicle","reason","requestedBy","approvedBy","rejectedBy","dispatchedBy","receivedBy","requestedAt","dispatchedAt","receivedAt","transportDetails","scrapDetails","buyerDetails","itemsIncluded","itemsReceived","odometerReading","fuelGaugeReading","hrsMeter","dispatchRemarks","approveRemarks","finalRemarks","transfer","prefix","machineCategoryId","erpCode","registrationNumber","machineNumber","machineCode","chassisNumber","engineNumber","serialNumber","make","yom","purchaseDate","capacity","ownerName","ownerType","machineName","fitnessCertificateExpiry","motorVehicleTaxDue","permitExpiryDate","nationalPermitExpiry","insuranceExpiry","pollutionCertificateExpiry","fitnessCertificateFile","pollutionCertificateFile","insuranceFile","permitFile","nationalPermitFile","motorVehicleTaxFile","machineImageFile","totalHoursRun","totalKmRun","lastServiceDate","lastServiceAtkm","lastServiceAtHours","machine","newErpCode","MaintenanceLog","title","description","parts","cost","technician","hoursAtService","kilometersAtService","vendorAndPartsDetails","dueDate","estimatedHours","estimatedCost","priority","assignedTo","lastAlertDate","MaterialIssue","issueNumber","issueDate","NOW","issueType","otherSiteId","requisitionId","issuedById","issuedAt","consumedById","consumedAt","dispatchedById","receivedById","rejectionReason","issue","MaterialIssueItem","Requisition","materialIssueId","issueTo","Notification","eventType","eventAction","referenceId","isRead","belongsToMany","Role","through","NotificationRole","NotificationReadStatus","userId","notificationId","readAt","paymentDate","paymentMethod","referenceNumber","slipUrl","procurementNo","vendorId","expectedDelivery","totalAmount","quotationComparisonId","Vendor","QuotationComparison","requisitionItemId","receivedQuantity","RequisitionItem","comparisonNo","submittedById","submittedAt","submissionRemarks","approvalRemarks","lockRemarks","comparison","newCode","QuotationComparisonItem","QuotationComparisonVendor","QuotationComparisonVersion","comparisonId","unit","selectedVendorId","selected","QuotationComparisonRate","comparisonItemId","isLowest","vendorName","attachmentFilePath","attachmentUploadedAt","attachmentUploadedById","versionNumber","changes","changedById","changedAt","requisitionNo","requestingSiteId","requestedFor","chargeType","requestPriority","preparedById","completedById","completedAt","approvedByPM","approvedAtPM","approvedByHO","approvedAtHO","requisition","RequisitionSiteRejection","underscored","address","pincode","mobileNumber","departmentId","site","minimumLevel","lockedQuantity","StockLog","change","sourceType","sourceId","decimalPlaces","bcrypt","email","phone","imageUrl","set","value","this","setDataValue","hashSync","genSaltSync","prototype","validPassword","compare","hashPassword","contactPerson","fs","path","Sequelize","sequelizeJoi","Joi","basename","__filename","NODE_ENV","__dirname","use_env_variable","readdirSync","filter","indexOf","slice","modelContext","modelName","itemService","getAllItems","items","getItemById","item","createItem","body","updateItem","deleteItem","router","asyncMiddleware","itemController","createItemSchema","updateItemSchema","get","post","put","delete","Op","findAll","include","create","getAllItemsV2","page","limit","orderBy","orderDirection","search","filters","offset","whereClause","or","iLike","count","rows","findAndCountAll","where","order","currentPage","totalPages","Math","ceil","totalCount","object","string","min","max","required","allow","number","integer","positive","itemGroupService","getAllItemGroups","groups","getItemGroupById","group","createItemGroup","updateItemGroup","deleteItemGroup","itemGroupController","createItemGroupSchema","updateItemGroupSchema","getAllItemGroupsV2","unitService","getAllUnits","units","getUnitById","createUnit","updateUnit","deleteUnit","unitController","createUnitSchema","updateUnitSchema","getAllUnitsV2","generateToken","payload","sign","expiresIn","login","findOne","attributes","cookie","maxAge","role","image","department","logout","refreshToken","json","newToken","userid","checkToken","isAuthenticated","JwtTokenBlacklist","Router","contorller","loginSchema","messages","pattern","RegExp","categoryService","createPrimaryCategory","category","getAllPrimaryCategories","categories","getPrimaryCategoryById","updatePrimaryCategory","deletePrimaryCategory","createMachineCategory","getAllMachineCategories","getMachineCategoryById","updateMachineCategory","deleteMachineCategory","express","categoryController","CategorySchema","hasRole","createPrimaryCategorySchema","updatePrimaryCategorySchema","createMachineCategorySchema","updateMachineCategorySchema","getAllMachineCategoriesV2","sortBy","sortOrder","query","Number","trim","valid","array","cron","checkMachineryDocumentExpiry","checkLowAndOutOfStock","checkScheduledMaintenanceAlerts","checkMachineMaintenanceAlerts","schedule","console","log","moment","roles","EXPIRY_FIELDS","label","alreadyNotified","today","startOf","toDate","createdAt","gte","checkMachineryDocumentExpiries","upcomingDate","add","machineries","lte","expiryDate","isSameOrBefore","format","STORE_MANAGER","PROJECT_MANAGER","MECHANICAL_MANAGER","inventories","inv","setHours","getLatestLogEntry","getLatestMaintenanceLog","serviceIntervals","interval","latestLogEntry","latestMaintenanceLog","shouldAlert","alertType","alertMessage","alertTitle","currentHours","nextServiceHours","currentKm","nextServiceKm","nextServiceDate","setDate","getDate","nextServiceDateStr","intervalCreationDate","ADMIN","now","tomorrow","nextWeek","scheduledMaintenances","titlePrefix","scheduleDate","nowDate","tomorrowDate","getTime","checkMachineServiceIntervalAlerts","dueIntervals","intervalType","nextServiceValue","literal","intervalValue","dashboardService","getRelevantSiteId","getOverview","overview","getAlerts","alerts","getRecentActivities","activities","getMachineStatus","machineStatus","getSitesSummary","sitesSummary","getInventoryAlerts","inventoryAlerts","getMaintenanceDue","maintenanceDue","getProcurementPending","procurementPending","getPaymentsOutstanding","paymentsOutstanding","getExpensesMonthly","expensesMonthly","getSiteOverview","getSiteRequisitions","requisitions","getSiteMaterialIssues","materialIssues","getSiteTransfers","transfers","getSiteInventoryAlerts","getSiteMachineAlerts","getSiteMachineStatus","getSiteInventoryStatus","inventoryStatus","getSiteMaintenanceDue","getSiteExpenses","expenses","getSiteInfo","siteInfo","dashboardController","dashboardFiltersSchema","dateRange","dateFilter","startDate","endDate","between","totalMachines","activeMachines","totalSites","activeSites","pendingRequisitions","pendingTransfers","lowStockItems","outstandingInvoices","in","machineStatusBreakdown","fn","col","thirtyDaysFromNow","certificateExpiries","lowStockAlerts","pendingApprovals","maintenanceOverdue","lt","recentRequisitions","recentTransfers","recentIssues","recentMaintenance","categoryId","statusBreakdown","siteWiseBreakdown","categoryWiseBreakdown","parseInt","getDataValue","totalUsers","severity","days","futureDate","procurements","totalValue","sum","totalOutstanding","reduce","invoice","paidAmount","payments","pSum","payment","parseFloat","invoices","months","setMonth","getMonth","procurementExpenses","maintenanceExpenses","totalInventoryItems","outOfStockItems","activeUsers","inventory","totalItems","machines","personnel","requisitionStats","pendingCount","pendingIssues","transferStats","outOfStockAlerts","approachingMinimumAlerts","lowStock","outOfStock","approachingMinimum","alertDate","insuranceExpiries","permitExpiries","inventoryOverview","optional","notification","setRoles","FileService","uploadFile","fileName","deleteFile","FileController","single","directory","use_filename","unique_filename","resource_type","fileUrl","inventoryService","createInventory","updateInventory","deleteInventory","getInventoryById","getAllInventories","getAggregatedInventoryForAdmin","getInventoryDetailsByItemId","inventoryDetails","inventoryDetailsByItemId","getInventoryBySiteId","getItemGroupsAndItemsBySiteId","getStockLogsByItem","logs","getStockStatusBulk","itemIds","stockStatus","getStockLogReference","inventoryController","createInventorySchema","updateInventorySchema","existing","save","reference","toSite","po","dateTime","availableQuantity","issueItem","machinery","reqItem","poItem","raw","nest","precision","invoiceService","createInvoice","parse","createPayment","acceptInvoice","invoiceController","createInvoiceSchema","updateInvoiceSchema","createPaymentSchema","fields","maxCount","findOrCreate","defaults","newQuantity","procurementItem","increment","by","every","commit","rollback","totalPaid","virtualSite","uri","ROLES","createNotification","createEntry","entry","fullEntry","allEntry","entries","entryDetails","updateEntry","updated","deleteEntry","allEntryV2","allMachines","subQuery","approveEntry","t","SITE_INCHARGE","rejectEntry","logbookController","TransferService","requestTransfer","approveTranfer","dispatchMachine","vehicleNumber","transferData","receiveMachine","transferHistory","transferHistoryOfMachine","history","rejectTransfer","dispachtedList","approvedList","getTransferById","transferController","siteDetail","currentSite","destinationSite","MECHANICAL_HEAD","userSiteId","updatedData","assign","machineryService","createMachinery","machineryData","getAllMachinery","machineryList","searchQuery","activity","getMachineryById","updateMachinery","deleteMachinery","restoreMachinery","getMachineryLogEntries","machineryController","createMachinerySchema","updateMachinerySchema","CustomError","constructor","super","original","sqlMessage","likeQuery","like","getAllMachineryV2","machineryId","sums","dataValues","machineryUpdates","toJSON","getFullYear","iso","boolean","default","any","machineryItemCodeService","createMachineryItemCode","itemCode","getAllMachineryItemCodes","itemCodes","getMachineryItemCodeById","updateMachineryItemCode","deleteMachineryItemCode","restoreMachineryItemCode","machineryItemCodeController","schemas","createMachineryItemCodeSchema","updateMachineryItemCodeSchema","MachineryItemCode","restore","machineServiceIntervalService","getMachineServiceIntervals","intervals","getMachineServiceIntervalById","createMachineServiceInterval","updateMachineServiceInterval","deleteMachineServiceInterval","getDueMachineServiceIntervals","calculateNextServiceForMachine","machineServiceIntervalController","createMachineServiceIntervalSchema","updateMachineServiceIntervalSchema","lastServiceValue","results","isDue","currentValue","remaining","latestLogbook","maintananceService","getMaintenanceLogById","createMaintenanceLog","updateMaintenanceLog","getMaintenanceLogsByMachine","getScheduledMaintenanceById","scheduled","createScheduledMaintenance","updateScheduledMaintenance","completeScheduledMaintenance","getScheduledMaintenancesByMachine","schedules","getMaintenanceStatsByMachine","stats","getLastMaintenanceByMachine","lastMaintenance","getNextMaintenanceByMachine","nextMaintenance","getMaintenanceAlerts","getMaintenanceSummaryByMachine","summary","maintananceController","createMaintenanceLogSchema","updateMaintenanceLogSchema","createScheduledMaintenanceSchema","updateScheduledMaintenanceSchema","machineServiceIntervalRoutes","use","weekLater","alert","toDateString","alertStatus","totalMaintenanceCount","overdueCount","startOfYear","totalRecords","nextScheduled","totalCostYTD","typeCounts","counts","repair","preventive","inspection","oil_change","parts_replacement","lastMaintenanceDate","nextScheduledDate","toFixed","service","createMaterialIssue","getMaterialIssueById","getAllMaterialIssues","getMaterialIssuesBySite","approveMaterialIssue","issueId","dispatchMaterialIssue","receiveMaterialIssue","issueForConsumption","rejectMaterialIssue","controller","createMaterialIssueSchema","issueData","itemData","bulkCreate","fromSite","createdById","fromInventory","toInventory","issueItems","issueItemSchema","notificationService","getAllNotifications","notifications","getNotificationsForUser","markAsRead","markNotificationAsRead","markAllAsRead","markAllNotificationsAsRead","notificationController","n","read","readStatuses","readStatus","created","readStatusData","ignoreDuplicates","procurementService","createProcurement","procurement","getProcurement","getProcurementById","updateStatus","updateProcurementStatus","listProcurements","updatePayment","updatePaymentStatus","getSummary","getProcurementSummary","getInventoryMovement","movement","getRequisitionWithRemainingItems","deleteProcurement","createFromComparison","selections","createProcurementsFromComparison","procurementController","createProcurementSchema","updateStatusSchema","listProcurementsSchema","updatePaymentSchema","generateProcurementNo","toString","calculateStockStatus","ProcurementItems","paymentData","isPaid","paymentStatus","statusCounts","monthlySpending","topVendors","statusDistribution","procuredQuantities","Map","issuedQuantities","currentQty","materialIssue","remainingItems","originalQty","procuredQty","issuedQty","remainingQty","originalQuantity","procuredQuantity","issuedQuantity","preparedBy","requestingSite","fullyFulfilledItems","mainSite","targetVendorId","itemsByVendor","currentSelectionId","rateRecord","rates","find","r","createdProcurements","quotationComparisonService","createComparison","getComparison","getComparisonWithDetails","addVendor","vendor","addVendorToComparison","updateRate","selectVendorForItem","selectVendorForAllItems","selectVendors","bulkSelectVendors","submitComparison","approveComparison","lockComparison","getComparisonsForRequisition","comparisons","getAllComparisons","removeVendor","removeVendorFromComparison","removeItem","bulkUpdate","quantities","deleteComparison","uploadVendorAttachment","success","attachmentData","uploadedById","attachment","getVendorAttachments","attachments","deleteAttachment","downloadAttachment","getAttachmentById","redirect","quotationComparisonController","auth","createQuotationComparisonSchema","addVendorSchema","updateRateSchema","selectVendorForItemSchema","selectVendorForAllItemsSchema","selectVendorsSchema","submitComparisonSchema","approveComparisonSchema","lockComparisonSchema","bulkUpdateSchema","removeVendorSchema","getRequisitionComparisonsSchema","deleteComparisonSchema","getVendorAttachmentsSchema","deleteAttachmentSchema","downloadAttachmentSchema","calculateTotalsAndLowestRates","comparisonItem","vendorTotals","lowestRate","sort","a","b","total","overallTotal","lowest","rateData","quantityData","ratesForItem","newAmount","comparisonVendor","attachmentFileName","attachmentFileSize","attachmentMimeType","getAttachmentByVendorId","regex","updateComparisonStatusSchema","listComparisonsSchema","updateItemQuantitySchema","removeItemSchema","uploadVendorAttachmentSchema","reportsService","getMachineUtilization","report","getMachineMaintenanceReport","getMachineTransferReport","getMachineComplianceReport","getLogbookReport","getInventoryStockReport","getInventoryConsumptionReport","getInventoryTransferReport","getInventoryValuationReport","getProcurementSummaryReport","getProcurementVendorReport","getPaymentStatusReport","getInvoiceAgingReport","getSitePerformanceReport","getRequisitionAnalysisReport","getUserActivityReport","getAssetDepreciationReport","getMaintenanceCostAnalysis","getFuelConsumptionReport","getVendorPerformanceReport","reportsController","reportsFiltersSchema","logbookEntries","utilizationData","runningHours","runningKM","dieselConsumption","efficiency","totalEntries","totalRunningHours","totalRunningKM","totalDieselConsumption","averageEfficiency","maintenanceLogs","totalMaintenance","totalCost","completedMaintenance","pendingMaintenance","scheduledMaintenance","byType","totalTransfers","byStatus","averageProcessingTime","expiring_within_days","currentDate","complianceData","compliance","expiring","expired","expiry","daysOverdue","floor","daysUntilExpiry","machinesWithExpiredDocs","machinesWithExpiringDocs","totalExpiredDocs","totalExpiringDocs","totalDieselConsumed","totalKMRun","averageDieselEfficiency","validEntries","and","consumptionLogs","consumptionByItem","totalConsumed","transactions","abs","totalTransactions","totalItemsConsumed","totalQuantityConsumed","byItem","totalItemsTransferred","valuationData","totalQuantity","lowStockValue","totalProcurements","proc","byVendor","vendorPerformance","totalOrders","onTimeDeliveries","pendingOrders","completedOrders","vp","values","totalVendors","totalPayments","byMethod","method","agingData","daysOld","remainingAmount","agingBucket","isOverdue","totalInvoices","overdueAmount","agingBuckets","bucket","sites","performanceData","requisitionWhere","issueWhere","logbookWhere","metrics","Machineries","m","Users","totalRequisitions","approvedRequisitions","totalMaterialIssues","totalLogbookEntries","byPriority","bySite","siteName","processingTime","activityType","UserActivity","totalActivities","uniqueUsers","Set","byActivityType","byUser","userName","assetType","assets","depreciationData","asset","ageInYears","originalValue","purchaseValue","depreciatedValue","totalDepreciation","depreciationRate","round","totalAssets","totalOriginalValue","totalCurrentValue","averageAge","maintenanceType","costByMachine","maintenanceCount","avgCostPerMaintenance","totalMaintenanceRecords","averageCostPerMaintenance","machinesWithMaintenance","highestCostMachine","lowestCostMachine","machineData","curr","consumptionByMachine","totalFuelConsumed","avgFuelPerKM","avgFuelPerHour","machinesTracked","cancelledOrders","averageOrderValue","onTimeDeliveryRate","qualityScore","perf","random","p","topPerformer","vendorData","when","is","exist","ref","otherwise","unknown","requisitionService","createRequisition","getRequisitionById","getAllRequisitions","approveRequisition","pmApproveRequisition","hoApproveRequisition","requisitionDelete","completeRequisition","rejectRequisition","rejectRequisitionBySite","rejection","getRequisitionRejections","rejections","updateItemQuantity","requisitionController","createRequisitionSchema","userDetail","reqData","includeOptions","whereOptions","notIn","rejectionData","userWithSite","requisitionItem","requisitionItemSchema","siteService","createSite","getAllSites","getSiteById","getVirtualSite","updateSite","deleteSite","restoreSite","getSiteInventoryMovement","getSiteSummaryStats","getDiscrepancyReport","discrepancies","getVirtualSiteProcurementSummary","dispatchProcurementItems","getIncomingDispatches","dispatches","receiveDispatch","siteController","SiteSchema","createSiteSchema","updateSiteSchema","deletedAt","getAllSitesV2","groupAttributes","groupedLogs","sourceDescription","destinationDescription","logData","plain","dispatch","reqSiteName","totalOut","totalIn","inDates","firstInDate","outDates","firstOutDate","inMovements","outMovements","currentInventory","inCount","outCount","inTransactionCount","outTransactionCount","netMovement","allLogs","itemMovements","inTotal","outTotal","net","procurementMap","orderedProcurementIds","dispatchedItems","procurementDate","Dispatches","dItem","virtualSiteId","virtualSiteName","procurementMovements","activeProcurements","virtualInventory","decrement","userService","createUser","getAllUsers","users","getUserById","updateUser","deleteUser","restoreUser","userController","userSchema","createUserSchema","updateUserSchema","userData","exclude","whereCondition","updateData","getAllUsersV2","vendorService","createVendor","getAllVendors","vendors","getVendorById","updateVendor","deleteVendor","vendorController","createVendorSchema","updateVendorSchema","winston","logger","createLogger","level","combine","transports","File","filename","__webpack_module_cache__","moduleId","cachedModule","__webpack_modules__","obj","prop","hasOwnProperty","call","cors","cookieParser","responseFormatter","errorHandler","tokenValidator","helmet","rateLimit","Cron","transferRoutes","logbookRoutes","materialRequisitionRoutes","notificationRoutes","startCronJobs","app","windowMs","standardHeaders","legacyHeaders","origin","credentials","methods","fetch","PORT","listen"],"sourceRoot":""}